{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/MacBook-Dev/package/mimisalon-pet-web/src/lib/env.ts"],"sourcesContent":["/**\n * Environment Variable Validation\n *\n * Provides type-safe runtime validation for all environment variables\n * using @t3-oss/env-nextjs and Zod schemas.\n *\n * Usage:\n * ```typescript\n * import { env } from '@/lib/env';\n *\n * // Server-side\n * const dbUrl = env.DATABASE_URL;\n *\n * // Client-side\n * const apiKey = env.NEXT_PUBLIC_KAKAO_MAP_KEY;\n * ```\n *\n * Features:\n * - Runtime validation with helpful error messages\n * - TypeScript autocomplete and type safety\n * - Separate server and client validation\n * - Build-time validation to catch issues early\n */\n\nimport { createEnv } from '@t3-oss/env-nextjs'\nimport { z } from 'zod'\n\nexport const env = createEnv({\n  /**\n   * Server-side environment variables\n   * These are only available on the server and never exposed to the client\n   */\n  server: {\n    // ===================================================\n    // Node Environment\n    // ===================================================\n    NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),\n\n    // ===================================================\n    // Database Configuration\n    // ===================================================\n    DATABASE_URL: z.string().url().describe('PostgreSQL database connection string'),\n\n    // ===================================================\n    // Authentication (better-auth)\n    // ===================================================\n    BETTER_AUTH_SECRET: z.string().min(32).describe('Auth secret key for session encryption'),\n    BETTER_AUTH_URL: z\n      .string()\n      .url()\n      .default('http://localhost:3000')\n      .describe('Application base URL'),\n    AUTH_SECRET: z\n      .string()\n      .min(1)\n      .optional()\n      .describe('Deprecated: Use BETTER_AUTH_SECRET instead'),\n    AUTH_TRUST_HOST: z\n      .string()\n      .transform((val) => val === 'true')\n      .optional(),\n    AUTH_URL: z.string().url().optional().describe('Deprecated: Use BETTER_AUTH_URL instead'),\n\n    // ===================================================\n    // Email Configuration (SMTP)\n    // ===================================================\n    SMTP_HOST: z.string().min(1).describe('SMTP server hostname'),\n    SMTP_PORT: z.coerce.number().int().min(1).max(65535).describe('SMTP server port'),\n    SMTP_USERNAME: z.string().email().describe('SMTP authentication username'),\n    SMTP_PASSWORD: z.string().min(1).describe('SMTP authentication password'),\n\n    // ===================================================\n    // Twilio Configuration (SMS & Phone Verification)\n    // ===================================================\n    TWILIO_ACCOUNT_SID: z.string().min(1).describe('Twilio Account SID'),\n    TWILIO_AUTH_TOKEN: z.string().min(1).describe('Twilio Auth Token'),\n    TWILIO_VERIFY_SERVICE_SID: z.string().min(1).describe('Twilio Verify Service SID'),\n    TWILIO_PHONE_NUMBER: z\n      .string()\n      .regex(/^\\+\\d{1,15}$/, 'Must be E.164 format')\n      .describe('Twilio phone number in E.164 format'),\n\n    // ===================================================\n    // PortOne Payment Configuration\n    // ===================================================\n    PORTONE_API_SECRET: z.string().min(1).describe('PortOne API secret for partner settlement'),\n    PORTONE_CHANNEL_KEY: z.string().min(1).describe('PortOne channel key'),\n    PORTONE_STORE_ID: z.string().min(1).describe('PortOne store ID'),\n    PORTONE_API_BASE_URL: z.string().url().default('https://api.portone.io'),\n    PORTONE_WEBHOOK_SECRET: z\n      .string()\n      .min(1)\n      .optional()\n      .describe('PortOne webhook secret for signature verification'),\n    PORTONE_PLATFORM_ENABLED: z\n      .string()\n      .transform((val) => val === 'true')\n      .optional(),\n    PORTONE_DEFAULT_CONTRACT_ID: z.string().optional(),\n\n    // ===================================================\n    // Settlement Configuration\n    // ===================================================\n    SETTLEMENT_COMMISSION_RATE: z.coerce.number().min(0).max(100).default(10),\n\n    // ===================================================\n    // Google Cloud Storage (GCS)\n    // ===================================================\n    GCS_PROJECT_ID: z.string().min(1).describe('Google Cloud project ID'),\n    GOOGLE_APPLICATION_CREDENTIALS: z\n      .string()\n      .optional()\n      .describe('Path to service account JSON key (local dev only)'),\n    GCS_APP_BUCKET: z.string().min(1).describe('GCS bucket name for application files'),\n\n    // ===================================================\n    // Kakao API (Server-side)\n    // ===================================================\n    KAKAO_REST_API_KEY: z.string().min(1).describe('Kakao REST API key for geocoding'),\n\n    // ===================================================\n    // Firebase Configuration (Push Notifications)\n    // ===================================================\n    FIREBASE_PROJECT_ID: z.string().optional(),\n    FIREBASE_CLIENT_EMAIL: z.string().email().optional(),\n    FIREBASE_PRIVATE_KEY: z.string().optional(),\n\n    // ===================================================\n    // Expo Push Notifications\n    // ===================================================\n    EXPO_ACCESS_TOKEN: z.string().optional().describe('Expo access token for push notifications'),\n\n    // ===================================================\n    // JIRA Error Reporting\n    // ===================================================\n    JIRA_DOMAIN: z.string().optional().describe('JIRA domain for error reporting'),\n    JIRA_EMAIL: z.string().email().optional().describe('JIRA authentication email'),\n    JIRA_API_TOKEN: z.string().optional().describe('JIRA API token'),\n    JIRA_PROJECT_KEY: z.string().optional().describe('JIRA project key'),\n\n    // ===================================================\n    // Winston Logging Configuration\n    // ===================================================\n    LOG_LEVEL: z.enum(['error', 'warn', 'info', 'debug']).default('info'),\n    LOG_DIR: z.string().default('logs'),\n    LOG_MAX_SIZE: z.string().default('20m').describe('Maximum log file size before rotation'),\n    LOG_MAX_FILES: z.string().default('14d').describe('Keep logs for specified duration'),\n\n    // ===================================================\n    // BullMQ Queue Configuration (Optional)\n    // ===================================================\n    BULLMQ_NOTIFICATION_CONCURRENCY: z.coerce.number().int().min(1).optional(),\n    BULLMQ_EMAIL_CONCURRENCY: z.coerce.number().int().min(1).optional(),\n    BULLMQ_CLEANUP_CONCURRENCY: z.coerce.number().int().min(1).optional(),\n    BULLMQ_EMAIL_RATE_LIMIT: z.coerce.number().int().min(1).optional(),\n    BULLMQ_NOTIFICATION_RATE_LIMIT: z.coerce.number().int().min(1).optional(),\n    BULLMQ_MAX_COMPLETED_JOBS: z.coerce.number().int().min(1).optional(),\n    BULLMQ_MAX_FAILED_JOBS: z.coerce.number().int().min(1).optional(),\n    BULLMQ_EMAIL_MAX_ATTEMPTS: z.coerce.number().int().min(1).optional(),\n    BULLMQ_EMAIL_RETRY_DELAY: z.coerce.number().int().min(0).optional(),\n    BULLMQ_CLEANUP_MAX_ATTEMPTS: z.coerce.number().int().min(1).optional(),\n    BULLMQ_CLEANUP_RETRY_DELAY: z.coerce.number().int().min(0).optional(),\n    BULLMQ_ENABLE_LEADER_ELECTION: z\n      .string()\n      .transform((val) => val === 'true')\n      .optional(),\n    BULLMQ_LEADER_TTL: z.coerce.number().int().min(1000).optional(),\n    BULLMQ_LEADER_HEARTBEAT: z.coerce.number().int().min(1000).optional(),\n    BULLMQ_LEADER_RETRY_INTERVAL: z.coerce.number().int().min(1000).optional(),\n    BULLMQ_VERBOSE_LOGGING: z\n      .string()\n      .transform((val) => val === 'true')\n      .optional(),\n    BULLMQ_ENABLE_METRICS: z\n      .string()\n      .transform((val) => val === 'true')\n      .optional(),\n\n    // ===================================================\n    // OAuth Providers (Optional)\n    // ===================================================\n    GOOGLE_CLIENT_ID: z.string().optional().describe('Google OAuth client ID'),\n    GOOGLE_CLIENT_SECRET: z.string().optional().describe('Google OAuth client secret'),\n\n    // ===================================================\n    // API Configuration\n    // ===================================================\n    API_BASE_URL: z.string().url().optional().describe('Backend API base URL'),\n\n    // ===================================================\n    // Webhook & Security Configuration\n    // ===================================================\n    PORTONE_WEBHOOK_ALLOWED_IPS: z\n      .string()\n      .optional()\n      .default('52.78.100.19,52.78.48.223,52.78.5.241,127.0.0.1,::1')\n      .describe('Comma-separated list of allowed IPs for PortOne webhooks'),\n\n    // ===================================================\n    // Scheduled Jobs & Cron\n    // ===================================================\n    CRON_SECRET: z\n      .string()\n      .optional()\n      .describe('Secret for authenticating cron job requests - REQUIRED in production'),\n    SCHEDULER_API_KEY: z\n      .string()\n      .optional()\n      .describe('API key for notification scheduler endpoints'),\n    QUEUE_HEALTH_TOKEN: z\n      .string()\n      .optional()\n      .describe('Authentication token for queue health check endpoint'),\n\n    // ===================================================\n    // Build & Runtime\n    // ===================================================\n    NEXT_PHASE: z.string().optional().describe('Next.js build phase identifier'),\n    npm_package_version: z.string().optional().default('1.0.0').describe('Application version'),\n  },\n\n  /**\n   * Client-side environment variables (NEXT_PUBLIC_*)\n   * These are exposed to the browser and must be prefixed with NEXT_PUBLIC_\n   */\n  client: {\n    // ===================================================\n    // Kakao Map API (Client-side)\n    // ===================================================\n    NEXT_PUBLIC_KAKAO_MAP_KEY: z.string().optional().describe('Kakao Map JavaScript API key'),\n\n    // ===================================================\n    // PortOne (Client-side)\n    // ===================================================\n    // Optional for runtime injection via /api/env endpoint\n    NEXT_PUBLIC_PORTONE_CHANNEL_KEY: z\n      .string()\n      .optional()\n      .describe('PortOne channel key for checkout (runtime injected)'),\n    NEXT_PUBLIC_PORTONE_STORE_ID: z\n      .string()\n      .optional()\n      .describe('PortOne store ID for checkout (runtime injected)'),\n\n    // ===================================================\n    // Customer Service\n    // ===================================================\n    NEXT_PUBLIC_CUSTOMER_SERVICE_PHONE: z\n      .string()\n      .default('+82-10-4043-9775')\n      .describe('Customer service phone number'),\n    NEXT_PUBLIC_CUSTOMER_SERVICE_EMAIL: z\n      .string()\n      .email()\n      .default('koobg@mimisalon.pet')\n      .describe('Customer service email'),\n\n    // ===================================================\n    // Client-side Logging\n    // ===================================================\n    NEXT_PUBLIC_LOGGING_ENABLED: z\n      .string()\n      .default('true')\n      .transform((val) => val === 'true')\n      .describe('Enable client-side error logging'),\n  },\n\n  /**\n   * Runtime environment variable mapping\n   * You can't destruct `process.env` as a regular object in Next.js edge runtime\n   * so we need to manually map each variable\n   */\n  runtimeEnv: {\n    // Node Environment\n    NODE_ENV: process.env.NODE_ENV,\n\n    // Database\n    DATABASE_URL: process.env.DATABASE_URL,\n\n    // Authentication\n    BETTER_AUTH_SECRET: process.env.BETTER_AUTH_SECRET,\n    BETTER_AUTH_URL: process.env.BETTER_AUTH_URL,\n    AUTH_SECRET: process.env.AUTH_SECRET,\n    AUTH_TRUST_HOST: process.env.AUTH_TRUST_HOST,\n    AUTH_URL: process.env.AUTH_URL,\n\n    // Email\n    SMTP_HOST: process.env.SMTP_HOST,\n    SMTP_PORT: process.env.SMTP_PORT,\n    SMTP_USERNAME: process.env.SMTP_USERNAME,\n    SMTP_PASSWORD: process.env.SMTP_PASSWORD,\n\n    // Twilio\n    TWILIO_ACCOUNT_SID: process.env.TWILIO_ACCOUNT_SID,\n    TWILIO_AUTH_TOKEN: process.env.TWILIO_AUTH_TOKEN,\n    TWILIO_VERIFY_SERVICE_SID: process.env.TWILIO_VERIFY_SERVICE_SID,\n    TWILIO_PHONE_NUMBER: process.env.TWILIO_PHONE_NUMBER,\n\n    // PortOne\n    PORTONE_API_SECRET: process.env.PORTONE_API_SECRET,\n    PORTONE_CHANNEL_KEY: process.env.PORTONE_CHANNEL_KEY,\n    PORTONE_STORE_ID: process.env.PORTONE_STORE_ID,\n    PORTONE_API_BASE_URL: process.env.PORTONE_API_BASE_URL,\n    PORTONE_WEBHOOK_SECRET: process.env.PORTONE_WEBHOOK_SECRET,\n    PORTONE_PLATFORM_ENABLED: process.env.PORTONE_PLATFORM_ENABLED,\n    PORTONE_DEFAULT_CONTRACT_ID: process.env.PORTONE_DEFAULT_CONTRACT_ID,\n    NEXT_PUBLIC_PORTONE_CHANNEL_KEY: process.env.NEXT_PUBLIC_PORTONE_CHANNEL_KEY,\n    NEXT_PUBLIC_PORTONE_STORE_ID: process.env.NEXT_PUBLIC_PORTONE_STORE_ID,\n\n    // Settlement\n    SETTLEMENT_COMMISSION_RATE: process.env.SETTLEMENT_COMMISSION_RATE,\n\n    // Google Cloud Storage\n    GCS_PROJECT_ID: process.env.GCS_PROJECT_ID,\n    GOOGLE_APPLICATION_CREDENTIALS: process.env.GOOGLE_APPLICATION_CREDENTIALS,\n    GCS_APP_BUCKET: process.env.GCS_APP_BUCKET,\n\n    // Kakao\n    KAKAO_REST_API_KEY: process.env.KAKAO_REST_API_KEY,\n    NEXT_PUBLIC_KAKAO_MAP_KEY: process.env.NEXT_PUBLIC_KAKAO_MAP_KEY,\n\n    // Firebase\n    FIREBASE_PROJECT_ID: process.env.FIREBASE_PROJECT_ID,\n    FIREBASE_CLIENT_EMAIL: process.env.FIREBASE_CLIENT_EMAIL,\n    FIREBASE_PRIVATE_KEY: process.env.FIREBASE_PRIVATE_KEY,\n\n    // Expo\n    EXPO_ACCESS_TOKEN: process.env.EXPO_ACCESS_TOKEN,\n\n    // JIRA\n    JIRA_DOMAIN: process.env.JIRA_DOMAIN,\n    JIRA_EMAIL: process.env.JIRA_EMAIL,\n    JIRA_API_TOKEN: process.env.JIRA_API_TOKEN,\n    JIRA_PROJECT_KEY: process.env.JIRA_PROJECT_KEY,\n\n    // Logging\n    LOG_LEVEL: process.env.LOG_LEVEL,\n    LOG_DIR: process.env.LOG_DIR,\n    LOG_MAX_SIZE: process.env.LOG_MAX_SIZE,\n    LOG_MAX_FILES: process.env.LOG_MAX_FILES,\n    NEXT_PUBLIC_LOGGING_ENABLED: process.env.NEXT_PUBLIC_LOGGING_ENABLED,\n\n    // BullMQ\n    BULLMQ_NOTIFICATION_CONCURRENCY: process.env.BULLMQ_NOTIFICATION_CONCURRENCY,\n    BULLMQ_EMAIL_CONCURRENCY: process.env.BULLMQ_EMAIL_CONCURRENCY,\n    BULLMQ_CLEANUP_CONCURRENCY: process.env.BULLMQ_CLEANUP_CONCURRENCY,\n    BULLMQ_EMAIL_RATE_LIMIT: process.env.BULLMQ_EMAIL_RATE_LIMIT,\n    BULLMQ_NOTIFICATION_RATE_LIMIT: process.env.BULLMQ_NOTIFICATION_RATE_LIMIT,\n    BULLMQ_MAX_COMPLETED_JOBS: process.env.BULLMQ_MAX_COMPLETED_JOBS,\n    BULLMQ_MAX_FAILED_JOBS: process.env.BULLMQ_MAX_FAILED_JOBS,\n    BULLMQ_EMAIL_MAX_ATTEMPTS: process.env.BULLMQ_EMAIL_MAX_ATTEMPTS,\n    BULLMQ_EMAIL_RETRY_DELAY: process.env.BULLMQ_EMAIL_RETRY_DELAY,\n    BULLMQ_CLEANUP_MAX_ATTEMPTS: process.env.BULLMQ_CLEANUP_MAX_ATTEMPTS,\n    BULLMQ_CLEANUP_RETRY_DELAY: process.env.BULLMQ_CLEANUP_RETRY_DELAY,\n    BULLMQ_ENABLE_LEADER_ELECTION: process.env.BULLMQ_ENABLE_LEADER_ELECTION,\n    BULLMQ_LEADER_TTL: process.env.BULLMQ_LEADER_TTL,\n    BULLMQ_LEADER_HEARTBEAT: process.env.BULLMQ_LEADER_HEARTBEAT,\n    BULLMQ_LEADER_RETRY_INTERVAL: process.env.BULLMQ_LEADER_RETRY_INTERVAL,\n    BULLMQ_VERBOSE_LOGGING: process.env.BULLMQ_VERBOSE_LOGGING,\n    BULLMQ_ENABLE_METRICS: process.env.BULLMQ_ENABLE_METRICS,\n\n    // OAuth\n    GOOGLE_CLIENT_ID: process.env.GOOGLE_CLIENT_ID,\n    GOOGLE_CLIENT_SECRET: process.env.GOOGLE_CLIENT_SECRET,\n\n    // API\n    API_BASE_URL: process.env.API_BASE_URL,\n\n    // Webhook & Security\n    PORTONE_WEBHOOK_ALLOWED_IPS: process.env.PORTONE_WEBHOOK_ALLOWED_IPS,\n\n    // Scheduled Jobs & Cron\n    CRON_SECRET: process.env.CRON_SECRET,\n    SCHEDULER_API_KEY: process.env.SCHEDULER_API_KEY,\n    QUEUE_HEALTH_TOKEN: process.env.QUEUE_HEALTH_TOKEN,\n\n    // Build & Runtime\n    NEXT_PHASE: process.env.NEXT_PHASE,\n    npm_package_version: process.env.npm_package_version,\n\n    // Customer Service\n    NEXT_PUBLIC_CUSTOMER_SERVICE_PHONE: process.env.NEXT_PUBLIC_CUSTOMER_SERVICE_PHONE,\n    NEXT_PUBLIC_CUSTOMER_SERVICE_EMAIL: process.env.NEXT_PUBLIC_CUSTOMER_SERVICE_EMAIL,\n  },\n\n  /**\n   * Skip validation during build\n   * This allows the build to succeed even if some optional variables are missing\n   */\n  skipValidation: !!process.env.SKIP_ENV_VALIDATION,\n\n  /**\n   * Emit validation errors with helpful messages\n   */\n  emptyStringAsUndefined: true,\n})\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;;;;;;;CAsBC;;;;AAED;AACA;;;AAEO,MAAM,MAAM,IAAA,4KAAS,EAAC;IAC3B;;;GAGC,GACD,QAAQ;QACN,sDAAsD;QACtD,mBAAmB;QACnB,sDAAsD;QACtD,UAAU,oLAAC,CAAC,IAAI,CAAC;YAAC;YAAe;YAAc;SAAO,EAAE,OAAO,CAAC;QAEhE,sDAAsD;QACtD,yBAAyB;QACzB,sDAAsD;QACtD,cAAc,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,CAAC;QAExC,sDAAsD;QACtD,+BAA+B;QAC/B,sDAAsD;QACtD,oBAAoB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,IAAI,QAAQ,CAAC;QAChD,iBAAiB,oLAAC,CACf,MAAM,GACN,GAAG,GACH,OAAO,CAAC,yBACR,QAAQ,CAAC;QACZ,aAAa,oLAAC,CACX,MAAM,GACN,GAAG,CAAC,GACJ,QAAQ,GACR,QAAQ,CAAC;QACZ,iBAAiB,oLAAC,CACf,MAAM,GACN,SAAS,CAAC,CAAC,MAAQ,QAAQ,QAC3B,QAAQ;QACX,UAAU,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAE/C,sDAAsD;QACtD,6BAA6B;QAC7B,sDAAsD;QACtD,WAAW,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QACtC,WAAW,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,OAAO,QAAQ,CAAC;QAC9D,eAAe,oLAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ,CAAC;QAC3C,eAAe,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAE1C,sDAAsD;QACtD,kDAAkD;QAClD,sDAAsD;QACtD,oBAAoB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAC/C,mBAAmB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAC9C,2BAA2B,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QACtD,qBAAqB,oLAAC,CACnB,MAAM,GACN,KAAK,CAAC,gBAAgB,wBACtB,QAAQ,CAAC;QAEZ,sDAAsD;QACtD,gCAAgC;QAChC,sDAAsD;QACtD,oBAAoB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAC/C,qBAAqB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAChD,kBAAkB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAC7C,sBAAsB,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,OAAO,CAAC;QAC/C,wBAAwB,oLAAC,CACtB,MAAM,GACN,GAAG,CAAC,GACJ,QAAQ,GACR,QAAQ,CAAC;QACZ,0BAA0B,oLAAC,CACxB,MAAM,GACN,SAAS,CAAC,CAAC,MAAQ,QAAQ,QAC3B,QAAQ;QACX,6BAA6B,oLAAC,CAAC,MAAM,GAAG,QAAQ;QAEhD,sDAAsD;QACtD,2BAA2B;QAC3B,sDAAsD;QACtD,4BAA4B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,GAAG,CAAC,KAAK,OAAO,CAAC;QAEtE,sDAAsD;QACtD,6BAA6B;QAC7B,sDAAsD;QACtD,gBAAgB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAC3C,gCAAgC,oLAAC,CAC9B,MAAM,GACN,QAAQ,GACR,QAAQ,CAAC;QACZ,gBAAgB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAE3C,sDAAsD;QACtD,0BAA0B;QAC1B,sDAAsD;QACtD,oBAAoB,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG,QAAQ,CAAC;QAE/C,sDAAsD;QACtD,8CAA8C;QAC9C,sDAAsD;QACtD,qBAAqB,oLAAC,CAAC,MAAM,GAAG,QAAQ;QACxC,uBAAuB,oLAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ;QAClD,sBAAsB,oLAAC,CAAC,MAAM,GAAG,QAAQ;QAEzC,sDAAsD;QACtD,0BAA0B;QAC1B,sDAAsD;QACtD,mBAAmB,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAElD,sDAAsD;QACtD,uBAAuB;QACvB,sDAAsD;QACtD,aAAa,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAC5C,YAAY,oLAAC,CAAC,MAAM,GAAG,KAAK,GAAG,QAAQ,GAAG,QAAQ,CAAC;QACnD,gBAAgB,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAC/C,kBAAkB,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAEjD,sDAAsD;QACtD,gCAAgC;QAChC,sDAAsD;QACtD,WAAW,oLAAC,CAAC,IAAI,CAAC;YAAC;YAAS;YAAQ;YAAQ;SAAQ,EAAE,OAAO,CAAC;QAC9D,SAAS,oLAAC,CAAC,MAAM,GAAG,OAAO,CAAC;QAC5B,cAAc,oLAAC,CAAC,MAAM,GAAG,OAAO,CAAC,OAAO,QAAQ,CAAC;QACjD,eAAe,oLAAC,CAAC,MAAM,GAAG,OAAO,CAAC,OAAO,QAAQ,CAAC;QAElD,sDAAsD;QACtD,wCAAwC;QACxC,sDAAsD;QACtD,iCAAiC,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QACxE,0BAA0B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QACjE,4BAA4B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QACnE,yBAAyB,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QAChE,gCAAgC,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QACvE,2BAA2B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QAClE,wBAAwB,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QAC/D,2BAA2B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QAClE,0BAA0B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QACjE,6BAA6B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QACpE,4BAA4B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,GAAG,QAAQ;QACnE,+BAA+B,oLAAC,CAC7B,MAAM,GACN,SAAS,CAAC,CAAC,MAAQ,QAAQ,QAC3B,QAAQ;QACX,mBAAmB,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,MAAM,QAAQ;QAC7D,yBAAyB,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,MAAM,QAAQ;QACnE,8BAA8B,oLAAC,CAAC,MAAM,CAAC,MAAM,GAAG,GAAG,GAAG,GAAG,CAAC,MAAM,QAAQ;QACxE,wBAAwB,oLAAC,CACtB,MAAM,GACN,SAAS,CAAC,CAAC,MAAQ,QAAQ,QAC3B,QAAQ;QACX,uBAAuB,oLAAC,CACrB,MAAM,GACN,SAAS,CAAC,CAAC,MAAQ,QAAQ,QAC3B,QAAQ;QAEX,sDAAsD;QACtD,6BAA6B;QAC7B,sDAAsD;QACtD,kBAAkB,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;QACjD,sBAAsB,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAErD,sDAAsD;QACtD,oBAAoB;QACpB,sDAAsD;QACtD,cAAc,oLAAC,CAAC,MAAM,GAAG,GAAG,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAEnD,sDAAsD;QACtD,mCAAmC;QACnC,sDAAsD;QACtD,6BAA6B,oLAAC,CAC3B,MAAM,GACN,QAAQ,GACR,OAAO,CAAC,uDACR,QAAQ,CAAC;QAEZ,sDAAsD;QACtD,wBAAwB;QACxB,sDAAsD;QACtD,aAAa,oLAAC,CACX,MAAM,GACN,QAAQ,GACR,QAAQ,CAAC;QACZ,mBAAmB,oLAAC,CACjB,MAAM,GACN,QAAQ,GACR,QAAQ,CAAC;QACZ,oBAAoB,oLAAC,CAClB,MAAM,GACN,QAAQ,GACR,QAAQ,CAAC;QAEZ,sDAAsD;QACtD,kBAAkB;QAClB,sDAAsD;QACtD,YAAY,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAC3C,qBAAqB,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,OAAO,CAAC,SAAS,QAAQ,CAAC;IACvE;IAEA;;;GAGC,GACD,QAAQ;QACN,sDAAsD;QACtD,8BAA8B;QAC9B,sDAAsD;QACtD,2BAA2B,oLAAC,CAAC,MAAM,GAAG,QAAQ,GAAG,QAAQ,CAAC;QAE1D,sDAAsD;QACtD,wBAAwB;QACxB,sDAAsD;QACtD,uDAAuD;QACvD,iCAAiC,oLAAC,CAC/B,MAAM,GACN,QAAQ,GACR,QAAQ,CAAC;QACZ,8BAA8B,oLAAC,CAC5B,MAAM,GACN,QAAQ,GACR,QAAQ,CAAC;QAEZ,sDAAsD;QACtD,mBAAmB;QACnB,sDAAsD;QACtD,oCAAoC,oLAAC,CAClC,MAAM,GACN,OAAO,CAAC,oBACR,QAAQ,CAAC;QACZ,oCAAoC,oLAAC,CAClC,MAAM,GACN,KAAK,GACL,OAAO,CAAC,uBACR,QAAQ,CAAC;QAEZ,sDAAsD;QACtD,sBAAsB;QACtB,sDAAsD;QACtD,6BAA6B,oLAAC,CAC3B,MAAM,GACN,OAAO,CAAC,QACR,SAAS,CAAC,CAAC,MAAQ,QAAQ,QAC3B,QAAQ,CAAC;IACd;IAEA;;;;GAIC,GACD,YAAY;QACV,mBAAmB;QACnB,QAAQ;QAER,WAAW;QACX,cAAc,QAAQ,GAAG,CAAC,YAAY;QAEtC,iBAAiB;QACjB,oBAAoB,QAAQ,GAAG,CAAC,kBAAkB;QAClD,iBAAiB,QAAQ,GAAG,CAAC,eAAe;QAC5C,aAAa,QAAQ,GAAG,CAAC,WAAW;QACpC,iBAAiB,QAAQ,GAAG,CAAC,eAAe;QAC5C,UAAU,QAAQ,GAAG,CAAC,QAAQ;QAE9B,QAAQ;QACR,WAAW,QAAQ,GAAG,CAAC,SAAS;QAChC,WAAW,QAAQ,GAAG,CAAC,SAAS;QAChC,eAAe,QAAQ,GAAG,CAAC,aAAa;QACxC,eAAe,QAAQ,GAAG,CAAC,aAAa;QAExC,SAAS;QACT,oBAAoB,QAAQ,GAAG,CAAC,kBAAkB;QAClD,mBAAmB,QAAQ,GAAG,CAAC,iBAAiB;QAChD,2BAA2B,QAAQ,GAAG,CAAC,yBAAyB;QAChE,qBAAqB,QAAQ,GAAG,CAAC,mBAAmB;QAEpD,UAAU;QACV,oBAAoB,QAAQ,GAAG,CAAC,kBAAkB;QAClD,qBAAqB,QAAQ,GAAG,CAAC,mBAAmB;QACpD,kBAAkB,QAAQ,GAAG,CAAC,gBAAgB;QAC9C,sBAAsB,QAAQ,GAAG,CAAC,oBAAoB;QACtD,wBAAwB,QAAQ,GAAG,CAAC,sBAAsB;QAC1D,0BAA0B,QAAQ,GAAG,CAAC,wBAAwB;QAC9D,6BAA6B,QAAQ,GAAG,CAAC,2BAA2B;QACpE,iCAAiC,QAAQ,GAAG,CAAC,+BAA+B;QAC5E,8BAA8B,QAAQ,GAAG,CAAC,4BAA4B;QAEtE,aAAa;QACb,4BAA4B,QAAQ,GAAG,CAAC,0BAA0B;QAElE,uBAAuB;QACvB,gBAAgB,QAAQ,GAAG,CAAC,cAAc;QAC1C,gCAAgC,QAAQ,GAAG,CAAC,8BAA8B;QAC1E,gBAAgB,QAAQ,GAAG,CAAC,cAAc;QAE1C,QAAQ;QACR,oBAAoB,QAAQ,GAAG,CAAC,kBAAkB;QAClD,2BAA2B,QAAQ,GAAG,CAAC,yBAAyB;QAEhE,WAAW;QACX,qBAAqB,QAAQ,GAAG,CAAC,mBAAmB;QACpD,uBAAuB,QAAQ,GAAG,CAAC,qBAAqB;QACxD,sBAAsB,QAAQ,GAAG,CAAC,oBAAoB;QAEtD,OAAO;QACP,mBAAmB,QAAQ,GAAG,CAAC,iBAAiB;QAEhD,OAAO;QACP,aAAa,QAAQ,GAAG,CAAC,WAAW;QACpC,YAAY,QAAQ,GAAG,CAAC,UAAU;QAClC,gBAAgB,QAAQ,GAAG,CAAC,cAAc;QAC1C,kBAAkB,QAAQ,GAAG,CAAC,gBAAgB;QAE9C,UAAU;QACV,WAAW,QAAQ,GAAG,CAAC,SAAS;QAChC,SAAS,QAAQ,GAAG,CAAC,OAAO;QAC5B,cAAc,QAAQ,GAAG,CAAC,YAAY;QACtC,eAAe,QAAQ,GAAG,CAAC,aAAa;QACxC,6BAA6B,QAAQ,GAAG,CAAC,2BAA2B;QAEpE,SAAS;QACT,iCAAiC,QAAQ,GAAG,CAAC,+BAA+B;QAC5E,0BAA0B,QAAQ,GAAG,CAAC,wBAAwB;QAC9D,4BAA4B,QAAQ,GAAG,CAAC,0BAA0B;QAClE,yBAAyB,QAAQ,GAAG,CAAC,uBAAuB;QAC5D,gCAAgC,QAAQ,GAAG,CAAC,8BAA8B;QAC1E,2BAA2B,QAAQ,GAAG,CAAC,yBAAyB;QAChE,wBAAwB,QAAQ,GAAG,CAAC,sBAAsB;QAC1D,2BAA2B,QAAQ,GAAG,CAAC,yBAAyB;QAChE,0BAA0B,QAAQ,GAAG,CAAC,wBAAwB;QAC9D,6BAA6B,QAAQ,GAAG,CAAC,2BAA2B;QACpE,4BAA4B,QAAQ,GAAG,CAAC,0BAA0B;QAClE,+BAA+B,QAAQ,GAAG,CAAC,6BAA6B;QACxE,mBAAmB,QAAQ,GAAG,CAAC,iBAAiB;QAChD,yBAAyB,QAAQ,GAAG,CAAC,uBAAuB;QAC5D,8BAA8B,QAAQ,GAAG,CAAC,4BAA4B;QACtE,wBAAwB,QAAQ,GAAG,CAAC,sBAAsB;QAC1D,uBAAuB,QAAQ,GAAG,CAAC,qBAAqB;QAExD,QAAQ;QACR,kBAAkB,QAAQ,GAAG,CAAC,gBAAgB;QAC9C,sBAAsB,QAAQ,GAAG,CAAC,oBAAoB;QAEtD,MAAM;QACN,cAAc,QAAQ,GAAG,CAAC,YAAY;QAEtC,qBAAqB;QACrB,6BAA6B,QAAQ,GAAG,CAAC,2BAA2B;QAEpE,wBAAwB;QACxB,aAAa,QAAQ,GAAG,CAAC,WAAW;QACpC,mBAAmB,QAAQ,GAAG,CAAC,iBAAiB;QAChD,oBAAoB,QAAQ,GAAG,CAAC,kBAAkB;QAElD,kBAAkB;QAClB,YAAY,QAAQ,GAAG,CAAC,UAAU;QAClC,qBAAqB,QAAQ,GAAG,CAAC,mBAAmB;QAEpD,mBAAmB;QACnB,oCAAoC,QAAQ,GAAG,CAAC,kCAAkC;QAClF,oCAAoC,QAAQ,GAAG,CAAC,kCAAkC;IACpF;IAEA;;;GAGC,GACD,gBAAgB,CAAC,CAAC,QAAQ,GAAG,CAAC,mBAAmB;IAEjD;;GAEC,GACD,wBAAwB;AAC1B","debugId":null}},
    {"offset": {"line": 424, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/MacBook-Dev/package/mimisalon-pet-web/src/lib/logger.ts"],"sourcesContent":["/**\n * Winston Logger Configuration\n *\n * Server-side only logger for structured logging to local filesystem.\n * Uses daily log rotation with automatic cleanup.\n *\n * @module lib/logger\n */\n\nimport winston from 'winston';\nimport DailyRotateFile from 'winston-daily-rotate-file';\nimport path from 'path';\nimport { env } from './env';\n\n// ============================================================================\n// Configuration (Lazy Initialization)\n// ============================================================================\n\n// Lazy getters for configuration to prevent build-time errors\nconst getLogDir = () => env.LOG_DIR;\nconst getLogLevel = () => env.LOG_LEVEL;\nconst getLogMaxSize = () => env.LOG_MAX_SIZE;\nconst getLogMaxFiles = () => env.LOG_MAX_FILES;\n\n// ============================================================================\n// Custom Log Format\n// ============================================================================\n\n/**\n * Custom format for structured JSON logging\n */\nconst jsonFormat = winston.format.combine(\n  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss.SSS' }),\n  winston.format.errors({ stack: true }),\n  winston.format.metadata({ fillExcept: ['timestamp', 'level', 'message'] }),\n  winston.format.json()\n);\n\n/**\n * Custom format for console output (development)\n */\nconst consoleFormat = winston.format.combine(\n  winston.format.colorize(),\n  winston.format.timestamp({ format: 'YYYY-MM-DD HH:mm:ss' }),\n  winston.format.printf(({ timestamp, level, message, ...metadata }) => {\n    let msg = `${timestamp} [${level}]: ${message}`;\n\n    // Add metadata if present\n    if (Object.keys(metadata).length > 0) {\n      msg += `\\n${JSON.stringify(metadata, null, 2)}`;\n    }\n\n    return msg;\n  })\n);\n\n// ============================================================================\n// Lazy Logger Initialization\n// ============================================================================\n\nlet _logger: winston.Logger | null = null;\n\n/**\n * Get or create the Winston logger instance (lazy initialization)\n * This prevents build-time errors when environment variables are not available\n */\nfunction getLogger(): winston.Logger {\n  if (!_logger) {\n    const LOG_DIR = getLogDir();\n    const LOG_LEVEL = getLogLevel();\n    const LOG_MAX_SIZE = getLogMaxSize();\n    const LOG_MAX_FILES = getLogMaxFiles();\n\n    /**\n     * Daily rotate file transport for error logs\n     */\n    const errorFileTransport = new DailyRotateFile({\n      filename: path.join(LOG_DIR, 'error-%DATE%.log'),\n      datePattern: 'YYYY-MM-DD',\n      level: 'error',\n      maxSize: LOG_MAX_SIZE,\n      maxFiles: LOG_MAX_FILES,\n      format: jsonFormat,\n      zippedArchive: true,\n    });\n\n    /**\n     * Daily rotate file transport for combined logs\n     */\n    const combinedFileTransport = new DailyRotateFile({\n      filename: path.join(LOG_DIR, 'combined-%DATE%.log'),\n      datePattern: 'YYYY-MM-DD',\n      maxSize: LOG_MAX_SIZE,\n      maxFiles: LOG_MAX_FILES,\n      format: jsonFormat,\n      zippedArchive: true,\n    });\n\n    /**\n     * Daily rotate file transport for network error logs\n     */\n    const networkFileTransport = new DailyRotateFile({\n      filename: path.join(LOG_DIR, 'network-%DATE%.log'),\n      datePattern: 'YYYY-MM-DD',\n      maxSize: LOG_MAX_SIZE,\n      maxFiles: LOG_MAX_FILES,\n      format: winston.format.combine(\n        winston.format((info: winston.Logform.TransformableInfo) => {\n          return info.type === 'NETWORK_ERROR' ? info : false;\n        })(),\n        jsonFormat\n      ),\n      zippedArchive: true,\n    });\n\n    /**\n     * Console transport for development\n     */\n    const consoleTransport = new winston.transports.Console({\n      format: consoleFormat,\n      level: process.env.NODE_ENV === 'production' ? 'warn' : 'debug',\n    });\n\n    _logger = winston.createLogger({\n      level: LOG_LEVEL,\n      format: jsonFormat,\n      defaultMeta: {\n        service: 'mimisalon-nextjs',\n        environment: process.env.NODE_ENV || 'development',\n      },\n      transports: [\n        errorFileTransport,\n        combinedFileTransport,\n        networkFileTransport,\n        consoleTransport,\n      ],\n      exceptionHandlers: [\n        new DailyRotateFile({\n          filename: path.join(LOG_DIR, 'exceptions-%DATE%.log'),\n          datePattern: 'YYYY-MM-DD',\n          maxSize: LOG_MAX_SIZE,\n          maxFiles: LOG_MAX_FILES,\n          format: jsonFormat,\n        }),\n      ],\n      rejectionHandlers: [\n        new DailyRotateFile({\n          filename: path.join(LOG_DIR, 'rejections-%DATE%.log'),\n          datePattern: 'YYYY-MM-DD',\n          maxSize: LOG_MAX_SIZE,\n          maxFiles: LOG_MAX_FILES,\n          format: jsonFormat,\n        }),\n      ],\n    });\n  }\n\n  return _logger;\n}\n\n// Proxy to maintain API compatibility\nconst logger = new Proxy({} as winston.Logger, {\n  get(_, prop) {\n    return (getLogger() as any)[prop];\n  },\n});\n\n// ============================================================================\n// Convenience Methods\n// ============================================================================\n\n/**\n * Log network error from client\n */\nexport const logNetworkError = (error: {\n  url: string;\n  method: string;\n  statusCode?: number;\n  message: string;\n  userId?: string;\n  sessionId?: string;\n  browser?: string;\n  userAgent?: string;\n  timestamp?: string;\n  [key: string]: any;\n}) => {\n  logger.error(error.message, {\n    type: 'NETWORK_ERROR',\n    ...error,\n  });\n};\n\n/**\n * Log API error\n */\nexport const logApiError = (\n  endpoint: string,\n  error: Error | unknown,\n  context?: Record<string, any>\n) => {\n  const errorMessage = error instanceof Error ? error.message : String(error);\n  const errorStack = error instanceof Error ? error.stack : undefined;\n\n  logger.error(errorMessage, {\n    type: 'API_ERROR',\n    endpoint,\n    stack: errorStack,\n    ...context,\n  });\n};\n\n/**\n * Log authentication error\n */\nexport const logAuthError = (\n  action: string,\n  error: Error | unknown,\n  userId?: string,\n  context?: Record<string, any>\n) => {\n  const errorMessage = error instanceof Error ? error.message : String(error);\n\n  logger.error(errorMessage, {\n    type: 'AUTH_ERROR',\n    action,\n    userId,\n    ...context,\n  });\n};\n\n/**\n * Log info message\n */\nexport const logInfo = (message: string, context?: Record<string, any>) => {\n  logger.info(message, context);\n};\n\n/**\n * Log warning\n */\nexport const logWarning = (message: string, context?: Record<string, any>) => {\n  logger.warn(message, context);\n};\n\n/**\n * Log debug message (development only)\n */\nexport const logDebug = (message: string, context?: Record<string, any>) => {\n  logger.debug(message, context);\n};\n\n// ============================================================================\n// Export\n// ============================================================================\n\nexport default logger;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 623, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/MacBook-Dev/package/mimisalon-pet-web/src/lib/logger-utils.ts"],"sourcesContent":["/**\n * Logger Utility Functions\n *\n * Helper functions for formatting, sanitizing, and processing logs.\n * Includes privacy protection and data masking utilities.\n *\n * @module lib/logger-utils\n */\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\n/**\n * Network error log entry structure\n */\nexport interface NetworkErrorLog {\n  url: string;\n  method: string;\n  statusCode?: number;\n  message: string;\n  userId?: string;\n  sessionId?: string;\n  browser?: string;\n  userAgent?: string;\n  timestamp: string;\n  pathname?: string;\n  pageUrl?: string;\n  referrer?: string;\n  requestHeaders?: Record<string, string>;\n  responseHeaders?: Record<string, string>;\n  requestBody?: any;\n  responseBody?: any;\n  duration?: number;\n  [key: string]: any;\n}\n\n/**\n * Sanitized log entry (privacy protected)\n */\nexport interface SanitizedLog extends Omit<NetworkErrorLog, 'requestHeaders' | 'responseHeaders'> {\n  requestHeaders?: Record<string, string>;\n  responseHeaders?: Record<string, string>;\n}\n\n// ============================================================================\n// Privacy & Security\n// ============================================================================\n\n/**\n * Sensitive header names to exclude from logs\n */\nconst SENSITIVE_HEADERS = [\n  'authorization',\n  'cookie',\n  'set-cookie',\n  'x-api-key',\n  'x-auth-token',\n  'proxy-authorization',\n];\n\n/**\n * Patterns for sensitive data to mask\n */\nconst SENSITIVE_PATTERNS = {\n  email: /([a-zA-Z0-9._%+-]+)@([a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})/g,\n  phone: /(\\d{3})[-.\\s]?(\\d{3,4})[-.\\s]?(\\d{4})/g,\n  creditCard: /\\b\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}[\\s-]?\\d{4}\\b/g,\n  ssn: /\\b\\d{3}-\\d{2}-\\d{4}\\b/g,\n  password: /\"password\"\\s*:\\s*\"[^\"]*\"/gi,\n  token: /\"token\"\\s*:\\s*\"[^\"]*\"/gi,\n};\n\n/**\n * Mask email address\n * Example: user@example.com -> u***@example.com\n */\nexport const maskEmail = (email: string): string => {\n  return email.replace(SENSITIVE_PATTERNS.email, (match, username, domain) => {\n    if (username.length <= 2) return `${username[0]}***@${domain}`;\n    return `${username[0]}***${username[username.length - 1]}@${domain}`;\n  });\n};\n\n/**\n * Mask phone number\n * Example: 010-1234-5678 -> 010-****-5678\n */\nexport const maskPhone = (phone: string): string => {\n  return phone.replace(SENSITIVE_PATTERNS.phone, (match, p1, p2, p3) => {\n    return `${p1}-****-${p3}`;\n  });\n};\n\n/**\n * Mask user ID\n * Example: user-12345 -> user-***45\n */\nexport const maskUserId = (userId: string | undefined): string | undefined => {\n  if (!userId) return undefined;\n  if (userId.length <= 5) return '***';\n  return `${userId.substring(0, userId.length - 5)}***${userId.substring(userId.length - 2)}`;\n};\n\n/**\n * Remove sensitive headers from header object\n */\nexport const sanitizeHeaders = (\n  headers?: Record<string, string>\n): Record<string, string> | undefined => {\n  if (!headers) return undefined;\n\n  const sanitized: Record<string, string> = {};\n\n  for (const [key, value] of Object.entries(headers)) {\n    const lowerKey = key.toLowerCase();\n\n    // Skip sensitive headers\n    if (SENSITIVE_HEADERS.includes(lowerKey)) {\n      sanitized[key] = '[REDACTED]';\n      continue;\n    }\n\n    sanitized[key] = value;\n  }\n\n  return sanitized;\n};\n\n/**\n * Mask sensitive data in body\n */\nexport const sanitizeBody = (body: any): any => {\n  if (!body) return undefined;\n\n  // If body is string, try to parse as JSON\n  if (typeof body === 'string') {\n    try {\n      const parsed = JSON.parse(body);\n      return sanitizeBody(parsed);\n    } catch {\n      // Not JSON, mask patterns in string\n      let sanitized = body;\n      for (const [key, pattern] of Object.entries(SENSITIVE_PATTERNS)) {\n        sanitized = sanitized.replace(pattern, `[MASKED_${key.toUpperCase()}]`);\n      }\n      return sanitized;\n    }\n  }\n\n  // If body is object, recursively sanitize\n  if (typeof body === 'object' && body !== null) {\n    const sanitized: any = Array.isArray(body) ? [] : {};\n\n    for (const [key, value] of Object.entries(body)) {\n      const lowerKey = key.toLowerCase();\n\n      // Mask password fields\n      if (\n        lowerKey.includes('password') ||\n        lowerKey.includes('secret') ||\n        lowerKey.includes('token')\n      ) {\n        sanitized[key] = '[REDACTED]';\n        continue;\n      }\n\n      // Recursively sanitize nested objects\n      if (typeof value === 'object' && value !== null) {\n        sanitized[key] = sanitizeBody(value);\n      } else if (typeof value === 'string') {\n        // Mask sensitive patterns\n        let maskedValue = value;\n        if (SENSITIVE_PATTERNS.email.test(value)) {\n          maskedValue = maskEmail(value);\n        }\n        if (SENSITIVE_PATTERNS.phone.test(value)) {\n          maskedValue = maskPhone(value);\n        }\n        sanitized[key] = maskedValue;\n      } else {\n        sanitized[key] = value;\n      }\n    }\n\n    return sanitized;\n  }\n\n  return body;\n};\n\n/**\n * Sanitize complete log entry\n */\nexport const sanitizeLog = (log: NetworkErrorLog): SanitizedLog => {\n  return {\n    ...log,\n    userId: maskUserId(log.userId),\n    requestHeaders: sanitizeHeaders(log.requestHeaders),\n    responseHeaders: sanitizeHeaders(log.responseHeaders),\n    requestBody: sanitizeBody(log.requestBody),\n    responseBody: sanitizeBody(log.responseBody),\n  };\n};\n\n// ============================================================================\n// Log Formatting\n// ============================================================================\n\n/**\n * Format error message based on status code\n */\nexport const formatErrorMessage = (statusCode?: number, originalMessage?: string): string => {\n  if (!statusCode) {\n    return originalMessage || 'Network error occurred';\n  }\n\n  // Client errors (4xx)\n  if (statusCode >= 400 && statusCode < 500) {\n    switch (statusCode) {\n      case 400:\n        return 'Bad Request - Invalid request data';\n      case 401:\n        return 'Unauthorized - Authentication required';\n      case 403:\n        return 'Forbidden - Access denied';\n      case 404:\n        return 'Not Found - Resource does not exist';\n      case 408:\n        return 'Request Timeout - Request took too long';\n      case 429:\n        return 'Too Many Requests - Rate limit exceeded';\n      default:\n        return originalMessage || `Client error (${statusCode})`;\n    }\n  }\n\n  // Server errors (5xx)\n  if (statusCode >= 500) {\n    switch (statusCode) {\n      case 500:\n        return 'Internal Server Error - Server encountered an error';\n      case 502:\n        return 'Bad Gateway - Invalid response from upstream server';\n      case 503:\n        return 'Service Unavailable - Server is temporarily unavailable';\n      case 504:\n        return 'Gateway Timeout - Upstream server timeout';\n      default:\n        return originalMessage || `Server error (${statusCode})`;\n    }\n  }\n\n  return originalMessage || `HTTP error (${statusCode})`;\n};\n\n/**\n * Determine error severity level\n */\nexport const getErrorSeverity = (statusCode?: number): 'critical' | 'high' | 'medium' | 'low' => {\n  if (!statusCode) return 'high';\n\n  // Network/timeout errors\n  if (statusCode === 0) return 'critical';\n\n  // Server errors\n  if (statusCode >= 500) return 'critical';\n\n  // Authentication errors\n  if (statusCode === 401 || statusCode === 403) return 'high';\n\n  // Client errors\n  if (statusCode >= 400 && statusCode < 500) return 'medium';\n\n  return 'low';\n};\n\n/**\n * Extract browser info from user agent\n */\nexport const extractBrowserInfo = (userAgent: string): string => {\n  // Chrome\n  if (userAgent.includes('Chrome')) {\n    const match = userAgent.match(/Chrome\\/(\\d+)/);\n    return match ? `Chrome ${match[1]}` : 'Chrome';\n  }\n\n  // Firefox\n  if (userAgent.includes('Firefox')) {\n    const match = userAgent.match(/Firefox\\/(\\d+)/);\n    return match ? `Firefox ${match[1]}` : 'Firefox';\n  }\n\n  // Safari\n  if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {\n    const match = userAgent.match(/Version\\/(\\d+)/);\n    return match ? `Safari ${match[1]}` : 'Safari';\n  }\n\n  // Edge\n  if (userAgent.includes('Edg')) {\n    const match = userAgent.match(/Edg\\/(\\d+)/);\n    return match ? `Edge ${match[1]}` : 'Edge';\n  }\n\n  return 'Unknown Browser';\n};\n\n// ============================================================================\n// Log Validation\n// ============================================================================\n\n/**\n * Validate log entry structure\n */\nexport const validateLog = (log: Partial<NetworkErrorLog>): boolean => {\n  // Required fields\n  if (!log.url || !log.method || !log.message || !log.timestamp) {\n    return false;\n  }\n\n  // Valid HTTP method\n  const validMethods = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'HEAD', 'OPTIONS'];\n  if (!validMethods.includes(log.method.toUpperCase())) {\n    return false;\n  }\n\n  // Valid timestamp\n  if (isNaN(Date.parse(log.timestamp))) {\n    return false;\n  }\n\n  return true;\n};\n\n/**\n * Check if error should be logged (filter out noise)\n */\nexport const shouldLogError = (statusCode?: number, url?: string): boolean => {\n  // Always log server errors\n  if (statusCode && statusCode >= 500) return true;\n\n  // Always log authentication errors\n  if (statusCode === 401 || statusCode === 403) return true;\n\n  // Filter out known noisy endpoints\n  const noisyEndpoints = ['/api/health', '/api/ping', '/_next/'];\n  if (url && noisyEndpoints.some((endpoint) => url.includes(endpoint))) {\n    return false;\n  }\n\n  // Filter out successful requests\n  if (statusCode && statusCode >= 200 && statusCode < 400) return false;\n\n  return true;\n};\n\n// ============================================================================\n// Export\n// ============================================================================\n\nexport default {\n  maskEmail,\n  maskPhone,\n  maskUserId,\n  sanitizeHeaders,\n  sanitizeBody,\n  sanitizeLog,\n  formatErrorMessage,\n  getErrorSeverity,\n  extractBrowserInfo,\n  validateLog,\n  shouldLogError,\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 905, "column": 0}, "map": {"version":3,"sources":["file:///Volumes/MacBook-Dev/package/mimisalon-pet-web/src/app/api/logs/route.ts"],"sourcesContent":["/**\n * Client Log Collection API\n *\n * Server endpoint for receiving client-side network error logs.\n * Implements rate limiting, validation, and Winston logging.\n *\n * @route POST /api/logs\n */\n\nimport {NextRequest, NextResponse} from 'next/server';\nimport {z} from 'zod';\nimport {logNetworkError} from '@/lib/logger';\nimport {type NetworkErrorLog, sanitizeLog, validateLog} from '@/lib/logger-utils';\n\n// ============================================================================\n// Rate Limiting\n// ============================================================================\n\n// In-memory rate limit store (use Redis in production)\nconst rateLimitStore = new Map<string, { count: number; resetTime: number }>();\nconst RATE_LIMIT_MAX = 100; // 100 logs per hour\nconst RATE_LIMIT_WINDOW = 60 * 60 * 1000; // 1 hour in milliseconds\n\n/**\n * Check rate limit for client\n */\nfunction checkRateLimit(identifier: string): {\n  allowed: boolean;\n  remaining: number;\n  resetTime: number;\n} {\n  const now = Date.now();\n  const windowStart = now - RATE_LIMIT_WINDOW;\n\n  let entry = rateLimitStore.get(identifier);\n\n  // Clean expired entries\n  if (entry && entry.resetTime < now) {\n    entry = undefined;\n    rateLimitStore.delete(identifier);\n  }\n\n  if (!entry) {\n    entry = {count: 0, resetTime: now + RATE_LIMIT_WINDOW};\n    rateLimitStore.set(identifier, entry);\n  }\n\n  const allowed = entry.count < RATE_LIMIT_MAX;\n  if (allowed) {\n    entry.count += 1;\n  }\n\n  return {\n    allowed,\n    remaining: Math.max(0, RATE_LIMIT_MAX - entry.count),\n    resetTime: entry.resetTime,\n  };\n}\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface LogBatchResponse {\n  success: boolean;\n  processed: number;\n  skipped: number;\n  message: string;\n}\n\nexport interface LogRateLimitResponse {\n  remaining: number;\n  resetTime: number;\n  limit: number;\n}\n\nexport interface LogErrorResponse {\n  success: false;\n  error: string;\n  details?: unknown;\n  message?: string;\n}\n\n// ============================================================================\n// Validation Schema\n// ============================================================================\n\n/**\n * Single log entry schema\n */\nexport const logEntrySchema = z.object({\n  url: z.string().min(1),\n  method: z.string().min(1),\n  statusCode: z.number().int().optional(),\n  message: z.string().min(1),\n  timestamp: z.string().datetime(),\n  requestHeaders: z.record(z.string(), z.unknown()).optional(),\n  responseHeaders: z.record(z.string(), z.unknown()).optional(),\n  requestBody: z.any().optional(),\n  responseBody: z.any().optional(),\n  duration: z.number().optional(),\n  browser: z.string().optional(),\n  userAgent: z.string().optional(),\n  sessionId: z.string().optional(),\n  userId: z.string().optional(),\n  pathname: z.string().optional(),\n  pageUrl: z.string().optional(),\n  referrer: z.string().optional(),\n});\n\n/**\n * Batch request schema\n */\nexport const logBatchSchema = z.object({\n  logs: z.array(logEntrySchema).min(1).max(50), // Max 50 logs per batch\n});\n\nexport type LogBatchRequest = z.infer<typeof logBatchSchema>;\n\n// ============================================================================\n// API Handler\n// ============================================================================\n\n/**\n * POST /api/logs\n * Receive and process client-side error logs\n */\nexport async function POST(\n  request: NextRequest\n): Promise<NextResponse<LogBatchResponse | LogErrorResponse>> {\n  try {\n    // Rate limiting\n    const clientIp = request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown';\n    const rateLimitKey = `logs:${clientIp}`;\n    const rateLimit = checkRateLimit(rateLimitKey);\n\n    if (!rateLimit.allowed) {\n      return NextResponse.json<LogErrorResponse>(\n        {\n          success: false,\n          error: `Rate limit exceeded. Maximum ${RATE_LIMIT_MAX} logs per hour.`,\n        },\n        {\n          status: 429,\n          headers: {\n            'X-RateLimit-Limit': RATE_LIMIT_MAX.toString(),\n            'X-RateLimit-Remaining': rateLimit.remaining.toString(),\n            'X-RateLimit-Reset': rateLimit.resetTime.toString(),\n          },\n        }\n      );\n    }\n\n    // Parse request body\n    const body = await request.json();\n\n    // Validate request\n    const validationResult = logBatchSchema.safeParse(body);\n    if (!validationResult.success) {\n      return NextResponse.json<LogErrorResponse>(\n        {\n          success: false,\n          error: 'Invalid log data',\n          details: validationResult.error.issues,\n        },\n        { status: 400 }\n      );\n    }\n\n    const {logs} = validationResult.data;\n\n    // Process each log entry\n    let processedCount = 0;\n    let skippedCount = 0;\n\n    for (const log of logs) {\n      // Validate log structure\n      if (!validateLog(log as Partial<NetworkErrorLog>)) {\n        skippedCount++;\n        continue;\n      }\n\n      // Sanitize log (remove sensitive data)\n      const sanitized = sanitizeLog(log as NetworkErrorLog);\n\n      // Log to Winston\n      logNetworkError({\n        url: sanitized.url,\n        method: sanitized.method,\n        statusCode: sanitized.statusCode,\n        message: sanitized.message,\n        userId: sanitized.userId,\n        sessionId: sanitized.sessionId,\n        browser: sanitized.browser,\n        userAgent: sanitized.userAgent,\n        timestamp: sanitized.timestamp,\n        pathname: sanitized.pathname,\n        pageUrl: sanitized.pageUrl,\n        referrer: sanitized.referrer,\n        requestHeaders: sanitized.requestHeaders as Record<string, string> | undefined,\n        responseHeaders: sanitized.responseHeaders as Record<string, string> | undefined,\n        requestBody: sanitized.requestBody,\n        responseBody: sanitized.responseBody,\n        duration: sanitized.duration,\n      });\n      processedCount++;\n    }\n\n    // Success response\n    return NextResponse.json<LogBatchResponse>(\n      {\n        success: true,\n        processed: processedCount,\n        skipped: skippedCount,\n        message: `Successfully processed ${processedCount} log(s)`,\n      },\n      {\n        status: 200,\n        headers: {\n          'X-RateLimit-Limit': RATE_LIMIT_MAX.toString(),\n          'X-RateLimit-Remaining': rateLimit.remaining.toString(),\n          'X-RateLimit-Reset': rateLimit.resetTime.toString(),\n        },\n      }\n    );\n  } catch (error) {\n    console.error('[LogAPI] Failed to process logs:', error);\n\n    return NextResponse.json<LogErrorResponse>(\n      {\n        success: false,\n        error: 'Failed to process logs',\n        message: error instanceof Error ? error.message : 'Unknown error',\n      },\n      { status: 500 }\n    );\n  }\n}\n\n/**\n * GET /api/logs\n * Get rate limit info for current client\n */\nexport async function GET(\n  request: NextRequest\n): Promise<NextResponse<LogRateLimitResponse | LogErrorResponse>> {\n  try {\n    const clientIp = request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip') || 'unknown';\n    const rateLimitKey = `logs:${clientIp}`;\n    const rateLimit = checkRateLimit(rateLimitKey);\n\n    return NextResponse.json<LogRateLimitResponse>({\n      remaining: rateLimit.remaining,\n      resetTime: rateLimit.resetTime,\n      limit: RATE_LIMIT_MAX,\n    });\n  } catch (error) {\n    console.error('[LogAPI] Failed to get rate limit info:', error);\n\n    return NextResponse.json<LogErrorResponse>(\n      {\n        success: false,\n        error: 'Failed to get rate limit info',\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}