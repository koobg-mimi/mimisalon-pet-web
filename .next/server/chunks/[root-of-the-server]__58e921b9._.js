module.exports=[609730,438220,874321,e=>{"use strict";let o=Symbol.for("constructDateFrom");function t(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&o in e?e[o](t):e instanceof Date?new e.constructor(t):new Date(t)}function r(e,o){return t(o||e,e)}e.s(["constructFromSymbol",0,o,"millisecondsInDay",0,864e5,"millisecondsInHour",0,36e5,"millisecondsInMinute",0,6e4,"millisecondsInWeek",0,6048e5],438220),e.s(["constructFrom",()=>t],874321),e.s(["toDate",()=>r],609730)},250354,662001,e=>{"use strict";let o={};function t(){return o}e.s(["getDefaultOptions",()=>t],662001);var r=e.i(609730);function n(e,t){let n=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??o.weekStartsOn??o.locale?.options?.weekStartsOn??0,i=(0,r.toDate)(e,t?.in),s=i.getDay();return i.setDate(i.getDate()-(7*(s<n)+s-n)),i.setHours(0,0,0,0),i}e.s(["startOfWeek",()=>n],250354)},688947,(e,o,t)=>{o.exports=e.x("stream",()=>require("stream"))},921517,(e,o,t)=>{o.exports=e.x("http",()=>require("http"))},524836,(e,o,t)=>{o.exports=e.x("https",()=>require("https"))},406461,(e,o,t)=>{o.exports=e.x("zlib",()=>require("zlib"))},792509,(e,o,t)=>{o.exports=e.x("url",()=>require("url"))},992097,(e,o,t)=>{o.exports=e.x("punycode",()=>require("punycode"))},389579,e=>{"use strict";var o=e.i(657446),t=e.i(647373);let r=new o.PrismaClient;class n{static isValidExpoPushToken(e){return t.ExpoNotificationService.isValidExpoPushToken(e)}static async updateUserToken(e,o,n="android",i){try{if(!t.ExpoNotificationService.isValidExpoPushToken(o))return{success:!1,error:"Invalid ExponentPushToken format"};let s=await r.deviceToken.upsert({where:{token:o},create:{userId:e,token:o,platform:n,deviceId:i,isActive:!0,lastUsed:new Date},update:{isActive:!0,lastUsed:new Date,platform:n,deviceId:i},select:{id:!0,token:!0,platform:!0,lastUsed:!0}});return console.log(`✅ ExponentPushToken saved to DeviceToken table:`),console.log(`   User ID: ${e}`),console.log(`   Token: ${s.token}`),console.log(`   Platform: ${s.platform}`),console.log(`   Last Used: ${s.lastUsed}`),{success:!0}}catch(e){return console.error("Error updating ExponentPushToken:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}static async getUserTokens(e){try{let o=await r.user.findUnique({where:{id:e},select:{notificationsEnabled:!0}});if(!o||!o.notificationsEnabled)return[];return(await r.deviceToken.findMany({where:{userId:e,isActive:!0},select:{token:!0}})).filter(e=>t.ExpoNotificationService.isValidExpoPushToken(e.token)).map(e=>e.token)}catch(e){return console.error("Error getting user ExponentPushTokens:",e),[]}}static async getUserToken(e){return(await this.getUserTokens(e))[0]||null}static async getMultipleUserTokens(e){try{let o=(await r.user.findMany({where:{id:{in:e},notificationsEnabled:!0},select:{id:!0}})).map(e=>e.id);return(await r.deviceToken.findMany({where:{userId:{in:o},isActive:!0},select:{token:!0}})).filter(e=>t.ExpoNotificationService.isValidExpoPushToken(e.token)).map(e=>e.token)}catch(e){return console.error("Error getting user ExponentPushTokens:",e),[]}}static async removeDeviceToken(e){try{return await r.deviceToken.delete({where:{token:e}}),console.log(`ExponentPushToken removed: ${e}`),!0}catch(e){return console.error("Error removing ExponentPushToken:",e),!1}}static async removeUserToken(e){try{return await r.deviceToken.deleteMany({where:{userId:e}}),console.log(`All ExponentPushTokens removed for user: ${e}`),!0}catch(e){return console.error("Error removing ExponentPushTokens:",e),!1}}static async deactivateUserTokens(e){try{return await r.deviceToken.updateMany({where:{userId:e},data:{isActive:!1}}),console.log(`ExponentPushTokens deactivated for user: ${e}`),!0}catch(e){return console.error("Error deactivating ExponentPushTokens:",e),!1}}static async getTokensByRole(e){try{let o=(await r.user.findMany({where:{role:e,notificationsEnabled:!0},select:{id:!0}})).map(e=>e.id);return(await r.deviceToken.findMany({where:{userId:{in:o},isActive:!0},select:{token:!0}})).filter(e=>t.ExpoNotificationService.isValidExpoPushToken(e.token)).map(e=>e.token)}catch(e){return console.error("Error getting ExponentPushTokens by role:",e),[]}}static async updateNotificationPreference(e,o){try{return await r.user.update({where:{id:e},data:{notificationsEnabled:o}}),console.log(`Notification preference updated for user: ${e} to ${o}`),!0}catch(e){return console.error("Error updating notification preference:",e),!1}}static async getAllGroomerTokens(){return this.getTokensByRole("GROOMER")}}e.s(["FCMTokenService",()=>n])},102434,e=>{"use strict";var o=e.i(647373);class t{static async sendToDevice(e,t){try{let r={title:t.title,body:t.body,data:t.data,sound:t.sound,badge:t.badge,channelId:t.channelId},n=await o.ExpoNotificationService.sendToDevice(e,r);if(!n.success)return console.error("Error sending notification:",n.error),!1;{let e=n.ticket&&"id"in n.ticket?n.ticket.id:"unknown";return console.log("Successfully sent notification:",e),!0}}catch(e){return console.error("Error sending notification:",e),!1}}static async sendToMultipleDevices(e,t){try{let r={title:t.title,body:t.body,data:t.data,sound:t.sound,badge:t.badge,channelId:t.channelId},n=await o.ExpoNotificationService.sendToMultipleDevices(e,r);return console.log("Successfully sent notifications:",{successCount:n.successCount,failureCount:n.failureCount}),{successCount:n.successCount,failureCount:n.failureCount}}catch(o){return console.error("Error sending multicast notification:",o),{successCount:0,failureCount:e.length}}}static async sendToTopic(e,o){return console.warn("Topic notifications are not supported by Expo Push Notifications"),!1}static async subscribeToTopic(e,o){return console.warn("Topic subscriptions are not supported by Expo Push Notifications"),!1}static async unsubscribeFromTopic(e,o){return console.warn("Topic unsubscriptions are not supported by Expo Push Notifications"),!1}static isValidExpoPushToken(e){return o.ExpoNotificationService.isValidExpoPushToken(e)}}e.s(["NotificationService",()=>t])},191486,e=>{"use strict";var o=e.i(102434),t=e.i(389579),r=e.i(343747),n=e.i(686880);class i{static async notifyNewBooking(e,i){try{let s=await t.FCMTokenService.getUserToken(e);if(!s)return console.log("No FCM token found for customer:",e),!1;let a=i.petNames.join(", "),c=(0,r.format)(i.serviceDate,"M월 d일 (E)",{locale:n.ko}),u={title:"예약이 성공적으로 완료되었습니다!",body:`${a}의 미용 예약 (${c} ${i.serviceTime})`,data:{type:"booking_created",bookingId:i.bookingId,bookingNumber:i.bookingNumber,url:`/customer/booking/${i.bookingId}`}};return await o.NotificationService.sendToDevice(s,u)}catch(e){return console.error("Error sending new booking notification:",e),!1}}static async notifyGroomersNewBooking(e){try{let i=await t.FCMTokenService.getTokensByRole("GROOMER");if(0===i.length)return console.log("No groomer FCM tokens found"),{successCount:0,failureCount:0};let s=e.petNames.join(", "),a=(0,r.format)(e.serviceDate,"M월 d일 (E)",{locale:n.ko}),c={title:"새로운 예약이 등록되었습니다",body:`${e.customerName}님의 ${s} 미용 예약 (${a} ${e.serviceTime})`,data:{type:"new_booking_available",bookingId:e.bookingId,bookingNumber:e.bookingNumber,url:`/groomer/bookings/${e.bookingId}`}};return await o.NotificationService.sendToMultipleDevices(i,c)}catch(e){return console.error("Error sending groomer notification:",e),{successCount:0,failureCount:0}}}static async notifyGroomerAssigned(e,i){try{let s=await t.FCMTokenService.getUserToken(e);if(!s)return console.log("No FCM token found for customer:",e),!1;let a=i.petNames.join(", "),c=(0,r.format)(i.serviceDate,"M월 d일 (E)",{locale:n.ko}),u={title:"미용사가 배정되었습니다!",body:`${i.groomerName}님이 ${a}의 미용을 담당하게 되었습니다 (${c} ${i.serviceTime})`,data:{type:"groomer_assigned",bookingId:i.bookingId,bookingNumber:i.bookingNumber,url:`/customer/booking/${i.bookingId}`}};return await o.NotificationService.sendToDevice(s,u)}catch(e){return console.error("Error sending groomer assigned notification:",e),!1}}static async notifyGroomerOfAssignment(e,i){try{let s=await t.FCMTokenService.getUserToken(e);if(!s)return console.log("No FCM token found for groomer:",e),!1;let a=i.petNames.join(", "),c=(0,r.format)(i.serviceDate,"M월 d일 (E)",{locale:n.ko}),u={title:"새로운 예약이 배정되었습니다",body:`${i.customerName}님의 ${a} 미용 예약이 배정되었습니다 (${c} ${i.serviceTime})`,data:{type:"booking_assigned",bookingId:i.bookingId,bookingNumber:i.bookingNumber,url:`/groomer/booking/${i.bookingId}`}};return await o.NotificationService.sendToDevice(s,u)}catch(e){return console.error("Error sending assignment notification to groomer:",e),!1}}static async notifyServiceStarted(e,r){try{let n=await t.FCMTokenService.getUserToken(e);if(!n)return console.log("No FCM token found for customer:",e),!1;let i=r.petNames.join(", "),s={title:"미용 서비스가 시작되었습니다",body:`${r.groomerName}님이 ${i}의 미용을 시작했습니다`,data:{type:"service_started",bookingId:r.bookingId,bookingNumber:r.bookingNumber,url:`/customer/booking/${r.bookingId}`}};return await o.NotificationService.sendToDevice(n,s)}catch(e){return console.error("Error sending service started notification:",e),!1}}static async notifyServiceCompleted(e,r){try{let n=await t.FCMTokenService.getUserToken(e);if(!n)return console.log("No FCM token found for customer:",e),!1;let i=r.petNames.join(", "),s={title:"미용 서비스가 완료되었습니다!",body:`${i}의 미용이 완료되었습니다. 리뷰를 남겨주세요!`,data:{type:"service_completed",bookingId:r.bookingId,bookingNumber:r.bookingNumber}};return await o.NotificationService.sendToDevice(n,s)}catch(e){return console.error("Error sending service completed notification:",e),!1}}static async notifyPaymentStatus(e,r,n){try{let i,s,a,c=await t.FCMTokenService.getUserToken(e);if(!c)return console.log("No FCM token found for customer:",e),!1;switch(n){case"success":i="결제가 완료되었습니다",s=`예약금 결제가 성공적으로 완료되었습니다 (${r.totalPrice.toLocaleString("ko-KR")}원)`,a="payment_success";break;case"failed":i="결제에 실패했습니다",s="결제 처리 중 문제가 발생했습니다. 다시 시도해주세요.",a="payment_failed";break;case"additional_required":i="추가 결제가 필요합니다",s="서비스 완료 후 추가 요금이 발생했습니다. 결제를 진행해주세요.",a="additional_payment_required";break;default:return!1}let u={title:i,body:s,data:{type:a,bookingId:r.bookingId,bookingNumber:r.bookingNumber,url:`/customer/booking/${r.bookingId}/payment`}};return await o.NotificationService.sendToDevice(c,u)}catch(e){return console.error("Error sending payment status notification:",e),!1}}static async sendServiceReminder(e,i,s=2){try{let a=await t.FCMTokenService.getUserToken(e);if(!a)return console.log("No FCM token found for customer:",e),!1;let c=i.petNames.join(", "),u=(0,r.format)(i.serviceDate,"M월 d일 (E)",{locale:n.ko}),l={title:`${s}시간 후 미용 서비스 예정`,body:`${c}의 미용 서비스가 곧 시작됩니다 (${u} ${i.serviceTime})`,data:{type:"service_reminder",bookingId:i.bookingId,bookingNumber:i.bookingNumber,url:`/customer/booking/${i.bookingId}`}};return await o.NotificationService.sendToDevice(a,l)}catch(e){return console.error("Error sending service reminder:",e),!1}}static async sendTodayReminder(e,i){try{let s=await t.FCMTokenService.getUserToken(e);if(!s)return console.log("No FCM token found for customer:",e),!1;let a=i.petNames.join(", ");(0,r.format)(i.serviceDate,"M월 d일 (E)",{locale:n.ko});let c={title:"오늘 미용 서비스가 예정되어 있습니다",body:`${a}의 미용 서비스가 오늘 ${i.serviceTime}에 진행됩니다. 준비해주세요!`,data:{type:"today_reminder",bookingId:i.bookingId,bookingNumber:i.bookingNumber,url:`/customer/booking/${i.bookingId}`}};return await o.NotificationService.sendToDevice(s,c)}catch(e){return console.error("Error sending today reminder:",e),!1}}static async notifyGroomerFirstPaymentCompleted(e,i){try{let s=await t.FCMTokenService.getUserToken(e);if(!s)return console.log("No Expo token found for groomer:",e),!1;let a=i.petNames.join(", "),c=(0,r.format)(i.serviceDate,"M월 d일 (E)",{locale:n.ko}),u={title:"새로운 예약 확인이 필요합니다",body:`${i.customerName}님의 ${a} 미용 예약을 확인해주세요 (${c} ${i.serviceTime})`,data:{type:"groomer_confirmation_needed",bookingId:i.bookingId,bookingNumber:i.bookingNumber,url:`/groomer/booking/${i.bookingId}`}};return await o.NotificationService.sendToDevice(s,u)}catch(e){return console.error("Error sending groomer first payment completed notification:",e),!1}}static async notifyAllGroomersFirstPaymentCompleted(e){try{let i=await t.FCMTokenService.getTokensByRole("GROOMER");if(0===i.length)return console.log("No groomer Expo tokens found"),{successCount:0,failureCount:0};let s=e.petNames.join(", "),a=(0,r.format)(e.serviceDate,"M월 d일 (E)",{locale:n.ko}),c={title:"새로운 예약 확인이 필요합니다",body:`${e.customerName}님의 ${s} 미용 예약을 확인해주세요 (${a} ${e.serviceTime})`,data:{type:"groomer_confirmation_needed",bookingId:e.bookingId,bookingNumber:e.bookingNumber,url:`/groomer/bookings/${e.bookingId}`}};return await o.NotificationService.sendToMultipleDevices(i,c)}catch(e){return console.error("Error sending groomer first payment completed notifications:",e),{successCount:0,failureCount:0}}}static async notifyCustomerQuoteRequested(e,r){try{let n=await t.FCMTokenService.getUserToken(e);if(!n)return console.log("No FCM token found for customer:",e),!1;let i={title:"추가 서비스 견적이 도착했습니다",body:`${r.groomerName}님이 추가 서비스 견적을 보냈습니다 (${r.totalAdditionalAmount.toLocaleString("ko-KR")}원)`,data:{type:"quote_requested",bookingId:r.bookingId,bookingNumber:r.bookingNumber}};return await o.NotificationService.sendToDevice(n,i)}catch(e){return console.error("Error sending quote requested notification:",e),!1}}static async notifyGroomerAdditionalPaymentCompleted(e,i){try{let s=await t.FCMTokenService.getUserToken(e);if(!s)return console.log("No FCM token found for groomer:",e),!1;let a=i.petNames.join(", "),c=(0,r.format)(i.serviceDate,"M월 d일 (E)",{locale:n.ko}),u={title:"추가 결제가 완료되었습니다",body:`${i.customerName}님의 추가 결제가 완료되었습니다. ${a} 미용을 계속 진행해주세요 (${c} ${i.serviceTime})`,data:{type:"additional_payment_completed",bookingId:i.bookingId,bookingNumber:i.bookingNumber}};return await o.NotificationService.sendToDevice(s,u)}catch(e){return console.error("Error sending additional payment completed notification:",e),!1}}}e.s(["BookingNotificationService",()=>i])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__58e921b9._.js.map