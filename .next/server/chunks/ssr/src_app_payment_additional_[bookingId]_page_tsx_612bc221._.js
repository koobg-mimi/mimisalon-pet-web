module.exports=[524890,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(205138),e=a.i(591119),f=a.i(699570),g=a.i(148452),h=a.i(400187),i=a.i(368114);function j(a){return`${a.toLocaleString("ko-KR")}원`}let k=(0,h.cva)("rounded-lg border transition-all",{variants:{variant:{default:"border-border bg-muted/50",compact:"border-border bg-card shadow-sm",detailed:"border-border bg-card shadow-md",highlight:"border-primary/50 bg-gradient-to-br from-primary/5 to-transparent shadow-md",minimal:"border-border/50 bg-transparent"},size:{sm:"p-3",default:"p-4",lg:"p-5"}},defaultVariants:{variant:"default",size:"default"}}),l=c.forwardRef(({className:a,variant:c,size:d,charges:e,showTotal:f=!1,...g},h)=>{let l=e.reduce((a,b)=>a+b.total,0);return(0,b.jsxs)("div",{ref:h,className:"space-y-4",...g,children:[e.map(e=>(0,b.jsxs)("div",{className:(0,i.cn)(k({variant:c,size:d}),"flex items-center justify-between",a),children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-medium",children:e.name}),e.description&&(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:e.description}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs",children:`${e.amount.toLocaleString("ko-KR")}원 \xd7 ${e.quantity}개`})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsx)("p",{className:"font-semibold",children:j(e.total)})})]},e.id)),f&&e.length>0&&(0,b.jsxs)("div",{className:"border-border flex items-center justify-between border-t pt-4",children:[(0,b.jsx)("span",{className:"font-semibold",children:"총 추가 비용"}),(0,b.jsx)("span",{className:"text-primary text-lg font-bold",children:j(l)})]})]})});l.displayName="AdditionalChargesCard";let m=(0,h.cva)("transition-all",{variants:{variant:{default:"border-border bg-card shadow-sm",compact:"border-border bg-card shadow-sm",detailed:"border-border bg-card shadow-md",highlight:"border-primary/50 bg-gradient-to-br from-primary/5 to-transparent shadow-md",minimal:"border-border/50 bg-transparent"},size:{sm:"",default:"",lg:""},sticky:{true:"sticky top-8",false:""}},defaultVariants:{variant:"default",size:"default",sticky:!0}}),n=c.forwardRef(({className:a,variant:c,size:d,sticky:f,booking:g,totalAdditional:h,...k},l)=>(0,b.jsxs)(e.Card,{ref:l,className:(0,i.cn)(m({variant:c,size:d,sticky:f}),a),...k,children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsx)(e.CardTitle,{className:"text-lg",children:"예약 정보"})}),(0,b.jsx)(e.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-foreground font-medium",children:g.service.name}),(0,b.jsxs)("p",{className:"text-muted-foreground text-sm",children:[g.pet.name," (",g.pet.breed,")"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"미용사:"})," ",g.groomer.name]}),(0,b.jsxs)("p",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"지점:"})," ",g.location.name]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm",children:(0,b.jsx)("span",{className:"font-medium",children:"예약일시:"})}),(0,b.jsxs)("p",{className:"text-muted-foreground text-sm",children:[g.date," ",g.time]})]}),(0,b.jsxs)("div",{className:"border-border border-t pt-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm",children:"기본 서비스"}),(0,b.jsx)("span",{className:"text-sm",children:j(g.originalAmount)})]}),(0,b.jsxs)("div",{className:"mt-1 flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm",children:"추가 비용"}),(0,b.jsx)("span",{className:"text-sm",children:j(h)})]}),(0,b.jsxs)("div",{className:"border-border mt-4 flex items-center justify-between border-t pt-4",children:[(0,b.jsx)("span",{className:"text-lg font-semibold",children:"추가 결제금액"}),(0,b.jsx)("span",{className:"text-primary text-lg font-bold",children:j(h)})]})]})]})})]}));n.displayName="BookingInfoSidebar";var o=a.i(292e3),p=a.i(816201),q=a.i(797063);let r=(0,h.cva)("rounded-lg p-4",{variants:{variant:{warning:"bg-yellow-50 border border-yellow-200",info:"bg-blue-50 border border-blue-200",success:"bg-green-50 border border-green-200"},size:{sm:"p-3",default:"p-4",lg:"p-5"}},defaultVariants:{variant:"warning",size:"default"}}),s=c.forwardRef(({className:a,variant:c,size:d,title:e="추가 비용 안내",items:f,icon:g,children:h,...j},k)=>{let l={warning:{icon:g||(0,b.jsx)(o.AlertCircle,{className:"h-5 w-5 text-yellow-600"}),titleColor:"text-yellow-900",textColor:"text-yellow-800"},info:{icon:g||(0,b.jsx)(q.Info,{className:"h-5 w-5 text-blue-600"}),titleColor:"text-blue-900",textColor:"text-blue-800"},success:{icon:g||(0,b.jsx)(p.CheckCircle,{className:"h-5 w-5 text-green-600"}),titleColor:"text-green-900",textColor:"text-green-800"}}[c||"warning"];return(0,b.jsx)("div",{ref:k,className:(0,i.cn)(r({variant:c,size:d}),a),...j,children:(0,b.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,b.jsx)("div",{className:"mt-0.5 flex-shrink-0",children:l.icon}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:(0,i.cn)("mb-2 font-semibold",l.titleColor),children:e}),h||(0,b.jsx)("ul",{className:(0,i.cn)("space-y-1 text-sm",l.textColor),children:(f||["위 비용은 서비스 진행 중 발생한 추가 항목입니다","미용사와 사전 협의된 내용에 한해 청구됩니다","문의사항이 있으시면 고객센터로 연락주세요"]).map((a,c)=>(0,b.jsxs)("li",{children:["• ",a]},c))})]})]})})});function t({className:a,header:c,content:d,sidebar:e,...f}){return(0,b.jsxs)("div",{className:(0,i.cn)("bg-background min-h-screen",a),...f,children:[c&&(0,b.jsx)("header",{className:"border-border border-b",children:(0,b.jsx)("div",{className:"container mx-auto px-4 py-4",children:c})}),(0,b.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,b.jsx)("div",{className:"mx-auto max-w-4xl space-y-8",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[(0,b.jsx)("div",{className:"space-y-6 lg:col-span-2",children:d}),(0,b.jsx)("div",{className:"lg:col-span-1",children:e})]})})})]})}function u({className:a,title:c="추가 결제",description:d="서비스 중 추가로 발생한 비용을 결제해주세요",...e}){return(0,b.jsxs)("div",{className:(0,i.cn)(a),...e,children:[(0,b.jsx)("h1",{className:"text-foreground text-2xl font-bold",children:c}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:d})]})}s.displayName="PaymentInfoNotice",t.displayName="AdditionalPaymentLayout",u.displayName="AdditionalPaymentHeader";var v=a.i(433217),w=a.i(370025),x=a.i(50944),y=a.i(529139),z=a.i(637441);function A({params:a}){let h=(0,c.use)(a).bookingId,{session:i,isSessionPending:j,profile:k,booking:m,isBookingLoading:o,paymentId:p,isInitializingPayment:q,totalAdditionalAmount:r,orderName:A,handlePaymentRequest:B,handlePaymentSuccess:C,handlePaymentError:D}=function(a){let{bookingId:b}=a,d=(0,x.useRouter)(),{data:e,isPending:f}=(0,y.useSession)(),{profile:g}=(0,z.useProfile)(),h=!!e?.user,i=e?.user?.role==="CUSTOMER",{booking:j,isLoading:k,error:l}=function(a){let{bookingId:b,hasSession:c,isCustomer:d}=a,e=(0,v.useQuery)({queryKey:["booking",b,"additional-payment"],queryFn:async()=>{let a=await fetch(`/api/bookings/${b}/additional-payment`);if(!a.ok)throw Error((await a.json().catch(()=>({}))).error||"예약 정보를 불러오는데 실패했습니다");return a.json()},enabled:!!b&&c&&d,retry:!1,staleTime:3e5});return{booking:e.data,isLoading:e.isLoading,error:e.error,queryResult:e}}({bookingId:b,hasSession:h,isCustomer:i}),m=j?j.additionalCharges.reduce((a,b)=>a+b.total,0):0,n=j?`추가 서비스 - ${j.pet.name}`:"",{paymentId:o,initializePayment:p,isInitializing:q}=function(a){let{bookingId:b,amount:d,orderName:e}=a,[f,g]=(0,c.useState)(null),h=(0,w.useMutation)({mutationFn:async()=>{let a=await fetch("/api/payments/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:b,amount:d,orderName:e})});if(!a.ok)throw Error((await a.json().catch(()=>({}))).error||"결제 초기화에 실패했습니다");return(await a.json()).paymentId},onSuccess:a=>{g(a)},onError:a=>{g(null),console.error("[Payment Initialization] Error:",a.message)}});return{paymentId:f,initializePayment:async()=>{if(h.isPending)return console.log("[Additional Payment] Request already in progress, ignoring duplicate click"),null;try{return{paymentId:await h.mutateAsync(),bookingId:b,amount:d,orderName:e}}catch(a){return console.error("[Payment Initialization] Failed:",a),null}},isInitializing:h.isPending,error:h.error,mutation:h}}({bookingId:b,amount:m,orderName:n});(0,c.useEffect)(()=>{if(!f){if(!h)return void d.push("/auth/signin");if(!i)return void d.push("/dashboard")}},[h,i,f,d]),(0,c.useEffect)(()=>{b||d.push("/customer/bookings")},[b,d]);let r=async a=>{if(o)try{await d.push(`/payment/success?paymentId=${o}&type=additional`)}catch(a){console.error("[Payment] Redirect failed:",a),alert("결제는 완료되었으나 페이지 이동에 실패했습니다. 예약 내역에서 확인해주세요.")}else console.error("[Payment] Missing paymentId after success"),alert("결제가 완료되었으나 정보를 찾을 수 없습니다. 고객센터로 문의해주세요.")};return{session:e,isSessionPending:f,profile:g,booking:j,isBookingLoading:k,bookingError:l,paymentId:o,isInitializingPayment:q,totalAdditionalAmount:m,orderName:n,handlePaymentRequest:async()=>p(),handlePaymentSuccess:r,handlePaymentError:a=>{console.error("[Payment] Error:",a)}}}({bookingId:h});return j||o?(0,b.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,b.jsx)(d.LoadingSpinner,{size:"lg"})}):i&&i.user?.role==="CUSTOMER"&&m?(0,b.jsx)(t,{header:(0,b.jsx)(u,{}),content:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{className:"text-xl",children:"추가 비용 내역"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"서비스 중 추가로 발생한 비용입니다"})]}),(0,b.jsxs)(e.CardContent,{children:[(0,b.jsx)(l,{charges:m.additionalCharges,variant:"default",size:"default"}),(0,b.jsx)(s,{className:"mt-6"})]})]}),p?(0,b.jsx)(g.PaymentCard,{amount:r,orderName:A,orderId:p,customerInfo:{name:k?.name||i?.user?.name||"",email:k?.email||i?.user?.email||"",phone:k?.phoneNumber||""},onSuccess:C,onError:D,termsText:"추가 결제 약관에 동의합니다",customData:{type:"additional",bookingId:h,originalAmount:m.originalAmount,additionalCharges:m.additionalCharges},title:"결제 방법 선택",description:"추가 서비스 결제를 위한 방법을 선택해주세요"}):(0,b.jsxs)(e.Card,{children:[(0,b.jsxs)(e.CardHeader,{children:[(0,b.jsx)(e.CardTitle,{className:"text-xl",children:"결제 진행"}),(0,b.jsx)("p",{className:"text-muted-foreground text-sm",children:"아래 버튼을 클릭하여 결제를 진행해주세요"})]}),(0,b.jsx)(e.CardContent,{children:(0,b.jsx)(f.Button,{onClick:B,disabled:q,size:"lg",className:"w-full",children:q?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.LoadingSpinner,{size:"sm",className:"mr-2"}),"결제 준비 중..."]}):"결제 진행하기"})})]})]}),sidebar:(0,b.jsx)(n,{booking:m,totalAdditional:r,variant:"default",sticky:!0})}):null}a.s(["default",()=>A],524890)}];

//# sourceMappingURL=src_app_payment_additional_%5BbookingId%5D_page_tsx_612bc221._.js.map