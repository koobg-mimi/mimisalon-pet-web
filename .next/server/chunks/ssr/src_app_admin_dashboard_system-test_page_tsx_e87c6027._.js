module.exports=[370236,a=>{"use strict";var b=a.i(187924),c=a.i(256711),d=a.i(302491),e=a.i(529139),f=a.i(50944),g=a.i(572131),h=a.i(433217),i=a.i(370025),j=a.i(937927),k=a.i(699570),l=a.i(205138),m=a.i(591119),n=a.i(866718),o=a.i(870430),p=a.i(429246),q=a.i(580701),r=a.i(147271),s=a.i(199071),s=s,t=a.i(660246),u=a.i(641710),v=a.i(601304),v=v,w=a.i(941675),x=a.i(1631);let y=(0,a.i(170106).default)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var z=a.i(669520),A=a.i(823292);function B(){let{data:a,isPending:B}=(0,e.useSession)(),C=(0,f.useRouter)(),D=(0,j.useQueryClient)(),[E,F]=(0,g.useState)(""),[G,H]=(0,g.useState)(""),[I,J]=(0,g.useState)(""),[K,L]=(0,g.useState)(1),[M,N]=(0,g.useState)("미미살롱 예약 알림"),[O,P]=(0,g.useState)("곧 예약 시간입니다!");(0,g.useEffect)(()=>{a||C.push("/auth/signin"),a?.user?.role&&"ADMIN"!==a.user.role&&C.push("/admin/dashboard/overview")},[a,C]);let{data:Q,isLoading:R}=(0,h.useQuery)({queryKey:["admin","users"],queryFn:async()=>{let a=await fetch("/api/admin/users");if(!a.ok)throw Error("Failed to fetch users");return a.json()},enabled:!!a?.user&&"ADMIN"===a.user.role}),{data:S,isLoading:T,refetch:U}=(0,h.useQuery)({queryKey:["admin","queue-status"],queryFn:async()=>{let a=await fetch("/api/admin/notifications/queue-status");if(!a.ok)throw Error("Failed to fetch queue status");return a.json()},enabled:!!a?.user&&"ADMIN"===a.user.role}),V=(0,i.useMutation)({mutationFn:async a=>{let b=await fetch("/api/admin/notifications/send-fcm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)throw Error((await b.json()).message||"FCM 알림 전송에 실패했습니다.");return b.json()},onSuccess:()=>{A.toast.success("FCM 알림이 성공적으로 전송되었습니다!"),H(""),J("")},onError:a=>{console.error("FCM send error:",a),A.toast.error(a instanceof Error?a.message:"FCM 알림 전송 중 오류가 발생했습니다.")}}),W=(0,i.useMutation)({mutationFn:async a=>{let b=await fetch("/api/admin/notifications/schedule-test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)throw Error((await b.json()).message||"알림 예약에 실패했습니다.");return b.json()},onSuccess:(a,b)=>{A.toast.success(`${b.delayMinutes}분 후 알림이 예약되었습니다! (Job ID: ${a.jobId})`),D.invalidateQueries({queryKey:["admin","queue-status"]})},onError:a=>{console.error("Schedule test error:",a),A.toast.error(a instanceof Error?a.message:"알림 예약 중 오류가 발생했습니다.")}}),X=Q?.users||[],Y=S?.status||null,Z=S?.recentJobs||[];if(B||R)return(0,b.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,b.jsx)(l.LoadingSpinner,{size:"lg"})});if(!a||a.user?.role!=="ADMIN")return null;let $=X.find(a=>a.id===E);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center gap-2",children:[(0,b.jsx)(r.TestTube,{className:"text-primary h-6 w-6"}),(0,b.jsx)("h1",{className:"text-foreground text-3xl font-bold",children:"시스템 테스트"})]}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"FCM 알림 및 예약 알림 시스템을 테스트하세요"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)(m.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(x.Smartphone,{className:"h-5 w-5"}),"FCM 즉시 알림 테스트"]})}),(0,b.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"user-select",children:"대상 사용자"}),(0,b.jsxs)(q.Select,{value:E,onValueChange:F,children:[(0,b.jsx)(q.SelectTrigger,{children:(0,b.jsx)(q.SelectValue,{placeholder:"사용자를 선택하세요"})}),(0,b.jsx)(q.SelectContent,{children:X.map(a=>(0,b.jsx)(q.SelectItem,{value:a.id,children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(t.Users,{className:"h-4 w-4"}),a.name," (",a.email,")",(0,b.jsx)("span",{className:"bg-muted rounded px-1 text-xs",children:a.role})]})},a.id))})]}),$&&(0,b.jsxs)("p",{className:"text-muted-foreground mt-1 text-xs",children:["FCM 토큰: ",$.fcmToken?"등록됨":"미등록"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"notification-title",children:"알림 제목"}),(0,b.jsx)(n.Input,{id:"notification-title",value:G,onChange:a=>H(a.target.value),placeholder:"알림 제목을 입력하세요"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"notification-body",children:"알림 내용"}),(0,b.jsx)(p.Textarea,{id:"notification-body",value:I,onChange:a=>J(a.target.value),placeholder:"알림 내용을 입력하세요",rows:3})]}),(0,b.jsx)(k.Button,{onClick:()=>{E&&G&&I?V.mutate({userId:E,title:G,body:I}):A.toast.error("모든 필드를 입력해주세요.")},disabled:V.isPending||!E,className:"w-full",children:V.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.LoadingSpinner,{size:"sm",className:"mr-2"}),"전송 중..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.default,{className:"mr-2 h-4 w-4"}),"FCM 알림 전송"]})})]})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)(m.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(u.Clock,{className:"h-5 w-5"}),"BullMQ 예약 알림 테스트"]})}),(0,b.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"delay-minutes",children:"지연 시간 (분)"}),(0,b.jsx)(n.Input,{id:"delay-minutes",type:"number",min:"1",max:"60",value:K,onChange:a=>L(Number(a.target.value)),placeholder:"1-60분 사이 입력"}),(0,b.jsxs)("p",{className:"text-muted-foreground mt-1 text-xs",children:[K,"분 후에 알림이 전송됩니다"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"test-title",children:"테스트 알림 제목"}),(0,b.jsx)(n.Input,{id:"test-title",value:M,onChange:a=>N(a.target.value),placeholder:"테스트 알림 제목"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"test-body",children:"테스트 알림 내용"}),(0,b.jsx)(p.Textarea,{id:"test-body",value:O,onChange:a=>P(a.target.value),placeholder:"테스트 알림 내용",rows:3})]}),(0,b.jsx)(k.Button,{onClick:()=>{!E||K<1?A.toast.error("유효한 사용자와 시간을 선택해주세요."):W.mutate({userId:E,delayMinutes:K,title:M,body:O})},disabled:W.isPending||!E,className:"w-full",variant:"outline",children:W.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.LoadingSpinner,{size:"sm",className:"mr-2"}),"예약 중..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Calendar,{className:"mr-2 h-4 w-4"}),K,"분 후 알림 예약"]})})]})]})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)(m.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(s.default,{className:"h-5 w-5"}),"시스템 정보"]})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 text-sm md:grid-cols-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"총 사용자 수:"}),(0,b.jsxs)("p",{className:"font-medium",children:[X.length,"명"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"FCM 토큰 등록 사용자:"}),(0,b.jsxs)("p",{className:"font-medium",children:[X.filter(a=>a.fcmToken).length,"명"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"선택된 사용자:"}),(0,b.jsx)("p",{className:"font-medium",children:$?`${$.name} (${$.role})`:"없음"})]})]})})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)(m.CardTitle,{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(y,{className:"h-5 w-5"}),"BullMQ 큐 상태"]}),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>U(),disabled:T,children:[T?(0,b.jsx)(l.LoadingSpinner,{size:"sm",className:"mr-2"}):(0,b.jsx)(z.RefreshCw,{className:"mr-2 h-4 w-4"}),"새로고침"]})]})}),(0,b.jsx)(m.CardContent,{children:Y?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm md:grid-cols-5",children:[(0,b.jsxs)("div",{className:"rounded border p-3 text-center",children:[(0,b.jsx)("div",{className:"text-xl font-bold text-yellow-600",children:Y.waiting}),(0,b.jsx)("div",{className:"text-muted-foreground",children:"대기중"})]}),(0,b.jsxs)("div",{className:"rounded border p-3 text-center",children:[(0,b.jsx)("div",{className:"text-xl font-bold text-blue-600",children:Y.active}),(0,b.jsx)("div",{className:"text-muted-foreground",children:"처리중"})]}),(0,b.jsxs)("div",{className:"rounded border p-3 text-center",children:[(0,b.jsx)("div",{className:"text-xl font-bold text-purple-600",children:Y.delayed}),(0,b.jsx)("div",{className:"text-muted-foreground",children:"지연됨"})]}),(0,b.jsxs)("div",{className:"rounded border p-3 text-center",children:[(0,b.jsx)("div",{className:"text-xl font-bold text-green-600",children:Y.completed}),(0,b.jsx)("div",{className:"text-muted-foreground",children:"완료"})]}),(0,b.jsxs)("div",{className:"rounded border p-3 text-center",children:[(0,b.jsx)("div",{className:"text-xl font-bold text-red-600",children:Y.failed}),(0,b.jsx)("div",{className:"text-muted-foreground",children:"실패"})]})]}),Z.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"mb-3 font-medium",children:"최근 작업 목록"}),(0,b.jsx)("div",{className:"max-h-60 space-y-2 overflow-y-auto",children:Z.map(a=>(0,b.jsxs)("div",{className:"rounded border p-3 text-sm",children:[(0,b.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"font-medium",children:["Job #",a.id]}),(0,b.jsx)("span",{className:`rounded px-2 py-1 text-xs ${"completed"===a.state?"bg-green-100 text-green-700":"failed"===a.state?"bg-red-100 text-red-700":"delayed"===a.state?"bg-purple-100 text-purple-700":"bg-yellow-100 text-yellow-700"}`,children:a.state})]}),(0,b.jsxs)("div",{className:"text-muted-foreground",children:[(0,b.jsxs)("div",{children:["제목: ",a.data?.title||a.name]}),a.delay&&(0,b.jsxs)("div",{children:["지연시간: ",Math.round(a.delay/1e3/60),"분"]}),(0,b.jsxs)("div",{children:["시도: ",a.attempts,"/",a.maxAttempts]}),(0,b.jsxs)("div",{children:["생성:"," ",(0,c.format)(new Date(a.timestamp),"yyyy-MM-dd HH:mm:ss",{locale:d.ko})]})]})]},a.id))})]})]}):(0,b.jsx)("div",{className:"text-muted-foreground py-4 text-center",children:"큐 상태를 불러오는 중..."})})]})]})}a.s(["default",()=>B],370236)}];

//# sourceMappingURL=src_app_admin_dashboard_system-test_page_tsx_e87c6027._.js.map