module.exports=[544402,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(171967),g=a.i(695245),h=a.i(159501),i=a.i(591119),j=a.i(699570),k=a.i(315055),l=a.i(205138),m=a.i(866718),n=a.i(870430),o=a.i(507554),p=a.i(470121),q=a.i(750104),r=a.i(30553),s=a.i(224050),t=a.i(225152),u=a.i(507827),v=a.i(3688),w=a.i(77994),x=a.i(777192),y="Radio",[z,A]=(0,q.createContextScope)(y),[B,C]=z(y),D=c.forwardRef((a,d)=>{let{__scopeRadio:e,name:f,checked:g=!1,required:h,disabled:i,value:j="on",onCheck:k,form:l,...m}=a,[n,q]=c.useState(null),s=(0,p.useComposedRefs)(d,a=>q(a)),t=c.useRef(!1),u=!n||l||!!n.closest("form");return(0,b.jsxs)(B,{scope:e,checked:g,disabled:i,children:[(0,b.jsx)(r.Primitive.button,{type:"button",role:"radio","aria-checked":g,"data-state":H(g),"data-disabled":i?"":void 0,disabled:i,value:j,...m,ref:s,onClick:(0,o.composeEventHandlers)(a.onClick,a=>{g||k?.(),u&&(t.current=a.isPropagationStopped(),t.current||a.stopPropagation())})}),u&&(0,b.jsx)(G,{control:n,bubbles:!t.current,name:f,value:j,checked:g,required:h,disabled:i,form:l,style:{transform:"translateX(-100%)"}})]})});D.displayName=y;var E="RadioIndicator",F=c.forwardRef((a,c)=>{let{__scopeRadio:d,forceMount:e,...f}=a,g=C(E,d);return(0,b.jsx)(x.Presence,{present:e||g.checked,children:(0,b.jsx)(r.Primitive.span,{"data-state":H(g.checked),"data-disabled":g.disabled?"":void 0,...f,ref:c})})});F.displayName=E;var G=c.forwardRef(({__scopeRadio:a,control:d,checked:e,bubbles:f=!0,...g},h)=>{let i=c.useRef(null),j=(0,p.useComposedRefs)(i,h),k=(0,w.usePrevious)(e),l=(0,v.useSize)(d);return c.useEffect(()=>{let a=i.current;if(!a)return;let b=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(k!==e&&b){let c=new Event("click",{bubbles:f});b.call(a,e),a.dispatchEvent(c)}},[k,e,f]),(0,b.jsx)(r.Primitive.input,{type:"radio","aria-hidden":!0,defaultChecked:e,...g,tabIndex:-1,ref:j,style:{...g.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function H(a){return a?"checked":"unchecked"}G.displayName="RadioBubbleInput";var I=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],J="RadioGroup",[K,L]=(0,q.createContextScope)(J,[s.createRovingFocusGroupScope,A]),M=(0,s.createRovingFocusGroupScope)(),N=A(),[O,P]=K(J),Q=c.forwardRef((a,c)=>{let{__scopeRadioGroup:d,name:e,defaultValue:f,value:g,required:h=!1,disabled:i=!1,orientation:j,dir:k,loop:l=!0,onValueChange:m,...n}=a,o=M(d),p=(0,u.useDirection)(k),[q,v]=(0,t.useControllableState)({prop:g,defaultProp:f??null,onChange:m,caller:J});return(0,b.jsx)(O,{scope:d,name:e,required:h,disabled:i,value:q,onValueChange:v,children:(0,b.jsx)(s.Root,{asChild:!0,...o,orientation:j,dir:p,loop:l,children:(0,b.jsx)(r.Primitive.div,{role:"radiogroup","aria-required":h,"aria-orientation":j,"data-disabled":i?"":void 0,dir:p,...n,ref:c})})})});Q.displayName=J;var R="RadioGroupItem",S=c.forwardRef((a,d)=>{let{__scopeRadioGroup:e,disabled:f,...g}=a,h=P(R,e),i=h.disabled||f,j=M(e),k=N(e),l=c.useRef(null),m=(0,p.useComposedRefs)(d,l),n=h.value===g.value,q=c.useRef(!1);return c.useEffect(()=>{let a=a=>{I.includes(a.key)&&(q.current=!0)},b=()=>q.current=!1;return document.addEventListener("keydown",a),document.addEventListener("keyup",b),()=>{document.removeEventListener("keydown",a),document.removeEventListener("keyup",b)}},[]),(0,b.jsx)(s.Item,{asChild:!0,...j,focusable:!i,active:n,children:(0,b.jsx)(D,{disabled:i,required:h.required,checked:n,...k,...g,name:h.name,ref:m,onCheck:()=>h.onValueChange(g.value),onKeyDown:(0,o.composeEventHandlers)(a=>{"Enter"===a.key&&a.preventDefault()}),onFocus:(0,o.composeEventHandlers)(g.onFocus,()=>{q.current&&l.current?.click()})})})});S.displayName=R;var T=c.forwardRef((a,c)=>{let{__scopeRadioGroup:d,...e}=a,f=N(d);return(0,b.jsx)(F,{...f,...e,ref:c})});T.displayName="RadioGroupIndicator";var U=a.i(171150),V=a.i(368114);function W({className:a,...c}){return(0,b.jsx)(Q,{"data-slot":"radio-group",className:(0,V.cn)("grid gap-3",a),...c})}function X({className:a,...c}){return(0,b.jsx)(S,{"data-slot":"radio-group-item",className:(0,V.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...c,children:(0,b.jsx)(T,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,b.jsx)(U.CircleIcon,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var Y=a.i(580701),Z=a.i(839982),$=a.i(170106);let _=(0,$.default)("banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);var aa=a.i(511081),aa=aa,ab=a.i(438500),ac=a.i(485155),ad=a.i(156757);let ae=ad.z.object({type:ad.z.enum(["CARD","BANK_TRANSFER","DIGITAL_WALLET"]),cardNumber:ad.z.string().optional(),expiryDate:ad.z.string().optional(),cvv:ad.z.string().optional(),cardHolderName:ad.z.string().optional(),bankCode:ad.z.string().optional(),accountNumber:ad.z.string().optional(),walletProvider:ad.z.enum(["KAKAO_PAY","TOSS_PAY","NAVER_PAY"]).optional()}),af=ad.z.object({name:ad.z.string().min(1,"이름을 입력해주세요"),phone:ad.z.string().min(1,"연락처를 입력해주세요"),address:ad.z.string().min(1,"주소를 입력해주세요"),detailAddress:ad.z.string().optional(),zipCode:ad.z.string().min(5,"우편번호를 입력해주세요")}),ag=ad.z.object({bookingId:ad.z.string(),services:ad.z.array(ad.z.object({id:ad.z.string(),name:ad.z.string(),price:ad.z.number(),duration:ad.z.number()})),totalAmount:ad.z.number().positive("결제 금액이 올바르지 않습니다"),discountAmount:ad.z.number().optional().default(0),finalAmount:ad.z.number().positive(),paymentMethod:ae,billingAddress:af,couponCode:ad.z.string().optional(),agreeToTerms:ad.z.boolean().refine(a=>!0===a,{message:"이용약관에 동의해주세요"}),agreeToPrivacy:ad.z.boolean().refine(a=>!0===a,{message:"개인정보 처리방침에 동의해주세요"})});ad.z.object({bookingId:ad.z.string(),reason:ad.z.enum(["CUSTOMER_REQUEST","GROOMER_CANCELLATION","SALON_CLOSURE","FORCE_MAJEURE","OTHER"]),customReason:ad.z.string().optional(),refundAmount:ad.z.number().positive(),bankAccount:ad.z.object({bankCode:ad.z.string(),accountNumber:ad.z.string(),accountHolder:ad.z.string()}).optional()});let ah=ad.z.object({code:ad.z.string().min(1,"쿠폰 코드를 입력해주세요"),bookingAmount:ad.z.number().positive()}),ai=[{id:"CARD",label:"신용/체크카드",description:"안전한 카드 결제",icon:Z.CreditCardIcon,color:"blue"},{id:"DIGITAL_WALLET",label:"간편결제",description:"카카오페이, 토스페이, 네이버페이",icon:aa.default,color:"green"},{id:"BANK_TRANSFER",label:"계좌이체",description:"실시간 계좌이체",icon:_,color:"purple"}],aj=[{value:"KAKAO_PAY",label:"카카오페이"},{value:"TOSS_PAY",label:"토스페이"},{value:"NAVER_PAY",label:"네이버페이"}],ak=[{value:"004",label:"KB국민은행"},{value:"011",label:"NH농협은행"},{value:"020",label:"우리은행"},{value:"088",label:"신한은행"},{value:"081",label:"하나은행"},{value:"027",label:"씨티은행"},{value:"003",label:"IBK기업은행"},{value:"007",label:"수협은행"},{value:"023",label:"SC제일은행"},{value:"039",label:"경남은행"}];function al({selectedMethod:a,onMethodChange:d,className:e}){let[f,j]=(0,c.useState)(a?.type||""),{register:k,setValue:l,formState:{errors:o}}=(0,g.useForm)({resolver:(0,h.zodResolver)(ae),defaultValues:a||{type:"CARD"}});return(0,b.jsx)("div",{className:(0,V.cn)("space-y-6",e),children:(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(ab.ShieldCheckIcon,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"결제 방법 선택"})]})}),(0,b.jsx)(i.CardContent,{className:"space-y-6",children:(0,b.jsx)(W,{value:f,onValueChange:a=>{j(a),l("type",a),d({type:a}),l("cardNumber",void 0),l("expiryDate",void 0),l("cvv",void 0),l("cardHolderName",void 0),l("bankCode",void 0),l("accountNumber",void 0),l("walletProvider",void 0)},className:"space-y-4",children:ai.map(a=>{let c=a.icon;return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(X,{value:a.id,id:a.id}),(0,b.jsxs)("label",{htmlFor:a.id,className:"flex flex-1 cursor-pointer items-center space-x-3",children:[(0,b.jsx)("div",{className:(0,V.cn)("rounded-lg p-2","blue"===a.color&&"bg-blue-100 text-blue-600","green"===a.color&&"bg-green-100 text-green-600","purple"===a.color&&"bg-purple-100 text-purple-600"),children:(0,b.jsx)(c,{className:"h-5 w-5"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.label}),(0,b.jsx)("div",{className:"text-muted-foreground text-sm",children:a.description})]})]})]}),f===a.id&&(0,b.jsxs)("div",{className:"bg-muted ml-8 space-y-4 rounded-lg p-4",children:["CARD"===a.id&&(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)(n.Label,{htmlFor:"cardNumber",children:"카드번호"}),(0,b.jsx)(m.Input,{id:"cardNumber",placeholder:"1234 5678 9012 3456",maxLength:19,...k("cardNumber"),onChange:a=>{l("cardNumber",(a=>{let b=a.replace(/\s+/g,"").replace(/[^0-9]/gi,""),c=b.match(/\d{4,16}/g),d=c&&c[0]||"",e=[];for(let a=0,b=d.length;a<b;a+=4)e.push(d.substring(a,a+4));return e.length?e.join(" "):b})(a.target.value))}}),o.cardNumber&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.cardNumber.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"expiryDate",children:"유효기간"}),(0,b.jsx)(m.Input,{id:"expiryDate",placeholder:"MM/YY",maxLength:5,...k("expiryDate"),onChange:a=>{let b;l("expiryDate",(b=a.target.value.replace(/\D/g,"")).length>=2?b.substring(0,2)+"/"+b.substring(2,4):b)}}),o.expiryDate&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.expiryDate.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"cvv",children:"CVV"}),(0,b.jsx)(m.Input,{id:"cvv",placeholder:"123",maxLength:4,...k("cvv")}),o.cvv&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.cvv.message})]}),(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)(n.Label,{htmlFor:"cardHolderName",children:"카드 소유자명"}),(0,b.jsx)(m.Input,{id:"cardHolderName",placeholder:"홍길동",...k("cardHolderName")}),o.cardHolderName&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.cardHolderName.message})]})]}),"DIGITAL_WALLET"===a.id&&(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"walletProvider",children:"간편결제 선택"}),(0,b.jsxs)(Y.Select,{onValueChange:a=>l("walletProvider",a),children:[(0,b.jsx)(Y.SelectTrigger,{children:(0,b.jsx)(Y.SelectValue,{placeholder:"간편결제를 선택해주세요"})}),(0,b.jsx)(Y.SelectContent,{children:aj.map(a=>(0,b.jsx)(Y.SelectItem,{value:a.value,children:a.label},a.value))})]}),o.walletProvider&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.walletProvider.message})]}),"BANK_TRANSFER"===a.id&&(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"bankCode",children:"은행 선택"}),(0,b.jsxs)(Y.Select,{onValueChange:a=>l("bankCode",a),children:[(0,b.jsx)(Y.SelectTrigger,{children:(0,b.jsx)(Y.SelectValue,{placeholder:"은행을 선택해주세요"})}),(0,b.jsx)(Y.SelectContent,{children:ak.map(a=>(0,b.jsx)(Y.SelectItem,{value:a.value,children:a.label},a.value))})]}),o.bankCode&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.bankCode.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"accountNumber",children:"계좌번호"}),(0,b.jsx)(m.Input,{id:"accountNumber",placeholder:"계좌번호를 입력해주세요",...k("accountNumber")}),o.accountNumber&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.accountNumber.message})]})]}),(0,b.jsxs)("div",{className:"flex items-start space-x-2 rounded-lg border border-blue-200 bg-blue-50 p-3",children:[(0,b.jsx)(ac.AlertCircleIcon,{className:"mt-0.5 h-5 w-5 flex-shrink-0 text-blue-600"}),(0,b.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,b.jsx)("p",{className:"font-medium",children:"보안 안내"}),(0,b.jsx)("p",{className:"mt-1",children:"결제 정보는 SSL 암호화로 안전하게 보호되며, 당사는 결제 정보를 저장하지 않습니다."})]})]})]})]},a.id)})})})]})})}var am=a.i(505084),an=a.i(786304),ao=a.i(275564),ap=a.i(558020);let aq=(0,$.default)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),ar=(0,$.default)("percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);var as=a.i(854251);function at({services:a,couponDiscount:d,onCouponApply:e,onCouponRemove:f,className:k}){let[l,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),{register:q,handleSubmit:r,formState:{errors:s},reset:t}=(0,g.useForm)({resolver:(0,h.zodResolver)(ah)}),u=a.reduce((a,b)=>a+b.price,0),v=d?.discountAmount||0,w=u-v,x=a.reduce((a,b)=>a+b.duration,0),y=async a=>{n(!0),p(null);try{await e({...a,bookingAmount:u})?t():p("유효하지 않은 쿠폰 코드입니다")}catch{p("쿠폰 적용 중 오류가 발생했습니다")}finally{n(!1)}};return(0,b.jsx)("div",{className:(0,V.cn)("space-y-6",k),children:(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(Z.CreditCardIcon,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"결제 요약"})]})}),(0,b.jsxs)(i.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h4",{className:"text-muted-foreground text-sm font-medium",children:"선택된 서비스"}),a.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between py-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"bg-primary/10 rounded-lg p-2",children:(0,b.jsx)(ao.ScissorsIcon,{className:"text-primary h-4 w-4"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:a.name}),(0,b.jsxs)("div",{className:"text-muted-foreground mt-1 flex items-center space-x-4 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,b.jsx)(ap.ClockIcon,{className:"h-3 w-3"}),(0,b.jsxs)("span",{children:[a.duration,"분"]})]}),(0,b.jsx)(an.Badge,{variant:"outline",className:"text-xs",children:a.category})]})]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsxs)("div",{className:"font-medium",children:[a.price.toLocaleString(),"원"]})})]},a.id))]}),(0,b.jsx)(am.Separator,{}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h4",{className:"text-muted-foreground flex items-center space-x-2 text-sm font-medium",children:[(0,b.jsx)(aq,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:"할인 쿠폰"})]}),d?(0,b.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-green-200 bg-green-50 p-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(as.CheckCircleIcon,{className:"h-5 w-5 text-green-600"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"font-medium text-green-900",children:["쿠폰 적용 완료: ",d.code]}),(0,b.jsx)("div",{className:"text-sm text-green-700",children:"PERCENTAGE"===d.discountType?`${d.discountAmount}% 할인`:`${d.discountAmount.toLocaleString("ko-KR")}원 할인`})]})]}),(0,b.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>{f(),p(null)},className:"border-green-300 text-green-700 hover:bg-green-100",children:"제거"})]}):(0,b.jsxs)("form",{onSubmit:r(y),className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(m.Input,{placeholder:"쿠폰 코드를 입력해주세요",...q("code")}),s.code&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:s.code.message})]}),(0,b.jsx)(j.Button,{type:"submit",disabled:l,className:"px-6",children:l?"확인 중...":"적용"})]}),o&&(0,b.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-red-600",children:[(0,b.jsx)(ac.AlertCircleIcon,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:o})]})]})]}),(0,b.jsx)(am.Separator,{}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsx)("span",{children:"서비스 소계"}),(0,b.jsxs)("span",{children:[u.toLocaleString("ko-KR"),"원"]})]}),v>0&&(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm text-green-600",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,b.jsx)(ar,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:"할인 금액"})]}),(0,b.jsxs)("span",{children:["-",v.toLocaleString("ko-KR"),"원"]})]}),(0,b.jsx)(am.Separator,{}),(0,b.jsxs)("div",{className:"flex items-center justify-between text-lg font-semibold",children:[(0,b.jsx)("span",{children:"총 결제금액"}),(0,b.jsxs)("span",{className:"text-primary",children:[w.toLocaleString("ko-KR"),"원"]})]}),(0,b.jsxs)("div",{className:"text-muted-foreground flex items-center justify-center text-sm",children:[(0,b.jsx)(ap.ClockIcon,{className:"mr-1 h-4 w-4"}),(0,b.jsxs)("span",{children:["예상 소요시간: ",x,"분"]})]})]}),(0,b.jsx)("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:(0,b.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,b.jsx)(ac.AlertCircleIcon,{className:"mt-0.5 h-5 w-5 flex-shrink-0 text-blue-600"}),(0,b.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,b.jsx)("p",{className:"font-medium",children:"결제 안내"}),(0,b.jsxs)("ul",{className:"mt-2 list-inside list-disc space-y-1",children:[(0,b.jsx)("li",{children:"예약 확정 후 24시간 전까지 무료 취소 가능합니다"}),(0,b.jsx)("li",{children:"당일 취소 시 취소 수수료가 발생할 수 있습니다"}),(0,b.jsx)("li",{children:"결제 후 영수증은 이메일로 발송됩니다"})]})]})]})})]})]})})}var au=a.i(301378),av=a.i(312207);function aw({defaultValues:a,onAddressChange:c,className:d}){let{register:e,handleSubmit:f,setValue:k,watch:l,formState:{errors:o,isValid:p}}=(0,g.useForm)({resolver:(0,h.zodResolver)(af),defaultValues:a||{},mode:"onChange"});l();let q=a=>{c(a)},r=()=>{p&&f(q)()};return(0,b.jsx)("div",{className:(0,V.cn)("space-y-6",d),children:(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(au.MapPinIcon,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"청구서 배송 주소"})]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)("form",{onSubmit:f(q),className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"name",children:"이름 *"}),(0,b.jsx)(m.Input,{id:"name",placeholder:"홍길동",...e("name"),onChange:a=>{e("name").onChange(a),setTimeout(r,100)}}),o.name&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.name.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"phone",children:"연락처 *"}),(0,b.jsx)(m.Input,{id:"phone",placeholder:"010-1234-5678",...e("phone"),onChange:a=>{let b;k("phone",(b=a.target.value.replace(/[^\d]/g,"")).length<=3?b:b.length<=7?`${b.slice(0,3)}-${b.slice(3)}`:`${b.slice(0,3)}-${b.slice(3,7)}-${b.slice(7,11)}`),setTimeout(r,100)}}),o.phone&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.phone.message})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"zipCode",children:"우편번호 *"}),(0,b.jsx)(m.Input,{id:"zipCode",placeholder:"12345",maxLength:5,...e("zipCode"),onChange:a=>{e("zipCode").onChange(a),setTimeout(r,100)}}),o.zipCode&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.zipCode.message})]}),(0,b.jsxs)("div",{className:"flex space-x-2 md:col-span-2",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(n.Label,{htmlFor:"address",children:"주소 *"}),(0,b.jsx)(m.Input,{id:"address",placeholder:"기본 주소",readOnly:!0,...e("address"),className:"bg-muted"}),o.address&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.address.message})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsxs)(j.Button,{type:"button",variant:"outline",onClick:()=>{console.log("주소 검색 API 호출")},className:"px-3",children:[(0,b.jsx)(av.SearchIcon,{className:"mr-1 h-4 w-4"}),"검색"]})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"detailAddress",children:"상세 주소"}),(0,b.jsx)(m.Input,{id:"detailAddress",placeholder:"동, 호수 등 상세 주소를 입력해주세요",...e("detailAddress"),onChange:a=>{e("detailAddress").onChange(a),setTimeout(r,100)}}),o.detailAddress&&(0,b.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o.detailAddress.message})]}),(0,b.jsx)("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:(0,b.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,b.jsx)("p",{className:"font-medium",children:"주소 입력 안내"}),(0,b.jsxs)("ul",{className:"mt-2 list-inside list-disc space-y-1",children:[(0,b.jsx)("li",{children:"우편번호를 입력하거나 주소 검색 버튼을 클릭해주세요"}),(0,b.jsx)("li",{children:"정확한 주소 입력으로 빠른 서비스 이용이 가능합니다"}),(0,b.jsx)("li",{children:"청구서는 입력하신 주소로 발송됩니다"})]})]})}),!1]})})]})})}var ax=a.i(524660),ay=a.i(988552);function az({params:a}){let m=(0,c.use)(a),n=(0,d.useRouter)(),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),{requestPayment:A,isLoading:B,error:C,clearError:D}=(0,f.usePayment)(),{handleSubmit:E,formState:{}}=(0,g.useForm)({resolver:(0,h.zodResolver)(ag),mode:"onChange"}),{data:F,isLoading:G,isError:H}=(0,e.useQuery)({queryKey:["customer","bookings",m.id],queryFn:async()=>{let a=await fetch(`/api/customer/bookings/${m.id}`);if(!a.ok)throw Error("예약 정보를 불러올 수 없습니다");return a.json()},enabled:!!m.id});(0,c.useEffect)(()=>{H&&n.push("/customer/bookings")},[H,n]);let I=async a=>{try{let b=await fetch("/api/coupons/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok)return!1;let c=await b.json();return v(c),!0}catch(a){return console.error("Error applying coupon:",a),!1}},J=async()=>{if(F&&q&&s){p(!0);try{let a=F.services.reduce((a,b)=>a+b.price,0),b=u?.discountAmount||0,c=a-b,d=await fetch("/api/payments/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:F.id,amount:c,orderName:`${F.pet.name} 미용 서비스`})});if(!d.ok)throw Error("결제 초기화에 실패했습니다");let e=await d.json(),f={amount:c,orderName:e.orderName,orderId:e.paymentId,customerName:e.customerName||s.name,customerEmail:e.customerEmail||"",customerPhone:e.customerPhone||s.phone||"",payMethod:q.type,storeId:e.storeId,channelKey:e.channelKey,customData:{bookingId:F.id,services:F.services.map(a=>({id:a.id,name:a.name,price:a.price})),originalAmount:a,discountAmount:b,finalAmount:c}};console.log("[Payment] Requesting payment via usePayment hook:",f);let g=await A(f);if(g.success){let a=0,b=!1,c=null;for(console.log("[Payment] Starting payment verification polling...");a<30&&!b;)try{let d=await fetch(`/api/payments/verify/${e.paymentId}`,{method:"GET"});if(d.ok){let f=await d.json();if(console.log(`[Payment] Attempt ${a+1}/30: Status = ${f.status}`),f.success){b=!0,console.log("[Payment] Payment verified successfully!"),n.push(`/customer/booking/${F.id}/payment/success?payment=${e.paymentId}`);break}if("FAILED"===f.status||"CANCELLED"===f.status){c=f.error||`결제가 ${"FAILED"===f.status?"실패":"취소"}되었습니다`;break}"PENDING"===f.status&&console.log("[Payment] Payment still pending, continuing to poll...")}else if(404===d.status)console.log(`[Payment] Attempt ${a+1}/30: Payment not found, waiting for webhook...`);else throw Error("서버 결제 검증 실패");a<29&&!b&&await new Promise(a=>setTimeout(a,1e3)),a++}catch(b){if(console.error(`[Payment] Verification attempt ${a+1} failed:`,b),a<29)await new Promise(a=>setTimeout(a,1e3)),a++;else{c=b instanceof Error?b.message:"결제 확인 중 오류가 발생했습니다";break}}if(!b){if(a>=30)throw Error("결제 확인 시간이 초과되었습니다. 고객센터에 문의해주세요.");else if(c)throw Error(c)}}else if(g.cancelled)console.log("[Payment] Payment was cancelled by user");else throw Error(g.error||"결제에 실패했습니다")}catch(b){console.error("Payment error:",b);let a=b instanceof Error?b.message:"알 수 없는 오류가 발생했습니다";alert(`결제 처리 중 오류가 발생했습니다: ${a}`)}finally{p(!1)}}},K=()=>q&&s&&w&&y;return G?(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsx)(i.Card,{children:(0,b.jsx)(i.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"space-y-4 text-center",children:[(0,b.jsx)(l.LoadingSpinner,{size:"lg"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"결제 정보를 불러오는 중..."})]})})})}):F?(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"mx-auto max-w-6xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)(j.Button,{variant:"ghost",onClick:()=>n.back(),className:"mb-4",children:[(0,b.jsx)(ay.ArrowLeftIcon,{className:"mr-2 h-4 w-4"}),"이전으로"]}),(0,b.jsxs)("div",{className:"mb-2 flex items-center space-x-3",children:[(0,b.jsx)(Z.CreditCardIcon,{className:"text-primary h-6 w-6"}),(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"결제하기"})]}),(0,b.jsxs)("div",{className:"text-muted-foreground",children:[F.pet.name,"의 기본 미용 서비스 결제 (추가 서비스는 현장에서 결제)"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-6 lg:col-span-2",children:[(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"예약 정보"})}),(0,b.jsx)(i.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 text-sm md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:"반려동물"}),(0,b.jsxs)("div",{className:"text-muted-foreground",children:[F.pet.name," (",F.pet.species,")"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:"미용사"}),(0,b.jsxs)("div",{className:"text-muted-foreground",children:[F.groomer.name," - ",F.groomer.salon]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:"예약 날짜"}),(0,b.jsx)("div",{className:"text-muted-foreground",children:F.scheduledDate})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium",children:"예약 시간"}),(0,b.jsx)("div",{className:"text-muted-foreground",children:F.scheduledTime})]})]})})]}),(0,b.jsx)(al,{selectedMethod:q,onMethodChange:r}),(0,b.jsx)(aw,{onAddressChange:t}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(ab.ShieldCheckIcon,{className:"h-5 w-5 text-blue-600"}),(0,b.jsx)("span",{children:"결제 안내"})]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)("div",{className:"mb-4 rounded-lg bg-blue-50 p-4",children:(0,b.jsxs)("ul",{className:"space-y-1 text-sm text-blue-800",children:[(0,b.jsxs)("li",{children:["• ",(0,b.jsx)("strong",{children:"1차 결제 (지금)"}),": 기본 미용 서비스 금액"]}),(0,b.jsxs)("li",{children:["• ",(0,b.jsx)("strong",{children:"2차 결제 (추가금 결제)"}),": 미용사가 제안하는 추가 서비스 금액"]})]})})})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center space-x-2",children:[(0,b.jsx)(ab.ShieldCheckIcon,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"약관 동의"})]})}),(0,b.jsx)(i.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,b.jsx)(k.Checkbox,{id:"terms",checked:w,onCheckedChange:a=>x(!0===a)}),(0,b.jsxs)("label",{htmlFor:"terms",className:"cursor-pointer text-sm leading-relaxed",children:[(0,b.jsx)("span",{className:"font-medium",children:"이용약관"}),"에 동의합니다. (필수)",(0,b.jsx)("br",{}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"서비스 이용 조건 및 결제 정책을 확인했습니다."})]})]}),(0,b.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,b.jsx)(k.Checkbox,{id:"privacy",checked:y,onCheckedChange:a=>z(!0===a)}),(0,b.jsxs)("label",{htmlFor:"privacy",className:"cursor-pointer text-sm leading-relaxed",children:[(0,b.jsx)("span",{className:"font-medium",children:"개인정보 처리방침"}),"에 동의합니다. (필수)",(0,b.jsx)("br",{}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"개인정보 수집 및 이용에 대한 안내를 확인했습니다."})]})]})]})})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(at,{services:F.services,couponDiscount:u||void 0,onCouponApply:I,onCouponRemove:()=>{v(null)}}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"pt-6",children:[(0,b.jsx)(j.Button,{onClick:E(J),disabled:!K()||o||B,className:"h-12 w-full text-lg font-semibold",size:"lg",children:o||B?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.LoadingSpinner,{size:"sm",className:"mr-2"}),"결제 처리 중..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(as.CheckCircleIcon,{className:"mr-2 h-5 w-5"}),"결제하기"]})}),!K()&&(0,b.jsx)("p",{className:"text-muted-foreground mt-3 text-center text-sm",children:"결제 정보를 모두 입력하고 약관에 동의해주세요"}),C&&(0,b.jsxs)("div",{className:"mt-3 rounded bg-red-50 p-2 text-center text-sm text-red-500",children:[C,(0,b.jsx)("button",{onClick:D,className:"ml-2 text-red-700 underline",children:"닫기"})]})]})})]})]})]})}):(0,b.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,b.jsx)(i.Card,{children:(0,b.jsx)(i.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"space-y-4 text-center",children:[(0,b.jsx)(ax.AlertTriangleIcon,{className:"text-muted-foreground mx-auto h-12 w-12"}),(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"예약 정보를 찾을 수 없습니다"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"유효하지 않은 예약이거나 이미 처리된 예약입니다."}),(0,b.jsx)(j.Button,{onClick:()=>n.push("/customer/bookings"),children:"예약 목록으로 돌아가기"})]})})})})}a.s(["default",()=>az],544402)}];

//# sourceMappingURL=src_app_customer_booking_%5Bid%5D_payment_page_tsx_f1bd6f15._.js.map