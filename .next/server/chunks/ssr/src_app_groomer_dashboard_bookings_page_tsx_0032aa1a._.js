module.exports=[853810,a=>{"use strict";var b=a.i(187924),c=a.i(529139),d=a.i(50944),e=a.i(572131),f=a.i(433217),g=a.i(370025),h=a.i(937927),i=a.i(699570),j=a.i(205138),k=a.i(737984),l=a.i(814574),m=a.i(633508),n=a.i(915618);function o({bookingId:a,trigger:c,onQuoteSubmitted:d}){let[f,g]=(0,e.useState)(!1),[h,k]=(0,e.useState)(!1),[o,p]=(0,e.useState)([{name:"",description:"",price:0,quantity:1}]),[q,r]=(0,e.useState)(""),[s,t]=(0,e.useState)(0),u=(a,b,c)=>{let d=[...o];d[a]={...d[a],[b]:c},p(d)},v=()=>o.reduce((a,b)=>a+b.price*b.quantity,0),w=async b=>{b.preventDefault(),k(!0);try{let b=await fetch(`/api/groomer/bookings/${a}/quote`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({additionalServices:o.filter(a=>a.name.trim()&&a.price>0),reason:q,estimatedTime:s,totalAdditionalAmount:v()})});if(b.ok)g(!1),p([{name:"",description:"",price:0,quantity:1}]),r(""),t(0),d?.(),alert("견적이 성공적으로 전송되었습니다!");else{let a=await b.json();alert(a.message||"견적 전송에 실패했습니다.")}}catch(a){console.error("Quote submission error:",a),alert("견적 전송 중 오류가 발생했습니다.")}finally{k(!1)}};return(0,b.jsxs)(l.Dialog,{open:f,onOpenChange:g,children:[(0,b.jsx)(l.DialogTrigger,{asChild:!0,children:c}),(0,b.jsxs)(l.DialogContent,{className:"max-h-[90vh] max-w-4xl overflow-y-auto",children:[(0,b.jsx)(l.DialogHeader,{children:(0,b.jsxs)(l.DialogTitle,{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:"추가 서비스 견적"}),(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>g(!1),children:(0,b.jsx)(m.X,{className:"h-4 w-4"})})]})}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsxs)("div",{className:"mb-6 rounded-lg bg-blue-50 p-4",children:[(0,b.jsx)("h3",{className:"mb-2 font-semibold text-blue-900",children:"견적 안내"}),(0,b.jsxs)("ul",{className:"space-y-1 text-sm text-blue-800",children:[(0,b.jsx)("li",{children:"• 서비스 시작 전 추가 서비스가 필요한 경우 견적을 보내주세요"}),(0,b.jsx)("li",{children:"• 고객이 승인한 후에만 추가 요금이 발생합니다"}),(0,b.jsx)("li",{children:"• 견적 없이 추가 서비스를 진행하지 마세요"})]})]}),(0,b.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"mb-4 text-lg font-semibold",children:"추가 서비스 항목"}),(0,b.jsx)("div",{className:"space-y-4",children:o.map((a,c)=>(0,b.jsxs)("div",{className:"border-border bg-muted/50 rounded-lg border p-4",children:[(0,b.jsxs)("div",{className:"mb-4 flex items-start justify-between",children:[(0,b.jsxs)("h4",{className:"font-medium",children:["서비스 ",c+1]}),o.length>1&&(0,b.jsx)(i.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{o.length>1&&p(o.filter((a,b)=>b!==c))},children:"삭제"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"서비스명 *"}),(0,b.jsx)("input",{type:"text",required:!0,value:a.name,onChange:a=>u(c,"name",a.target.value),placeholder:"예: 털 엉킴 제거",className:"border-input bg-background focus:ring-ring w-full rounded-md border px-3 py-2 focus:ring-2 focus:outline-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"가격 (원) *"}),(0,b.jsx)("input",{type:"number",required:!0,min:"0",step:"1000",value:a.price,onChange:a=>u(c,"price",parseInt(a.target.value)||0),placeholder:"10000",className:"border-input bg-background focus:ring-ring w-full rounded-md border px-3 py-2 focus:ring-2 focus:outline-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"수량"}),(0,b.jsx)("input",{type:"number",min:"1",value:a.quantity,onChange:a=>u(c,"quantity",parseInt(a.target.value)||1),className:"border-input bg-background focus:ring-ring w-full rounded-md border px-3 py-2 focus:ring-2 focus:outline-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"소계"}),(0,b.jsxs)("div",{className:"bg-muted rounded-md px-3 py-2",children:[(a.price*a.quantity).toLocaleString(),"원"]})]}),(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"설명"}),(0,b.jsx)("textarea",{value:a.description,onChange:a=>u(c,"description",a.target.value),placeholder:"추가 서비스에 대한 상세 설명을 입력하세요",rows:2,className:"border-input bg-background focus:ring-ring w-full rounded-md border px-3 py-2 focus:ring-2 focus:outline-none"})]})]})]},c))}),(0,b.jsxs)(i.Button,{type:"button",variant:"outline",onClick:()=>{p([...o,{name:"",description:"",price:0,quantity:1}])},className:"mt-4",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"서비스 추가"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"추가 작업 예상 시간 (분)"}),(0,b.jsx)("input",{type:"number",min:"0",step:"15",value:s,onChange:a=>t(parseInt(a.target.value)||0),placeholder:"30",className:"border-input bg-background focus:ring-ring w-full rounded-md border px-3 py-2 focus:ring-2 focus:outline-none"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"추가 서비스 사유"}),(0,b.jsx)("textarea",{value:q,onChange:a=>r(a.target.value),placeholder:"추가 서비스가 필요한 이유를 설명해주세요",rows:3,className:"border-input bg-background focus:ring-ring w-full rounded-md border px-3 py-2 focus:ring-2 focus:outline-none"})]}),(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-lg font-semibold",children:"총 추가 금액"}),(0,b.jsxs)("span",{className:"text-primary text-lg font-bold",children:[v().toLocaleString("ko-KR"),"원"]})]}),(0,b.jsxs)("div",{className:"flex space-x-3",children:[(0,b.jsx)(i.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>g(!1),disabled:h,children:"취소"}),(0,b.jsx)(i.Button,{type:"submit",className:"flex-1",disabled:h||0===v(),children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.LoadingSpinner,{size:"sm",className:"mr-2"}),"견적 전송 중..."]}):"견적 전송"})]})]})]})]})]})]})}var p=a.i(238246),q=a.i(578767);function r(){let{data:a,isPending:l}=(0,c.useSession)(),m=(0,d.useRouter)(),n=(0,d.useSearchParams)(),r=(0,h.useQueryClient)(),[s,t]=(0,e.useState)("ALL"),[u,v]=(0,e.useState)(1);(0,e.useEffect)(()=>{a||m.push("/auth/signin"),a?.user?.role&&"GROOMER"!==a.user.role&&m.push("/dashboard")},[a,m]),(0,e.useEffect)(()=>{"today"===n.get("filter")&&t("TODAY")},[n]);let{data:w,isLoading:x}=(0,f.useQuery)({queryKey:["groomer","bookings",s,u],queryFn:async()=>{let a=new URLSearchParams({filter:s,page:u.toString(),limit:"10",sortBy:"serviceDate",sortOrder:"desc"}),b=await fetch(`/api/groomer/bookings?${a.toString()}`);if(!b.ok)throw Error("Failed to fetch bookings");return b.json()},enabled:!!a?.user&&"GROOMER"===a.user.role}),y=w?.bookings||[],z=w?.pagination||{page:1,limit:10,totalPages:1,totalCount:0,hasNext:!1,hasPrev:!1},A=(0,g.useMutation)({mutationFn:async({bookingId:a,newStatus:b})=>{let c=await fetch(`/api/groomer/bookings/${a}/status`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:b})});if(!c.ok)throw Error("Failed to update booking status");return c.json()},onSuccess:()=>{r.invalidateQueries({queryKey:["groomer","bookings"]})}}),B=(a,b)=>{A.mutate({bookingId:a,newStatus:b})},C=a=>{switch(a){case"PENDING":return"대기중";case"CONFIRMED":return"확정";case"IN_PROGRESS":return"진행중";case"COMPLETED":return"완료";case"CANCELLED":return"취소";default:return a}};return l||x?(0,b.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,b.jsx)(j.LoadingSpinner,{size:"lg"})}):a&&a.user?.role==="GROOMER"?(0,b.jsxs)("div",{className:"bg-background min-h-screen",children:[(0,b.jsx)("header",{className:"border-border border-b",children:(0,b.jsx)(k.PageHeader,{title:"예약 관리",description:"고객 예약을 확인하고 관리하세요",children:(0,b.jsx)(i.Button,{variant:"outline",asChild:!0,children:(0,b.jsx)(p.default,{href:"/groomer/dashboard/overview",children:"대시보드"})})})}),(0,b.jsxs)("main",{className:"container mx-auto px-4 py-6 sm:px-6 sm:py-8",children:[(0,b.jsx)("div",{className:"mb-4 sm:mb-6",children:(0,b.jsx)("div",{className:"flex flex-wrap gap-2 sm:gap-3",children:["ALL","TODAY","PENDING","CONFIRMED","IN_PROGRESS","COMPLETED","CANCELLED"].map(a=>(0,b.jsx)(i.Button,{variant:s===a?"default":"outline",className:"px-3 py-2 text-xs sm:px-4 sm:py-2 sm:text-sm",onClick:()=>t(a),children:"ALL"===a?"전체":"TODAY"===a?"오늘":"IN_PROGRESS"===a?"진행중":C(a)},a))})}),0===y.length?(0,b.jsxs)("div",{className:"py-8 text-center sm:py-12",children:[(0,b.jsx)("div",{className:"bg-muted mx-auto mb-4 flex h-14 w-14 items-center justify-center rounded-full sm:h-16 sm:w-16",children:(0,b.jsx)("svg",{className:"text-muted-foreground h-6 w-6 sm:h-8 sm:w-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,b.jsx)("h3",{className:"text-foreground mb-2 text-base font-medium sm:text-lg",children:"ALL"===s?"예약이 없습니다":"TODAY"===s?"오늘 예약이 없습니다":`${C(s)} 예약이 없습니다`}),(0,b.jsx)("p",{className:"text-muted-foreground px-4 text-sm sm:text-base",children:"새로운 예약이 들어오면 여기에 표시됩니다."})]}):(0,b.jsx)("div",{className:"grid gap-4 sm:gap-6",children:y.map(a=>{var c;let d;return(0,b.jsxs)("div",{className:"border-border bg-card rounded-lg border p-4 sm:p-6",children:[(0,b.jsx)("div",{className:"mb-4",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"mb-3 flex flex-col gap-2 sm:flex-row sm:items-center",children:[(0,b.jsxs)("h3",{className:"text-base font-semibold sm:text-lg",children:["예약번호: ",a.bookingNumber]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)("span",{className:`rounded-full px-2 py-1 text-xs font-medium ${(a=>{switch(a){case"PENDING":return"text-yellow-600 bg-yellow-50";case"CONFIRMED":return"text-blue-600 bg-blue-50";case"IN_PROGRESS":return"text-purple-600 bg-purple-50";case"COMPLETED":return"text-green-600 bg-green-50";case"CANCELLED":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}})(a.status)}`,children:C(a.status)}),(c=a.date,d=new Date,new Date(c).toDateString()===d.toDateString()&&(0,b.jsx)("span",{className:"bg-primary/10 text-primary rounded-full px-2 py-1 text-xs font-medium",children:"오늘"}))]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-3 text-xs sm:grid-cols-2 sm:gap-4 sm:text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-foreground text-sm font-medium sm:text-base",children:a.customer.name}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs sm:text-sm",children:a.customer.phone||"연락처 없음"})]}),(0,b.jsx)("div",{children:a.pets.map((a,c)=>(0,b.jsxs)("div",{className:c>0?"mt-2":"",children:[(0,b.jsxs)("p",{className:"text-foreground text-sm font-medium sm:text-base",children:[a.name," (",a.breed,")"]}),a.weight&&(0,b.jsxs)("p",{className:"text-muted-foreground text-xs sm:text-sm",children:[a.weight,"kg"]}),(0,b.jsx)("div",{className:"text-muted-foreground text-xs break-words",children:a.services.map(a=>a.name).join(", ")})]},a.id))}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"text-foreground text-sm font-medium sm:text-base",children:[a.date," ",a.time]}),(0,b.jsxs)("p",{className:"text-muted-foreground text-xs sm:text-sm",children:[a.estimatedDuration,"분 •"," ",a.totalPrice.toLocaleString("ko-KR"),"원"]})]}),(0,b.jsx)("div",{children:a.location?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-foreground text-sm font-medium sm:text-base",children:a.location.name}),(0,b.jsx)("p",{className:"text-muted-foreground text-xs break-words sm:text-sm",children:a.location.address}),a.location.detailAddress&&(0,b.jsx)("p",{className:"text-muted-foreground text-xs break-words",children:a.location.detailAddress})]}):(0,b.jsx)("p",{className:"text-muted-foreground text-xs sm:text-sm",children:"주소 정보 없음"})})]})]})}),(0,b.jsxs)("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsx)(i.Button,{variant:"outline",className:"w-full text-xs sm:w-auto sm:text-sm",asChild:!0,children:(0,b.jsx)(p.default,{href:`/groomer/dashboard/bookings/${a.id}`,children:"상세보기"})}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[("GROOMER_CONFIRM_PENDING"===a.dbStatus||"FIRST_PAYMENT_COMPLETE"===a.dbStatus)&&(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,b.jsx)(i.Button,{className:"w-full text-xs sm:w-auto sm:text-sm",onClick:()=>B(a.id,q.BookingStatus.GROOMER_CONFIRM),children:"확정"}),(0,b.jsx)(i.Button,{variant:"outline",className:"w-full text-xs sm:w-auto sm:text-sm",onClick:()=>B(a.id,q.BookingStatus.SERVICE_CANCELLED),children:"취소"})]}),"GROOMER_CONFIRM"===a.dbStatus&&(0,b.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,b.jsx)(o,{bookingId:a.id,onQuoteSubmitted:()=>{r.invalidateQueries({queryKey:["groomer","bookings"]})},trigger:(0,b.jsx)(i.Button,{className:"w-full text-xs sm:w-auto sm:text-sm",variant:"outline",children:"견적 보내기"})}),(0,b.jsx)(i.Button,{className:"w-full text-xs sm:w-auto sm:text-sm",onClick:()=>B(a.id,q.BookingStatus.WORK_IN_PROGRESS),children:"바로 시작"})]}),"WORK_IN_PROGRESS"===a.dbStatus&&(0,b.jsx)(i.Button,{className:"w-full text-xs sm:w-auto sm:text-sm",onClick:()=>B(a.id,q.BookingStatus.SERVICE_COMPLETED),children:"완료"})]})]})]},a.id)})}),z.totalPages>1&&(0,b.jsxs)("div",{className:"mt-6 sm:mt-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2 sm:hidden",children:[(0,b.jsx)(i.Button,{variant:"outline",className:"px-3 py-2 text-xs",onClick:()=>v(u-1),disabled:!z.hasPrev||x,children:"이전"}),(0,b.jsxs)("div",{className:"px-3 py-2 text-xs",children:[(0,b.jsx)("span",{className:"font-medium",children:u}),(0,b.jsxs)("span",{className:"text-muted-foreground",children:[" / ",z.totalPages]})]}),(0,b.jsx)(i.Button,{variant:"outline",className:"px-3 py-2 text-xs",onClick:()=>v(u+1),disabled:!z.hasNext||x,children:"다음"})]}),(0,b.jsxs)("div",{className:"hidden items-center justify-center gap-2 sm:flex",children:[(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>v(u-1),disabled:!z.hasPrev||x,children:"이전"}),(0,b.jsx)("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,z.totalPages)},(a,c)=>{let d;return d=z.totalPages<=5||u<=3?c+1:u>=z.totalPages-2?z.totalPages-4+c:u-2+c,(0,b.jsx)(i.Button,{variant:u===d?"default":"outline",size:"sm",onClick:()=>v(d),disabled:x,className:"min-w-[40px]",children:d},d)})}),(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>v(u+1),disabled:!z.hasNext||x,children:"다음"}),(0,b.jsxs)("span",{className:"text-muted-foreground ml-4 text-sm",children:["전체 ",z.totalCount,"개 중 ",(u-1)*z.limit+1,"-",Math.min(u*z.limit,z.totalCount),"번째"]})]})]})]})]}):null}a.s(["default",()=>r],853810)}];

//# sourceMappingURL=src_app_groomer_dashboard_bookings_page_tsx_0032aa1a._.js.map