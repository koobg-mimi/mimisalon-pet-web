module.exports=[736313,(a,b,c)=>{"use strict";b.exports=a.r(342602).vendored.contexts.HooksClientContext},818341,(a,b,c)=>{"use strict";b.exports=a.r(342602).vendored.contexts.ServerInsertedHtml},556704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},120635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},909270,(a,b,c)=>{"use strict";b.exports=a.r(342602).vendored.contexts.AppRouterContext},738783,(a,b,c)=>{"use strict";b.exports=a.r(342602).vendored["react-ssr"].ReactServerDOMTurbopackClient},808591,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"useMergedRef",{enumerable:!0,get:function(){return e}});let d=a.r(572131);function e(a,b){let c=(0,d.useRef)(null),e=(0,d.useRef)(null);return(0,d.useCallback)(d=>{if(null===d){let a=c.current;a&&(c.current=null,a());let b=e.current;b&&(e.current=null,b())}else a&&(c.current=f(a,d)),b&&(e.current=f(b,d))},[a,b])}function f(a,b){if("function"!=typeof a)return a.current=b,()=>{a.current=null};{let c=a(b);return"function"==typeof c?c:()=>a(null)}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},192434,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"warnOnce",{enumerable:!0,get:function(){return d}});let d=a=>{}},370025,a=>{"use strict";var b=a.i(572131),c=a.i(612794),d=a.i(118544),e=a.i(533791),f=a.i(442871),g=class extends e.Subscribable{#a;#b=void 0;#c;#d;constructor(a,b){super(),this.#a=a,this.setOptions(b),this.bindMethods(),this.#e()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){let b=this.options;this.options=this.#a.defaultMutationOptions(a),(0,f.shallowEqualObjects)(this.options,b)||this.#a.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#c,observer:this}),b?.mutationKey&&this.options.mutationKey&&(0,f.hashKey)(b.mutationKey)!==(0,f.hashKey)(this.options.mutationKey)?this.reset():this.#c?.state.status==="pending"&&this.#c.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#c?.removeObserver(this)}onMutationUpdate(a){this.#e(),this.#f(a)}getCurrentResult(){return this.#b}reset(){this.#c?.removeObserver(this),this.#c=void 0,this.#e(),this.#f()}mutate(a,b){return this.#d=b,this.#c?.removeObserver(this),this.#c=this.#a.getMutationCache().build(this.#a,this.options),this.#c.addObserver(this),this.#c.execute(a)}#e(){let a=this.#c?.state??(0,c.getDefaultState)();this.#b={...a,isPending:"pending"===a.status,isSuccess:"success"===a.status,isError:"error"===a.status,isIdle:"idle"===a.status,mutate:this.mutate,reset:this.reset}}#f(a){d.notifyManager.batch(()=>{if(this.#d&&this.hasListeners()){let b=this.#b.variables,c=this.#b.context,d={client:this.#a,meta:this.options.meta,mutationKey:this.options.mutationKey};a?.type==="success"?(this.#d.onSuccess?.(a.data,b,c,d),this.#d.onSettled?.(a.data,null,b,c,d)):a?.type==="error"&&(this.#d.onError?.(a.error,b,c,d),this.#d.onSettled?.(void 0,a.error,b,c,d))}this.listeners.forEach(a=>{a(this.#b)})})}},h=a.i(937927);function i(a,c){let e=(0,h.useQueryClient)(c),[i]=b.useState(()=>new g(e,a));b.useEffect(()=>{i.setOptions(a)},[i,a]);let j=b.useSyncExternalStore(b.useCallback(a=>i.subscribe(d.notifyManager.batchCalls(a)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),k=b.useCallback((a,b)=>{i.mutate(a,b).catch(f.noop)},[i]);if(j.error&&(0,f.shouldThrowError)(i.options.throwOnError,[j.error]))throw j.error;return{...j,mutate:k,mutateAsync:j.mutate}}a.s(["useMutation",()=>i],370025)},265057,a=>{"use strict";var b=a.i(187924),c=a.i(256711),d=a.i(302491),e=a.i(529139),f=a.i(50944),g=a.i(572131),h=a.i(433217),i=a.i(370025),j=a.i(699570),k=a.i(205138),l=a.i(238246);function m(){let{data:a,isPending:m}=(0,e.useSession)(),n=(0,f.useRouter)(),o=(0,f.useSearchParams)(),p=o.get("paymentId"),q=o.get("code"),r=o.get("message");(0,g.useEffect)(()=>{if(q||r){let a=r||"결제가 취소되었습니다",b=o.get("bookingId")||"";n.push(`/payment/fail?reason=${encodeURIComponent(a)}&bookingId=${b}`);return}a||n.push("/auth/signin"),a?.user?.role&&"CUSTOMER"!==a.user.role&&n.push("/dashboard")},[a,n,q,r,o]);let{data:s,isLoading:t}=(0,h.useQuery)({queryKey:["payment",p],queryFn:async({signal:a})=>{console.log("Verifying payment:",p);let b=await fetch(`/api/payments/verify/${p}`,{signal:a});if(!b.ok){if(404===b.status)throw Error("NOT_FOUND");throw Error("Failed to verify payment")}let c=await b.json();if(c.success&&c.payment)return console.log("Payment verification successful:",c),c.payment;if("PENDING"===c.status||"NOT_FOUND"===c.status)throw Error(c.status);{let a=c.error||c.message||"결제 확인 실패";throw console.error("Payment verification failed:",a,c),n.push(`/payment/fail?reason=${encodeURIComponent(a)}&paymentId=${p}`),Error(a)}},enabled:!!p&&!!a?.user&&"CUSTOMER"===a.user.role&&!q&&!r,retry:(a,b)=>("PENDING"===b.message||"NOT_FOUND"===b.message)&&!!(a<20),retryDelay:3e3});(0,g.useEffect)(()=>{p||q||r||n.push("/customer/bookings")},[p,q,r,n]);let u=(0,i.useMutation)({mutationFn:async()=>{let a=await fetch(`/api/payments/${p}/receipt`);if(!a.ok)throw Error("Failed to download receipt");return a.blob()},onSuccess:a=>{let b=window.URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`receipt-${p}.pdf`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(b),document.body.removeChild(c)},onError:a=>{console.error("Failed to download receipt:",a)}});return m||t||q||r?(0,b.jsx)("div",{className:"flex min-h-screen items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(k.LoadingSpinner,{size:"lg"}),t&&!q&&!r&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"mt-4 text-lg font-semibold",children:"결제를 확인하고 있습니다..."}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2 text-sm",children:"최대 1분 정도 소요될 수 있습니다."})]})]})}):a&&a.user?.role==="CUSTOMER"&&s?(0,b.jsx)("div",{className:"bg-background min-h-screen",children:(0,b.jsx)("main",{className:"container mx-auto px-4 py-8",children:(0,b.jsxs)("div",{className:"mx-auto max-w-2xl text-center",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("div",{className:"mx-auto mb-6 flex h-20 w-20 items-center justify-center rounded-full bg-green-100",children:(0,b.jsx)("svg",{className:"h-10 w-10 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,b.jsx)("h1",{className:"text-foreground mb-2 text-3xl font-bold",children:"결제가 완료되었습니다!"}),(0,b.jsxs)("div",{className:"text-muted-foreground",children:[(0,b.jsx)("p",{children:"예약이 성공적으로 접수되었습니다."}),(0,b.jsx)("p",{children:"미용사 확인 후 예약이 확정됩니다."})]})]}),(0,b.jsxs)("div",{className:"border-border bg-card mb-8 rounded-lg border p-6 text-left",children:[(0,b.jsx)("h2",{className:"mb-4 text-center text-xl font-semibold",children:"결제 정보"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"결제번호"}),(0,b.jsx)("span",{className:"font-medium",children:s.id})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"결제금액"}),(0,b.jsxs)("span",{className:"text-primary text-lg font-semibold",children:[s.amount.toLocaleString("ko-KR"),"원"]})]}),s.booking&&(0,b.jsxs)("div",{className:"border-border border-t pt-4",children:[(0,b.jsx)("h3",{className:"mb-3 font-semibold",children:"예약 정보"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[s.booking.pets&&s.booking.pets.length>0&&(0,b.jsx)(b.Fragment,{children:s.booking.pets.map((a,c)=>(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"반려동물"}),(0,b.jsxs)("span",{children:[a.name," ",a.breed&&`(${a.breed})`]})]}),a.services&&a.services.length>0&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"서비스"}),(0,b.jsx)("span",{children:a.services.map(a=>a.name).join(", ")})]})]},c))}),s.booking.groomer&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"미용사"}),(0,b.jsx)("span",{children:s.booking.groomer.name})]}),s.booking.address&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"주소"}),(0,b.jsxs)("span",{children:[s.booking.address.street,", ",s.booking.address.city]})]}),(s.booking.serviceDate||s.booking.serviceTime)&&(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"예약일시"}),(0,b.jsxs)("span",{children:[s.booking.serviceDate&&(0,c.format)(new Date(s.booking.serviceDate),"yyyy-MM-dd",{locale:d.ko})," ",s.booking.serviceTime]})]})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsxs)(j.Button,{onClick:()=>{u.mutate()},variant:"outline",className:"w-full",children:[(0,b.jsx)("svg",{className:"mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"영수증 다운로드"]}),s.booking?.id&&(0,b.jsx)(j.Button,{asChild:!0,variant:"outline",className:"w-full",children:(0,b.jsxs)(l.default,{href:`/customer/booking/${s.booking.id}`,children:[(0,b.jsx)("svg",{className:"mr-2 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"예약 상세보기"]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,b.jsx)(j.Button,{asChild:!0,className:"w-full",children:(0,b.jsx)(l.default,{href:"/customer/bookings",children:"예약 관리"})}),(0,b.jsx)(j.Button,{asChild:!0,variant:"outline",className:"w-full",children:(0,b.jsx)(l.default,{href:"/booking/new",children:"새 예약하기"})})]})]}),(0,b.jsxs)("div",{className:"mt-8 rounded-lg bg-blue-50 p-4",children:[(0,b.jsx)("h3",{className:"mb-2 font-semibold text-blue-900",children:"안내사항"}),(0,b.jsxs)("ul",{className:"space-y-1 text-left text-sm text-blue-800",children:[(0,b.jsx)("li",{children:"• 예약 확정 여부는 SMS 또는 앱 알림으로 안내드립니다."}),(0,b.jsx)("li",{children:"• 예약 변경이나 취소는 예약일 1일 전까지 가능합니다."}),(0,b.jsx)("li",{children:"• 문의사항이 있으시면 고객센터로 연락주세요."}),(0,b.jsx)("li",{children:"• 서비스 완료 후 리뷰 작성시 포인트를 적립해드립니다."})]})]})]})})}):null}a.s(["default",()=>m])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d0ef2db3._.js.map