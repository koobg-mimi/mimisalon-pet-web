module.exports=[143162,e=>{"use strict";var t=e.i(747909),o=e.i(174017),n=e.i(996250),a=e.i(759756),r=e.i(561916),i=e.i(114444),s=e.i(837092),l=e.i(869741),u=e.i(316795),d=e.i(487718),c=e.i(995169),p=e.i(47587),g=e.i(666012),m=e.i(570101),R=e.i(626937),v=e.i(10372),h=e.i(193695);e.i(52474);var E=e.i(600220),w=e.i(686880),k=e.i(89171),O=e.i(493458),C=e.i(79832),S=e.i(657446),P=e.i(968422),M=e.i(609730),b=e.i(250354),f=e.i(121741),y=e.i(278052),N=e.i(343747);async function A(){try{var e,t;let o,n=await C.default.api.getSession({headers:await (0,O.headers)()});if(!n||n.user?.role!=="GROOMER")return k.NextResponse.json({error:"Unauthorized"},{status:401});let a=n.user.id;console.log("[Groomer Dashboard API] Fetching overview for groomer:",a);let r=(0,P.startOfDay)(Date.now(),void 0),i=(e=Date.now(),t=void 0,(o=(0,M.toDate)(e,t?.in)).setHours(23,59,59,999),o),s=(0,b.startOfWeek)(new Date,{weekStartsOn:1}),l=(0,f.startOfMonth)(new Date),u=(0,y.endOfMonth)(new Date);console.log("[Groomer Dashboard API] Date ranges:",{todayStart:r.toISOString(),todayEnd:i.toISOString(),weekStart:s.toISOString(),monthStart:l.toISOString(),monthEnd:u.toISOString()});let d=await S.prisma.booking.count({where:{groomerId:a,serviceDate:{gte:r,lte:i},status:{in:[S.BookingStatus.FIRST_PAYMENT_COMPLETE,S.BookingStatus.GROOMER_CONFIRM_PENDING,S.BookingStatus.GROOMER_CONFIRM,S.BookingStatus.ADDITIONAL_PAYMENT_COMPLETE,S.BookingStatus.WORK_IN_PROGRESS,S.BookingStatus.SERVICE_COMPLETED]}}}),c=await S.prisma.booking.count({where:{groomerId:a,serviceDate:{gte:s,lte:i},status:{in:[S.BookingStatus.FIRST_PAYMENT_COMPLETE,S.BookingStatus.GROOMER_CONFIRM_PENDING,S.BookingStatus.GROOMER_CONFIRM,S.BookingStatus.ADDITIONAL_PAYMENT_COMPLETE,S.BookingStatus.WORK_IN_PROGRESS,S.BookingStatus.SERVICE_COMPLETED]}}}),p=(await S.prisma.booking.findMany({where:{groomerId:a,serviceDate:{gte:l,lte:u},status:S.BookingStatus.SERVICE_COMPLETED},select:{totalPrice:!0}})).reduce((e,t)=>e+(t.totalPrice||0),0),g=await S.prisma.booking.count({where:{groomerId:a,serviceDate:{gte:l,lte:u}}}),m=await S.prisma.booking.count({where:{groomerId:a,serviceDate:{gte:l,lte:u},status:S.BookingStatus.SERVICE_COMPLETED}}),R=g>0?Math.round(m/g*100):0,v=await S.prisma.review.aggregate({where:{booking:{groomerId:a}},_avg:{rating:!0},_count:{rating:!0}}),h=v._avg.rating||0,E=v._count.rating||0;console.log("[Groomer Dashboard API] Fetched data counts:",{todayBookings:d,weeklyBookings:c,monthlyRevenue:p,totalMonthlyBookings:g,completedMonthlyBookings:m,completionRate:R,averageRating:h,totalReviews:E,upcomingBookingsCount:"fetching...",pendingBookingsCount:"fetching...",recentReviewsCount:"fetching..."});let A=await S.prisma.booking.findMany({where:{groomerId:a,serviceDate:{gte:r,lte:i},status:{in:[S.BookingStatus.GROOMER_CONFIRM,S.BookingStatus.GROOMER_CONFIRM_PENDING]}},include:{customer:{select:{name:!0}},bookingPets:{include:{pet:{select:{name:!0,breed:{select:{name:!0}}}},services:{include:{service:{select:{name:!0,durationMinutes:!0}}},take:1}},take:1}},orderBy:{serviceTime:"asc"},take:10}),_=await S.prisma.booking.findMany({where:{groomerId:a,status:{in:[S.BookingStatus.FIRST_PAYMENT_COMPLETE,S.BookingStatus.GROOMER_CONFIRM_PENDING]}},include:{customer:{select:{name:!0,phoneNumber:!0}},customerAddress:{select:{street:!0,city:!0,state:!0,zipCode:!0}},bookingPets:{include:{pet:{select:{name:!0,breed:{select:{name:!0}}}},services:{include:{service:{select:{name:!0}}}},selectedOptions:{include:{serviceOption:{select:{name:!0}}}}}}},orderBy:{serviceDate:"asc"},take:10}),I=await S.prisma.review.findMany({where:{booking:{groomerId:a}},include:{customer:{select:{name:!0}}},orderBy:{createdAt:"desc"},take:5});console.log("[Groomer Dashboard API] Additional data counts:",{upcomingBookingsCount:A.length,pendingBookingsCount:_.length,recentReviewsCount:I.length});let D={todayBookings:d,weeklyBookings:c,monthlyRevenue:Math.round(p),completionRate:R,averageRating:Math.round(10*h)/10,totalReviews:E,upcomingBookings:A.map(e=>({id:e.id,time:e.serviceTime||"",customer:{name:e.customer?.name||"고객"},pet:{name:e.bookingPets[0]?.pet.name||"반려동물",breed:e.bookingPets[0]?.pet.breed?.name||"정보없음"},service:{name:e.bookingPets[0]?.services[0]?.service.name||"서비스",duration:e.bookingPets[0]?.services[0]?.service.durationMinutes||60}})),pendingBookings:_.map(e=>{let t=e.customerAddress?`${e.customerAddress.street}, ${e.customerAddress.city}, ${e.customerAddress.state} ${e.customerAddress.zipCode}`:void 0;return{id:e.id,bookingNumber:e.bookingNumber,serviceDate:(0,N.format)(e.serviceDate,"yyyy-MM-dd",{locale:w.ko}),serviceTime:e.serviceTime,estimatedDurationMinutes:e.estimatedDurationMinutes,customer:{name:e.customer?.name||"고객",phone:e.customer?.phoneNumber||void 0,address:t},pets:e.bookingPets.map(e=>({name:e.pet.name,breed:e.pet.breed?.name||void 0,services:e.services.map(e=>({name:e.service.name,price:e.servicePrice})),options:e.selectedOptions.map(e=>({name:e.serviceOption.name,price:e.optionPrice}))})),totalPrice:e.totalPrice,specialRequests:e.specialRequests||void 0}}),recentReviews:I.map(e=>({id:e.id,rating:e.rating,content:e.comment||"",customer:{name:e.customer?.name||"고객"},createdAt:e.createdAt.toISOString()}))};return console.log("[Groomer Dashboard API] Response summary:",{todayBookings:D.todayBookings,weeklyBookings:D.weeklyBookings,monthlyRevenue:D.monthlyRevenue,completionRate:D.completionRate,averageRating:D.averageRating,totalReviews:D.totalReviews,upcomingBookingsCount:D.upcomingBookings.length,pendingBookingsCount:D.pendingBookings.length,recentReviewsCount:D.recentReviews.length}),k.NextResponse.json(D)}catch(e){return console.error("Failed to fetch groomer overview stats:",e),k.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["GET",()=>A],201015);var _=e.i(201015);let I=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/groomer/dashboard/overview/route",pathname:"/api/groomer/dashboard/overview",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/groomer/dashboard/overview/route.ts",nextConfigOutput:"standalone",userland:_}),{workAsyncStorage:D,workUnitAsyncStorage:T,serverHooks:B}=I;function x(){return(0,n.patchFetch)({workAsyncStorage:D,workUnitAsyncStorage:T})}async function G(e,t,n){I.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/groomer/dashboard/overview/route";w=w.replace(/\/index$/,"")||"/";let k=await I.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!k)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:O,params:C,nextConfig:S,parsedUrl:P,isDraftMode:M,prerenderManifest:b,routerServerContext:f,isOnDemandRevalidate:y,revalidateOnlyGenerated:N,resolvedPathname:A,clientReferenceManifest:_,serverActionsManifest:D}=k,T=(0,l.normalizeAppPath)(w),B=!!(b.dynamicRoutes[T]||b.routes[A]),x=async()=>((null==f?void 0:f.render404)?await f.render404(e,t,P,!1):t.end("This page could not be found"),null);if(B&&!M){let e=!!b.routes[A],t=b.dynamicRoutes[T];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await x();throw new h.NoFallbackError}}let G=null;!B||I.isDev||M||(G="/index"===(G=A)?"/":G);let F=!0===I.isDev||!B,H=B&&!F;D&&_&&(0,i.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:_,serverActionsManifest:D,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:D})});let U=e.method||"GET",q=(0,r.getTracer)(),L=q.getActiveScopeSpan(),$={params:C,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,n)=>I.onRequestError(e,t,n,f)},sharedContext:{buildId:O}},j=new u.NodeNextRequest(e),K=new u.NodeNextResponse(t),V=d.NextRequestAdapter.fromNodeNextRequest(j,(0,d.signalFromNodeResponse)(t));try{let i=async e=>I.handle(V,$).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=q.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=o.get("next.route");if(n){let t=`${U} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${w}`)}),s=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var r,l;let u=async({previousCacheEntry:o})=>{try{if(!s&&y&&N&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await i(a);e.fetchMetrics=$.renderOpts.fetchMetrics;let l=$.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=$.renderOpts.collectedTags;if(!B)return await (0,g.sendResponse)(j,K,r,$.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(r.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==$.renderOpts.collectedRevalidate&&!($.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&$.renderOpts.collectedRevalidate,n=void 0===$.renderOpts.collectedExpire||$.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:$.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:n}}}}catch(t){throw(null==o?void 0:o.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:y})},f),t}},d=await I.handleResponse({req:e,nextConfig:S,cacheKey:G,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:y,revalidateOnlyGenerated:N,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:s});if(!B)return null;if((null==d||null==(r=d.value)?void 0:r.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",y?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),M&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&B||c.delete(v.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,R.getCacheControlHeader)(d.cacheControl)),await (0,g.sendResponse)(j,K,new Response(d.value.body,{headers:c,status:d.value.status||200})),null};L?await l(L):await q.withPropagatedContext(e.headers,()=>q.trace(c.BaseServerSpan.handleRequest,{spanName:`${U} ${w}`,kind:r.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:T,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:y})}),B)throw t;return await (0,g.sendResponse)(j,K,new Response(null,{status:500})),null}}e.s(["handler",()=>G,"patchFetch",()=>x,"routeModule",()=>I,"serverHooks",()=>B,"workAsyncStorage",()=>D,"workUnitAsyncStorage",()=>T],143162)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_619292cd.js.map