module.exports=[409902,e=>{"use strict";var t=e.i(747909),n=e.i(174017),a=e.i(996250),r=e.i(759756),o=e.i(561916),i=e.i(114444),s=e.i(837092),l=e.i(869741),d=e.i(316795),u=e.i(487718),c=e.i(995169),p=e.i(47587),g=e.i(666012),m=e.i(570101),R=e.i(626937),v=e.i(10372),E=e.i(193695);e.i(52474);var h=e.i(600220),f=e.i(89171),z=e.i(469719);let T=z.z.enum(["TEXT","IMAGE","FILE","BOOKING_INFO","SYSTEM"]),O=z.z.enum(["CUSTOMER_GROOMER","CUSTOMER_ADMIN","GROOMER_ADMIN","GROUP"]),A=z.z.enum(["SENT","DELIVERED","READ","FAILED"]);z.z.object({conversationId:z.z.string().min(1,"대화 ID가 필요합니다"),content:z.z.string().min(1,"메시지 내용을 입력해주세요").max(1e3,"메시지는 1000자 이하로 입력해주세요"),type:T,attachments:z.z.array(z.z.object({fileName:z.z.string(),fileUrl:z.z.string().url(),fileSize:z.z.number(),mimeType:z.z.string()})).optional(),metadata:z.z.record(z.z.string(),z.z.unknown()).optional(),replyToId:z.z.string().optional()});let C=z.z.object({type:O,participants:z.z.array(z.z.string()).min(2,"최소 2명의 참가자가 필요합니다"),title:z.z.string().optional(),bookingId:z.z.string().optional(),metadata:z.z.record(z.z.string(),z.z.unknown()).optional()});z.z.object({conversationId:z.z.string(),page:z.z.number().min(1).default(1),limit:z.z.number().min(1).max(100).default(20),beforeMessageId:z.z.string().optional(),afterMessageId:z.z.string().optional()}),z.z.object({type:O.optional(),page:z.z.number().min(1).default(1),limit:z.z.number().min(1).max(50).default(20),search:z.z.string().optional(),unreadOnly:z.z.boolean().default(!1)}),z.z.object({content:z.z.string().min(1).max(1e3).optional(),status:A.optional(),readAt:z.z.date().optional()}),z.z.object({title:z.z.string().max(100).optional(),isArchived:z.z.boolean().optional(),isMuted:z.z.boolean().optional(),mutedUntil:z.z.date().optional()}),z.z.object({file:z.z.instanceof(File),conversationId:z.z.string(),caption:z.z.string().optional()}),z.z.object({query:z.z.string().min(1,"검색어를 입력해주세요"),conversationId:z.z.string().optional(),type:T.optional(),fromDate:z.z.string().optional(),toDate:z.z.string().optional(),page:z.z.number().min(1).default(1),limit:z.z.number().min(1).max(50).default(20)}),z.z.object({type:z.z.enum(["MESSAGE_SENT","MESSAGE_READ","TYPING_START","TYPING_STOP","USER_JOINED","USER_LEFT"]),conversationId:z.z.string(),userId:z.z.string(),messageId:z.z.string().optional(),data:z.z.record(z.z.string(),z.z.unknown()).optional()});let y=[{id:"conv_001",type:"CUSTOMER_GROOMER",participants:[{id:"user_001",name:"김고객",avatar:"/avatars/customer1.jpg",role:"CUSTOMER",isOnline:!0,lastSeen:"2024-01-15T15:30:00Z"},{id:"groomer_001",name:"박미용사",avatar:"/avatars/groomer1.jpg",role:"GROOMER",isOnline:!1,lastSeen:"2024-01-15T14:45:00Z"}],bookingId:"booking_001",lastMessage:{id:"msg_001",content:"뽀삐 미용이 완료되었습니다! 사진을 확인해주세요.",senderId:"groomer_001",createdAt:"2024-01-15T15:20:00Z"},unreadCount:2,createdAt:"2024-01-10T10:00:00Z",updatedAt:"2024-01-15T15:20:00Z"},{id:"conv_002",type:"CUSTOMER_ADMIN",participants:[{id:"user_001",name:"김고객",avatar:"/avatars/customer1.jpg",role:"CUSTOMER",isOnline:!0,lastSeen:"2024-01-15T15:30:00Z"},{id:"admin_001",name:"미미살롱 고객센터",avatar:"/avatars/admin.jpg",role:"ADMIN",isOnline:!0,lastSeen:"2024-01-15T15:25:00Z"}],title:"환불 문의",lastMessage:{id:"msg_002",content:"환불 처리가 완료되었습니다. 3-5 영업일 내에 계좌로 입금될 예정입니다.",senderId:"admin_001",createdAt:"2024-01-14T16:30:00Z"},unreadCount:0,createdAt:"2024-01-14T14:00:00Z",updatedAt:"2024-01-14T16:30:00Z"},{id:"conv_003",type:"CUSTOMER_GROOMER",participants:[{id:"user_001",name:"김고객",avatar:"/avatars/customer1.jpg",role:"CUSTOMER",isOnline:!0,lastSeen:"2024-01-15T15:30:00Z"},{id:"groomer_002",name:"이미용사",avatar:"/avatars/groomer2.jpg",role:"GROOMER",isOnline:!0,lastSeen:"2024-01-12T09:15:00Z"}],bookingId:"booking_002",lastMessage:{id:"msg_003",content:"다음 주 화요일 오후 2시로 예약 변경이 가능할까요?",senderId:"user_001",createdAt:"2024-01-12T09:10:00Z"},unreadCount:0,createdAt:"2024-01-11T16:00:00Z",updatedAt:"2024-01-12T09:10:00Z"}];async function S(e){try{let{searchParams:t}=new URL(e.url),n={type:t.get("type")||void 0,page:parseInt(t.get("page")||"1"),limit:parseInt(t.get("limit")||"20"),search:t.get("search")||void 0,unreadOnly:"true"===t.get("unreadOnly")},a="user_001",r=y.filter(e=>e.participants.some(e=>e.id===a));if(n.type&&(r=r.filter(e=>e.type===n.type)),n.unreadOnly&&(r=r.filter(e=>e.unreadCount>0)),n.search){let e=n.search.toLowerCase();r=r.filter(t=>{let n=t.participants.find(e=>e.id!==a);return(n?.name||"").toLowerCase().includes(e)||t.lastMessage?.content.toLowerCase().includes(e)})}r.sort((e,t)=>{let n=new Date(e.lastMessage?.createdAt||e.updatedAt).getTime();return new Date(t.lastMessage?.createdAt||t.updatedAt).getTime()-n});let o=(n.page-1)*n.limit,i=o+n.limit,s=r.slice(o,i);return f.NextResponse.json({conversations:s,pagination:{page:n.page,limit:n.limit,total:r.length,totalPages:Math.ceil(r.length/n.limit)},summary:{unreadCount:r.filter(e=>e.unreadCount>0).length,totalCount:r.length}})}catch(e){return console.error("Error fetching conversations:",e),f.NextResponse.json({error:"대화 목록을 불러올 수 없습니다"},{status:500})}}async function _(e){try{let t=await e.json(),n=C.parse(t),a={id:`conv_${Date.now()}`,...n,lastMessage:void 0,unreadCount:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return f.NextResponse.json({success:!0,conversation:a,message:"대화가 성공적으로 생성되었습니다"})}catch(e){if(console.error("Error creating conversation:",e),e instanceof z.z.ZodError)return f.NextResponse.json({error:"잘못된 대화 데이터입니다",details:e.issues},{status:400});return f.NextResponse.json({error:"대화 생성 중 오류가 발생했습니다"},{status:500})}}e.s(["GET",()=>S,"POST",()=>_],882507);var w=e.i(882507);let I=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/conversations/route",pathname:"/api/conversations",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/conversations/route.ts",nextConfigOutput:"standalone",userland:w}),{workAsyncStorage:M,workUnitAsyncStorage:b,serverHooks:x}=I;function N(){return(0,a.patchFetch)({workAsyncStorage:M,workUnitAsyncStorage:b})}async function D(e,t,a){I.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let f="/api/conversations/route";f=f.replace(/\/index$/,"")||"/";let z=await I.prepare(e,t,{srcPage:f,multiZoneDraftMode:!1});if(!z)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:T,params:O,nextConfig:A,parsedUrl:C,isDraftMode:y,prerenderManifest:S,routerServerContext:_,isOnDemandRevalidate:w,revalidateOnlyGenerated:M,resolvedPathname:b,clientReferenceManifest:x,serverActionsManifest:N}=z,D=(0,l.normalizeAppPath)(f),U=!!(S.dynamicRoutes[D]||S.routes[b]),j=async()=>((null==_?void 0:_.render404)?await _.render404(e,t,C,!1):t.end("This page could not be found"),null);if(U&&!y){let e=!!S.routes[b],t=S.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await j();throw new E.NoFallbackError}}let P=null;!U||I.isDev||y||(P="/index"===(P=b)?"/":P);let k=!0===I.isDev||!U,G=U&&!k;N&&x&&(0,i.setReferenceManifestsSingleton)({page:f,clientReferenceManifest:x,serverActionsManifest:N,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:N})});let H=e.method||"GET",Z=(0,o.getTracer)(),q=Z.getActiveScopeSpan(),F={params:O,prerenderManifest:S,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,a)=>I.onRequestError(e,t,a,_)},sharedContext:{buildId:T}},L=new d.NodeNextRequest(e),$=new d.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(L,(0,u.signalFromNodeResponse)(t));try{let i=async e=>I.handle(K,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=Z.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=n.get("next.route");if(a){let t=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${f}`)}),s=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var o,l;let d=async({previousCacheEntry:n})=>{try{if(!s&&w&&M&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(r);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=F.renderOpts.collectedTags;if(!U)return await (0,g.sendResponse)(L,$,o,F.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[v.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,a=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:a}}}}catch(t){throw(null==n?void 0:n.isStale)&&await I.onRequestError(e,t,{routerKind:"App Router",routePath:f,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:w})},_),t}},u=await I.handleResponse({req:e,nextConfig:A,cacheKey:P,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:S,isRoutePPREnabled:!1,isOnDemandRevalidate:w,revalidateOnlyGenerated:M,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:s});if(!U)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",w?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),y&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&U||c.delete(v.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,R.getCacheControlHeader)(u.cacheControl)),await (0,g.sendResponse)(L,$,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};q?await l(q):await Z.withPropagatedContext(e.headers,()=>Z.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${f}`,kind:o.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof E.NoFallbackError||await I.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:G,isOnDemandRevalidate:w})}),U)throw t;return await (0,g.sendResponse)(L,$,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>N,"routeModule",()=>I,"serverHooks",()=>x,"workAsyncStorage",()=>M,"workUnitAsyncStorage",()=>b],409902)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_5d7a44a5.js.map