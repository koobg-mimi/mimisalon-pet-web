{"version":3,"sources":["turbopack:///[project]/src/lib/email.ts"],"sourcesContent":["/**\n * Email Service\n *\n * Provides email sending functionality using Nodemailer\n * Migrated from packages/worker for direct use in Next.js app\n */\n\nimport nodemailer from 'nodemailer'\nimport { env } from './env'\n\nexport interface EmailOptions {\n  to: string\n  subject: string\n  html: string\n  text?: string\n}\n\n/**\n * Get SMTP configuration from environment variables\n */\nfunction getSMTPConfig() {\n  return {\n    host: env.SMTP_HOST,\n    port: env.SMTP_PORT,\n    secure: env.SMTP_PORT === 465, // true for 465, false for other ports\n    auth: {\n      user: env.SMTP_USERNAME,\n      pass: env.SMTP_PASSWORD,\n    },\n  }\n}\n\n/**\n * Create email transporter (lazy initialization)\n */\nlet transporter: nodemailer.Transporter | null = null\n\nfunction getEmailTransporter(): nodemailer.Transporter {\n  if (!transporter) {\n    const smtpConfig = getSMTPConfig()\n    transporter = nodemailer.createTransport(smtpConfig)\n  }\n  return transporter\n}\n\n/**\n * Send email using SMTP\n */\nexport async function sendEmail({ to, subject, html, text }: EmailOptions): Promise<{\n  success: boolean\n  messageId?: string\n  error?: string\n}> {\n  try {\n    // Validate email address\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n    if (!emailRegex.test(to)) {\n      return {\n        success: false,\n        error: `Invalid recipient email address: ${to}`,\n      }\n    }\n\n    // Get transporter\n    const transporter = getEmailTransporter()\n\n    // Send email\n    const info = await transporter.sendMail({\n      from: env.SMTP_USERNAME,\n      to,\n      subject,\n      text: text || undefined,\n      html,\n    })\n\n    console.log('üìß Email sent successfully:', {\n      messageId: info.messageId,\n      to,\n      subject,\n    })\n\n    return {\n      success: true,\n      messageId: info.messageId,\n    }\n  } catch (error) {\n    console.error('‚ùå Failed to send email:', error)\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : 'Unknown error',\n    }\n  }\n}\n\n/**\n * Test SMTP connection (for health checks)\n */\nexport async function testSMTPConnection(): Promise<{\n  success: boolean\n  message: string\n}> {\n  try {\n    const transporter = getEmailTransporter()\n    await transporter.verify()\n\n    return {\n      success: true,\n      message: 'SMTP connection test successful',\n    }\n  } catch (error) {\n    return {\n      success: false,\n      message: error instanceof Error ? error.message : 'Unknown error',\n    }\n  }\n}\n\n/**\n * Check SMTP health without connecting\n */\nexport function checkSMTPHealth(): { healthy: boolean; message: string } {\n  try {\n    const config = getSMTPConfig()\n\n    if (!config.host || !config.auth.user || !config.auth.pass) {\n      return {\n        healthy: false,\n        message: 'SMTP configuration is incomplete',\n      }\n    }\n\n    return {\n      healthy: true,\n      message: `SMTP configured for ${config.host}:${config.port}`,\n    }\n  } catch (error) {\n    return {\n      healthy: false,\n      message: error instanceof Error ? error.message : 'Unknown SMTP error',\n    }\n  }\n}\n"],"names":[],"mappings":"gHAOA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAYA,SAAS,IACP,MAAO,CACL,KAAM,EAAA,GAAG,CAAC,SAAS,CACnB,KAAM,EAAA,GAAG,CAAC,SAAS,CACnB,OAAQ,AAAkB,QAAlB,GAAG,CAAC,SAAS,CACrB,KAAM,CACJ,KAAM,EAAA,GAAG,CAAC,aAAa,CACvB,KAAM,EAAA,GAAG,CAAC,aAAa,AACzB,CACF,CACF,CAKA,IAAI,EAA6C,KAEjD,SAAS,IACP,GAAI,CAAC,EAAa,CAChB,IAAM,EAAa,IACnB,EAAc,EAAA,OAAU,CAAC,eAAe,CAAC,EAC3C,CACA,OAAO,CACT,CAKO,eAAe,EAAU,CAAE,IAAE,SAAE,CAAO,MAAE,CAAI,MAAE,CAAI,CAAgB,EAKvE,GAAI,CAGF,GAAI,CAAC,AADc,6BACH,IAAI,CAAC,GACnB,EADwB,IACjB,CACL,SAAS,EACT,MAAO,CAAC,iCAAiC,EAAE,EAAA,CAC7C,AADiD,EAKnD,IAAM,EAAc,IAGd,EAAO,MAAM,EAAY,QAAQ,CAAC,CACtC,KAAM,EAAA,GAAG,CAAC,aAAa,IACvB,UACA,EACA,KAAM,QAAQ,OACd,CACF,GAQA,OANA,QAAQ,GAAG,CAAC,8BAA+B,CACzC,UAAW,EAAK,SAAS,IACzB,UACA,CACF,GAEO,CACL,SAAS,EACT,UAAW,EAAK,SAAS,AAC3B,CACF,CAAE,MAAO,EAAO,CAEd,OADA,QAAQ,KAAK,CAAC,0BAA2B,GAClC,CACL,SAAS,EACT,MAAO,aAAiB,MAAQ,EAAM,OAAO,CAAG,eAClD,CACF,CACF,CAKO,eAAe,IAIpB,GAAI,CACF,IAAM,EAAc,IAGpB,OAFA,MAAM,EAAY,MAAM,GAEjB,CACL,SAAS,EACT,QAAS,iCACX,CACF,CAAE,MAAO,EAAO,CACd,MAAO,CACL,SAAS,EACT,QAAS,aAAiB,MAAQ,EAAM,OAAO,CAAG,eACpD,CACF,CACF,CAKO,SAAS,IACd,GAAI,CACF,IAAM,EAAS,IAEf,GAAI,CAAC,EAAO,IAAI,EAAI,CAAC,EAAO,IAAI,CAAC,IAAI,EAAI,CAAC,EAAO,IAAI,CAAC,IAAI,CACxD,CAD0D,KACnD,CACL,SAAS,EACT,QAAS,kCACX,EAGF,MAAO,CACL,SAAS,EACT,QAAS,CAAC,oBAAoB,EAAE,EAAO,IAAI,CAAC,CAAC,EAAE,EAAO,IAAI,CAAA,CAAE,AAC9D,CACF,CAAE,MAAO,EAAO,CACd,MAAO,CACL,SAAS,EACT,QAAS,aAAiB,MAAQ,EAAM,OAAO,CAAG,oBACpD,CACF,CACF"}