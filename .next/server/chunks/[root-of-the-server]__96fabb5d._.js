module.exports=[709254,(e,t,r)=>{"use strict";var n=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,s={},c={RequestCookies:()=>m,ResponseCookies:()=>g,parseCookie:()=>u,parseSetCookie:()=>p,stringifyCookie:()=>l};for(var d in c)n(s,d,{get:c[d],enumerable:!0});function l(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),n=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===r.length?n:`${n}; ${r.join("; ")}`}function u(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[n,i]=[r.slice(0,e),r.slice(e+1)];try{t.set(n,decodeURIComponent(null!=i?i:"true"))}catch{}}return t}function p(e){if(!e)return;let[[t,r],...n]=u(e),{domain:i,expires:o,httponly:a,maxage:s,path:c,samesite:d,secure:l,partitioned:p,priority:m}=Object.fromEntries(n.map(([e,t])=>[e.toLowerCase().replace(/-/g,""),t]));{var g,y,b={name:t,value:decodeURIComponent(r),domain:i,...o&&{expires:new Date(o)},...a&&{httpOnly:!0},..."string"==typeof s&&{maxAge:Number(s)},path:c,...d&&{sameSite:f.includes(g=(g=d).toLowerCase())?g:void 0},...l&&{secure:!0},...m&&{priority:h.includes(y=(y=m).toLowerCase())?y:void 0},...p&&{partitioned:!0}};let e={};for(let t in b)b[t]&&(e[t]=b[t]);return e}}t.exports=((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let c of o(t))a.call(e,c)||c===r||n(e,c,{get:()=>t[c],enumerable:!(s=i(t,c))||s.enumerable});return e})(n({},"__esModule",{value:!0}),s);var f=["strict","lax","none"],h=["low","medium","high"],m=class{constructor(e){this._parsed=new Map,this._headers=e;const t=e.get("cookie");if(t)for(const[e,r]of u(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===n).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,n=this._parsed;return n.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(n).map(([e,t])=>l(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>l(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},g=class{constructor(e){var t,r,n;this._parsed=new Map,this._headers=e;const i=null!=(n=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?n:[];for(const e of Array.isArray(i)?i:function(e){if(!e)return[];var t,r,n,i,o,a=[],s=0;function c(){for(;s<e.length&&/\s/.test(e.charAt(s));)s+=1;return s<e.length}for(;s<e.length;){for(t=s,o=!1;c();)if(","===(r=e.charAt(s))){for(n=s,s+=1,c(),i=s;s<e.length&&"="!==(r=e.charAt(s))&&";"!==r&&","!==r;)s+=1;s<e.length&&"="===e.charAt(s)?(o=!0,s=i,a.push(e.substring(t,n)),t=s):s=n+1}else s+=1;(!o||s>=e.length)&&a.push(e.substring(t,e.length))}return a}(i)){const t=p(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===n)}has(e){return this._parsed.has(e)}set(...e){let[t,r,n]=1===e.length?[e[0].name,e[0].value,e[0]]:e,i=this._parsed;return i.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...n})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=l(r);t.append("set-cookie",e)}}(i,this._headers),this}delete(...e){let[t,r]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0]];return this.set({...r,name:t,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(l).join("; ")}}},331387,(e,t,r)=>{(()=>{"use strict";let r,n,i,o,a;var s,c,d,l,u,p,f,h,m,g,y,b,w,x,v,_,E={491:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextAPI=void 0;let n=r(223),i=r(172),o=r(930),a="context",s=new n.NoopContextManager;class c{constructor(){}static getInstance(){return this._instance||(this._instance=new c),this._instance}setGlobalContextManager(e){return(0,i.registerGlobal)(a,e,o.DiagAPI.instance())}active(){return this._getContextManager().active()}with(e,t,r,...n){return this._getContextManager().with(e,t,r,...n)}bind(e,t){return this._getContextManager().bind(e,t)}_getContextManager(){return(0,i.getGlobal)(a)||s}disable(){this._getContextManager().disable(),(0,i.unregisterGlobal)(a,o.DiagAPI.instance())}}t.ContextAPI=c},930:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagAPI=void 0;let n=r(56),i=r(912),o=r(957),a=r(172);class s{constructor(){function e(e){return function(...t){let r=(0,a.getGlobal)("diag");if(r)return r[e](...t)}}const t=this;t.setLogger=(e,r={logLevel:o.DiagLogLevel.INFO})=>{var n,s,c;if(e===t){let e=Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!=(n=e.stack)?n:e.message),!1}"number"==typeof r&&(r={logLevel:r});let d=(0,a.getGlobal)("diag"),l=(0,i.createLogLevelDiagLogger)(null!=(s=r.logLevel)?s:o.DiagLogLevel.INFO,e);if(d&&!r.suppressOverrideMessage){let e=null!=(c=Error().stack)?c:"<failed to generate stacktrace>";d.warn(`Current logger will be overwritten from ${e}`),l.warn(`Current logger will overwrite one already registered from ${e}`)}return(0,a.registerGlobal)("diag",l,t,!0)},t.disable=()=>{(0,a.unregisterGlobal)("diag",t)},t.createComponentLogger=e=>new n.DiagComponentLogger(e),t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}static instance(){return this._instance||(this._instance=new s),this._instance}}t.DiagAPI=s},653:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsAPI=void 0;let n=r(660),i=r(172),o=r(930),a="metrics";class s{constructor(){}static getInstance(){return this._instance||(this._instance=new s),this._instance}setGlobalMeterProvider(e){return(0,i.registerGlobal)(a,e,o.DiagAPI.instance())}getMeterProvider(){return(0,i.getGlobal)(a)||n.NOOP_METER_PROVIDER}getMeter(e,t,r){return this.getMeterProvider().getMeter(e,t,r)}disable(){(0,i.unregisterGlobal)(a,o.DiagAPI.instance())}}t.MetricsAPI=s},181:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropagationAPI=void 0;let n=r(172),i=r(874),o=r(194),a=r(277),s=r(369),c=r(930),d="propagation",l=new i.NoopTextMapPropagator;class u{constructor(){this.createBaggage=s.createBaggage,this.getBaggage=a.getBaggage,this.getActiveBaggage=a.getActiveBaggage,this.setBaggage=a.setBaggage,this.deleteBaggage=a.deleteBaggage}static getInstance(){return this._instance||(this._instance=new u),this._instance}setGlobalPropagator(e){return(0,n.registerGlobal)(d,e,c.DiagAPI.instance())}inject(e,t,r=o.defaultTextMapSetter){return this._getGlobalPropagator().inject(e,t,r)}extract(e,t,r=o.defaultTextMapGetter){return this._getGlobalPropagator().extract(e,t,r)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,n.unregisterGlobal)(d,c.DiagAPI.instance())}_getGlobalPropagator(){return(0,n.getGlobal)(d)||l}}t.PropagationAPI=u},997:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceAPI=void 0;let n=r(172),i=r(846),o=r(139),a=r(607),s=r(930),c="trace";class d{constructor(){this._proxyTracerProvider=new i.ProxyTracerProvider,this.wrapSpanContext=o.wrapSpanContext,this.isSpanContextValid=o.isSpanContextValid,this.deleteSpan=a.deleteSpan,this.getSpan=a.getSpan,this.getActiveSpan=a.getActiveSpan,this.getSpanContext=a.getSpanContext,this.setSpan=a.setSpan,this.setSpanContext=a.setSpanContext}static getInstance(){return this._instance||(this._instance=new d),this._instance}setGlobalTracerProvider(e){let t=(0,n.registerGlobal)(c,this._proxyTracerProvider,s.DiagAPI.instance());return t&&this._proxyTracerProvider.setDelegate(e),t}getTracerProvider(){return(0,n.getGlobal)(c)||this._proxyTracerProvider}getTracer(e,t){return this.getTracerProvider().getTracer(e,t)}disable(){(0,n.unregisterGlobal)(c,s.DiagAPI.instance()),this._proxyTracerProvider=new i.ProxyTracerProvider}}t.TraceAPI=d},277:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteBaggage=t.setBaggage=t.getActiveBaggage=t.getBaggage=void 0;let n=r(491),i=(0,r(780).createContextKey)("OpenTelemetry Baggage Key");function o(e){return e.getValue(i)||void 0}t.getBaggage=o,t.getActiveBaggage=function(){return o(n.ContextAPI.getInstance().active())},t.setBaggage=function(e,t){return e.setValue(i,t)},t.deleteBaggage=function(e){return e.deleteValue(i)}},993:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaggageImpl=void 0;class r{constructor(e){this._entries=e?new Map(e):new Map}getEntry(e){let t=this._entries.get(e);if(t)return Object.assign({},t)}getAllEntries(){return Array.from(this._entries.entries()).map(([e,t])=>[e,t])}setEntry(e,t){let n=new r(this._entries);return n._entries.set(e,t),n}removeEntry(e){let t=new r(this._entries);return t._entries.delete(e),t}removeEntries(...e){let t=new r(this._entries);for(let r of e)t._entries.delete(r);return t}clear(){return new r}}t.BaggageImpl=r},830:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataSymbol=void 0,t.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")},369:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataFromString=t.createBaggage=void 0;let n=r(930),i=r(993),o=r(830),a=n.DiagAPI.instance();t.createBaggage=function(e={}){return new i.BaggageImpl(new Map(Object.entries(e)))},t.baggageEntryMetadataFromString=function(e){return"string"!=typeof e&&(a.error(`Cannot create baggage metadata from unknown type: ${typeof e}`),e=""),{__TYPE__:o.baggageEntryMetadataSymbol,toString:()=>e}}},67:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.context=void 0,t.context=r(491).ContextAPI.getInstance()},223:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopContextManager=void 0;let n=r(780);t.NoopContextManager=class{active(){return n.ROOT_CONTEXT}with(e,t,r,...n){return t.call(r,...n)}bind(e,t){return t}enable(){return this}disable(){return this}}},780:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ROOT_CONTEXT=t.createContextKey=void 0,t.createContextKey=function(e){return Symbol.for(e)};class r{constructor(e){const t=this;t._currentContext=e?new Map(e):new Map,t.getValue=e=>t._currentContext.get(e),t.setValue=(e,n)=>{let i=new r(t._currentContext);return i._currentContext.set(e,n),i},t.deleteValue=e=>{let n=new r(t._currentContext);return n._currentContext.delete(e),n}}}t.ROOT_CONTEXT=new r},506:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diag=void 0,t.diag=r(930).DiagAPI.instance()},56:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagComponentLogger=void 0;let n=r(172);function i(e,t,r){let i=(0,n.getGlobal)("diag");if(i)return r.unshift(t),i[e](...r)}t.DiagComponentLogger=class{constructor(e){this._namespace=e.namespace||"DiagComponentLogger"}debug(...e){return i("debug",this._namespace,e)}error(...e){return i("error",this._namespace,e)}info(...e){return i("info",this._namespace,e)}warn(...e){return i("warn",this._namespace,e)}verbose(...e){return i("verbose",this._namespace,e)}}},972:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagConsoleLogger=void 0;let r=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];t.DiagConsoleLogger=class{constructor(){for(let e=0;e<r.length;e++)this[r[e].n]=function(e){return function(...t){if(console){let r=console[e];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,t)}}}(r[e].c)}}},912:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogLevelDiagLogger=void 0;let n=r(957);t.createLogLevelDiagLogger=function(e,t){function r(r,n){let i=t[r];return"function"==typeof i&&e>=n?i.bind(t):function(){}}return e<n.DiagLogLevel.NONE?e=n.DiagLogLevel.NONE:e>n.DiagLogLevel.ALL&&(e=n.DiagLogLevel.ALL),t=t||{},{error:r("error",n.DiagLogLevel.ERROR),warn:r("warn",n.DiagLogLevel.WARN),info:r("info",n.DiagLogLevel.INFO),debug:r("debug",n.DiagLogLevel.DEBUG),verbose:r("verbose",n.DiagLogLevel.VERBOSE)}}},957:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DiagLogLevel=void 0,(r=t.DiagLogLevel||(t.DiagLogLevel={}))[r.NONE=0]="NONE",r[r.ERROR=30]="ERROR",r[r.WARN=50]="WARN",r[r.INFO=60]="INFO",r[r.DEBUG=70]="DEBUG",r[r.VERBOSE=80]="VERBOSE",r[r.ALL=9999]="ALL"},172:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unregisterGlobal=t.getGlobal=t.registerGlobal=void 0;let n=r(200),i=r(521),o=r(130),a=i.VERSION.split(".")[0],s=Symbol.for(`opentelemetry.js.api.${a}`),c=n._globalThis;t.registerGlobal=function(e,t,r,n=!1){var o;let a=c[s]=null!=(o=c[s])?o:{version:i.VERSION};if(!n&&a[e]){let t=Error(`@opentelemetry/api: Attempted duplicate registration of API: ${e}`);return r.error(t.stack||t.message),!1}if(a.version!==i.VERSION){let t=Error(`@opentelemetry/api: Registration of version v${a.version} for ${e} does not match previously registered API v${i.VERSION}`);return r.error(t.stack||t.message),!1}return a[e]=t,r.debug(`@opentelemetry/api: Registered a global for ${e} v${i.VERSION}.`),!0},t.getGlobal=function(e){var t,r;let n=null==(t=c[s])?void 0:t.version;if(n&&(0,o.isCompatible)(n))return null==(r=c[s])?void 0:r[e]},t.unregisterGlobal=function(e,t){t.debug(`@opentelemetry/api: Unregistering a global for ${e} v${i.VERSION}.`);let r=c[s];r&&delete r[e]}},130:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCompatible=t._makeCompatibilityCheck=void 0;let n=r(521),i=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function o(e){let t=new Set([e]),r=new Set,n=e.match(i);if(!n)return()=>!1;let o={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(null!=o.prerelease)return function(t){return t===e};function a(e){return r.add(e),!1}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;let n=e.match(i);if(!n)return a(e);let s={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(null!=s.prerelease||o.major!==s.major)return a(e);if(0===o.major)return o.minor===s.minor&&o.patch<=s.patch?(t.add(e),!0):a(e);return o.minor<=s.minor?(t.add(e),!0):a(e)}}t._makeCompatibilityCheck=o,t.isCompatible=o(n.VERSION)},886:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.metrics=void 0,t.metrics=r(653).MetricsAPI.getInstance()},901:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ValueType=void 0,(r=t.ValueType||(t.ValueType={}))[r.INT=0]="INT",r[r.DOUBLE=1]="DOUBLE"},102:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createNoopMeter=t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=t.NOOP_OBSERVABLE_GAUGE_METRIC=t.NOOP_OBSERVABLE_COUNTER_METRIC=t.NOOP_UP_DOWN_COUNTER_METRIC=t.NOOP_HISTOGRAM_METRIC=t.NOOP_COUNTER_METRIC=t.NOOP_METER=t.NoopObservableUpDownCounterMetric=t.NoopObservableGaugeMetric=t.NoopObservableCounterMetric=t.NoopObservableMetric=t.NoopHistogramMetric=t.NoopUpDownCounterMetric=t.NoopCounterMetric=t.NoopMetric=t.NoopMeter=void 0;class r{constructor(){}createHistogram(e,r){return t.NOOP_HISTOGRAM_METRIC}createCounter(e,r){return t.NOOP_COUNTER_METRIC}createUpDownCounter(e,r){return t.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(e,r){return t.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(e,r){return t.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(e,r){return t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(e,t){}removeBatchObservableCallback(e){}}t.NoopMeter=r;class n{}t.NoopMetric=n;class i extends n{add(e,t){}}t.NoopCounterMetric=i;class o extends n{add(e,t){}}t.NoopUpDownCounterMetric=o;class a extends n{record(e,t){}}t.NoopHistogramMetric=a;class s{addCallback(e){}removeCallback(e){}}t.NoopObservableMetric=s;class c extends s{}t.NoopObservableCounterMetric=c;class d extends s{}t.NoopObservableGaugeMetric=d;class l extends s{}t.NoopObservableUpDownCounterMetric=l,t.NOOP_METER=new r,t.NOOP_COUNTER_METRIC=new i,t.NOOP_HISTOGRAM_METRIC=new a,t.NOOP_UP_DOWN_COUNTER_METRIC=new o,t.NOOP_OBSERVABLE_COUNTER_METRIC=new c,t.NOOP_OBSERVABLE_GAUGE_METRIC=new d,t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new l,t.createNoopMeter=function(){return t.NOOP_METER}},660:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOOP_METER_PROVIDER=t.NoopMeterProvider=void 0;let n=r(102);class i{getMeter(e,t,r){return n.NOOP_METER}}t.NoopMeterProvider=i,t.NOOP_METER_PROVIDER=new i},200:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(46),t)},651:(t,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r._globalThis=void 0,r._globalThis="object"==typeof globalThis?globalThis:e.g},46:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(651),t)},939:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.propagation=void 0,t.propagation=r(181).PropagationAPI.getInstance()},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTextMapPropagator=void 0,t.NoopTextMapPropagator=class{inject(e,t){}extract(e,t){return e}fields(){return[]}}},194:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTextMapSetter=t.defaultTextMapGetter=void 0,t.defaultTextMapGetter={get(e,t){if(null!=e)return e[t]},keys:e=>null==e?[]:Object.keys(e)},t.defaultTextMapSetter={set(e,t,r){null!=e&&(e[t]=r)}}},845:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trace=void 0,t.trace=r(997).TraceAPI.getInstance()},403:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NonRecordingSpan=void 0;let n=r(476);t.NonRecordingSpan=class{constructor(e=n.INVALID_SPAN_CONTEXT){this._spanContext=e}spanContext(){return this._spanContext}setAttribute(e,t){return this}setAttributes(e){return this}addEvent(e,t){return this}setStatus(e){return this}updateName(e){return this}end(e){}isRecording(){return!1}recordException(e,t){}}},614:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracer=void 0;let n=r(491),i=r(607),o=r(403),a=r(139),s=n.ContextAPI.getInstance();t.NoopTracer=class{startSpan(e,t,r=s.active()){var n;if(null==t?void 0:t.root)return new o.NonRecordingSpan;let c=r&&(0,i.getSpanContext)(r);return"object"==typeof(n=c)&&"string"==typeof n.spanId&&"string"==typeof n.traceId&&"number"==typeof n.traceFlags&&(0,a.isSpanContextValid)(c)?new o.NonRecordingSpan(c):new o.NonRecordingSpan}startActiveSpan(e,t,r,n){let o,a,c;if(arguments.length<2)return;2==arguments.length?c=t:3==arguments.length?(o=t,c=r):(o=t,a=r,c=n);let d=null!=a?a:s.active(),l=this.startSpan(e,o,d),u=(0,i.setSpan)(d,l);return s.with(u,c,void 0,l)}}},124:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracerProvider=void 0;let n=r(614);t.NoopTracerProvider=class{getTracer(e,t,r){return new n.NoopTracer}}},125:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracer=void 0;let n=new(r(614)).NoopTracer;t.ProxyTracer=class{constructor(e,t,r,n){this._provider=e,this.name=t,this.version=r,this.options=n}startSpan(e,t,r){return this._getTracer().startSpan(e,t,r)}startActiveSpan(e,t,r,n){let i=this._getTracer();return Reflect.apply(i.startActiveSpan,i,arguments)}_getTracer(){if(this._delegate)return this._delegate;let e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):n}}},846:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracerProvider=void 0;let n=r(125),i=new(r(124)).NoopTracerProvider;t.ProxyTracerProvider=class{getTracer(e,t,r){var i;return null!=(i=this.getDelegateTracer(e,t,r))?i:new n.ProxyTracer(this,e,t,r)}getDelegate(){var e;return null!=(e=this._delegate)?e:i}setDelegate(e){this._delegate=e}getDelegateTracer(e,t,r){var n;return null==(n=this._delegate)?void 0:n.getTracer(e,t,r)}}},996:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.SamplingDecision=void 0,(r=t.SamplingDecision||(t.SamplingDecision={}))[r.NOT_RECORD=0]="NOT_RECORD",r[r.RECORD=1]="RECORD",r[r.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"},607:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSpanContext=t.setSpanContext=t.deleteSpan=t.setSpan=t.getActiveSpan=t.getSpan=void 0;let n=r(780),i=r(403),o=r(491),a=(0,n.createContextKey)("OpenTelemetry Context Key SPAN");function s(e){return e.getValue(a)||void 0}function c(e,t){return e.setValue(a,t)}t.getSpan=s,t.getActiveSpan=function(){return s(o.ContextAPI.getInstance().active())},t.setSpan=c,t.deleteSpan=function(e){return e.deleteValue(a)},t.setSpanContext=function(e,t){return c(e,new i.NonRecordingSpan(t))},t.getSpanContext=function(e){var t;return null==(t=s(e))?void 0:t.spanContext()}},325:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceStateImpl=void 0;let n=r(564);class i{constructor(e){this._internalState=new Map,e&&this._parse(e)}set(e,t){let r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r}unset(e){let t=this._clone();return t._internalState.delete(e),t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,t)=>(e.push(t+"="+this.get(t)),e),[]).join(",")}_parse(e){!(e.length>512)&&(this._internalState=e.split(",").reverse().reduce((e,t)=>{let r=t.trim(),i=r.indexOf("=");if(-1!==i){let o=r.slice(0,i),a=r.slice(i+1,t.length);(0,n.validateKey)(o)&&(0,n.validateValue)(a)&&e.set(o,a)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){let e=new i;return e._internalState=new Map(this._internalState),e}}t.TraceStateImpl=i},564:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateValue=t.validateKey=void 0;let r="[_0-9a-z-*/]",n=`[a-z]${r}{0,255}`,i=`[a-z0-9]${r}{0,240}@[a-z]${r}{0,13}`,o=RegExp(`^(?:${n}|${i})$`),a=/^[ -~]{0,255}[!-~]$/,s=/,|=/;t.validateKey=function(e){return o.test(e)},t.validateValue=function(e){return a.test(e)&&!s.test(e)}},98:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTraceState=void 0;let n=r(325);t.createTraceState=function(e){return new n.TraceStateImpl(e)}},476:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INVALID_SPAN_CONTEXT=t.INVALID_TRACEID=t.INVALID_SPANID=void 0;let n=r(475);t.INVALID_SPANID="0000000000000000",t.INVALID_TRACEID="00000000000000000000000000000000",t.INVALID_SPAN_CONTEXT={traceId:t.INVALID_TRACEID,spanId:t.INVALID_SPANID,traceFlags:n.TraceFlags.NONE}},357:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.SpanKind=void 0,(r=t.SpanKind||(t.SpanKind={}))[r.INTERNAL=0]="INTERNAL",r[r.SERVER=1]="SERVER",r[r.CLIENT=2]="CLIENT",r[r.PRODUCER=3]="PRODUCER",r[r.CONSUMER=4]="CONSUMER"},139:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wrapSpanContext=t.isSpanContextValid=t.isValidSpanId=t.isValidTraceId=void 0;let n=r(476),i=r(403),o=/^([0-9a-f]{32})$/i,a=/^[0-9a-f]{16}$/i;function s(e){return o.test(e)&&e!==n.INVALID_TRACEID}function c(e){return a.test(e)&&e!==n.INVALID_SPANID}t.isValidTraceId=s,t.isValidSpanId=c,t.isSpanContextValid=function(e){return s(e.traceId)&&c(e.spanId)},t.wrapSpanContext=function(e){return new i.NonRecordingSpan(e)}},847:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.SpanStatusCode=void 0,(r=t.SpanStatusCode||(t.SpanStatusCode={}))[r.UNSET=0]="UNSET",r[r.OK=1]="OK",r[r.ERROR=2]="ERROR"},475:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TraceFlags=void 0,(r=t.TraceFlags||(t.TraceFlags={}))[r.NONE=0]="NONE",r[r.SAMPLED=1]="SAMPLED"},521:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="1.6.0"}},T={};function A(e){var t=T[e];if(void 0!==t)return t.exports;var r=T[e]={exports:{}},n=!0;try{E[e].call(r.exports,r,r.exports,A),n=!1}finally{n&&delete T[e]}return r.exports}A.ab="/ROOT/node_modules/next/dist/compiled/@opentelemetry/api/";var S={};Object.defineProperty(S,"__esModule",{value:!0}),S.trace=S.propagation=S.metrics=S.diag=S.context=S.INVALID_SPAN_CONTEXT=S.INVALID_TRACEID=S.INVALID_SPANID=S.isValidSpanId=S.isValidTraceId=S.isSpanContextValid=S.createTraceState=S.TraceFlags=S.SpanStatusCode=S.SpanKind=S.SamplingDecision=S.ProxyTracerProvider=S.ProxyTracer=S.defaultTextMapSetter=S.defaultTextMapGetter=S.ValueType=S.createNoopMeter=S.DiagLogLevel=S.DiagConsoleLogger=S.ROOT_CONTEXT=S.createContextKey=S.baggageEntryMetadataFromString=void 0,s=A(369),Object.defineProperty(S,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return s.baggageEntryMetadataFromString}}),c=A(780),Object.defineProperty(S,"createContextKey",{enumerable:!0,get:function(){return c.createContextKey}}),Object.defineProperty(S,"ROOT_CONTEXT",{enumerable:!0,get:function(){return c.ROOT_CONTEXT}}),d=A(972),Object.defineProperty(S,"DiagConsoleLogger",{enumerable:!0,get:function(){return d.DiagConsoleLogger}}),l=A(957),Object.defineProperty(S,"DiagLogLevel",{enumerable:!0,get:function(){return l.DiagLogLevel}}),u=A(102),Object.defineProperty(S,"createNoopMeter",{enumerable:!0,get:function(){return u.createNoopMeter}}),p=A(901),Object.defineProperty(S,"ValueType",{enumerable:!0,get:function(){return p.ValueType}}),f=A(194),Object.defineProperty(S,"defaultTextMapGetter",{enumerable:!0,get:function(){return f.defaultTextMapGetter}}),Object.defineProperty(S,"defaultTextMapSetter",{enumerable:!0,get:function(){return f.defaultTextMapSetter}}),h=A(125),Object.defineProperty(S,"ProxyTracer",{enumerable:!0,get:function(){return h.ProxyTracer}}),m=A(846),Object.defineProperty(S,"ProxyTracerProvider",{enumerable:!0,get:function(){return m.ProxyTracerProvider}}),g=A(996),Object.defineProperty(S,"SamplingDecision",{enumerable:!0,get:function(){return g.SamplingDecision}}),y=A(357),Object.defineProperty(S,"SpanKind",{enumerable:!0,get:function(){return y.SpanKind}}),b=A(847),Object.defineProperty(S,"SpanStatusCode",{enumerable:!0,get:function(){return b.SpanStatusCode}}),w=A(475),Object.defineProperty(S,"TraceFlags",{enumerable:!0,get:function(){return w.TraceFlags}}),x=A(98),Object.defineProperty(S,"createTraceState",{enumerable:!0,get:function(){return x.createTraceState}}),v=A(139),Object.defineProperty(S,"isSpanContextValid",{enumerable:!0,get:function(){return v.isSpanContextValid}}),Object.defineProperty(S,"isValidTraceId",{enumerable:!0,get:function(){return v.isValidTraceId}}),Object.defineProperty(S,"isValidSpanId",{enumerable:!0,get:function(){return v.isValidSpanId}}),_=A(476),Object.defineProperty(S,"INVALID_SPANID",{enumerable:!0,get:function(){return _.INVALID_SPANID}}),Object.defineProperty(S,"INVALID_TRACEID",{enumerable:!0,get:function(){return _.INVALID_TRACEID}}),Object.defineProperty(S,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return _.INVALID_SPAN_CONTEXT}}),r=A(67),Object.defineProperty(S,"context",{enumerable:!0,get:function(){return r.context}}),n=A(506),Object.defineProperty(S,"diag",{enumerable:!0,get:function(){return n.diag}}),i=A(886),Object.defineProperty(S,"metrics",{enumerable:!0,get:function(){return i.metrics}}),o=A(939),Object.defineProperty(S,"propagation",{enumerable:!0,get:function(){return o.propagation}}),a=A(845),Object.defineProperty(S,"trace",{enumerable:!0,get:function(){return a.trace}}),S.default={context:r.context,diag:n.diag,metrics:i.metrics,propagation:o.propagation,trace:a.trace},t.exports=S})()},262712,(e,t,r)=>{(()=>{"use strict";"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab="/ROOT/node_modules/next/dist/compiled/cookie/");var e,r,n,i,o={};o.parse=function(t,r){if("string"!=typeof t)throw TypeError("argument str must be a string");for(var i={},o=t.split(n),a=(r||{}).decode||e,s=0;s<o.length;s++){var c=o[s],d=c.indexOf("=");if(!(d<0)){var l=c.substr(0,d).trim(),u=c.substr(++d,c.length).trim();'"'==u[0]&&(u=u.slice(1,-1)),void 0==i[l]&&(i[l]=function(e,t){try{return t(e)}catch(t){return e}}(u,a))}}return i},o.serialize=function(e,t,n){var o=n||{},a=o.encode||r;if("function"!=typeof a)throw TypeError("option encode is invalid");if(!i.test(e))throw TypeError("argument name is invalid");var s=a(t);if(s&&!i.test(s))throw TypeError("argument val is invalid");var c=e+"="+s;if(null!=o.maxAge){var d=o.maxAge-0;if(isNaN(d)||!isFinite(d))throw TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(d)}if(o.domain){if(!i.test(o.domain))throw TypeError("option domain is invalid");c+="; Domain="+o.domain}if(o.path){if(!i.test(o.path))throw TypeError("option path is invalid");c+="; Path="+o.path}if(o.expires){if("function"!=typeof o.expires.toUTCString)throw TypeError("option expires is invalid");c+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&(c+="; HttpOnly"),o.secure&&(c+="; Secure"),o.sameSite)switch("string"==typeof o.sameSite?o.sameSite.toLowerCase():o.sameSite){case!0:case"strict":c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"none":c+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return c},e=decodeURIComponent,r=encodeURIComponent,n=/; */,i=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,t.exports=o})()},447413,(e,t,r)=>{(()=>{"use strict";let e,r,n,i,o;var a={993:e=>{var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw TypeError("The listener must be a function");var s=new i(n,o||e,a),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var c,d,l=this._events[s],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,o),!0;case 6:return l.fn.call(l.context,t,n,i,o,a),!0}for(d=1,c=Array(u-1);d<u;d++)c[d-1]=arguments[d];l.fn.apply(l.context,c)}else{var p,f=l.length;for(d=0;d<f;d++)switch(l[d].once&&this.removeListener(e,l[d].fn,void 0,!0),u){case 1:l[d].fn.call(l[d].context);break;case 2:l[d].fn.call(l[d].context,t);break;case 3:l[d].fn.call(l[d].context,t,n);break;case 4:l[d].fn.call(l[d].context,t,n,i);break;default:if(!c)for(p=1,c=Array(u-1);p<u;p++)c[p-1]=arguments[p];l[d].fn.apply(l[d].context,c)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var c=0,d=[],l=s.length;c<l;c++)(s[c].fn!==t||i&&!s[c].once||n&&s[c].context!==n)&&d.push(s[c]);d.length?this._events[o]=1===d.length?d[0]:d:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s},213:e=>{e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},574:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let n=0,i=e.length;for(;i>0;){let o=i/2|0,a=n+o;0>=r(e[a],t)?(n=++a,i-=o+1):i=o}return n}},821:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let n=r(574);t.default=class{constructor(){this._queue=[]}enqueue(e,t){let r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);let i=n.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(i,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}}},816:(e,t,r)=>{let n=r(213);class i extends Error{constructor(e){super(e),this.name="TimeoutError"}}let o=(e,t,r)=>new Promise((o,a)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void o(e);let s=setTimeout(()=>{if("function"==typeof r){try{o(r())}catch(e){a(e)}return}let n="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,s=r instanceof Error?r:new i(n);"function"==typeof e.cancel&&e.cancel(),a(s)},t);n(e.then(o,a),()=>{clearTimeout(s)})});e.exports=o,e.exports.default=o,e.exports.TimeoutError=i}},s={};function c(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}},n=!0;try{a[e](r,r.exports,c),n=!1}finally{n&&delete s[e]}return r.exports}c.ab="/ROOT/node_modules/next/dist/compiled/p-queue/";var d={};Object.defineProperty(d,"__esModule",{value:!0}),e=c(993),r=c(816),n=c(821),i=()=>{},o=new r.TimeoutError,d.default=class extends e{constructor(e){var t,r,o,a;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=i,this._resolveIdle=i,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:n.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!=(r=null==(t=e.intervalCap)?void 0:t.toString())?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!=(a=null==(o=e.interval)?void 0:o.toString())?a:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=i,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=i,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((n,i)=>{let a=async()=>{this._pendingCount++,this._intervalCount++;try{let a=void 0===this._timeout&&void 0===t.timeout?e():r.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&i(o)});n(await a)}catch(e){i(e)}this._next()};this._queue.enqueue(a,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}},t.exports=d})()},951187,(e,t,r)=>{t.exports=e.x("next/dist/server/lib/incremental-cache/tags-manifest.external.js",()=>require("next/dist/server/lib/incremental-cache/tags-manifest.external.js"))},478500,(e,t,r)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},22947,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={getTestReqInfo:function(){return c},withRequest:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=new(e.r(478500)).AsyncLocalStorage;function a(e,t){let r=t.header(e,"next-test-proxy-port");if(!r)return;let n=t.url(e);return{url:n,proxyPort:Number(r),testData:t.header(e,"next-test-data")||""}}function s(e,t,r){let n=a(e,t);return n?o.run(n,r):r()}function c(e,t){let r=o.getStore();return r||(e&&t?a(e,t):void 0)}},49883,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={handleFetch:function(){return c},interceptFetch:function(){return d},reader:function(){return a}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(22947),a={url:e=>e.url,header:(e,t)=>e.headers.get(t)};async function s(e,t){let{url:r,method:n,headers:i,body:o,cache:a,credentials:s,integrity:c,mode:d,redirect:l,referrer:u,referrerPolicy:p}=t;return{testData:e,api:"fetch",request:{url:r,method:n,headers:[...Array.from(i),["next-test-stack",function(){let e=(Error().stack??"").split("\n");for(let t=1;t<e.length;t++)if(e[t].length>0){e=e.slice(t);break}return(e=(e=(e=e.filter(e=>!e.includes("/next/dist/"))).slice(0,5)).map(e=>e.replace("webpack-internal:///(rsc)/","").trim())).join("    ")}()]],body:o?Buffer.from(await t.arrayBuffer()).toString("base64"):null,cache:a,credentials:s,integrity:c,mode:d,redirect:l,referrer:u,referrerPolicy:p}}}async function c(e,t){let r=(0,o.getTestReqInfo)(t,a);if(!r)return e(t);let{testData:n,proxyPort:i}=r,c=await s(n,t),d=await e(`http://localhost:${i}`,{method:"POST",body:JSON.stringify(c),next:{internal:!0}});if(!d.ok)throw Object.defineProperty(Error(`Proxy request failed: ${d.status}`),"__NEXT_ERROR_CODE",{value:"E146",enumerable:!1,configurable:!0});let l=await d.json(),{api:u}=l;switch(u){case"continue":return e(t);case"abort":case"unhandled":throw Object.defineProperty(Error(`Proxy request aborted [${t.method} ${t.url}]`),"__NEXT_ERROR_CODE",{value:"E145",enumerable:!1,configurable:!0});case"fetch":return function(e){let{status:t,headers:r,body:n}=e.response;return new Response(n?Buffer.from(n,"base64"):null,{status:t,headers:new Headers(r)})}(l);default:return u}}function d(t){return e.g.fetch=function(e,r){var n;return(null==r||null==(n=r.next)?void 0:n.internal)?t(e,r):c(t,new Request(e,r))},()=>{e.g.fetch=t}}},376532,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={interceptTestApis:function(){return s},wrapRequestHandler:function(){return c}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(22947),a=e.r(49883);function s(){return(0,a.interceptFetch)(e.g.fetch)}function c(e){return(t,r)=>(0,o.withRequest)(t,a.reader,()=>e(t,r))}},184528,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.prisma=void 0;let n=e.r(29173);r.prisma=globalThis.prisma??new n.PrismaClient({log:["error"]})},893022,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.WorkerApiError=void 0,r.WorkerApiError=class extends Error{constructor(e,t,r,n){super(e),this.code=t,this.statusCode=r,this.details=n,this.name="WorkerApiError"}}},88015,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),i(e.r(29173),r),i(e.r(893022),r)},110724,(e,t,r)=>{"use strict";var n=e.e&&e.e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=e.e&&e.e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),r.prisma=void 0;var o=e.r(184528);Object.defineProperty(r,"prisma",{enumerable:!0,get:function(){return o.prisma}}),i(e.r(88015),r)},512953,(e,t,r)=>{"use strict";function n(e,t,r){if(e){for(let n of(r&&(r=r.toLowerCase()),e))if(t===n.domain?.split(":",1)[0].toLowerCase()||r===n.defaultLocale.toLowerCase()||n.locales?.some(e=>e.toLowerCase()===r))return n}}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"detectDomainLocale",{enumerable:!0,get:function(){return n}})},157520,(e,t,r)=>{"use strict";function n(e){return e.replace(/\/$/,"")||"/"}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"removeTrailingSlash",{enumerable:!0,get:function(){return n}})},952799,(e,t,r)=>{"use strict";function n(e){let t=e.indexOf("#"),r=e.indexOf("?"),n=r>-1&&(t<0||r<t);return n||t>-1?{pathname:e.substring(0,n?r:t),query:n?e.substring(r,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"parsePath",{enumerable:!0,get:function(){return n}})},511959,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"addPathPrefix",{enumerable:!0,get:function(){return i}});let n=e.r(952799);function i(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:i,hash:o}=(0,n.parsePath)(e);return`${t}${r}${i}${o}`}},130652,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"addPathSuffix",{enumerable:!0,get:function(){return i}});let n=e.r(952799);function i(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:i,hash:o}=(0,n.parsePath)(e);return`${r}${t}${i}${o}`}},886984,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"pathHasPrefix",{enumerable:!0,get:function(){return i}});let n=e.r(952799);function i(e,t){if("string"!=typeof e)return!1;let{pathname:r}=(0,n.parsePath)(e);return r===t||r.startsWith(t+"/")}},399256,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"addLocale",{enumerable:!0,get:function(){return o}});let n=e.r(511959),i=e.r(886984);function o(e,t,r,o){if(!t||t===r)return e;let a=e.toLowerCase();return!o&&((0,i.pathHasPrefix)(a,"/api")||(0,i.pathHasPrefix)(a,`/${t.toLowerCase()}`))?e:(0,n.addPathPrefix)(e,`/${t}`)}},16107,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"formatNextPathnameInfo",{enumerable:!0,get:function(){return s}});let n=e.r(157520),i=e.r(511959),o=e.r(130652),a=e.r(399256);function s(e){let t=(0,a.addLocale)(e.pathname,e.locale,e.buildId?void 0:e.defaultLocale,e.ignorePrefix);return(e.buildId||!e.trailingSlash)&&(t=(0,n.removeTrailingSlash)(t)),e.buildId&&(t=(0,o.addPathSuffix)((0,i.addPathPrefix)(t,`/_next/data/${e.buildId}`),"/"===e.pathname?"index.json":".json")),t=(0,i.addPathPrefix)(t,e.basePath),!e.buildId&&e.trailingSlash?t.endsWith("/")?t:(0,o.addPathSuffix)(t,"/"):(0,n.removeTrailingSlash)(t)}},26729,(e,t,r)=>{"use strict";function n(e,t){let r;if(t?.host&&!Array.isArray(t.host))r=t.host.toString().split(":",1)[0];else{if(!e.hostname)return;r=e.hostname}return r.toLowerCase()}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getHostname",{enumerable:!0,get:function(){return n}})},996045,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"normalizeLocalePath",{enumerable:!0,get:function(){return i}});let n=new WeakMap;function i(e,t){let r;if(!t)return{pathname:e};let i=n.get(t);i||(i=t.map(e=>e.toLowerCase()),n.set(t,i));let o=e.split("/",2);if(!o[1])return{pathname:e};let a=o[1].toLowerCase(),s=i.indexOf(a);return s<0?{pathname:e}:(r=t[s],{pathname:e=e.slice(r.length+1)||"/",detectedLocale:r})}},92624,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"removePathPrefix",{enumerable:!0,get:function(){return i}});let n=e.r(886984);function i(e,t){if(!(0,n.pathHasPrefix)(e,t))return e;let r=e.slice(t.length);return r.startsWith("/")?r:`/${r}`}},107657,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getNextPathnameInfo",{enumerable:!0,get:function(){return a}});let n=e.r(996045),i=e.r(92624),o=e.r(886984);function a(e,t){let{basePath:r,i18n:a,trailingSlash:s}=t.nextConfig??{},c={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):s};r&&(0,o.pathHasPrefix)(c.pathname,r)&&(c.pathname=(0,i.removePathPrefix)(c.pathname,r),c.basePath=r);let d=c.pathname;if(c.pathname.startsWith("/_next/data/")&&c.pathname.endsWith(".json")){let e=c.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/");c.buildId=e[0],d="index"!==e[1]?`/${e.slice(1).join("/")}`:"/",!0===t.parseData&&(c.pathname=d)}if(a){let e=t.i18nProvider?t.i18nProvider.analyze(c.pathname):(0,n.normalizeLocalePath)(c.pathname,a.locales);c.locale=e.detectedLocale,c.pathname=e.pathname??c.pathname,!e.detectedLocale&&c.buildId&&(e=t.i18nProvider?t.i18nProvider.analyze(d):(0,n.normalizeLocalePath)(d,a.locales)).detectedLocale&&(c.locale=e.detectedLocale)}return c}},761400,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NextURL",{enumerable:!0,get:function(){return l}});let n=e.r(512953),i=e.r(16107),o=e.r(26729),a=e.r(107657),s=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function c(e,t){return new URL(String(e).replace(s,"localhost"),t&&String(t).replace(s,"localhost"))}let d=Symbol("NextURLInternal");class l{constructor(e,t,r){let n,i;"object"==typeof t&&"pathname"in t||"string"==typeof t?(n=t,i=r||{}):i=r||t||{},this[d]={url:c(e,n??i.base),options:i,basePath:""},this.analyze()}analyze(){var e,t,r,i,s;let c=(0,a.getNextPathnameInfo)(this[d].url.pathname,{nextConfig:this[d].options.nextConfig,parseData:!0,i18nProvider:this[d].options.i18nProvider}),l=(0,o.getHostname)(this[d].url,this[d].options.headers);this[d].domainLocale=this[d].options.i18nProvider?this[d].options.i18nProvider.detectDomainLocale(l):(0,n.detectDomainLocale)(null==(t=this[d].options.nextConfig)||null==(e=t.i18n)?void 0:e.domains,l);let u=(null==(r=this[d].domainLocale)?void 0:r.defaultLocale)||(null==(s=this[d].options.nextConfig)||null==(i=s.i18n)?void 0:i.defaultLocale);this[d].url.pathname=c.pathname,this[d].defaultLocale=u,this[d].basePath=c.basePath??"",this[d].buildId=c.buildId,this[d].locale=c.locale??u,this[d].trailingSlash=c.trailingSlash}formatPathname(){return(0,i.formatNextPathnameInfo)({basePath:this[d].basePath,buildId:this[d].buildId,defaultLocale:this[d].options.forceLocale?void 0:this[d].defaultLocale,locale:this[d].locale,pathname:this[d].url.pathname,trailingSlash:this[d].trailingSlash})}formatSearch(){return this[d].url.search}get buildId(){return this[d].buildId}set buildId(e){this[d].buildId=e}get locale(){return this[d].locale??""}set locale(e){var t,r;if(!this[d].locale||!(null==(r=this[d].options.nextConfig)||null==(t=r.i18n)?void 0:t.locales.includes(e)))throw Object.defineProperty(TypeError(`The NextURL configuration includes no locale "${e}"`),"__NEXT_ERROR_CODE",{value:"E597",enumerable:!1,configurable:!0});this[d].locale=e}get defaultLocale(){return this[d].defaultLocale}get domainLocale(){return this[d].domainLocale}get searchParams(){return this[d].url.searchParams}get host(){return this[d].url.host}set host(e){this[d].url.host=e}get hostname(){return this[d].url.hostname}set hostname(e){this[d].url.hostname=e}get port(){return this[d].url.port}set port(e){this[d].url.port=e}get protocol(){return this[d].url.protocol}set protocol(e){this[d].url.protocol=e}get href(){let e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[d].url=c(e),this.analyze()}get origin(){return this[d].url.origin}get pathname(){return this[d].url.pathname}set pathname(e){this[d].url.pathname=e}get hash(){return this[d].url.hash}set hash(e){this[d].url.hash=e}get search(){return this[d].url.search}set search(e){this[d].url.search=e}get password(){return this[d].url.password}set password(e){this[d].url.password=e}get username(){return this[d].url.username}set username(e){this[d].url.username=e}get basePath(){return this[d].basePath}set basePath(e){this[d].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new l(String(this),this[d].options)}}},430009,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={ACTION_SUFFIX:function(){return y},APP_DIR_ALIAS:function(){return M},CACHE_ONE_YEAR:function(){return I},DOT_NEXT_ALIAS:function(){return j},ESLINT_DEFAULT_DIRS:function(){return eo},GSP_NO_RETURNED_VALUE:function(){return X},GSSP_COMPONENT_MEMBER_ERROR:function(){return er},GSSP_NO_RETURNED_VALUE:function(){return ee},HTML_CONTENT_TYPE_HEADER:function(){return a},INFINITE_CACHE:function(){return k},INSTRUMENTATION_HOOK_FILENAME:function(){return D},JSON_CONTENT_TYPE_HEADER:function(){return s},MATCHED_PATH_HEADER:function(){return l},MIDDLEWARE_FILENAME:function(){return N},MIDDLEWARE_LOCATION_REGEXP:function(){return P},NEXT_BODY_SUFFIX:function(){return x},NEXT_CACHE_IMPLICIT_TAG_ID:function(){return O},NEXT_CACHE_REVALIDATED_TAGS_HEADER:function(){return _},NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER:function(){return E},NEXT_CACHE_SOFT_TAG_MAX_LENGTH:function(){return R},NEXT_CACHE_TAGS_HEADER:function(){return v},NEXT_CACHE_TAG_MAX_ITEMS:function(){return A},NEXT_CACHE_TAG_MAX_LENGTH:function(){return S},NEXT_DATA_SUFFIX:function(){return b},NEXT_INTERCEPTION_MARKER_PREFIX:function(){return d},NEXT_META_SUFFIX:function(){return w},NEXT_QUERY_PARAM_PREFIX:function(){return c},NEXT_RESUME_HEADER:function(){return T},NON_STANDARD_NODE_ENV:function(){return en},PAGES_DIR_ALIAS:function(){return L},PRERENDER_REVALIDATE_HEADER:function(){return u},PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER:function(){return p},PROXY_FILENAME:function(){return U},PROXY_LOCATION_REGEXP:function(){return C},PUBLIC_DIR_MIDDLEWARE_CONFLICT:function(){return K},ROOT_DIR_ALIAS:function(){return $},RSC_ACTION_CLIENT_WRAPPER_ALIAS:function(){return F},RSC_ACTION_ENCRYPTION_ALIAS:function(){return H},RSC_ACTION_PROXY_ALIAS:function(){return B},RSC_ACTION_VALIDATE_ALIAS:function(){return V},RSC_CACHE_WRAPPER_ALIAS:function(){return z},RSC_DYNAMIC_IMPORT_WRAPPER_ALIAS:function(){return W},RSC_MOD_REF_PROXY_ALIAS:function(){return q},RSC_PREFETCH_SUFFIX:function(){return f},RSC_SEGMENTS_DIR_SUFFIX:function(){return h},RSC_SEGMENT_SUFFIX:function(){return m},RSC_SUFFIX:function(){return g},SERVER_PROPS_EXPORT_ERROR:function(){return J},SERVER_PROPS_GET_INIT_PROPS_CONFLICT:function(){return Z},SERVER_PROPS_SSG_CONFLICT:function(){return G},SERVER_RUNTIME:function(){return ea},SSG_FALLBACK_EXPORT_ERROR:function(){return ei},SSG_GET_INITIAL_PROPS_CONFLICT:function(){return Q},STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR:function(){return Y},TEXT_PLAIN_CONTENT_TYPE_HEADER:function(){return o},UNSTABLE_REVALIDATE_RENAME_ERROR:function(){return et},WEBPACK_LAYERS:function(){return ed},WEBPACK_RESOURCE_QUERIES:function(){return el},WEB_SOCKET_MAX_RECONNECTIONS:function(){return es}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o="text/plain",a="text/html; charset=utf-8",s="application/json; charset=utf-8",c="nxtP",d="nxtI",l="x-matched-path",u="x-prerender-revalidate",p="x-prerender-revalidate-if-generated",f=".prefetch.rsc",h=".segments",m=".segment.rsc",g=".rsc",y=".action",b=".json",w=".meta",x=".body",v="x-next-cache-tags",_="x-next-revalidated-tags",E="x-next-revalidate-tag-token",T="next-resume",A=128,S=256,R=1024,O="_N_T_",I=31536e3,k=0xfffffffe,N="middleware",P=`(?:src/)?${N}`,U="proxy",C=`(?:src/)?${U}`,D="instrumentation",L="private-next-pages",j="private-dot-next",$="private-next-root-dir",M="private-next-app-dir",q="private-next-rsc-mod-ref-proxy",V="private-next-rsc-action-validate",B="private-next-rsc-server-reference",z="private-next-rsc-cache-wrapper",W="private-next-rsc-track-dynamic-import",H="private-next-rsc-action-encryption",F="private-next-rsc-action-client-wrapper",K="You can not have a '_next' folder inside of your public folder. This conflicts with the internal '/_next' route. https://nextjs.org/docs/messages/public-next-folder-conflict",Q="You can not use getInitialProps with getStaticProps. To use SSG, please remove your getInitialProps",Z="You can not use getInitialProps with getServerSideProps. Please remove getInitialProps.",G="You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps",Y="can not have getInitialProps/getServerSideProps, https://nextjs.org/docs/messages/404-get-initial-props",J="pages with `getServerSideProps` can not be exported. See more info here: https://nextjs.org/docs/messages/gssp-export",X="Your `getStaticProps` function did not return an object. Did you forget to add a `return`?",ee="Your `getServerSideProps` function did not return an object. Did you forget to add a `return`?",et="The `unstable_revalidate` property is available for general use.\nPlease use `revalidate` instead.",er="can not be attached to a page's component and must be exported from the page. See more info here: https://nextjs.org/docs/messages/gssp-component-member",en='You are using a non-standard "NODE_ENV" value in your environment. This creates inconsistencies in the project and is strongly advised against. Read more: https://nextjs.org/docs/messages/non-standard-node-env',ei="Pages with `fallback` enabled in `getStaticPaths` can not be exported. See more info here: https://nextjs.org/docs/messages/ssg-fallback-true-export",eo=["app","pages","components","lib","src"],ea={edge:"edge",experimentalEdge:"experimental-edge",nodejs:"nodejs"},es=12,ec={shared:"shared",reactServerComponents:"rsc",serverSideRendering:"ssr",actionBrowser:"action-browser",apiNode:"api-node",apiEdge:"api-edge",middleware:"middleware",instrument:"instrument",edgeAsset:"edge-asset",appPagesBrowser:"app-pages-browser",pagesDirBrowser:"pages-dir-browser",pagesDirEdge:"pages-dir-edge",pagesDirNode:"pages-dir-node"},ed={...ec,GROUP:{builtinReact:[ec.reactServerComponents,ec.actionBrowser],serverOnly:[ec.reactServerComponents,ec.actionBrowser,ec.instrument,ec.middleware],neutralTarget:[ec.apiNode,ec.apiEdge],clientOnly:[ec.serverSideRendering,ec.appPagesBrowser],bundled:[ec.reactServerComponents,ec.actionBrowser,ec.serverSideRendering,ec.appPagesBrowser,ec.shared,ec.instrument,ec.middleware],appPages:[ec.reactServerComponents,ec.serverSideRendering,ec.appPagesBrowser,ec.actionBrowser]}},el={edgeSSREntry:"__next_edge_ssr_entry__",metadata:"__next_metadata__",metadataRoute:"__next_metadata_route__",metadataImageMeta:"__next_metadata_image_meta__"}},341296,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={fromNodeOutgoingHttpHeaders:function(){return a},normalizeNextQueryParam:function(){return l},splitCookiesString:function(){return s},toNodeOutgoingHttpHeaders:function(){return c},validateURL:function(){return d}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(430009);function a(e){let t=new Headers;for(let[r,n]of Object.entries(e))for(let e of Array.isArray(n)?n:[n])void 0!==e&&("number"==typeof e&&(e=e.toString()),t.append(r,e));return t}function s(e){var t,r,n,i,o,a=[],s=0;function c(){for(;s<e.length&&/\s/.test(e.charAt(s));)s+=1;return s<e.length}for(;s<e.length;){for(t=s,o=!1;c();)if(","===(r=e.charAt(s))){for(n=s,s+=1,c(),i=s;s<e.length&&"="!==(r=e.charAt(s))&&";"!==r&&","!==r;)s+=1;s<e.length&&"="===e.charAt(s)?(o=!0,s=i,a.push(e.substring(t,n)),t=s):s=n+1}else s+=1;(!o||s>=e.length)&&a.push(e.substring(t,e.length))}return a}function c(e){let t={},r=[];if(e)for(let[n,i]of e.entries())"set-cookie"===n.toLowerCase()?(r.push(...s(i)),t[n]=1===r.length?r[0]:r):t[n]=i;return t}function d(e){try{return String(new URL(String(e)))}catch(t){throw Object.defineProperty(Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t}),"__NEXT_ERROR_CODE",{value:"E61",enumerable:!1,configurable:!0})}}function l(e){for(let t of[o.NEXT_QUERY_PARAM_PREFIX,o.NEXT_INTERCEPTION_MARKER_PREFIX])if(e!==t&&e.startsWith(t))return e.substring(t.length);return null}},243241,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={PageSignatureError:function(){return o},RemovedPageError:function(){return a},RemovedUAError:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});class o extends Error{constructor({page:e}){super(`The middleware "${e}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class a extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class s extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}},677312,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={RequestCookies:function(){return o.RequestCookies},ResponseCookies:function(){return o.ResponseCookies},stringifyCookie:function(){return o.stringifyCookie}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(709254)},775447,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={INTERNALS:function(){return d},NextRequest:function(){return l}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(761400),a=e.r(341296),s=e.r(243241),c=e.r(677312),d=Symbol("internal request");class l extends Request{constructor(e,t={}){const r="string"!=typeof e&&"url"in e?e.url:String(e);(0,a.validateURL)(r),t.body&&"half"!==t.duplex&&(t.duplex="half"),e instanceof Request?super(e,t):super(r,t);const n=new o.NextURL(r,{headers:(0,a.toNodeOutgoingHttpHeaders)(this.headers),nextConfig:t.nextConfig});this[d]={cookies:new c.RequestCookies(this.headers),nextUrl:n,url:n.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[d].cookies}get nextUrl(){return this[d].nextUrl}get page(){throw new s.RemovedPageError}get ua(){throw new s.RemovedUAError}get url(){return this[d].url}}},508126,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ReflectAdapter",{enumerable:!0,get:function(){return n}});class n{static get(e,t,r){let n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}static set(e,t,r,n){return Reflect.set(e,t,r,n)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},909052,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"NextResponse",{enumerable:!0,get:function(){return u}});let n=e.r(677312),i=e.r(761400),o=e.r(341296),a=e.r(508126),s=e.r(677312),c=Symbol("internal response"),d=new Set([301,302,303,307,308]);function l(e,t){var r;if(null==e||null==(r=e.request)?void 0:r.headers){if(!(e.request.headers instanceof Headers))throw Object.defineProperty(Error("request.headers must be an instance of Headers"),"__NEXT_ERROR_CODE",{value:"E119",enumerable:!1,configurable:!0});let r=[];for(let[n,i]of e.request.headers)t.set("x-middleware-request-"+n,i),r.push(n);t.set("x-middleware-override-headers",r.join(","))}}class u extends Response{constructor(e,t={}){super(e,t);const r=this.headers,d=new Proxy(new s.ResponseCookies(r),{get(e,i,o){switch(i){case"delete":case"set":return(...o)=>{let a=Reflect.apply(e[i],e,o),c=new Headers(r);return a instanceof s.ResponseCookies&&r.set("x-middleware-set-cookie",a.getAll().map(e=>(0,n.stringifyCookie)(e)).join(",")),l(t,c),a};default:return a.ReflectAdapter.get(e,i,o)}}});this[c]={cookies:d,url:t.url?new i.NextURL(t.url,{headers:(0,o.toNodeOutgoingHttpHeaders)(r),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[c].cookies}static json(e,t){let r=Response.json(e,t);return new u(r.body,r)}static redirect(e,t){let r="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!d.has(r))throw Object.defineProperty(RangeError('Failed to execute "redirect" on "response": Invalid status code'),"__NEXT_ERROR_CODE",{value:"E529",enumerable:!1,configurable:!0});let n="object"==typeof t?t:{},i=new Headers(null==n?void 0:n.headers);return i.set("Location",(0,o.validateURL)(e)),new u(null,{...n,headers:i,status:r})}static rewrite(e,t){let r=new Headers(null==t?void 0:t.headers);return r.set("x-middleware-rewrite",(0,o.validateURL)(e)),l(t,r),new u(null,{...t,headers:r})}static next(e){let t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),l(e,t),new u(null,{...e,headers:t})}}},302075,(e,t,r)=>{"use strict";function n(){throw Object.defineProperty(Error('ImageResponse moved from "next/server" to "next/og" since Next.js 14, please import from "next/og" instead'),"__NEXT_ERROR_CODE",{value:"E183",enumerable:!1,configurable:!0})}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ImageResponse",{enumerable:!0,get:function(){return n}})},506992,(e,t,r)=>{var n={226:function(t,r){!function(n,i){"use strict";var o="function",a="undefined",s="object",c="string",d="major",l="model",u="name",p="type",f="vendor",h="version",m="architecture",g="console",y="mobile",b="tablet",w="smarttv",x="wearable",v="embedded",_="Amazon",E="Apple",T="ASUS",A="BlackBerry",S="Browser",R="Chrome",O="Firefox",I="Google",k="Huawei",N="Microsoft",P="Motorola",U="Opera",C="Samsung",D="Sharp",L="Sony",j="Xiaomi",$="Zebra",M="Facebook",q="Chromium OS",V="Mac OS",B=function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r},z=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},W=function(e,t){return typeof e===c&&-1!==H(t).indexOf(H(e))},H=function(e){return e.toLowerCase()},F=function(e,t){if(typeof e===c)return e=e.replace(/^\s\s*/,""),typeof t===a?e:e.substring(0,350)},K=function(e,t){for(var r,n,i,a,c,d,l=0;l<t.length&&!c;){var u=t[l],p=t[l+1];for(r=n=0;r<u.length&&!c&&u[r];)if(c=u[r++].exec(e))for(i=0;i<p.length;i++)d=c[++n],typeof(a=p[i])===s&&a.length>0?2===a.length?typeof a[1]==o?this[a[0]]=a[1].call(this,d):this[a[0]]=a[1]:3===a.length?typeof a[1]!==o||a[1].exec&&a[1].test?this[a[0]]=d?d.replace(a[1],a[2]):void 0:this[a[0]]=d?a[1].call(this,d,a[2]):void 0:4===a.length&&(this[a[0]]=d?a[3].call(this,d.replace(a[1],a[2])):void 0):this[a]=d||void 0;l+=2}},Q=function(e,t){for(var r in t)if(typeof t[r]===s&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(W(t[r][n],e))return"?"===r?void 0:r}else if(W(t[r],e))return"?"===r?void 0:r;return e},Z={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},G={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,h],[/opios[\/ ]+([\w\.]+)/i],[h,[u,U+" Mini"]],[/\bopr\/([\w\.]+)/i],[h,[u,U]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,h],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[u,"UC"+S]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[h,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[h,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[h,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+S],h],[/\bfocus\/([\w\.]+)/i],[h,[u,O+" Focus"]],[/\bopt\/([\w\.]+)/i],[h,[u,U+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[u,U+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[u,"MIUI "+S]],[/fxios\/([-\w\.]+)/i],[h,[u,O]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 "+S]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 "+S],h],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,h],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,M],h],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[h,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[u,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,R+" WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[u,"Android "+S]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[h,Q,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[u,O+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[u,h],[/(cobalt)\/([\w\.]+)/i],[u,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,H]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[m,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[m,"armhf"]],[/windows (ce|mobile); ppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[m,/ower/,"",H]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[m,H]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[f,C],[p,b]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[f,C],[p,y]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[l,[f,E],[p,y]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[f,E],[p,b]],[/(macintosh);/i],[l,[f,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[f,D],[p,y]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[f,k],[p,b]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[f,k],[p,y]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[f,j],[p,y]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[f,j],[p,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[f,"OPPO"],[p,y]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[f,"Vivo"],[p,y]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[f,"Realme"],[p,y]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[f,P],[p,y]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[f,P],[p,b]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[f,"LG"],[p,b]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[f,"LG"],[p,y]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[f,"Lenovo"],[p,b]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[f,"Nokia"],[p,y]],[/(pixel c)\b/i],[l,[f,I],[p,b]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[f,I],[p,y]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[f,L],[p,y]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[f,L],[p,b]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[f,"OnePlus"],[p,y]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[f,_],[p,b]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[f,_],[p,y]],[/(playbook);[-\w\),; ]+(rim)/i],[l,f,[p,b]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[f,A],[p,y]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[f,T],[p,b]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[f,T],[p,y]],[/(nexus 9)/i],[l,[f,"HTC"],[p,b]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[f,[l,/_/g," "],[p,y]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[f,"Acer"],[p,b]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[f,"Meizu"],[p,y]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[f,l,[p,y]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[f,l,[p,b]],[/(surface duo)/i],[l,[f,N],[p,b]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[f,"Fairphone"],[p,y]],[/(u304aa)/i],[l,[f,"AT&T"],[p,y]],[/\bsie-(\w*)/i],[l,[f,"Siemens"],[p,y]],[/\b(rct\w+) b/i],[l,[f,"RCA"],[p,b]],[/\b(venue[\d ]{2,7}) b/i],[l,[f,"Dell"],[p,b]],[/\b(q(?:mv|ta)\w+) b/i],[l,[f,"Verizon"],[p,b]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[f,"Barnes & Noble"],[p,b]],[/\b(tm\d{3}\w+) b/i],[l,[f,"NuVision"],[p,b]],[/\b(k88) b/i],[l,[f,"ZTE"],[p,b]],[/\b(nx\d{3}j) b/i],[l,[f,"ZTE"],[p,y]],[/\b(gen\d{3}) b.+49h/i],[l,[f,"Swiss"],[p,y]],[/\b(zur\d{3}) b/i],[l,[f,"Swiss"],[p,b]],[/\b((zeki)?tb.*\b) b/i],[l,[f,"Zeki"],[p,b]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[f,"Dragon Touch"],l,[p,b]],[/\b(ns-?\w{0,9}) b/i],[l,[f,"Insignia"],[p,b]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[f,"NextBook"],[p,b]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[f,"Voice"],l,[p,y]],[/\b(lvtel\-)?(v1[12]) b/i],[[f,"LvTel"],l,[p,y]],[/\b(ph-1) /i],[l,[f,"Essential"],[p,y]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[f,"Envizen"],[p,b]],[/\b(trio[-\w\. ]+) b/i],[l,[f,"MachSpeed"],[p,b]],[/\btu_(1491) b/i],[l,[f,"Rotor"],[p,b]],[/(shield[\w ]+) b/i],[l,[f,"Nvidia"],[p,b]],[/(sprint) (\w+)/i],[f,l,[p,y]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[f,N],[p,y]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[f,$],[p,b]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[f,$],[p,y]],[/smart-tv.+(samsung)/i],[f,[p,w]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[f,C],[p,w]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[f,"LG"],[p,w]],[/(apple) ?tv/i],[f,[l,E+" TV"],[p,w]],[/crkey/i],[[l,R+"cast"],[f,I],[p,w]],[/droid.+aft(\w)( bui|\))/i],[l,[f,_],[p,w]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[f,D],[p,w]],[/(bravia[\w ]+)( bui|\))/i],[l,[f,L],[p,w]],[/(mitv-\w{5}) bui/i],[l,[f,j],[p,w]],[/Hbbtv.*(technisat) (.*);/i],[f,l,[p,w]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[f,F],[l,F],[p,w]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[p,w]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[f,l,[p,g]],[/droid.+; (shield) bui/i],[l,[f,"Nvidia"],[p,g]],[/(playstation [345portablevi]+)/i],[l,[f,L],[p,g]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[f,N],[p,g]],[/((pebble))app/i],[f,l,[p,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[f,E],[p,x]],[/droid.+; (glass) \d/i],[l,[f,I],[p,x]],[/droid.+; (wt63?0{2,3})\)/i],[l,[f,$],[p,x]],[/(quest( 2| pro)?)/i],[l,[f,M],[p,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[f,[p,v]],[/(aeobc)\b/i],[l,[f,_],[p,v]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[p,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[p,b]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[p,b]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[p,y]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[f,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,h],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[h,Q,Z]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[h,Q,Z]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,V],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,h],[/\(bb(10);/i],[h,[u,A]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[u,O+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[u,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,q],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,h],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,h]]},Y=function(e,t){if(typeof e===s&&(t=e,e=void 0),!(this instanceof Y))return new Y(e,t).getResult();var r=typeof n!==a&&n.navigator?n.navigator:void 0,i=e||(r&&r.userAgent?r.userAgent:""),g=r&&r.userAgentData?r.userAgentData:void 0,w=t?B(G,t):G,x=r&&r.userAgent==i;return this.getBrowser=function(){var e,t={};return t[u]=void 0,t[h]=void 0,K.call(t,i,w.browser),t[d]=typeof(e=t[h])===c?e.replace(/[^\d\.]/g,"").split(".")[0]:void 0,x&&r&&r.brave&&typeof r.brave.isBrave==o&&(t[u]="Brave"),t},this.getCPU=function(){var e={};return e[m]=void 0,K.call(e,i,w.cpu),e},this.getDevice=function(){var e={};return e[f]=void 0,e[l]=void 0,e[p]=void 0,K.call(e,i,w.device),x&&!e[p]&&g&&g.mobile&&(e[p]=y),x&&"Macintosh"==e[l]&&r&&typeof r.standalone!==a&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e[l]="iPad",e[p]=b),e},this.getEngine=function(){var e={};return e[u]=void 0,e[h]=void 0,K.call(e,i,w.engine),e},this.getOS=function(){var e={};return e[u]=void 0,e[h]=void 0,K.call(e,i,w.os),x&&!e[u]&&g&&"Unknown"!=g.platform&&(e[u]=g.platform.replace(/chrome os/i,q).replace(/macos/i,V)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=typeof e===c&&e.length>350?F(e,350):e,this},this.setUA(i),this};if(Y.VERSION="1.0.35",Y.BROWSER=z([u,h,d]),Y.CPU=z([m]),Y.DEVICE=z([l,f,p,g,y,w,b,x,v]),Y.ENGINE=Y.OS=z([u,h]),typeof r!==a)t.exports&&(r=t.exports=Y),r.UAParser=Y;else if(typeof define===o&&define.amd)e.r,void 0!==Y&&e.v(Y);else typeof n!==a&&(n.UAParser=Y);var J=typeof n!==a&&(n.jQuery||n.Zepto);if(J&&!J.ua){var X=new Y;J.ua=X.getResult(),J.ua.get=function(){return X.getUA()},J.ua.set=function(e){X.setUA(e);var t=X.getResult();for(var r in t)J.ua[r]=t[r]}}}(this)}},i={};function o(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}},a=!0;try{n[e].call(r.exports,r,r.exports,o),a=!1}finally{a&&delete i[e]}return r.exports}o.ab="/ROOT/node_modules/next/dist/compiled/ua-parser-js/",t.exports=o(226)},660567,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i={isBot:function(){return s},userAgent:function(){return d},userAgentFromString:function(){return c}};for(var o in i)Object.defineProperty(r,o,{enumerable:!0,get:i[o]});let a=(n=e.r(506992))&&n.__esModule?n:{default:n};function s(e){return/Googlebot|Mediapartners-Google|AdsBot-Google|googleweblight|Storebot-Google|Google-PageRenderer|Google-InspectionTool|Bingbot|BingPreview|Slurp|DuckDuckBot|baiduspider|yandex|sogou|LinkedInBot|bitlybot|tumblr|vkShare|quora link preview|facebookexternalhit|facebookcatalog|Twitterbot|applebot|redditbot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|ia_archiver/i.test(e)}function c(e){return{...(0,a.default)(e),isBot:void 0!==e&&s(e)}}function d({headers:e}){return c(e.get("user-agent")||void 0)}},698214,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"URLPattern",{enumerable:!0,get:function(){return n}});let n="undefined"==typeof URLPattern?void 0:URLPattern},698521,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"after",{enumerable:!0,get:function(){return i}});let n=e.r(556704);function i(e){let t=n.workAsyncStorage.getStore();if(!t)throw Object.defineProperty(Error("`after` was called outside a request scope. Read more: https://nextjs.org/docs/messages/next-dynamic-api-wrong-context"),"__NEXT_ERROR_CODE",{value:"E468",enumerable:!1,configurable:!0});let{afterContext:r}=t;return r.after(e)}},603368,(e,t,r)=>{"use strict";var n,i;Object.defineProperty(r,"__esModule",{value:!0}),n=e.r(698521),i=r,Object.keys(n).forEach(function(e){"default"===e||Object.prototype.hasOwnProperty.call(i,e)||Object.defineProperty(i,e,{enumerable:!0,get:function(){return n[e]}})})},549518,(e,t,r)=>{"use strict";t.exports=e.r(339622).vendored["react-rsc"].React},777753,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={DynamicServerError:function(){return a},isDynamicServerError:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o="DYNAMIC_SERVER_USAGE";class a extends Error{constructor(e){super(`Dynamic server usage: ${e}`),this.description=e,this.digest=o}}function s(e){return"object"==typeof e&&null!==e&&"digest"in e&&"string"==typeof e.digest&&e.digest===o}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},680773,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={StaticGenBailoutError:function(){return a},isStaticGenBailoutError:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o="NEXT_STATIC_GEN_BAILOUT";class a extends Error{constructor(...e){super(...e),this.code=o}}function s(e){return"object"==typeof e&&null!==e&&"code"in e&&e.code===o}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},537138,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={isHangingPromiseRejectionError:function(){return o},makeDevtoolsIOAwarePromise:function(){return u},makeHangingPromise:function(){return d}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});function o(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===a}let a="HANGING_PROMISE_REJECTION";class s extends Error{constructor(e,t){super(`During prerendering, ${t} rejects when the prerender is complete. Typically these errors are handled by React but if you move ${t} to a different context by using \`setTimeout\`, \`after\`, or similar functions you may observe this error and you should handle it in that context. This occurred at route "${e}".`),this.route=e,this.expression=t,this.digest=a}}let c=new WeakMap;function d(e,t,r){if(e.aborted)return Promise.reject(new s(t,r));{let n=new Promise((n,i)=>{let o=i.bind(null,new s(t,r)),a=c.get(e);if(a)a.push(o);else{let t=[o];c.set(e,t),e.addEventListener("abort",()=>{for(let e=0;e<t.length;e++)t[e]()},{once:!0})}});return n.catch(l),n}}function l(){}function u(e,t,r){return t.stagedRendering?t.stagedRendering.delayUntilStage(r,void 0,e):new Promise(t=>{setTimeout(()=>{t(e)},0)})}},313332,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={METADATA_BOUNDARY_NAME:function(){return o},OUTLET_BOUNDARY_NAME:function(){return s},ROOT_LAYOUT_BOUNDARY_NAME:function(){return c},VIEWPORT_BOUNDARY_NAME:function(){return a}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o="__next_metadata_boundary__",a="__next_viewport_boundary__",s="__next_outlet_boundary__",c="__next_root_layout_boundary__"},818697,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={atLeastOneTask:function(){return s},scheduleImmediate:function(){return a},scheduleOnNextTick:function(){return o},waitAtLeastOneReactRenderTask:function(){return c}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e=>{Promise.resolve().then(()=>{process.nextTick(e)})},a=e=>{setImmediate(e)};function s(){return new Promise(e=>a(e))}function c(){return new Promise(e=>setImmediate(e))}},939491,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={BailoutToCSRError:function(){return a},isBailoutToCSRError:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o="BAILOUT_TO_CLIENT_SIDE_RENDERING";class a extends Error{constructor(e){super(`Bail out to client-side rendering: ${e}`),this.reason=e,this.digest=o}}function s(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===o}},635121,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"InvariantError",{enumerable:!0,get:function(){return n}});class n extends Error{constructor(e,t){super(`Invariant: ${e.endsWith(".")?e:e+"."} This is a bug in Next.js.`,t),this.name="InvariantError"}}},745470,(e,t,r)=>{"use strict";function n(){let e,t,r=new Promise((r,n)=>{e=r,t=n});return{resolve:e,reject:t,promise:r}}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"createPromiseWithResolvers",{enumerable:!0,get:function(){return n}})},998771,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i={RenderStage:function(){return c},StagedRenderingController:function(){return d}};for(var o in i)Object.defineProperty(r,o,{enumerable:!0,get:i[o]});let a=e.r(635121),s=e.r(745470);var c=((n={})[n.Static=1]="Static",n[n.Runtime=2]="Runtime",n[n.Dynamic=3]="Dynamic",n);class d{constructor(e=null){this.abortSignal=e,this.currentStage=1,this.runtimeStagePromise=(0,s.createPromiseWithResolvers)(),this.dynamicStagePromise=(0,s.createPromiseWithResolvers)(),e&&e.addEventListener("abort",()=>{let{reason:t}=e;this.currentStage<2&&(this.runtimeStagePromise.promise.catch(l),this.runtimeStagePromise.reject(t)),this.currentStage<3&&(this.dynamicStagePromise.promise.catch(l),this.dynamicStagePromise.reject(t))},{once:!0})}advanceStage(e){!(this.currentStage>=e)&&(this.currentStage=e,e>=2&&this.runtimeStagePromise.resolve(),e>=3&&this.dynamicStagePromise.resolve())}getStagePromise(e){switch(e){case 2:return this.runtimeStagePromise.promise;case 3:return this.dynamicStagePromise.promise;default:throw Object.defineProperty(new a.InvariantError(`Invalid render stage: ${e}`),"__NEXT_ERROR_CODE",{value:"E881",enumerable:!1,configurable:!0})}}waitForStage(e){return this.getStagePromise(e)}delayUntilStage(e,t,r){var n,i,o;let a,s=(n=this.getStagePromise(e),i=t,o=r,a=new Promise((e,t)=>{n.then(e.bind(null,o),t)}),void 0!==i&&(a.displayName=i),a);return this.abortSignal&&s.catch(l),s}}function l(){}},521401,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n,i,o={Postpone:function(){return I},PreludeState:function(){return Y},abortAndThrowOnSynchronousRequestDataAccess:function(){return O},abortOnSynchronousPlatformIOAccess:function(){return S},accessedDynamicData:function(){return j},annotateDynamicAccess:function(){return B},consumeDynamicAccess:function(){return $},createDynamicTrackingState:function(){return w},createDynamicValidationState:function(){return x},createHangingInputAbortSignal:function(){return V},createRenderInBrowserAbortSignal:function(){return q},delayUntilRuntimeStage:function(){return ee},formatDynamicAPIAccesses:function(){return M},getFirstDynamicReason:function(){return v},isDynamicPostpone:function(){return P},isPrerenderInterruptedError:function(){return L},logDisallowedDynamicError:function(){return J},markCurrentScopeAsDynamic:function(){return _},postponeWithTracking:function(){return k},throwIfDisallowedDynamic:function(){return X},throwToInterruptStaticGeneration:function(){return E},trackAllowedDynamicAccess:function(){return G},trackDynamicDataInDynamicRender:function(){return T},trackSynchronousPlatformIOAccessInDev:function(){return R},useDynamicRouteParams:function(){return z},useDynamicSearchParams:function(){return W}};for(var a in o)Object.defineProperty(r,a,{enumerable:!0,get:o[a]});let s=(n=e.r(549518))&&n.__esModule?n:{default:n},c=e.r(777753),d=e.r(680773),l=e.r(832319),u=e.r(556704),p=e.r(537138),f=e.r(313332),h=e.r(818697),m=e.r(939491),g=e.r(635121),y=e.r(998771),b="function"==typeof s.default.unstable_postpone;function w(e){return{isDebugDynamicAccesses:e,dynamicAccesses:[],syncDynamicErrorWithStack:null}}function x(){return{hasSuspenseAboveBody:!1,hasDynamicMetadata:!1,hasDynamicViewport:!1,hasAllowedDynamic:!1,dynamicErrors:[]}}function v(e){var t;return null==(t=e.dynamicAccesses[0])?void 0:t.expression}function _(e,t,r){if(t)switch(t.type){case"cache":case"unstable-cache":case"private-cache":return}if(!e.forceDynamic&&!e.forceStatic){if(e.dynamicShouldError)throw Object.defineProperty(new d.StaticGenBailoutError(`Route ${e.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${r}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E553",enumerable:!1,configurable:!0});if(t)switch(t.type){case"prerender-ppr":return k(e.route,r,t.dynamicTracking);case"prerender-legacy":t.revalidate=0;let n=Object.defineProperty(new c.DynamicServerError(`Route ${e.route} couldn't be rendered statically because it used ${r}. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E550",enumerable:!1,configurable:!0});throw e.dynamicUsageDescription=r,e.dynamicUsageStack=n.stack,n}}}function E(e,t,r){let n=Object.defineProperty(new c.DynamicServerError(`Route ${t.route} couldn't be rendered statically because it used \`${e}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw r.revalidate=0,t.dynamicUsageDescription=e,t.dynamicUsageStack=n.stack,n}function T(e){switch(e.type){case"cache":case"unstable-cache":case"private-cache":return}}function A(e,t,r){let n=D(`Route ${e} needs to bail out of prerendering at this point because it used ${t}.`);r.controller.abort(n);let i=r.dynamicTracking;i&&i.dynamicAccesses.push({stack:i.isDebugDynamicAccesses?Error().stack:void 0,expression:t})}function S(e,t,r,n){let i=n.dynamicTracking;A(e,t,n),i&&null===i.syncDynamicErrorWithStack&&(i.syncDynamicErrorWithStack=r)}function R(e){e.stagedRendering&&e.stagedRendering.advanceStage(y.RenderStage.Dynamic)}function O(e,t,r,n){if(!1===n.controller.signal.aborted){A(e,t,n);let i=n.dynamicTracking;i&&null===i.syncDynamicErrorWithStack&&(i.syncDynamicErrorWithStack=r)}throw D(`Route ${e} needs to bail out of prerendering at this point because it used ${t}.`)}function I({reason:e,route:t}){let r=l.workUnitAsyncStorage.getStore();k(t,e,r&&"prerender-ppr"===r.type?r.dynamicTracking:null)}function k(e,t,r){(function(){if(!b)throw Object.defineProperty(Error("Invariant: React.unstable_postpone is not defined. This suggests the wrong version of React was loaded. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E224",enumerable:!1,configurable:!0})})(),r&&r.dynamicAccesses.push({stack:r.isDebugDynamicAccesses?Error().stack:void 0,expression:t}),s.default.unstable_postpone(N(e,t))}function N(e,t){return`Route ${e} needs to bail out of prerendering at this point because it used ${t}. React throws this special object to indicate where. It should not be caught by your own try/catch. Learn more: https://nextjs.org/docs/messages/ppr-caught-error`}function P(e){return"object"==typeof e&&null!==e&&"string"==typeof e.message&&U(e.message)}function U(e){return e.includes("needs to bail out of prerendering at this point because it used")&&e.includes("Learn more: https://nextjs.org/docs/messages/ppr-caught-error")}if(!1===U(N("%%%","^^^")))throw Object.defineProperty(Error("Invariant: isDynamicPostpone misidentified a postpone reason. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E296",enumerable:!1,configurable:!0});let C="NEXT_PRERENDER_INTERRUPTED";function D(e){let t=Object.defineProperty(Error(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t.digest=C,t}function L(e){return"object"==typeof e&&null!==e&&e.digest===C&&"name"in e&&"message"in e&&e instanceof Error}function j(e){return e.length>0}function $(e,t){return e.dynamicAccesses.push(...t.dynamicAccesses),e.dynamicAccesses}function M(e){return e.filter(e=>"string"==typeof e.stack&&e.stack.length>0).map(({expression:e,stack:t})=>(t=t.split("\n").slice(4).filter(e=>!(e.includes("node_modules/next/")||e.includes(" (<anonymous>)")||e.includes(" (node:"))).join("\n"),`Dynamic API Usage Debug - ${e}:
${t}`))}function q(){let e=new AbortController;return e.abort(Object.defineProperty(new m.BailoutToCSRError("Render in Browser"),"__NEXT_ERROR_CODE",{value:"E721",enumerable:!1,configurable:!0})),e.signal}function V(e){switch(e.type){case"prerender":case"prerender-runtime":let t=new AbortController;if(e.cacheSignal)e.cacheSignal.inputReady().then(()=>{t.abort()});else{let r=(0,l.getRuntimeStagePromise)(e);r?r.then(()=>(0,h.scheduleOnNextTick)(()=>t.abort())):(0,h.scheduleOnNextTick)(()=>t.abort())}return t.signal;case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"request":case"cache":case"private-cache":case"unstable-cache":return}}function B(e,t){let r=t.dynamicTracking;r&&r.dynamicAccesses.push({stack:r.isDebugDynamicAccesses?Error().stack:void 0,expression:e})}function z(e){let t=u.workAsyncStorage.getStore(),r=l.workUnitAsyncStorage.getStore();if(t&&r)switch(r.type){case"prerender-client":case"prerender":{let n=r.fallbackRouteParams;n&&n.size>0&&s.default.use((0,p.makeHangingPromise)(r.renderSignal,t.route,e));break}case"prerender-ppr":{let n=r.fallbackRouteParams;if(n&&n.size>0)return k(t.route,e,r.dynamicTracking);break}case"prerender-runtime":throw Object.defineProperty(new g.InvariantError(`\`${e}\` was called during a runtime prerender. Next.js should be preventing ${e} from being included in server components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E771",enumerable:!1,configurable:!0});case"cache":case"private-cache":throw Object.defineProperty(new g.InvariantError(`\`${e}\` was called inside a cache scope. Next.js should be preventing ${e} from being included in server components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E745",enumerable:!1,configurable:!0})}}function W(e){let t=u.workAsyncStorage.getStore(),r=l.workUnitAsyncStorage.getStore();if(t)switch(!r&&(0,l.throwForMissingRequestStore)(e),r.type){case"prerender-client":s.default.use((0,p.makeHangingPromise)(r.renderSignal,t.route,e));break;case"prerender-legacy":case"prerender-ppr":if(t.forceStatic)return;throw Object.defineProperty(new m.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":throw Object.defineProperty(new g.InvariantError(`\`${e}\` was called from a Server Component. Next.js should be preventing ${e} from being included in server components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E795",enumerable:!1,configurable:!0});case"cache":case"unstable-cache":case"private-cache":throw Object.defineProperty(new g.InvariantError(`\`${e}\` was called inside a cache scope. Next.js should be preventing ${e} from being included in server components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E745",enumerable:!1,configurable:!0});case"request":return}}let H=/\n\s+at Suspense \(<anonymous>\)/,F=RegExp(`\\n\\s+at Suspense \\(<anonymous>\\)(?:(?!\\n\\s+at (?:body|div|main|section|article|aside|header|footer|nav|form|p|span|h1|h2|h3|h4|h5|h6) \\(<anonymous>\\))[\\s\\S])*?\\n\\s+at ${f.ROOT_LAYOUT_BOUNDARY_NAME} \\([^\\n]*\\)`),K=RegExp(`\\n\\s+at ${f.METADATA_BOUNDARY_NAME}[\\n\\s]`),Q=RegExp(`\\n\\s+at ${f.VIEWPORT_BOUNDARY_NAME}[\\n\\s]`),Z=RegExp(`\\n\\s+at ${f.OUTLET_BOUNDARY_NAME}[\\n\\s]`);function G(e,t,r,n){if(!Z.test(t)){if(K.test(t)){r.hasDynamicMetadata=!0;return}if(Q.test(t)){r.hasDynamicViewport=!0;return}if(F.test(t)){r.hasAllowedDynamic=!0,r.hasSuspenseAboveBody=!0;return}else if(H.test(t)){r.hasAllowedDynamic=!0;return}else{var i,o;let a;if(n.syncDynamicErrorWithStack)return void r.dynamicErrors.push(n.syncDynamicErrorWithStack);let s=(i=`Route "${e.route}": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route`,o=t,(a=Object.defineProperty(Error(i),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})).stack=a.name+": "+i+o,a);return void r.dynamicErrors.push(s)}}}var Y=((i={})[i.Full=0]="Full",i[i.Empty=1]="Empty",i[i.Errored=2]="Errored",i);function J(e,t){console.error(t),e.dev||(e.hasReadableErrorStacks?console.error(`To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \`next dev\`, then open "${e.route}" in your browser to investigate the error.`):console.error(`To get a more detailed stack trace and pinpoint the issue, try one of the following:
  - Start the app in development mode by running \`next dev\`, then open "${e.route}" in your browser to investigate the error.
  - Rerun the production build with \`next build --debug-prerender\` to generate better stack traces.`))}function X(e,t,r,n){if(n.syncDynamicErrorWithStack)throw J(e,n.syncDynamicErrorWithStack),new d.StaticGenBailoutError;if(0!==t){if(r.hasSuspenseAboveBody)return;let n=r.dynamicErrors;if(n.length>0){for(let t=0;t<n.length;t++)J(e,n[t]);throw new d.StaticGenBailoutError}if(r.hasDynamicViewport)throw console.error(`Route "${e.route}" has a \`generateViewport\` that depends on Request data (\`cookies()\`, etc...) or uncached external data (\`fetch(...)\`, etc...) without explicitly allowing fully dynamic rendering. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport`),new d.StaticGenBailoutError;if(1===t)throw console.error(`Route "${e.route}" did not produce a static shell and Next.js was unable to determine a reason. This is a bug in Next.js.`),new d.StaticGenBailoutError}else if(!1===r.hasAllowedDynamic&&r.hasDynamicMetadata)throw console.error(`Route "${e.route}" has a \`generateMetadata\` that depends on Request data (\`cookies()\`, etc...) or uncached external data (\`fetch(...)\`, etc...) when the rest of the route does not. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-metadata`),new d.StaticGenBailoutError}function ee(e,t){return e.runtimeStagePromise?e.runtimeStagePromise.then(()=>t):t}},519048,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n={isRequestAPICallableInsideAfter:function(){return d},throwForSearchParamsAccessInUseCache:function(){return c},throwWithStaticGenerationBailoutErrorWithDynamicError:function(){return s}};for(var i in n)Object.defineProperty(r,i,{enumerable:!0,get:n[i]});let o=e.r(680773),a=e.r(324725);function s(e,t){throw Object.defineProperty(new o.StaticGenBailoutError(`Route ${e} with \`dynamic = "error"\` couldn't be rendered statically because it used ${t}. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E543",enumerable:!1,configurable:!0})}function c(e,t){let r=Object.defineProperty(Error(`Route ${e.route} used \`searchParams\` inside "use cache". Accessing dynamic request data inside a cache scope is not supported. If you need some search params inside a cached function await \`searchParams\` outside of the cached function and pass only the required search params as arguments to the cached function. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E842",enumerable:!1,configurable:!0});throw Error.captureStackTrace(r,t),e.invalidDynamicUsageError??=r,r}function d(){let e=a.afterTaskAsyncStorage.getStore();return(null==e?void 0:e.rootTaskSpawnPhase)==="action"}},44822,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"connection",{enumerable:!0,get:function(){return d}});let n=e.r(556704),i=e.r(832319),o=e.r(521401),a=e.r(680773),s=e.r(537138),c=e.r(519048);function d(){let e=n.workAsyncStorage.getStore(),t=i.workUnitAsyncStorage.getStore();if(e){if(t&&"after"===t.phase&&!(0,c.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${e.route} used \`connection()\` inside \`after()\`. The \`connection()\` function is used to indicate the subsequent code must only run when there is an actual Request, but \`after()\` executes after the request, so this function is not allowed in this scope. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E827",enumerable:!1,configurable:!0});if(e.forceStatic)return Promise.resolve(void 0);if(e.dynamicShouldError)throw Object.defineProperty(new a.StaticGenBailoutError(`Route ${e.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`connection()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E847",enumerable:!1,configurable:!0});if(t)switch(t.type){case"cache":{let t=Object.defineProperty(Error(`Route ${e.route} used \`connection()\` inside "use cache". The \`connection()\` function is used to indicate the subsequent code must only run when there is an actual request, but caches must be able to be produced before a request, so this function is not allowed in this scope. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E841",enumerable:!1,configurable:!0});throw Error.captureStackTrace(t,d),e.invalidDynamicUsageError??=t,t}case"private-cache":{let t=Object.defineProperty(Error(`Route ${e.route} used \`connection()\` inside "use cache: private". The \`connection()\` function is used to indicate the subsequent code must only run when there is an actual navigation request, but caches must be able to be produced before a navigation request, so this function is not allowed in this scope. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E837",enumerable:!1,configurable:!0});throw Error.captureStackTrace(t,d),e.invalidDynamicUsageError??=t,t}case"unstable-cache":throw Object.defineProperty(Error(`Route ${e.route} used \`connection()\` inside a function cached with \`unstable_cache()\`. The \`connection()\` function is used to indicate the subsequent code must only run when there is an actual Request, but caches must be able to be produced before a Request so this function is not allowed in this scope. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E840",enumerable:!1,configurable:!0});case"prerender":case"prerender-client":case"prerender-runtime":return(0,s.makeHangingPromise)(t.renderSignal,e.route,"`connection()`");case"prerender-ppr":return(0,o.postponeWithTracking)(e.route,"connection",t.dynamicTracking);case"prerender-legacy":return(0,o.throwToInterruptStaticGeneration)("connection",e,t);case"request":return(0,o.trackDynamicDataInDynamicRender)(t),Promise.resolve(void 0)}}(0,i.throwForMissingRequestStore)("connection")}e.r(998771)},955207,(e,t,r)=>{let n={NextRequest:e.r(775447).NextRequest,NextResponse:e.r(909052).NextResponse,ImageResponse:e.r(302075).ImageResponse,userAgentFromString:e.r(660567).userAgentFromString,userAgent:e.r(660567).userAgent,URLPattern:e.r(698214).URLPattern,after:e.r(603368).after,connection:e.r(44822).connection};t.exports=n,r.NextRequest=n.NextRequest,r.NextResponse=n.NextResponse,r.ImageResponse=n.ImageResponse,r.userAgentFromString=n.userAgentFromString,r.userAgent=n.userAgent,r.URLPattern=n.URLPattern,r.after=n.after,r.connection=n.connection},489997,e=>{"use strict";let t,r,n,i,o,a,s,c,d,l,u,p,f,h,m,g,y;async function b(){return"_ENTRIES"in globalThis&&_ENTRIES.middleware_instrumentation&&await _ENTRIES.middleware_instrumentation}let w=null;async function x(){if("phase-production-build"===process.env.NEXT_PHASE)return;w||(w=b());let e=await w;if(null==e?void 0:e.register)try{await e.register()}catch(e){throw e.message=`An error occurred while loading instrumentation hook: ${e.message}`,e}}async function v(...e){let t=await b();try{var r;await (null==t||null==(r=t.onRequestError)?void 0:r.call(t,...e))}catch(e){console.error("Error in instrumentation.onRequestError:",e)}}let _=null;class E extends Error{constructor({page:e}){super(`The middleware "${e}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class T extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class A extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}let S="_N_T_",R={shared:"shared",reactServerComponents:"rsc",serverSideRendering:"ssr",actionBrowser:"action-browser",apiNode:"api-node",apiEdge:"api-edge",middleware:"middleware",instrument:"instrument",edgeAsset:"edge-asset",appPagesBrowser:"app-pages-browser",pagesDirBrowser:"pages-dir-browser",pagesDirEdge:"pages-dir-edge",pagesDirNode:"pages-dir-node"};function O(e){var t,r,n,i,o,a=[],s=0;function c(){for(;s<e.length&&/\s/.test(e.charAt(s));)s+=1;return s<e.length}for(;s<e.length;){for(t=s,o=!1;c();)if(","===(r=e.charAt(s))){for(n=s,s+=1,c(),i=s;s<e.length&&"="!==(r=e.charAt(s))&&";"!==r&&","!==r;)s+=1;s<e.length&&"="===e.charAt(s)?(o=!0,s=i,a.push(e.substring(t,n)),t=s):s=n+1}else s+=1;(!o||s>=e.length)&&a.push(e.substring(t,e.length))}return a}function I(e){let t={},r=[];if(e)for(let[n,i]of e.entries())"set-cookie"===n.toLowerCase()?(r.push(...O(i)),t[n]=1===r.length?r[0]:r):t[n]=i;return t}function k(e){try{return String(new URL(String(e)))}catch(t){throw Object.defineProperty(Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t}),"__NEXT_ERROR_CODE",{value:"E61",enumerable:!1,configurable:!0})}}({...R,GROUP:{builtinReact:[R.reactServerComponents,R.actionBrowser],serverOnly:[R.reactServerComponents,R.actionBrowser,R.instrument,R.middleware],neutralTarget:[R.apiNode,R.apiEdge],clientOnly:[R.serverSideRendering,R.appPagesBrowser],bundled:[R.reactServerComponents,R.actionBrowser,R.serverSideRendering,R.appPagesBrowser,R.shared,R.instrument,R.middleware],appPages:[R.reactServerComponents,R.serverSideRendering,R.appPagesBrowser,R.actionBrowser]}});let N=Symbol("response"),P=Symbol("passThrough"),U=Symbol("waitUntil");class C{constructor(e,t){this[P]=!1,this[U]=t?{kind:"external",function:t}:{kind:"internal",promises:[]}}respondWith(e){this[N]||(this[N]=Promise.resolve(e))}passThroughOnException(){this[P]=!0}waitUntil(e){if("external"===this[U].kind)return(0,this[U].function)(e);this[U].promises.push(e)}}class D extends C{constructor(e){var t;super(e.request,null==(t=e.context)?void 0:t.waitUntil),this.sourcePage=e.page}get request(){throw Object.defineProperty(new E({page:this.sourcePage}),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}respondWith(){throw Object.defineProperty(new E({page:this.sourcePage}),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}}function L(e){return e.replace(/\/$/,"")||"/"}function j(e){let t=e.indexOf("#"),r=e.indexOf("?"),n=r>-1&&(t<0||r<t);return n||t>-1?{pathname:e.substring(0,n?r:t),query:n?e.substring(r,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}function $(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:n,hash:i}=j(e);return`${t}${r}${n}${i}`}function M(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:n,hash:i}=j(e);return`${r}${t}${n}${i}`}function q(e,t){if("string"!=typeof e)return!1;let{pathname:r}=j(e);return r===t||r.startsWith(t+"/")}let V=new WeakMap;function B(e,t){let r;if(!t)return{pathname:e};let n=V.get(t);n||(n=t.map(e=>e.toLowerCase()),V.set(t,n));let i=e.split("/",2);if(!i[1])return{pathname:e};let o=i[1].toLowerCase(),a=n.indexOf(o);return a<0?{pathname:e}:(r=t[a],{pathname:e=e.slice(r.length+1)||"/",detectedLocale:r})}let z=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function W(e,t){return new URL(String(e).replace(z,"localhost"),t&&String(t).replace(z,"localhost"))}let H=Symbol("NextURLInternal");class F{constructor(e,t,r){let n,i;"object"==typeof t&&"pathname"in t||"string"==typeof t?(n=t,i=r||{}):i=r||t||{},this[H]={url:W(e,n??i.base),options:i,basePath:""},this.analyze()}analyze(){var e,t,r,n,i;let o=function(e,t){let{basePath:r,i18n:n,trailingSlash:i}=t.nextConfig??{},o={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):i};r&&q(o.pathname,r)&&(o.pathname=function(e,t){if(!q(e,t))return e;let r=e.slice(t.length);return r.startsWith("/")?r:`/${r}`}(o.pathname,r),o.basePath=r);let a=o.pathname;if(o.pathname.startsWith("/_next/data/")&&o.pathname.endsWith(".json")){let e=o.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/");o.buildId=e[0],a="index"!==e[1]?`/${e.slice(1).join("/")}`:"/",!0===t.parseData&&(o.pathname=a)}if(n){let e=t.i18nProvider?t.i18nProvider.analyze(o.pathname):B(o.pathname,n.locales);o.locale=e.detectedLocale,o.pathname=e.pathname??o.pathname,!e.detectedLocale&&o.buildId&&(e=t.i18nProvider?t.i18nProvider.analyze(a):B(a,n.locales)).detectedLocale&&(o.locale=e.detectedLocale)}return o}(this[H].url.pathname,{nextConfig:this[H].options.nextConfig,parseData:!0,i18nProvider:this[H].options.i18nProvider}),a=function(e,t){let r;if(t?.host&&!Array.isArray(t.host))r=t.host.toString().split(":",1)[0];else{if(!e.hostname)return;r=e.hostname}return r.toLowerCase()}(this[H].url,this[H].options.headers);this[H].domainLocale=this[H].options.i18nProvider?this[H].options.i18nProvider.detectDomainLocale(a):function(e,t,r){if(e){for(let n of(r&&(r=r.toLowerCase()),e))if(t===n.domain?.split(":",1)[0].toLowerCase()||r===n.defaultLocale.toLowerCase()||n.locales?.some(e=>e.toLowerCase()===r))return n}}(null==(t=this[H].options.nextConfig)||null==(e=t.i18n)?void 0:e.domains,a);let s=(null==(r=this[H].domainLocale)?void 0:r.defaultLocale)||(null==(i=this[H].options.nextConfig)||null==(n=i.i18n)?void 0:n.defaultLocale);this[H].url.pathname=o.pathname,this[H].defaultLocale=s,this[H].basePath=o.basePath??"",this[H].buildId=o.buildId,this[H].locale=o.locale??s,this[H].trailingSlash=o.trailingSlash}formatPathname(){var e;let t;return t=function(e,t,r,n){if(!t||t===r)return e;let i=e.toLowerCase();return!n&&(q(i,"/api")||q(i,`/${t.toLowerCase()}`))?e:$(e,`/${t}`)}((e={basePath:this[H].basePath,buildId:this[H].buildId,defaultLocale:this[H].options.forceLocale?void 0:this[H].defaultLocale,locale:this[H].locale,pathname:this[H].url.pathname,trailingSlash:this[H].trailingSlash}).pathname,e.locale,e.buildId?void 0:e.defaultLocale,e.ignorePrefix),(e.buildId||!e.trailingSlash)&&(t=L(t)),e.buildId&&(t=M($(t,`/_next/data/${e.buildId}`),"/"===e.pathname?"index.json":".json")),t=$(t,e.basePath),!e.buildId&&e.trailingSlash?t.endsWith("/")?t:M(t,"/"):L(t)}formatSearch(){return this[H].url.search}get buildId(){return this[H].buildId}set buildId(e){this[H].buildId=e}get locale(){return this[H].locale??""}set locale(e){var t,r;if(!this[H].locale||!(null==(r=this[H].options.nextConfig)||null==(t=r.i18n)?void 0:t.locales.includes(e)))throw Object.defineProperty(TypeError(`The NextURL configuration includes no locale "${e}"`),"__NEXT_ERROR_CODE",{value:"E597",enumerable:!1,configurable:!0});this[H].locale=e}get defaultLocale(){return this[H].defaultLocale}get domainLocale(){return this[H].domainLocale}get searchParams(){return this[H].url.searchParams}get host(){return this[H].url.host}set host(e){this[H].url.host=e}get hostname(){return this[H].url.hostname}set hostname(e){this[H].url.hostname=e}get port(){return this[H].url.port}set port(e){this[H].url.port=e}get protocol(){return this[H].url.protocol}set protocol(e){this[H].url.protocol=e}get href(){let e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[H].url=W(e),this.analyze()}get origin(){return this[H].url.origin}get pathname(){return this[H].url.pathname}set pathname(e){this[H].url.pathname=e}get hash(){return this[H].url.hash}set hash(e){this[H].url.hash=e}get search(){return this[H].url.search}set search(e){this[H].url.search=e}get password(){return this[H].url.password}set password(e){this[H].url.password=e}get username(){return this[H].url.username}set username(e){this[H].url.username=e}get basePath(){return this[H].basePath}set basePath(e){this[H].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new F(String(this),this[H].options)}}var K,Q,Z,G,Y,J,X,ee,et,er,en,ei,eo,ea,es,ec,ed,el=e.i(709254);let eu=Symbol("internal request");class ep extends Request{constructor(e,t={}){const r="string"!=typeof e&&"url"in e?e.url:String(e);k(r),t.body&&"half"!==t.duplex&&(t.duplex="half"),e instanceof Request?super(e,t):super(r,t);const n=new F(r,{headers:I(this.headers),nextConfig:t.nextConfig});this[eu]={cookies:new el.RequestCookies(this.headers),nextUrl:n,url:n.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[eu].cookies}get nextUrl(){return this[eu].nextUrl}get page(){throw new T}get ua(){throw new A}get url(){return this[eu].url}}class ef{static get(e,t,r){let n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}static set(e,t,r,n){return Reflect.set(e,t,r,n)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}let eh=Symbol("internal response"),em=new Set([301,302,303,307,308]);function eg(e,t){var r;if(null==e||null==(r=e.request)?void 0:r.headers){if(!(e.request.headers instanceof Headers))throw Object.defineProperty(Error("request.headers must be an instance of Headers"),"__NEXT_ERROR_CODE",{value:"E119",enumerable:!1,configurable:!0});let r=[];for(let[n,i]of e.request.headers)t.set("x-middleware-request-"+n,i),r.push(n);t.set("x-middleware-override-headers",r.join(","))}}class ey extends Response{constructor(e,t={}){super(e,t);const r=this.headers,n=new Proxy(new el.ResponseCookies(r),{get(e,n,i){switch(n){case"delete":case"set":return(...i)=>{let o=Reflect.apply(e[n],e,i),a=new Headers(r);return o instanceof el.ResponseCookies&&r.set("x-middleware-set-cookie",o.getAll().map(e=>(0,el.stringifyCookie)(e)).join(",")),eg(t,a),o};default:return ef.get(e,n,i)}}});this[eh]={cookies:n,url:t.url?new F(t.url,{headers:I(r),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[eh].cookies}static json(e,t){let r=Response.json(e,t);return new ey(r.body,r)}static redirect(e,t){let r="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!em.has(r))throw Object.defineProperty(RangeError('Failed to execute "redirect" on "response": Invalid status code'),"__NEXT_ERROR_CODE",{value:"E529",enumerable:!1,configurable:!0});let n="object"==typeof t?t:{},i=new Headers(null==n?void 0:n.headers);return i.set("Location",k(e)),new ey(null,{...n,headers:i,status:r})}static rewrite(e,t){let r=new Headers(null==t?void 0:t.headers);return r.set("x-middleware-rewrite",k(e)),eg(t,r),new ey(null,{...t,headers:r})}static next(e){let t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),eg(e,t),new ey(null,{...e,headers:t})}}function eb(e,t){let r="string"==typeof t?new URL(t):t,n=new URL(e,t),i=n.origin===r.origin;return{url:i?n.toString().slice(r.origin.length):n.toString(),isRelative:i}}let ew="next-router-prefetch",ex=["rsc","next-router-state-tree",ew,"next-hmr-refresh","next-router-segment-prefetch"],ev="_rsc";class e_ extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new e_}}class eE extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,n){if("symbol"==typeof r)return ef.get(t,r,n);let i=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===i);if(void 0!==o)return ef.get(t,o,n)},set(t,r,n,i){if("symbol"==typeof r)return ef.set(t,r,n,i);let o=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===o);return ef.set(t,a??r,n,i)},has(t,r){if("symbol"==typeof r)return ef.has(t,r);let n=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0!==i&&ef.has(t,i)},deleteProperty(t,r){if("symbol"==typeof r)return ef.deleteProperty(t,r);let n=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===n);return void 0===i||ef.deleteProperty(t,i)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return e_.callable;default:return ef.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new eE(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,n]of this.entries())e.call(t,n,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}var eT=e.i(556704);class eA extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new eA}}class eS{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return eA.callable;default:return ef.get(e,t,r)}}})}}let eR=Symbol.for("next.mutated.cookies");class eO{static wrap(e,t){let r=new el.ResponseCookies(new Headers);for(let t of e.getAll())r.set(t);let n=[],i=new Set,o=()=>{let e=eT.workAsyncStorage.getStore();if(e&&(e.pathWasRevalidated=!0),n=r.getAll().filter(e=>i.has(e.name)),t){let e=[];for(let t of n){let r=new el.ResponseCookies(new Headers);r.set(t),e.push(r.toString())}t(e)}},a=new Proxy(r,{get(e,t,r){switch(t){case eR:return n;case"delete":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.delete(...t),a}finally{o()}};case"set":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t),a}finally{o()}};default:return ef.get(e,t,r)}}});return a}}function eI(e,t){if("action"!==e.phase)throw new eA}var ek=((K=ek||{}).handleRequest="BaseServer.handleRequest",K.run="BaseServer.run",K.pipe="BaseServer.pipe",K.getStaticHTML="BaseServer.getStaticHTML",K.render="BaseServer.render",K.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",K.renderToResponse="BaseServer.renderToResponse",K.renderToHTML="BaseServer.renderToHTML",K.renderError="BaseServer.renderError",K.renderErrorToResponse="BaseServer.renderErrorToResponse",K.renderErrorToHTML="BaseServer.renderErrorToHTML",K.render404="BaseServer.render404",K),eN=((Q=eN||{}).loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",Q.loadComponents="LoadComponents.loadComponents",Q),eP=((Z=eP||{}).getRequestHandler="NextServer.getRequestHandler",Z.getRequestHandlerWithMetadata="NextServer.getRequestHandlerWithMetadata",Z.getServer="NextServer.getServer",Z.getServerRequestHandler="NextServer.getServerRequestHandler",Z.createServer="createServer.createServer",Z),eU=((G=eU||{}).compression="NextNodeServer.compression",G.getBuildId="NextNodeServer.getBuildId",G.createComponentTree="NextNodeServer.createComponentTree",G.clientComponentLoading="NextNodeServer.clientComponentLoading",G.getLayoutOrPageModule="NextNodeServer.getLayoutOrPageModule",G.generateStaticRoutes="NextNodeServer.generateStaticRoutes",G.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",G.generatePublicRoutes="NextNodeServer.generatePublicRoutes",G.generateImageRoutes="NextNodeServer.generateImageRoutes.route",G.sendRenderResult="NextNodeServer.sendRenderResult",G.proxyRequest="NextNodeServer.proxyRequest",G.runApi="NextNodeServer.runApi",G.render="NextNodeServer.render",G.renderHTML="NextNodeServer.renderHTML",G.imageOptimizer="NextNodeServer.imageOptimizer",G.getPagePath="NextNodeServer.getPagePath",G.getRoutesManifest="NextNodeServer.getRoutesManifest",G.findPageComponents="NextNodeServer.findPageComponents",G.getFontManifest="NextNodeServer.getFontManifest",G.getServerComponentManifest="NextNodeServer.getServerComponentManifest",G.getRequestHandler="NextNodeServer.getRequestHandler",G.renderToHTML="NextNodeServer.renderToHTML",G.renderError="NextNodeServer.renderError",G.renderErrorToHTML="NextNodeServer.renderErrorToHTML",G.render404="NextNodeServer.render404",G.startResponse="NextNodeServer.startResponse",G.route="route",G.onProxyReq="onProxyReq",G.apiResolver="apiResolver",G.internalFetch="internalFetch",G),eC=((Y=eC||{}).startServer="startServer.startServer",Y),eD=((J=eD||{}).getServerSideProps="Render.getServerSideProps",J.getStaticProps="Render.getStaticProps",J.renderToString="Render.renderToString",J.renderDocument="Render.renderDocument",J.createBodyResult="Render.createBodyResult",J),eL=((X=eL||{}).renderToString="AppRender.renderToString",X.renderToReadableStream="AppRender.renderToReadableStream",X.getBodyResult="AppRender.getBodyResult",X.fetch="AppRender.fetch",X),ej=((ee=ej||{}).executeRoute="Router.executeRoute",ee),e$=((et=e$||{}).runHandler="Node.runHandler",et),eM=((er=eM||{}).runHandler="AppRouteRouteHandlers.runHandler",er),eq=((en=eq||{}).generateMetadata="ResolveMetadata.generateMetadata",en.generateViewport="ResolveMetadata.generateViewport",en),eV=((ei=eV||{}).execute="Middleware.execute",ei);let eB=["Middleware.execute","BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata","ResolveMetadata.generateViewport","NextNodeServer.createComponentTree","NextNodeServer.findPageComponents","NextNodeServer.getLayoutOrPageModule","NextNodeServer.startResponse","NextNodeServer.clientComponentLoading"],ez=["NextNodeServer.findPageComponents","NextNodeServer.createComponentTree","NextNodeServer.clientComponentLoading"];function eW(e){return null!==e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then}try{t=e.r(270406)}catch(r){t=e.r(331387)}let{context:eH,propagation:eF,trace:eK,SpanStatusCode:eQ,SpanKind:eZ,ROOT_CONTEXT:eG}=t;class eY extends Error{constructor(e,t){super(),this.bubble=e,this.result=t}}let eJ=(e,t)=>{"object"==typeof t&&null!==t&&t instanceof eY&&t.bubble?e.setAttribute("next.bubble",!0):(t&&(e.recordException(t),e.setAttribute("error.type",t.name)),e.setStatus({code:eQ.ERROR,message:null==t?void 0:t.message})),e.end()},eX=new Map,e0=t.createContextKey("next.rootSpanId"),e1=0,e2={set(e,t,r){e.push({key:t,value:r})}},e5=(s=new class e{getTracerInstance(){return eK.getTracer("next.js","0.0.1")}getContext(){return eH}getTracePropagationData(){let e=eH.active(),t=[];return eF.inject(e,t,e2),t}getActiveScopeSpan(){return eK.getSpan(null==eH?void 0:eH.active())}withPropagatedContext(e,t,r){let n=eH.active();if(eK.getSpanContext(n))return t();let i=eF.extract(n,e,r);return eH.with(i,t)}trace(...e){var t;let[r,n,i]=e,{fn:o,options:a}="function"==typeof n?{fn:n,options:{}}:{fn:i,options:{...n}},s=a.spanName??r;if(!eB.includes(r)&&"1"!==process.env.NEXT_OTEL_VERBOSE||a.hideSpan)return o();let c=this.getSpanContext((null==a?void 0:a.parentSpan)??this.getActiveScopeSpan()),d=!1;c?(null==(t=eK.getSpanContext(c))?void 0:t.isRemote)&&(d=!0):(c=(null==eH?void 0:eH.active())??eG,d=!0);let l=e1++;return a.attributes={"next.span_name":s,"next.span_type":r,...a.attributes},eH.with(c.setValue(e0,l),()=>this.getTracerInstance().startActiveSpan(s,a,e=>{let t="performance"in globalThis&&"measure"in performance?globalThis.performance.now():void 0,n=()=>{eX.delete(l),t&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX&&ez.includes(r||"")&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-${(r.split(".").pop()||"").replace(/[A-Z]/g,e=>"-"+e.toLowerCase())}`,{start:t,end:performance.now()})};d&&eX.set(l,new Map(Object.entries(a.attributes??{})));try{if(o.length>1)return o(e,t=>eJ(e,t));let t=o(e);if(eW(t))return t.then(t=>(e.end(),t)).catch(t=>{throw eJ(e,t),t}).finally(n);return e.end(),n(),t}catch(t){throw eJ(e,t),n(),t}}))}wrap(...e){let t=this,[r,n,i]=3===e.length?e:[e[0],{},e[1]];return eB.includes(r)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let e=n;"function"==typeof e&&"function"==typeof i&&(e=e.apply(this,arguments));let o=arguments.length-1,a=arguments[o];if("function"!=typeof a)return t.trace(r,e,()=>i.apply(this,arguments));{let n=t.getContext().bind(eH.active(),a);return t.trace(r,e,(e,t)=>(arguments[o]=function(e){return null==t||t(e),n.apply(this,arguments)},i.apply(this,arguments)))}}:i}startSpan(...e){let[t,r]=e,n=this.getSpanContext((null==r?void 0:r.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(t,r,n)}getSpanContext(e){return e?eK.setSpan(eH.active(),e):void 0}getRootSpanAttributes(){let e=eH.active().getValue(e0);return eX.get(e)}setRootSpanAttribute(e,t){let r=eH.active().getValue(e0),n=eX.get(r);n&&!n.has(e)&&n.set(e,t)}},()=>s),e6="__prerender_bypass";Symbol("__next_preview_data"),Symbol(e6);class e3{constructor(e,t,r,n){var i;const o=e&&function(e,t){let r=eE.from(e.headers);return{isOnDemandRevalidate:r.get("x-prerender-revalidate")===t.previewModeId,revalidateOnlyGenerated:r.has("x-prerender-revalidate-if-generated")}}(t,e).isOnDemandRevalidate,a=null==(i=r.get(e6))?void 0:i.value;this._isEnabled=!!(!o&&a&&e&&a===e.previewModeId),this._previewModeId=null==e?void 0:e.previewModeId,this._mutableCookies=n}get isEnabled(){return this._isEnabled}enable(){if(!this._previewModeId)throw Object.defineProperty(Error("Invariant: previewProps missing previewModeId this should never happen"),"__NEXT_ERROR_CODE",{value:"E93",enumerable:!1,configurable:!0});this._mutableCookies.set({name:e6,value:this._previewModeId,httpOnly:!0,sameSite:"none",secure:!0,path:"/"}),this._isEnabled=!0}disable(){this._mutableCookies.set({name:e6,value:"",httpOnly:!0,sameSite:"none",secure:!0,path:"/",expires:new Date(0)}),this._isEnabled=!1}}function e4(e,t){if("x-middleware-set-cookie"in e.headers&&"string"==typeof e.headers["x-middleware-set-cookie"]){let r=e.headers["x-middleware-set-cookie"],n=new Headers;for(let e of O(r))n.append("set-cookie",e);for(let e of new el.ResponseCookies(n).getAll())t.set(e)}}var e8=e.i(832319),e9=e.i(447413);class e7 extends Error{constructor(e,t){super(`Invariant: ${e.endsWith(".")?e:e+"."} This is a bug in Next.js.`,t),this.name="InvariantError"}}e.i(951187),process.env.NEXT_PRIVATE_DEBUG_CACHE&&((e,...t)=>{console.log(`use-cache: ${e}`,...t)}),Symbol.for("@next/cache-handlers");let te=Symbol.for("@next/cache-handlers-map"),tt=Symbol.for("@next/cache-handlers-set"),tr=globalThis;function tn(){if(tr[te])return tr[te].entries()}async function ti(e,t){if(!e)return t();let r=to(e);try{return await t()}finally{var n,i;let t,o,a=(n=r,i=to(e),t=new Set(n.pendingRevalidatedTags.map(e=>{let t="object"==typeof e.profile?JSON.stringify(e.profile):e.profile||"";return`${e.tag}:${t}`})),o=new Set(n.pendingRevalidateWrites),{pendingRevalidatedTags:i.pendingRevalidatedTags.filter(e=>{let r="object"==typeof e.profile?JSON.stringify(e.profile):e.profile||"";return!t.has(`${e.tag}:${r}`)}),pendingRevalidates:Object.fromEntries(Object.entries(i.pendingRevalidates).filter(([e])=>!(e in n.pendingRevalidates))),pendingRevalidateWrites:i.pendingRevalidateWrites.filter(e=>!o.has(e))});await ts(e,a)}}function to(e){return{pendingRevalidatedTags:e.pendingRevalidatedTags?[...e.pendingRevalidatedTags]:[],pendingRevalidates:{...e.pendingRevalidates},pendingRevalidateWrites:e.pendingRevalidateWrites?[...e.pendingRevalidateWrites]:[]}}async function ta(e,t,r){if(0===e.length)return;let n=function(){if(tr[tt])return tr[tt].values()}(),i=[],o=new Map;for(let t of e){let e,r=t.profile;for(let[t]of o)if("string"==typeof t&&"string"==typeof r&&t===r||"object"==typeof t&&"object"==typeof r&&JSON.stringify(t)===JSON.stringify(r)||t===r){e=t;break}let n=e||r;o.has(n)||o.set(n,[]),o.get(n).push(t.tag)}for(let[e,s]of o){let o;if(e){let t;if("object"==typeof e)t=e;else if("string"==typeof e){var a;if(!(t=null==r||null==(a=r.cacheLifeProfiles)?void 0:a[e]))throw Object.defineProperty(Error(`Invalid profile provided "${e}" must be configured under cacheLife in next.config or be "max"`),"__NEXT_ERROR_CODE",{value:"E873",enumerable:!1,configurable:!0})}t&&(o={expire:t.expire})}for(let t of n||[])e?i.push(null==t.updateTags?void 0:t.updateTags.call(t,s,o)):i.push(null==t.updateTags?void 0:t.updateTags.call(t,s));t&&i.push(t.revalidateTag(s,o))}await Promise.all(i)}async function ts(e,t){let r=(null==t?void 0:t.pendingRevalidatedTags)??e.pendingRevalidatedTags??[],n=(null==t?void 0:t.pendingRevalidates)??e.pendingRevalidates??{},i=(null==t?void 0:t.pendingRevalidateWrites)??e.pendingRevalidateWrites??[];return Promise.all([ta(r,e.incrementalCache,e),...Object.values(n),...i])}let tc=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class td{disable(){throw tc}getStore(){}run(){throw tc}exit(){throw tc}enterWith(){throw tc}static bind(e){return e}}let tl="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;var tu=e.i(324725);class tp{constructor({waitUntil:e,onClose:t,onTaskError:r}){this.workUnitStores=new Set,this.waitUntil=e,this.onClose=t,this.onTaskError=r,this.callbackQueue=new e9.default,this.callbackQueue.pause()}after(e){if(eW(e))this.waitUntil||tf(),this.waitUntil(e.catch(e=>this.reportTaskError("promise",e)));else if("function"==typeof e)this.addCallback(e);else throw Object.defineProperty(Error("`after()`: Argument must be a promise or a function"),"__NEXT_ERROR_CODE",{value:"E50",enumerable:!1,configurable:!0})}addCallback(e){var t;this.waitUntil||tf();let r=e8.workUnitAsyncStorage.getStore();r&&this.workUnitStores.add(r);let n=tu.afterTaskAsyncStorage.getStore(),i=n?n.rootTaskSpawnPhase:null==r?void 0:r.phase;this.runCallbacksOnClosePromise||(this.runCallbacksOnClosePromise=this.runCallbacksOnClose(),this.waitUntil(this.runCallbacksOnClosePromise));let o=(t=async()=>{try{await tu.afterTaskAsyncStorage.run({rootTaskSpawnPhase:i},()=>e())}catch(e){this.reportTaskError("function",e)}},tl?tl.bind(t):td.bind(t));this.callbackQueue.add(o)}async runCallbacksOnClose(){return await new Promise(e=>this.onClose(e)),this.runCallbacks()}async runCallbacks(){if(0===this.callbackQueue.size)return;for(let e of this.workUnitStores)e.phase="after";let e=eT.workAsyncStorage.getStore();if(!e)throw Object.defineProperty(new e7("Missing workStore in AfterContext.runCallbacks"),"__NEXT_ERROR_CODE",{value:"E547",enumerable:!1,configurable:!0});return ti(e,()=>(this.callbackQueue.start(),this.callbackQueue.onIdle()))}reportTaskError(e,t){if(console.error("promise"===e?"A promise passed to `after()` rejected:":"An error occurred in a function passed to `after()`:",t),this.onTaskError)try{null==this.onTaskError||this.onTaskError.call(this,t)}catch(e){console.error(Object.defineProperty(new e7("`onTaskError` threw while handling an error thrown from an `after` task",{cause:e}),"__NEXT_ERROR_CODE",{value:"E569",enumerable:!1,configurable:!0}))}}}function tf(){throw Object.defineProperty(Error("`after()` will not work correctly, because `waitUntil` is not available in the current environment."),"__NEXT_ERROR_CODE",{value:"E91",enumerable:!1,configurable:!0})}function th(e){let t,r={then:(n,i)=>(t||(t=e()),t.then(e=>{r.value=e}).catch(()=>{}),t.then(n,i))};return r}class tm{onClose(e){if(this.isClosed)throw Object.defineProperty(Error("Cannot subscribe to a closed CloseController"),"__NEXT_ERROR_CODE",{value:"E365",enumerable:!1,configurable:!0});this.target.addEventListener("close",e),this.listeners++}dispatchClose(){if(this.isClosed)throw Object.defineProperty(Error("Cannot close a CloseController multiple times"),"__NEXT_ERROR_CODE",{value:"E229",enumerable:!1,configurable:!0});this.listeners>0&&this.target.dispatchEvent(new Event("close")),this.isClosed=!0}constructor(){this.target=new EventTarget,this.listeners=0,this.isClosed=!1}}function tg(){return{previewModeId:process.env.__NEXT_PREVIEW_MODE_ID||"",previewModeSigningKey:process.env.__NEXT_PREVIEW_MODE_SIGNING_KEY||"",previewModeEncryptionKey:process.env.__NEXT_PREVIEW_MODE_ENCRYPTION_KEY||""}}let ty=Symbol.for("@next/request-context");async function tb(e,t,r){let n=new Set;for(let t of(e=>{let t=["/layout"];if(e.startsWith("/")){let r=e.split("/");for(let e=1;e<r.length+1;e++){let n=r.slice(0,e).join("/");n&&(n.endsWith("/page")||n.endsWith("/route")||(n=`${n}${!n.endsWith("/")?"/":""}layout`),t.push(n))}}return t})(e))t=`${S}${t}`,n.add(t);if(t.pathname&&(!r||0===r.size)){let e=`${S}${t.pathname}`;n.add(e)}n.has(`${S}/`)&&n.add(`${S}/index`),n.has(`${S}/index`)&&n.add(`${S}/`);let i=Array.from(n);return{tags:i,expirationsByCacheKind:function(e){let t=new Map,r=tn();if(r)for(let[n,i]of r)"getExpiration"in i&&t.set(n,th(async()=>i.getExpiration(e)));return t}(i)}}class tw extends ep{constructor(e){super(e.input,e.init),this.sourcePage=e.page}get request(){throw Object.defineProperty(new E({page:this.sourcePage}),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}respondWith(){throw Object.defineProperty(new E({page:this.sourcePage}),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}waitUntil(){throw Object.defineProperty(new E({page:this.sourcePage}),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}}let tx={keys:e=>Array.from(e.keys()),get:(e,t)=>e.get(t)??void 0},tv=(e,t)=>e5().withPropagatedContext(e.headers,t,tx),t_=!1;async function tE(t){var r,n,i,o;let a,s,c,d,l;!function(){if(!t_&&(t_=!0,"true"===process.env.NEXT_PRIVATE_TEST_PROXY)){let{interceptTestApis:t,wrapRequestHandler:r}=e.r(376532);t(),tv=r(tv)}}(),await (!_&&(_=x()),_);let u=void 0!==globalThis.__BUILD_MANIFEST;t.request.url=t.request.url.replace(/\.rsc($|\?)/,"$1");let p=t.bypassNextUrl?new URL(t.request.url):new F(t.request.url,{headers:t.request.headers,nextConfig:t.request.nextConfig});for(let e of[...p.searchParams.keys()]){let t=p.searchParams.getAll(e),r=function(e){for(let t of["nxtP","nxtI"])if(e!==t&&e.startsWith(t))return e.substring(t.length);return null}(e);if(r){for(let e of(p.searchParams.delete(r),t))p.searchParams.append(r,e);p.searchParams.delete(e)}}let f=process.env.__NEXT_BUILD_ID||"";"buildId"in p&&(f=p.buildId||"",p.buildId="");let h=function(e){let t=new Headers;for(let[r,n]of Object.entries(e))for(let e of Array.isArray(n)?n:[n])void 0!==e&&("number"==typeof e&&(e=e.toString()),t.append(r,e));return t}(t.request.headers),m=h.has("x-nextjs-data"),g="1"===h.get("rsc");m&&"/index"===p.pathname&&(p.pathname="/");let y=new Map;if(!u)for(let e of ex){let t=h.get(e);null!==t&&(y.set(e,t),h.delete(e))}let b=p.searchParams.get(ev),w=new tw({page:t.page,input:((d=(c="string"==typeof p)?new URL(p):p).searchParams.delete(ev),c?d.toString():d).toString(),init:{body:t.request.body,headers:h,method:t.request.method,nextConfig:t.request.nextConfig,signal:t.request.signal}});m&&Object.defineProperty(w,"__isData",{enumerable:!1,value:!0}),!globalThis.__incrementalCacheShared&&t.IncrementalCache&&(globalThis.__incrementalCache=new t.IncrementalCache({CurCacheHandler:t.incrementalCacheHandler,minimalMode:!0,fetchCacheKeyPrefix:"",dev:!1,requestHeaders:t.request.headers,getPrerenderManifest:()=>({version:-1,routes:{},dynamicRoutes:{},notFoundRoutes:[],preview:tg()})}));let v=t.request.waitUntil??(null==(r=null==(l=globalThis[ty])?void 0:l.get())?void 0:r.waitUntil),E=new D({request:w,page:t.page,context:v?{waitUntil:v}:void 0});if((a=await tv(w,()=>{if("/middleware"===t.page||"/src/middleware"===t.page||"/proxy"===t.page||"/src/proxy"===t.page){let e=E.waitUntil.bind(E),r=new tm;return e5().trace(eV.execute,{spanName:`middleware ${w.method}`,attributes:{"http.target":w.nextUrl.pathname,"http.method":w.method}},async()=>{try{var n,i,o,a,c,d;let l=tg(),u=await tb("/",w.nextUrl,null),p=(c=w.nextUrl,d=e=>{s=e},function(e,t,r,n,i,o,a,s,c,d,l,u){function p(e){r&&r.setHeader("Set-Cookie",e)}let f={};return{type:"request",phase:e,implicitTags:o,url:{pathname:n.pathname,search:n.search??""},rootParams:i,get headers(){return f.headers||(f.headers=function(e){let t=eE.from(e);for(let e of ex)t.delete(e);return eE.seal(t)}(t.headers)),f.headers},get cookies(){if(!f.cookies){let e=new el.RequestCookies(eE.from(t.headers));e4(t,e),f.cookies=eS.seal(e)}return f.cookies},set cookies(value){f.cookies=value},get mutableCookies(){if(!f.mutableCookies){var h,m;let e,n=(h=t.headers,m=a||(r?p:void 0),e=new el.RequestCookies(eE.from(h)),eO.wrap(e,m));e4(t,n),f.mutableCookies=n}return f.mutableCookies},get userspaceMutableCookies(){if(!f.userspaceMutableCookies){var g;let e;g=this,f.userspaceMutableCookies=e=new Proxy(g.mutableCookies,{get(t,r,n){switch(r){case"delete":return function(...r){return eI(g,"cookies().delete"),t.delete(...r),e};case"set":return function(...r){return eI(g,"cookies().set"),t.set(...r),e};default:return ef.get(t,r,n)}}})}return f.userspaceMutableCookies},get draftMode(){return f.draftMode||(f.draftMode=new e3(c,t,this.cookies,this.mutableCookies)),f.draftMode},renderResumeDataCache:null,isHmrRefresh:d,serverComponentsHmrCache:l||globalThis.__serverComponentsHmrCache,devFallbackParams:null}}("action",w,void 0,c,{},u,d,null,l,!1,void 0,null)),h=function({page:e,renderOpts:t,isPrefetchRequest:r,buildId:n,previouslyRevalidatedTags:i,nonce:o}){var a;let s=!t.shouldWaitOnAllReady&&!t.supportsDynamicResponse&&!t.isDraftMode&&!t.isPossibleServerAction,c=t.dev??!1,d=c||s&&(!!process.env.NEXT_DEBUG_BUILD||"1"===process.env.NEXT_SSG_FETCH_METRICS),l={isStaticGeneration:s,page:e,route:(a=e.split("/").reduce((e,t,r,n)=>t?"("===t[0]&&t.endsWith(")")||"@"===t[0]||("page"===t||"route"===t)&&r===n.length-1?e:`${e}/${t}`:e,"")).startsWith("/")?a:`/${a}`,incrementalCache:t.incrementalCache||globalThis.__incrementalCache,cacheLifeProfiles:t.cacheLifeProfiles,isBuildTimePrerendering:t.nextExport,hasReadableErrorStacks:t.hasReadableErrorStacks,fetchCache:t.fetchCache,isOnDemandRevalidate:t.isOnDemandRevalidate,isDraftMode:t.isDraftMode,isPrefetchRequest:r,buildId:n,reactLoadableManifest:(null==t?void 0:t.reactLoadableManifest)||{},assetPrefix:(null==t?void 0:t.assetPrefix)||"",nonce:o,afterContext:function(e){let{waitUntil:t,onClose:r,onAfterTaskError:n}=e;return new tp({waitUntil:t,onClose:r,onTaskError:n})}(t),cacheComponentsEnabled:t.cacheComponents,dev:c,previouslyRevalidatedTags:i,refreshTagsByCacheKind:function(){let e=new Map,t=tn();if(t)for(let[r,n]of t)"refreshTags"in n&&e.set(r,th(async()=>n.refreshTags()));return e}(),runInCleanSnapshot:tl?tl.snapshot():function(e,...t){return e(...t)},shouldTrackFetchMetrics:d};return t.store=l,l}({page:"/",renderOpts:{cacheLifeProfiles:null==(i=t.request.nextConfig)||null==(n=i.experimental)?void 0:n.cacheLife,cacheComponents:!1,experimental:{isRoutePPREnabled:!1,authInterrupts:!!(null==(a=t.request.nextConfig)||null==(o=a.experimental)?void 0:o.authInterrupts)},supportsDynamicResponse:!0,waitUntil:e,onClose:r.onClose.bind(r),onAfterTaskError:void 0},isPrefetchRequest:"1"===w.headers.get(ew),buildId:f??"",previouslyRevalidatedTags:[]});return await eT.workAsyncStorage.run(h,()=>e8.workUnitAsyncStorage.run(p,t.handler,w,E))}finally{setTimeout(()=>{r.dispatchClose()},0)}})}return t.handler(w,E)}))&&!(a instanceof Response))throw Object.defineProperty(TypeError("Expected an instance of Response to be returned"),"__NEXT_ERROR_CODE",{value:"E567",enumerable:!1,configurable:!0});a&&s&&a.headers.set("set-cookie",s);let T=null==a?void 0:a.headers.get("x-middleware-rewrite");if(a&&T&&(g||!u)){let e=new F(T,{forceLocale:!0,headers:t.request.headers,nextConfig:t.request.nextConfig});u||e.host!==w.nextUrl.host||(e.buildId=f||e.buildId,a.headers.set("x-middleware-rewrite",String(e)));let{url:r,isRelative:s}=eb(e.toString(),p.toString());!u&&m&&a.headers.set("x-nextjs-rewrite",r);let c=!s&&(null==(o=t.request.nextConfig)||null==(i=o.experimental)||null==(n=i.clientParamParsingOrigins)?void 0:n.some(t=>new RegExp(t).test(e.origin)));g&&(s||c)&&(p.pathname!==e.pathname&&a.headers.set("x-nextjs-rewritten-path",e.pathname),p.search!==e.search&&a.headers.set("x-nextjs-rewritten-query",e.search.slice(1)))}if(a&&T&&g&&b){let e=new URL(T);e.searchParams.has(ev)||(e.searchParams.set(ev,b),a.headers.set("x-middleware-rewrite",e.toString()))}let A=null==a?void 0:a.headers.get("Location");if(a&&A&&!u){let e=new F(A,{forceLocale:!1,headers:t.request.headers,nextConfig:t.request.nextConfig});a=new Response(a.body,a),e.host===p.host&&(e.buildId=f||e.buildId,a.headers.set("Location",e.toString())),m&&(a.headers.delete("Location"),a.headers.set("x-nextjs-redirect",eb(e.toString(),p.toString()).url))}let S=a||ey.next(),R=S.headers.get("x-middleware-override-headers"),O=[];if(R){for(let[e,t]of y)S.headers.set(`x-middleware-request-${e}`,t),O.push(e);O.length>0&&S.headers.set("x-middleware-override-headers",R+","+O.join(","))}return{response:S,waitUntil:("internal"===E[U].kind?Promise.all(E[U].promises).then(()=>{}):void 0)??Promise.resolve(),fetchMetrics:w.fetchMetrics}}let tT=Object.create(null),tA=e=>globalThis.process?.env||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?tT:globalThis),tS=new Proxy(tT,{get:(e,t)=>tA()[t]??tT[t],has:(e,t)=>t in tA()||t in tT,set:(e,t,r)=>(tA(!0)[t]=r,!0),deleteProperty(e,t){if(!t)return!1;let r=tA(!0);return delete r[t],!0},ownKeys:()=>Object.keys(tA(!0))}),tR="undefined"!=typeof process&&process.env&&"production"||"",tO="production"===tR,tI=()=>"dev"===tR||"development"===tR,tk=()=>{var e;return"test"===tR||!!(e=tS.TEST)&&"false"!==e};function tN(e,t){return"undefined"!=typeof process&&process.env?process.env[e]??t:"undefined"!=typeof Deno?Deno.env.get(e)??t:"undefined"!=typeof Bun?Bun.env[e]??t:t}function tP(e,t=!0){let r=tN(e);return r?"0"!==r&&"false"!==r.toLowerCase()&&""!==r:t}let tU=Object.freeze({get BETTER_AUTH_SECRET(){return tN("BETTER_AUTH_SECRET")},get AUTH_SECRET(){return tN("AUTH_SECRET")},get BETTER_AUTH_TELEMETRY(){return tN("BETTER_AUTH_TELEMETRY")},get BETTER_AUTH_TELEMETRY_ID(){return tN("BETTER_AUTH_TELEMETRY_ID")},get NODE_ENV(){return tN("NODE_ENV","development")},get PACKAGE_VERSION(){return tN("PACKAGE_VERSION","0.0.0")},get BETTER_AUTH_TELEMETRY_ENDPOINT(){return tN("BETTER_AUTH_TELEMETRY_ENDPOINT","https://telemetry.better-auth.com/v1/track")}}),tC={eterm:4,cons25:4,console:4,cygwin:4,dtterm:4,gnome:4,hurd:4,jfbterm:4,konsole:4,kterm:4,mlterm:4,mosh:24,putty:4,st:4,"rxvt-unicode-24bit":24,terminator:24,"xterm-kitty":24},tD=new Map(Object.entries({APPVEYOR:8,BUILDKITE:8,CIRCLECI:24,DRONE:8,GITEA_ACTIONS:24,GITHUB_ACTIONS:24,GITLAB_CI:8,TRAVIS:8})),tL=[/ansi/,/color/,/linux/,/direct/,/^con[0-9]*x[0-9]/,/^rxvt/,/^screen/,/^xterm/,/^vt100/,/^vt220/];function tj(){if(void 0!==tN("FORCE_COLOR"))switch(tN("FORCE_COLOR")){case"":case"1":case"true":return 4;case"2":return 8;case"3":return 24;default:return 1}if(void 0!==tN("NODE_DISABLE_COLORS")&&""!==tN("NODE_DISABLE_COLORS")||void 0!==tN("NO_COLOR")&&""!==tN("NO_COLOR")||"dumb"===tN("TERM"))return 1;if(tN("TMUX"))return 24;if("TF_BUILD"in tS&&"AGENT_NAME"in tS)return 4;if("CI"in tS){for(let{0:e,1:t}of tD)if(e in tS)return t;return"codeship"===tN("CI_NAME")?8:1}if("TEAMCITY_VERSION"in tS)return null!==/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.exec(tN("TEAMCITY_VERSION"))?4:1;switch(tN("TERM_PROGRAM")){case"iTerm.app":if(!tN("TERM_PROGRAM_VERSION")||null!==/^[0-2]\./.exec(tN("TERM_PROGRAM_VERSION")))return 8;return 24;case"HyperTerm":case"MacTerm":return 24;case"Apple_Terminal":return 8}if("truecolor"===tN("COLORTERM")||"24bit"===tN("COLORTERM"))return 24;if(tN("TERM")){if(null!==/truecolor/.exec(tN("TERM")))return 24;if(null!==/^xterm-256/.exec(tN("TERM")))return 8;let e=tN("TERM").toLowerCase();if(tC[e])return tC[e];if(tL.some(t=>null!==t.exec(e)))return 4}return tN("COLORTERM")?4:1}let t$="\x1b[0m",tM="\x1b[1m",tq="\x1b[2m",tV="\x1b[31m",tB="\x1b[32m",tz="\x1b[33m",tW="\x1b[34m",tH="\x1b[35m",tF="\x1b[40m",tK=["info","success","warn","error","debug"];function tQ(e,t){return tK.indexOf(t)<=tK.indexOf(e)}let tZ={info:tW,success:tB,warn:tz,error:tV,debug:tH},tG=e=>{let t=e?.disabled!==!0,r=e?.level??"error",n=e?.disableColors!==void 0?!e.disableColors:1!==tj();return{...Object.fromEntries(tK.map(i=>[i,(...[o,...a])=>((i,o,a=[])=>{let s;if(!t||!tQ(r,i))return;let c=(s=new Date().toISOString(),n?`${tq}${s}${t$} ${tZ[i]}${i.toUpperCase()}${t$} ${tM}[Better Auth]:${t$} ${o}`:`${s} ${i.toUpperCase()} [Better Auth]: ${o}`);e&&"function"==typeof e.log?e.log("success"===i?"info":i,o,...a):"error"===i?console.error(c,...a):"warn"===i?console.warn(c,...a):console.log(c,...a)})(i,o,a)])),get level(){return r}}},tY=tG();function tJ(e){return e?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function tX(e,t,r){let n="",i=0,o=0;for(let r of e)for(i=i<<8|r,o+=8;o>=6;)o-=6,n+=t[i>>o&63];if(o>0&&(n+=t[i<<6-o&63]),r){let e=(4-n.length%4)%4;n+="=".repeat(e)}return n}function t0(e,t){let r=new Map;for(let e=0;e<t.length;e++)r.set(t[e],e);let n=[],i=0,o=0;for(let t of e){if("="===t)break;let e=r.get(t);if(void 0===e)throw Error(`Invalid Base64 character: ${t}`);i=i<<6|e,(o+=6)>=8&&(o-=8,n.push(i>>o&255))}return Uint8Array.from(n)}let t1={encode(e,t={}){let r=tJ(!1);return tX("string"==typeof e?new TextEncoder().encode(e):new Uint8Array(e),r,t.padding??!0)},decode(e){"string"!=typeof e&&(e=new TextDecoder().decode(e));let t=tJ(e.includes("-")||e.includes("_"));return t0(e,t)}},t2={encode(e,t={}){let r=tJ(!0);return tX("string"==typeof e?new TextEncoder().encode(e):new Uint8Array(e),r,t.padding??!0)},decode(e){let t=tJ(e.includes("-")||e.includes("_"));return t0(e,t)}};var t5=Object.defineProperty,t6=Object.defineProperties,t3=Object.getOwnPropertyDescriptors,t4=Object.getOwnPropertySymbols,t8=Object.prototype.hasOwnProperty,t9=Object.prototype.propertyIsEnumerable,t7=(e,t,r)=>t in e?t5(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,re=(e,t)=>{for(var r in t||(t={}))t8.call(t,r)&&t7(e,r,t[r]);if(t4)for(var r of t4(t))t9.call(t,r)&&t7(e,r,t[r]);return e},rt=(e,t)=>t6(e,t3(t)),rr=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},rn=async(e,t)=>{var r,n,i,o,a,s;let c=t||{},d={onRequest:[null==t?void 0:t.onRequest],onResponse:[null==t?void 0:t.onResponse],onSuccess:[null==t?void 0:t.onSuccess],onError:[null==t?void 0:t.onError],onRetry:[null==t?void 0:t.onRetry]};if(!t||!(null==t?void 0:t.plugins))return{url:e,options:c,hooks:d};for(let l of(null==t?void 0:t.plugins)||[]){if(l.init){let n=await (null==(r=l.init)?void 0:r.call(l,e.toString(),t));c=n.options||c,e=n.url}d.onRequest.push(null==(n=l.hooks)?void 0:n.onRequest),d.onResponse.push(null==(i=l.hooks)?void 0:i.onResponse),d.onSuccess.push(null==(o=l.hooks)?void 0:o.onSuccess),d.onError.push(null==(a=l.hooks)?void 0:a.onError),d.onRetry.push(null==(s=l.hooks)?void 0:s.onRetry)}return{url:e,options:c,hooks:d}},ri=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},ro=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}},ra=async e=>{let t={},r=async e=>"function"==typeof e?await e():e;if(null==e?void 0:e.auth){if("Bearer"===e.auth.type){let n=await r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if("Basic"===e.auth.type){let n=r(e.auth.username),i=r(e.auth.password);if(!n||!i)return t;t.authorization=`Basic ${btoa(`${n}:${i}`)}`}else if("Custom"===e.auth.type){let n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},rs=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function rc(e){if(void 0===e)return!1;let t=typeof e;return"string"===t||"number"===t||"boolean"===t||null===t||"object"===t&&(!!Array.isArray(e)||!e.buffer&&(e.constructor&&"Object"===e.constructor.name||"function"==typeof e.toJSON))}function rd(e){try{return JSON.parse(e)}catch(t){return e}}async function rl(e){let t=new Headers(null==e?void 0:e.headers);for(let[r,n]of Object.entries(await ra(e)||{}))t.set(r,n);if(!t.has("content-type")){let r=rc(null==e?void 0:e.body)?"application/json":null;r&&t.set("content-type",r)}return t}var ru=class e extends Error{constructor(t,r){super(r||JSON.stringify(t,null,2)),this.issues=t,Object.setPrototypeOf(this,e.prototype)}};async function rp(e,t){let r=await e["~standard"].validate(t);if(r.issues)throw new ru(r.issues);return r.value}var rf=["get","post","put","patch","delete"],rh=async(e,t)=>{var r,n,i,o,a,s,c,d;let l,{hooks:u,url:p,options:f}=await rn(e,t),h=function(e){if(null==e?void 0:e.customFetchImpl)return e.customFetchImpl;if("undefined"!=typeof globalThis&&"function"==typeof globalThis.fetch)return globalThis.fetch;throw Error("No fetch implementation found")}(f),m=new AbortController,g=null!=(r=f.signal)?r:m.signal,y=function(e,t){let{baseURL:r,params:n,query:i}=t||{query:{},params:{},baseURL:""},o=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r||"";if(e.startsWith("@")){let t=e.toString().split("@")[1].split("/")[0];rf.includes(t)&&(e=e.replace(`@${t}/`,"/"))}o.endsWith("/")||(o+="/");let[a,s]=e.replace(o,"").split("?"),c=new URLSearchParams(s);for(let[e,t]of Object.entries(i||{}))null!=t&&c.set(e,String(t));if(n)if(Array.isArray(n))for(let[e,t]of a.split("/").filter(e=>e.startsWith(":")).entries()){let r=n[e];a=a.replace(t,r)}else for(let[e,t]of Object.entries(n))a=a.replace(`:${e}`,String(t));(a=a.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(a=a.slice(1));let d=c.toString();return(d=d.length>0?`?${d}`.replace(/\+/g,"%20"):"",o.startsWith("http"))?new URL(`${a}${d}`,o):`${o}${a}${d}`}(p,f),b=function(e){if(!(null==e?void 0:e.body))return null;let t=new Headers(null==e?void 0:e.headers);if(rc(e.body)&&!t.has("content-type")){for(let[t,r]of Object.entries(null==e?void 0:e.body))r instanceof Date&&(e.body[t]=r.toISOString());return JSON.stringify(e.body)}return e.body}(f),w=await rl(f),x=function(e,t){var r;if(null==t?void 0:t.method)return t.method.toUpperCase();if(e.startsWith("@")){let n=null==(r=e.split("@")[1])?void 0:r.split("/")[0];return rf.includes(n)?n.toUpperCase():(null==t?void 0:t.body)?"POST":"GET"}return(null==t?void 0:t.body)?"POST":"GET"}(p,f),v=rt(re({},f),{url:y,headers:w,body:b,method:x,signal:g});for(let e of u.onRequest)if(e){let t=await e(v);t instanceof Object&&(v=t)}("pipeTo"in v&&"function"==typeof v.pipeTo||"function"==typeof(null==(n=null==t?void 0:t.body)?void 0:n.pipe))&&!("duplex"in v)&&(v.duplex="half");let{clearTimeout:_}=(!(null==f?void 0:f.signal)&&(null==f?void 0:f.timeout)&&(l=setTimeout(()=>null==m?void 0:m.abort(),null==f?void 0:f.timeout)),{abortTimeout:l,clearTimeout:()=>{l&&clearTimeout(l)}}),E=await h(v.url,v);_();let T={response:E,request:v};for(let e of u.onResponse)if(e){let r=await e(rt(re({},T),{response:(null==(i=null==t?void 0:t.hookOptions)?void 0:i.cloneResponse)?E.clone():E}));r instanceof Response?E=r:r instanceof Object&&(E=r.response)}if(E.ok){if("HEAD"===v.method)return{data:"",error:null};let e=function(e){let t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";let n=t.split(";").shift()||"";return rs.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}(E),r={data:"",response:E,request:v};if("json"===e||"text"===e){let e=await E.text(),t=null!=(o=v.jsonParser)?o:rd;r.data=await t(e)}else r.data=await E[e]();for(let e of((null==v?void 0:v.output)&&v.output&&!v.disableValidation&&(r.data=await rp(v.output,r.data)),u.onSuccess))e&&await e(rt(re({},r),{response:(null==(a=null==t?void 0:t.hookOptions)?void 0:a.cloneResponse)?E.clone():E}));return(null==t?void 0:t.throw)?r.data:{data:r.data,error:null}}let A=null!=(s=null==t?void 0:t.jsonParser)?s:rd,S=await E.text(),R=function(e){try{return JSON.parse(e),!0}catch(e){return!1}}(S),O=R?await A(S):null,I={response:E,responseText:S,request:v,error:rt(re({},O),{status:E.status,statusText:E.statusText})};for(let e of u.onError)e&&await e(rt(re({},I),{response:(null==(c=null==t?void 0:t.hookOptions)?void 0:c.cloneResponse)?E.clone():E}));if(null==t?void 0:t.retry){let r=function(e){if("number"==typeof e)return new ri({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new ri(e);case"exponential":return new ro(e);default:throw Error("Invalid retry strategy")}}(t.retry),n=null!=(d=t.retryAttempt)?d:0;if(await r.shouldAttemptRetry(n,E)){for(let e of u.onRetry)e&&await e(T);let i=r.getDelay(n);return await new Promise(e=>setTimeout(e,i)),await rh(e,rt(re({},t),{retryAttempt:n+1}))}}if(null==t?void 0:t.throw)throw new rr(E.status,E.statusText,R?O:S);return{data:null,error:rt(re({},O),{status:E.status,statusText:E.statusText})}};let rm=new TextEncoder,rg=new TextDecoder;function ry(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let n of e)t.set(n,r),r+=n.length;return t}function rb(e){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof e?e:rg.decode(e),{alphabet:"base64url"});let t=e;t instanceof Uint8Array&&(t=rg.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{var r=t;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(r);let e=atob(r),n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function rw(e){let t=e;return("string"==typeof t&&(t=rm.encode(t)),Uint8Array.prototype.toBase64)?t.toBase64({alphabet:"base64url",omitPadding:!0}):(function(e){if(Uint8Array.prototype.toBase64)return e.toBase64();let t=[];for(let r=0;r<e.length;r+=32768)t.push(String.fromCharCode.apply(null,e.subarray(r,r+32768)));return btoa(t.join(""))})(t).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}class rx extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class rv extends rx{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class r_ extends rx{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",n="unspecified"){super(e,{cause:{claim:r,reason:n,payload:t}}),this.claim=r,this.reason=n,this.payload=t}}class rE extends rx{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class rT extends rx{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class rA extends rx{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class rS extends rx{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class rR extends rx{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class rO extends rx{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t)}}class rI extends rx{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class rk extends rx{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(e="request timed out",t){super(e,t)}}class rN extends rx{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}let rP=(e,t)=>{let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:parseInt(e.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:e};default:throw new rT(`alg ${e} is not supported either by JOSE or your javascript runtime`)}},rU=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}};function rC(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function rD(e,t){return e.name===t}function rL(e){return parseInt(e.name.slice(4),10)}function rj(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}function r$(e,t,...r){return rj(`Key for the ${e} algorithm must be `,t,...r)}let rM=async(e,t,r)=>{if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(((e,...t)=>rj("Key must be ",e,...t))(t,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}return!function(e,t,r){switch(t){case"HS256":case"HS384":case"HS512":{if(!rD(e.algorithm,"HMAC"))throw rC("HMAC");let r=parseInt(t.slice(2),10);if(rL(e.algorithm.hash)!==r)throw rC(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!rD(e.algorithm,"RSASSA-PKCS1-v1_5"))throw rC("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(rL(e.algorithm.hash)!==r)throw rC(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!rD(e.algorithm,"RSA-PSS"))throw rC("RSA-PSS");let r=parseInt(t.slice(2),10);if(rL(e.algorithm.hash)!==r)throw rC(`SHA-${r}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if(!rD(e.algorithm,"Ed25519"))throw rC("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":if(!rD(e.algorithm,t))throw rC(t);break;case"ES256":case"ES384":case"ES512":{if(!rD(e.algorithm,"ECDSA"))throw rC("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw rC(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(r&&!e.usages.includes(r))throw TypeError(`CryptoKey does not support this operation, its usages must include ${r}.`)}(t,e,r),t},rq=async(e,t,r,n)=>{let i=await rM(e,t,"verify");rU(e,i);let o=rP(e,i.algorithm);try{return await crypto.subtle.verify(o,i,r,n)}catch{return!1}},rV=(...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0},rB=e=>{if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t};function rz(e){return e?.[Symbol.toStringTag]==="CryptoKey"}function rW(e){return e?.[Symbol.toStringTag]==="KeyObject"}let rH=e=>rz(e)||rW(e);function rF(e){return rB(e)&&"string"==typeof e.kty}let rK=e=>e?.[Symbol.toStringTag],rQ=(e,t,r)=>{if(void 0!==t.use){let e;switch(r){case"sign":case"verify":e="sig";break;case"encrypt":case"decrypt":e="enc"}if(t.use!==e)throw TypeError(`Invalid key for this operation, its "use" must be "${e}" when present`)}if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, its "alg" must be "${e}" when present`);if(Array.isArray(t.key_ops)){let n;switch(!0){case"sign"===r||"verify"===r:case"dir"===e:case e.includes("CBC-HS"):n=r;break;case e.startsWith("PBES2"):n="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(e):n=!e.includes("GCM")&&e.endsWith("KW")?"encrypt"===r?"wrapKey":"unwrapKey":r;break;case"encrypt"===r&&e.startsWith("RSA"):n="wrapKey";break;case"decrypt"===r:n=e.startsWith("RSA")?"unwrapKey":"deriveBits"}if(n&&t.key_ops?.includes?.(n)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${n}" when present`)}return!0},rZ=(e,t,r)=>{e.startsWith("HS")||"dir"===e||e.startsWith("PBES2")||/^A(?:128|192|256)(?:GCM)?(?:KW)?$/.test(e)||/^A(?:128|192|256)CBC-HS(?:256|384|512)$/.test(e)?((e,t,r)=>{if(!(t instanceof Uint8Array)){if(rF(t)){if("oct"===t.kty&&"string"==typeof t.k&&rQ(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!rH(t))throw TypeError(r$(e,t,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==t.type)throw TypeError(`${rK(t)} instances for symmetric algorithms must be of type "secret"`)}})(e,t,r):((e,t,r)=>{if(rF(t))switch(r){case"decrypt":case"sign":if("oct"!==t.kty&&("AKP"===t.kty&&"string"==typeof t.priv||"string"==typeof t.d)&&rQ(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"encrypt":case"verify":if("oct"!==t.kty&&void 0===t.d&&void 0===t.priv&&rQ(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!rH(t))throw TypeError(r$(e,t,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===t.type)throw TypeError(`${rK(t)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===t.type)switch(r){case"sign":throw TypeError(`${rK(t)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${rK(t)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===t.type)switch(r){case"verify":throw TypeError(`${rK(t)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${rK(t)} instances for asymmetric algorithm encryption must be of type "public"`)}})(e,t,r)},rG=(e,t,r,n,i)=>{let o;if(void 0!==i.crit&&n?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!n||void 0===n.crit)return new Set;if(!Array.isArray(n.crit)||0===n.crit.length||n.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(o=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,n.crit)){if(!o.has(a))throw new rT(`Extension Header Parameter "${a}" is not recognized`);if(void 0===i[a])throw new e(`Extension Header Parameter "${a}" is missing`);if(o.get(a)&&void 0===n[a])throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(n.crit)},rY=async e=>{if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"AKP":switch(e.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":t={name:e.alg},r=e.priv?["sign"]:["verify"];break;default:throw new rT('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new rT('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new rT('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":case"EdDSA":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new rT('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new rT('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),n={...e};return"AKP"!==n.kty&&delete n.alg,delete n.use,crypto.subtle.importKey("jwk",n,t,e.ext??(!e.d&&!e.priv),e.key_ops??r)},rJ=async(e,t,n,i=!1)=>{let o=(r||=new WeakMap).get(e);if(o?.[n])return o[n];let a=await rY({...t,alg:n});return i&&Object.freeze(e),o?o[n]=a:r.set(e,{[n]:a}),a},rX=async(e,t)=>{if(e instanceof Uint8Array||rz(e))return e;if(rW(e)){if("secret"===e.type)return e.export();if("toCryptoKey"in e&&"function"==typeof e.toCryptoKey)try{return((e,t)=>{let n,i=(r||=new WeakMap).get(e);if(i?.[t])return i[t];let o="public"===e.type,a=!!o;if("x25519"===e.asymmetricKeyType){switch(t){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}n=e.toCryptoKey(e.asymmetricKeyType,a,o?[]:["deriveBits"])}if("ed25519"===e.asymmetricKeyType){if("EdDSA"!==t&&"Ed25519"!==t)throw TypeError("given KeyObject instance cannot be used for this algorithm");n=e.toCryptoKey(e.asymmetricKeyType,a,[o?"verify":"sign"])}switch(e.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(t!==e.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");n=e.toCryptoKey(e.asymmetricKeyType,a,[o?"verify":"sign"])}if("rsa"===e.asymmetricKeyType){let r;switch(t){case"RSA-OAEP":r="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":r="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":r="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":r="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(t.startsWith("RSA-OAEP"))return e.toCryptoKey({name:"RSA-OAEP",hash:r},a,o?["encrypt"]:["decrypt"]);n=e.toCryptoKey({name:t.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:r},a,[o?"verify":"sign"])}if("ec"===e.asymmetricKeyType){let r=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(e.asymmetricKeyDetails?.namedCurve);if(!r)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===t&&"P-256"===r&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[o?"verify":"sign"])),"ES384"===t&&"P-384"===r&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[o?"verify":"sign"])),"ES512"===t&&"P-521"===r&&(n=e.toCryptoKey({name:"ECDSA",namedCurve:r},a,[o?"verify":"sign"])),t.startsWith("ECDH-ES")&&(n=e.toCryptoKey({name:"ECDH",namedCurve:r},a,o?[]:["deriveBits"]))}if(!n)throw TypeError("given KeyObject instance cannot be used for this algorithm");return i?i[t]=n:r.set(e,{[t]:n}),n})(e,t)}catch(e){if(e instanceof TypeError)throw e}let n=e.export({format:"jwk"});return rJ(e,n,t)}if(rF(e))return e.k?rb(e.k):rJ(e,e,t,!0);throw Error("unreachable")};async function r0(e,t,r){let n,i;if(!rB(e))throw new rA("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new rA('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new rA("JWS Protected Header incorrect type");if(void 0===e.payload)throw new rA("JWS Payload missing");if("string"!=typeof e.signature)throw new rA("JWS Signature missing or incorrect type");if(void 0!==e.header&&!rB(e.header))throw new rA("JWS Unprotected Header incorrect type");let o={};if(e.protected)try{let t=rb(e.protected);o=JSON.parse(rg.decode(t))}catch{throw new rA("JWS Protected Header is invalid")}if(!rV(o,e.header))throw new rA("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let a={...o,...e.header},s=rG(rA,new Map([["b64",!0]]),r?.crit,o,a),c=!0;if(s.has("b64")&&"boolean"!=typeof(c=o.b64))throw new rA('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:d}=a;if("string"!=typeof d||!d)throw new rA('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=r&&((e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)})("algorithms",r.algorithms);if(l&&!l.has(d))throw new rE('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new rA("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new rA("JWS Payload must be a string or an Uint8Array instance");let u=!1;"function"==typeof t&&(t=await t(o,e),u=!0),rZ(d,t,"verify");let p=ry(rm.encode(e.protected??""),rm.encode("."),"string"==typeof e.payload?rm.encode(e.payload):e.payload);try{n=rb(e.signature)}catch{throw new rA("Failed to base64url decode the signature")}let f=await rX(t,d);if(!await rq(d,f,n,p))throw new rN;if(c)try{i=rb(e.payload)}catch{throw new rA("Failed to base64url decode the payload")}else i="string"==typeof e.payload?rm.encode(e.payload):e.payload;let h={payload:i};return(void 0!==e.protected&&(h.protectedHeader=o),void 0!==e.header&&(h.unprotectedHeader=e.header),u)?{...h,key:f}:h}async function r1(e,t,r){if(e instanceof Uint8Array&&(e=rg.decode(e)),"string"!=typeof e)throw new rA("Compact JWS must be a string or Uint8Array");let{0:n,1:i,2:o,length:a}=e.split(".");if(3!==a)throw new rA("Invalid Compact JWS");let s=await r0({payload:i,protected:n,signature:o},t,r),c={payload:s.payload,protectedHeader:s.protectedHeader};return"function"==typeof t?{...c,key:s.key}:c}let r2=e=>Math.floor(e.getTime()/1e3),r5=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,r6=e=>{let t,r=r5.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let n=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(n);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*n);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*n);break;case"day":case"days":case"d":t=Math.round(86400*n);break;case"week":case"weeks":case"w":t=Math.round(604800*n);break;default:t=Math.round(0x1e187e0*n)}return"-"===r[1]||"ago"===r[4]?-t:t};function r3(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}let r4=e=>e.includes("/")?e.toLowerCase():`application/${e.toLowerCase()}`;class r8{#e;constructor(e){if(!rB(e))throw TypeError("JWT Claims Set MUST be an object");this.#e=structuredClone(e)}data(){return rm.encode(JSON.stringify(this.#e))}get iss(){return this.#e.iss}set iss(e){this.#e.iss=e}get sub(){return this.#e.sub}set sub(e){this.#e.sub=e}get aud(){return this.#e.aud}set aud(e){this.#e.aud=e}set jti(e){this.#e.jti=e}set nbf(e){"number"==typeof e?this.#e.nbf=r3("setNotBefore",e):e instanceof Date?this.#e.nbf=r3("setNotBefore",r2(e)):this.#e.nbf=r2(new Date)+r6(e)}set exp(e){"number"==typeof e?this.#e.exp=r3("setExpirationTime",e):e instanceof Date?this.#e.exp=r3("setExpirationTime",r2(e)):this.#e.exp=r2(new Date)+r6(e)}set iat(e){void 0===e?this.#e.iat=r2(new Date):e instanceof Date?this.#e.iat=r3("setIssuedAt",r2(e)):"string"==typeof e?this.#e.iat=r3("setIssuedAt",r2(new Date)+r6(e)):this.#e.iat=r3("setIssuedAt",e)}}async function r9(e,t,r){let n=await r1(e,t,r);if(n.protectedHeader.crit?.includes("b64")&&!1===n.protectedHeader.b64)throw new rS("JWTs MUST NOT use unencoded payload");let i={payload:function(e,t,r={}){var n,i;let o,a;try{o=JSON.parse(rg.decode(t))}catch{}if(!rB(o))throw new rS("JWT Claims Set must be a top-level JSON object");let{typ:s}=r;if(s&&("string"!=typeof e.typ||r4(e.typ)!==r4(s)))throw new rv('unexpected "typ" JWT header value',o,"typ","check_failed");let{requiredClaims:c=[],issuer:d,subject:l,audience:u,maxTokenAge:p}=r,f=[...c];for(let e of(void 0!==p&&f.push("iat"),void 0!==u&&f.push("aud"),void 0!==l&&f.push("sub"),void 0!==d&&f.push("iss"),new Set(f.reverse())))if(!(e in o))throw new rv(`missing required "${e}" claim`,o,e,"missing");if(d&&!(Array.isArray(d)?d:[d]).includes(o.iss))throw new rv('unexpected "iss" claim value',o,"iss","check_failed");if(l&&o.sub!==l)throw new rv('unexpected "sub" claim value',o,"sub","check_failed");if(u&&(n=o.aud,i="string"==typeof u?[u]:u,"string"==typeof n?!i.includes(n):!(Array.isArray(n)&&i.some(Set.prototype.has.bind(new Set(n))))))throw new rv('unexpected "aud" claim value',o,"aud","check_failed");switch(typeof r.clockTolerance){case"string":a=r6(r.clockTolerance);break;case"number":a=r.clockTolerance;break;case"undefined":a=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:h}=r,m=r2(h||new Date);if((void 0!==o.iat||p)&&"number"!=typeof o.iat)throw new rv('"iat" claim must be a number',o,"iat","invalid");if(void 0!==o.nbf){if("number"!=typeof o.nbf)throw new rv('"nbf" claim must be a number',o,"nbf","invalid");if(o.nbf>m+a)throw new rv('"nbf" claim timestamp check failed',o,"nbf","check_failed")}if(void 0!==o.exp){if("number"!=typeof o.exp)throw new rv('"exp" claim must be a number',o,"exp","invalid");if(o.exp<=m-a)throw new r_('"exp" claim timestamp check failed',o,"exp","check_failed")}if(p){let e=m-o.iat;if(e-a>("number"==typeof p?p:r6(p)))throw new r_('"iat" claim timestamp check failed (too far in the past)',o,"iat","check_failed");if(e<0-a)throw new rv('"iat" claim timestamp check failed (it should be in the past)',o,"iat","check_failed")}return o}(n.protectedHeader,n.payload,r),protectedHeader:n.protectedHeader};return"function"==typeof t?{...i,key:n.key}:i}function r7(e){let t=e=>new Date(new Date().getTime()+1e3*e);return{tokenType:e.token_type,accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?t(e.expires_in):void 0,refreshTokenExpiresAt:e.refresh_token_expires_in?t(e.refresh_token_expires_in):void 0,scopes:e?.scope?"string"==typeof e.scope?e.scope.split(" "):e.scope:[],idToken:e.id_token}}async function ne(e){let t=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",t);return t2.encode(new Uint8Array(r),{padding:!1})}async function nt({id:e,options:t,authorizationEndpoint:r,state:n,codeVerifier:i,scopes:o,claims:a,redirectURI:s,duration:c,prompt:d,accessType:l,responseType:u,display:p,loginHint:f,hd:h,responseMode:m,additionalParams:g,scopeJoiner:y}){let b=new URL(r);b.searchParams.set("response_type",u||"code");let w=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;if(b.searchParams.set("client_id",w),b.searchParams.set("state",n),b.searchParams.set("scope",o.join(y||" ")),b.searchParams.set("redirect_uri",t.redirectURI||s),c&&b.searchParams.set("duration",c),p&&b.searchParams.set("display",p),f&&b.searchParams.set("login_hint",f),d&&b.searchParams.set("prompt",d),h&&b.searchParams.set("hd",h),l&&b.searchParams.set("access_type",l),m&&b.searchParams.set("response_mode",m),i){let e=await ne(i);b.searchParams.set("code_challenge_method","S256"),b.searchParams.set("code_challenge",e)}if(a){let e=a.reduce((e,t)=>(e[t]=null,e),{});b.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...e}}))}return g&&Object.entries(g).forEach(([e,t])=>{b.searchParams.set(e,t)}),b}async function nr({code:e,codeVerifier:t,redirectURI:r,options:n,tokenEndpoint:i,authentication:o,deviceId:a,headers:s,additionalParams:c={},resource:d}){let{body:l,headers:u}=function({code:e,codeVerifier:t,redirectURI:r,options:n,authentication:i,deviceId:o,headers:a,additionalParams:s={},resource:c}){let d=new URLSearchParams,l={"content-type":"application/x-www-form-urlencoded",accept:"application/json","user-agent":"better-auth",...a};if(d.set("grant_type","authorization_code"),d.set("code",e),t&&d.set("code_verifier",t),n.clientKey&&d.set("client_key",n.clientKey),o&&d.set("device_id",o),d.set("redirect_uri",n.redirectURI||r),c)if("string"==typeof c)d.append("resource",c);else for(let e of c)d.append("resource",e);if("basic"===i){let e=Array.isArray(n.clientId)?n.clientId[0]:n.clientId,t=t1.encode(`${e}:${n.clientSecret??""}`);l.authorization=`Basic ${t}`}else{let e=Array.isArray(n.clientId)?n.clientId[0]:n.clientId;d.set("client_id",e),n.clientSecret&&d.set("client_secret",n.clientSecret)}for(let[e,t]of Object.entries(s))d.has(e)||d.append(e,t);return{body:d,headers:l}}({code:e,codeVerifier:t,redirectURI:r,options:n,authentication:o,deviceId:a,headers:s,additionalParams:c,resource:d}),{data:p,error:f}=await rh(i,{method:"POST",body:l,headers:u});if(f)throw f;return r7(p)}async function nn({refreshToken:e,options:t,tokenEndpoint:r,authentication:n,extraParams:i}){let{body:o,headers:a}=function({refreshToken:e,options:t,authentication:r,extraParams:n,resource:i}){let o=new URLSearchParams,a={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(o.set("grant_type","refresh_token"),o.set("refresh_token",e),"basic"===r){let e=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;e?a.authorization="Basic "+t1.encode(`${e}:${t.clientSecret??""}`):a.authorization="Basic "+t1.encode(`:${t.clientSecret??""}`)}else{let e=Array.isArray(t.clientId)?t.clientId[0]:t.clientId;o.set("client_id",e),t.clientSecret&&o.set("client_secret",t.clientSecret)}if(i)if("string"==typeof i)o.append("resource",i);else for(let e of i)o.append("resource",e);if(n)for(let[e,t]of Object.entries(n))o.set(e,t);return{body:o,headers:a}}({refreshToken:e,options:t,authentication:n,extraParams:i}),{data:s,error:c}=await rh(r,{method:"POST",body:o,headers:a});if(c)throw c;let d={accessToken:s.access_token,refreshToken:s.refresh_token,tokenType:s.token_type,scopes:s.scope?.split(" "),idToken:s.id_token};return s.expires_in&&(d.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*s.expires_in)),d}let ni={USER_NOT_FOUND:"User not found",FAILED_TO_CREATE_USER:"Failed to create user",FAILED_TO_CREATE_SESSION:"Failed to create session",FAILED_TO_UPDATE_USER:"Failed to update user",FAILED_TO_GET_SESSION:"Failed to get session",INVALID_PASSWORD:"Invalid password",INVALID_EMAIL:"Invalid email",INVALID_EMAIL_OR_PASSWORD:"Invalid email or password",SOCIAL_ACCOUNT_ALREADY_LINKED:"Social account already linked",PROVIDER_NOT_FOUND:"Provider not found",INVALID_TOKEN:"Invalid token",ID_TOKEN_NOT_SUPPORTED:"id_token not supported",FAILED_TO_GET_USER_INFO:"Failed to get user info",USER_EMAIL_NOT_FOUND:"User email not found",EMAIL_NOT_VERIFIED:"Email not verified",PASSWORD_TOO_SHORT:"Password too short",PASSWORD_TOO_LONG:"Password too long",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",EMAIL_CAN_NOT_BE_UPDATED:"Email can not be updated",CREDENTIAL_ACCOUNT_NOT_FOUND:"Credential account not found",SESSION_EXPIRED:"Session expired. Re-authenticate to perform this action.",FAILED_TO_UNLINK_LAST_ACCOUNT:"You can't unlink your last account",ACCOUNT_NOT_FOUND:"Account not found",USER_ALREADY_HAS_PASSWORD:"User already has a password. Provide that to delete the account."};class no extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}}function na(){let e="undefined"!=typeof globalThis&&globalThis.crypto;if(e&&"object"==typeof e.subtle&&null!=e.subtle)return e.subtle;throw Error("crypto.subtle must be defined")}let ns=((c=function(){}).prototype=Object.create(null),c);function nc(){return{root:{key:""},static:new ns}}function nd(e){return e.split("/").filter(Boolean)}function nl(e,t){let r=new ns;for(let[n,i]of t){let t=n<0?e.slice(-1*n).join("/"):e[n];if("string"==typeof i)r[i]=t;else{let e=t.match(i);if(e)for(let t in e.groups)r[t]=e.groups[t]}}return r}function nu(e,t="",r,n){let i=nd(r),o=e.root,a=0,s=[];for(let e=0;e<i.length;e++){let t=i[e];if(t.startsWith("**")){o.wildcard||(o.wildcard={key:"**"}),o=o.wildcard,s.push([-e,t.split(":")[1]||"_",2===t.length]);break}if("*"===t||t.includes(":")){o.param||(o.param={key:"*"}),o=o.param;let r="*"===t;s.push([e,r?`_${a++}`:function(e){if(!e.includes(":",1))return e.slice(1);let t=e.replace(/:(\w+)/g,(e,t)=>`(?<${t}>\\w+)`);return RegExp(`^${t}$`)}(t),r]);continue}let r=o.static?.[t];if(r)o=r;else{let e={key:t};o.static||(o.static=new ns),o.static[t]=e,o=e}}let c=s.length>0;o.methods||(o.methods=new ns),o.methods[t]||(o.methods[t]=[]),o.methods[t].push({data:n||null,paramsMap:c?s:void 0}),c||(e.static[r]=o)}var np=Object.defineProperty,nf={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511},nh=function(e,t){class r extends e{#t;constructor(...e){if(function(){let e=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");return void 0===e?Object.isExtensible(Error):Object.prototype.hasOwnProperty.call(e,"writable")?e.writable:void 0!==e.set}()){const t=Error.stackTraceLimit;Error.stackTraceLimit=0,super(...e),Error.stackTraceLimit=t}else super(...e);const t=Error().stack;t&&(this.#t=function(e){let t=e.split("\n    at ");return t.length<=1?e:(t.splice(1,1),t.join("\n    at "))}(t.replace(/^Error/,this.name)))}get errorStack(){return this.#t}}return Object.defineProperty(r.prototype,"constructor",{get:()=>t,enumerable:!1,configurable:!0}),r}(class extends Error{constructor(e="INTERNAL_SERVER_ERROR",t,r={},n="number"==typeof e?e:nf[e]){super(t?.message,t?.cause?{cause:t.cause}:void 0),this.status=e,this.body=t,this.headers=r,this.statusCode=n,this.name="APIError",this.status=e,this.headers=r,this.statusCode=n,this.body=t?{code:t?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...t}:void 0}},Error);async function nm(e){let t=e.headers.get("content-type")||"";if(e.body){if(t.includes("application/json"))return await e.json();if(t.includes("application/x-www-form-urlencoded")){let t=await e.formData(),r={};return t.forEach((e,t)=>{r[t]=e.toString()}),r}if(t.includes("multipart/form-data")){let t=await e.formData(),r={};return t.forEach((e,t)=>{r[t]=e}),r}return t.includes("text/plain")?await e.text():t.includes("application/octet-stream")?await e.arrayBuffer():t.includes("application/pdf")||t.includes("image/")||t.includes("video/")?await e.blob():t.includes("application/stream")||e.body instanceof ReadableStream?e.body:await e.text()}}function ng(e){return e instanceof nh||e?.name==="APIError"}function ny(e,t){if(e instanceof Response)return t?.headers instanceof Headers&&t.headers.forEach((t,r)=>{e.headers.set(r,t)}),e;if(e&&"object"==typeof e&&"_flag"in e&&"json"===e._flag){let r=e.body,n=e.routerResponse;if(n instanceof Response)return n;let i=new Headers({...n?.headers,...e.headers,...t?.headers,"Content-Type":"application/json"});return new Response(JSON.stringify(r),{...n,headers:i,status:e.status??t?.status??n?.status,statusText:t?.statusText??n?.statusText})}if(ng(e))return ny(e.body,{status:t?.status??e.statusCode,statusText:e.status.toString(),headers:t?.headers||e.headers});let r=e,n=new Headers(t?.headers);if(e){if("string"==typeof e)r=e,n.set("Content-Type","text/plain");else if(e instanceof ArrayBuffer||ArrayBuffer.isView(e))r=e,n.set("Content-Type","application/octet-stream");else if(e instanceof Blob)r=e,n.set("Content-Type",e.type||"application/octet-stream");else if(e instanceof FormData)r=e;else if(e instanceof URLSearchParams)r=e,n.set("Content-Type","application/x-www-form-urlencoded");else if(e instanceof ReadableStream)r=e,n.set("Content-Type","application/octet-stream");else if(function(e){if(void 0===e)return!1;let t=typeof e;return"string"===t||"number"===t||"boolean"===t||null===t||"object"===t&&(!!Array.isArray(e)||!e.buffer&&(e.constructor&&"Object"===e.constructor.name||"function"==typeof e.toJSON))}(e)){let t,i;t=0,i=new WeakMap,r=JSON.stringify(e,(e,r)=>{if("bigint"==typeof r)return r.toString();if("object"==typeof r&&null!==r){if(i.has(r))return`[Circular ref-${i.get(r)}]`;i.set(r,t++)}return r},void 0),n.set("Content-Type","application/json")}}else null===e&&(r=JSON.stringify(null)),n.set("content-type","application/json");return new Response(r,{...t,headers:n})}async function nb(e,t={}){let r={body:t.body,query:t.query};if(e.body){let n=await e.body["~standard"].validate(t.body);if(n.issues)return{data:null,error:nw(n.issues,"body")};r.body=n.value}if(e.query){let n=await e.query["~standard"].validate(t.query);if(n.issues)return{data:null,error:nw(n.issues,"query")};r.query=n.value}return e.requireHeaders&&!t.headers?{data:null,error:{message:"Headers is required"}}:e.requireRequest&&!t.request?{data:null,error:{message:"Request is required"}}:{data:r,error:null}}function nw(e,t){let r=[];for(let t of e){let e=t.message;r.push(e)}return{message:`Invalid ${t} parameters`}}var nx={name:"HMAC",hash:"SHA-256"},nv=async e=>{let t="string"==typeof e?new TextEncoder().encode(e):e;return await na().importKey("raw",t,nx,!1,["sign","verify"])},n_=async(e,t,r)=>{try{let n=atob(e),i=new Uint8Array(n.length);for(let e=0,t=n.length;e<t;e++)i[e]=n.charCodeAt(e);return await na().verify(nx,r,i,new TextEncoder().encode(t))}catch(e){return!1}},nE=async(e,t)=>{let r=await nv(t);return btoa(String.fromCharCode(...new Uint8Array(await na().sign(nx.name,r,new TextEncoder().encode(e)))))},nT=async(e,t)=>{let r=await nE(e,t);return encodeURIComponent(e=`${e}.${r}`)},nA=(e,t)=>{let r=e;if(t)if("secure"===t)r="__Secure-"+e;else{if("host"!==t)return;r="__Host-"+e}return r},nS=(e,t,r={})=>{let n;if(n=r?.prefix==="secure"?`__Secure-${e}=${t}`:r?.prefix==="host"?`__Host-${e}=${t}`:`${e}=${t}`,e.startsWith("__Secure-")&&!r.secure&&(r.secure=!0),e.startsWith("__Host-")&&(r.secure||(r.secure=!0),"/"!==r.path&&(r.path="/"),r.domain&&(r.domain=void 0)),r&&"number"==typeof r.maxAge&&r.maxAge>=0){if(r.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");n+=`; Max-Age=${Math.floor(r.maxAge)}`}if(r.domain&&"host"!==r.prefix&&(n+=`; Domain=${r.domain}`),r.path&&(n+=`; Path=${r.path}`),r.expires){if(r.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");n+=`; Expires=${r.expires.toUTCString()}`}return r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.sameSite&&(n+=`; SameSite=${r.sameSite.charAt(0).toUpperCase()+r.sameSite.slice(1)}`),r.partitioned&&(r.secure||(r.secure=!0),n+="; Partitioned"),n},nR=async(e,t,r,n)=>nS(e,t=await nT(t,r),n),nO=async(e,{options:t,path:r})=>{let n=new Headers,{data:i,error:o}=await nb(t,e);if(o)throw new nh(400,{message:o.message,code:"VALIDATION_ERROR"});let a="headers"in e?e.headers instanceof Headers?e.headers:new Headers(e.headers):"request"in e&&e.request instanceof Request?e.request.headers:null,s=a?.get("cookie"),c=s?function(e){if("string"!=typeof e)throw TypeError("argument str must be a string");let t=new Map,r=0;for(;r<e.length;){let n=e.indexOf("=",r);if(-1===n)break;let i=e.indexOf(";",r);if(-1===i)i=e.length;else if(i<n){r=e.lastIndexOf(";",n-1)+1;continue}let o=e.slice(r,n).trim();if(!t.has(o)){let r=e.slice(n+1,i).trim();34===r.codePointAt(0)&&(r=r.slice(1,-1)),t.set(o,function(e){try{return e.includes("%")?decodeURIComponent(e):e}catch{return e}}(r))}r=i+1}return t}(s):void 0,d={...e,body:i.body,query:i.query,path:e.path||r,context:"context"in e&&e.context?e.context:{},returned:void 0,headers:e?.headers,request:e?.request,params:"params"in e?e.params:void 0,method:e.method,setHeader:(e,t)=>{n.set(e,t)},getHeader:e=>a?a.get(e):null,getCookie:(e,t)=>{let r=nA(e,t);return r&&c?.get(r)||null},getSignedCookie:async(e,t,r)=>{let n=nA(e,r);if(!n)return null;let i=c?.get(n);if(!i)return null;let o=i.lastIndexOf(".");if(o<1)return null;let a=i.substring(0,o),s=i.substring(o+1);if(44!==s.length||!s.endsWith("="))return null;let d=await nv(t);return!!await n_(s,a,d)&&a},setCookie:(e,t,r)=>{var i;let o=nS(e,i=encodeURIComponent(i=t),r);return n.append("set-cookie",o),o},setSignedCookie:async(e,t,r,i)=>{let o=await nR(e,t,r,i);return n.append("set-cookie",o),o},redirect:e=>(n.set("location",e),new nh("FOUND",void 0,n)),error:(e,t,r)=>new nh(e,t,r),json:(t,r)=>e.asResponse?{body:r?.body||t,routerResponse:r,_flag:"json"}:t,responseHeaders:n};for(let e of t.use||[]){let t=await e({...d,returnHeaders:!0,asResponse:!1});t.response&&Object.assign(d.context,t.response),t.headers&&t.headers.forEach((e,t)=>{d.responseHeaders.set(t,e)})}return d};function nI(e,t){let r=async r=>{let n="function"==typeof e?e:t,i=await nO(r,{options:"function"==typeof e?{}:e,path:"/"});if(!n)throw Error("handler must be defined");let o=await n(i),a=i.responseHeaders;return r.returnHeaders?{headers:a,response:o}:o};return r.options="function"==typeof e?{}:e,r}nI.create=e=>function(t,r){if("function"==typeof t)return nI({use:e?.use},t);if(!r)throw Error("Middleware handler is required");return nI({...t,method:"*",use:[...e?.use||[],...t.use||[]]},r)};var nk=(e,t,r)=>{let n=async(...n)=>{let i=n[0]||{},o=await nO(i,{options:t,path:e}),a=await r(o).catch(async e=>{if(ng(e)){let r=t.onAPIError;if(r&&await r(e),i.asResponse)return e}throw e}),s=o.responseHeaders;return i.asResponse?ny(a,{headers:s}):i.returnHeaders?{headers:s,response:a}:a};return n.options=t,n.path=e,n};function nN(e,t,r){function n(r,n){var i;for(let o in Object.defineProperty(r,"_zod",{value:r._zod??{},enumerable:!1}),(i=r._zod).traits??(i.traits=new Set),r._zod.traits.add(e),t(r,n),a.prototype)o in r||Object.defineProperty(r,o,{value:a.prototype[o].bind(r)});r._zod.constr=a,r._zod.def=n}let i=r?.Parent??Object;class o extends i{}function a(e){var t;let i=r?.Parent?new o:this;for(let r of(n(i,e),(t=i._zod).deferred??(t.deferred=[]),i._zod.deferred))r();return i}return Object.defineProperty(o,"name",{value:e}),Object.defineProperty(a,"init",{value:n}),Object.defineProperty(a,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(a,"name",{value:e}),a}nk.create=e=>(t,r,n)=>nk(t,{...r,use:[...r?.use||[],...e?.use||[]]},n),Object.freeze({status:"aborted"}),Symbol("zod_brand");var nP=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}},nU={};function nC(e){return e&&Object.assign(nU,e),nU}var nD={},nL={BIGINT_FORMAT_RANGES:()=>ic,Class:()=>iT,NUMBER_FORMAT_RANGES:()=>is,aborted:()=>ig,allowsEval:()=>n6,assert:()=>nB,assertEqual:()=>n$,assertIs:()=>nq,assertNever:()=>nV,assertNotEqual:()=>nM,assignProp:()=>nY,cached:()=>nF,captureStackTrace:()=>n2,cleanEnum:()=>iE,cleanRegex:()=>nQ,clone:()=>it,createTransparentProxy:()=>ii,defineLazy:()=>nG,esc:()=>n1,escapeRegex:()=>ie,extend:()=>iu,finalizeIssue:()=>iw,floatSafeRemainder:()=>nZ,getElementAtPath:()=>nJ,getEnumValues:()=>nz,getLengthableOrigin:()=>iv,getParsedType:()=>n8,getSizableOrigin:()=>ix,isObject:()=>n5,isPlainObject:()=>n3,issue:()=>i_,joinValues:()=>nW,jsonStringifyReplacer:()=>nH,merge:()=>ip,normalizeParams:()=>ir,nullish:()=>nK,numKeys:()=>n4,omit:()=>il,optionalKeys:()=>ia,partial:()=>ih,pick:()=>id,prefixIssues:()=>iy,primitiveTypes:()=>n7,promiseAllObject:()=>nX,propertyKeyTypes:()=>n9,randomString:()=>n0,required:()=>im,stringifyPrimitive:()=>io,unwrapMessage:()=>ib};for(var nj in nL)np(nD,nj,{get:nL[nj],enumerable:!0});function n$(e){return e}function nM(e){return e}function nq(e){}function nV(e){throw Error()}function nB(e){}function nz(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function nW(e,t="|"){return e.map(e=>io(e)).join(t)}function nH(e,t){return"bigint"==typeof t?t.toString():t}function nF(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function nK(e){return null==e}function nQ(e){let t=+!!e.startsWith("^"),r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function nZ(e,t){let r=(e.toString().split(".")[1]||"").length,n=(t.toString().split(".")[1]||"").length,i=r>n?r:n;return Number.parseInt(e.toFixed(i).replace(".",""))%Number.parseInt(t.toFixed(i).replace(".",""))/10**i}function nG(e,t,r){Object.defineProperty(e,t,{get(){{let n=r();return e[t]=n,n}},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function nY(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function nJ(e,t){return t?t.reduce((e,t)=>e?.[t],e):e}function nX(e){let t=Object.keys(e);return Promise.all(t.map(t=>e[t])).then(e=>{let r={};for(let n=0;n<t.length;n++)r[t[n]]=e[n];return r})}function n0(e=10){let t="abcdefghijklmnopqrstuvwxyz",r="";for(let n=0;n<e;n++)r+=t[Math.floor(Math.random()*t.length)];return r}function n1(e){return JSON.stringify(e)}var n2=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function n5(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}var n6=nF(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});function n3(e){if(!1===n5(e))return!1;let t=e.constructor;if(void 0===t)return!0;let r=t.prototype;return!1!==n5(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}function n4(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}var n8=e=>{let t=typeof e;switch(t){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(e)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":if(Array.isArray(e))return"array";if(null===e)return"null";if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return"promise";if("undefined"!=typeof Map&&e instanceof Map)return"map";if("undefined"!=typeof Set&&e instanceof Set)return"set";if("undefined"!=typeof Date&&e instanceof Date)return"date";if("undefined"!=typeof File&&e instanceof File)return"file";return"object";default:throw Error(`Unknown data type: ${t}`)}},n9=new Set(["string","number","symbol"]),n7=new Set(["string","number","bigint","boolean","symbol","undefined"]);function ie(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function it(e,t,r){let n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function ir(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}function ii(e){let t;return new Proxy({},{get:(r,n,i)=>(t??(t=e()),Reflect.get(t,n,i)),set:(r,n,i,o)=>(t??(t=e()),Reflect.set(t,n,i,o)),has:(r,n)=>(t??(t=e()),Reflect.has(t,n)),deleteProperty:(r,n)=>(t??(t=e()),Reflect.deleteProperty(t,n)),ownKeys:r=>(t??(t=e()),Reflect.ownKeys(t)),getOwnPropertyDescriptor:(r,n)=>(t??(t=e()),Reflect.getOwnPropertyDescriptor(t,n)),defineProperty:(r,n,i)=>(t??(t=e()),Reflect.defineProperty(t,n,i))})}function io(e){return"bigint"==typeof e?e.toString()+"n":"string"==typeof e?`"${e}"`:`${e}`}function ia(e){return Object.keys(e).filter(t=>"optional"===e[t]._zod.optin&&"optional"===e[t]._zod.optout)}var is={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-0x80000000,0x7fffffff],uint32:[0,0xffffffff],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},ic={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function id(e,t){let r={},n=e._zod.def;for(let e in t){if(!(e in n.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&(r[e]=n.shape[e])}return it(e,{...e._zod.def,shape:r,checks:[]})}function il(e,t){let r={...e._zod.def.shape},n=e._zod.def;for(let e in t){if(!(e in n.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete r[e]}return it(e,{...e._zod.def,shape:r,checks:[]})}function iu(e,t){if(!n3(t))throw Error("Invalid input to extend: expected a plain object");let r={...e._zod.def,get shape(){let r={...e._zod.def.shape,...t};return nY(this,"shape",r),r},checks:[]};return it(e,r)}function ip(e,t){return it(e,{...e._zod.def,get shape(){let r={...e._zod.def.shape,...t._zod.def.shape};return nY(this,"shape",r),r},catchall:t._zod.def.catchall,checks:[]})}function ih(e,t,r){let n=t._zod.def.shape,i={...n};if(r)for(let t in r){if(!(t in n))throw Error(`Unrecognized key: "${t}"`);r[t]&&(i[t]=e?new e({type:"optional",innerType:n[t]}):n[t])}else for(let t in n)i[t]=e?new e({type:"optional",innerType:n[t]}):n[t];return it(t,{...t._zod.def,shape:i,checks:[]})}function im(e,t,r){let n=t._zod.def.shape,i={...n};if(r)for(let t in r){if(!(t in i))throw Error(`Unrecognized key: "${t}"`);r[t]&&(i[t]=new e({type:"nonoptional",innerType:n[t]}))}else for(let t in n)i[t]=new e({type:"nonoptional",innerType:n[t]});return it(t,{...t._zod.def,shape:i,checks:[]})}function ig(e,t=0){for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function iy(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function ib(e){return"string"==typeof e?e:e?.message}function iw(e,t,r){let n={...e,path:e.path??[]};return e.message||(n.message=ib(e.inst?._zod.def?.error?.(e))??ib(t?.error?.(e))??ib(r.customError?.(e))??ib(r.localeError?.(e))??"Invalid input"),delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function ix(e){return e instanceof Set?"set":e instanceof Map?"map":e instanceof File?"file":"unknown"}function iv(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function i_(...e){let[t,r,n]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:n}:{...t}}function iE(e){return Object.entries(e).filter(([e,t])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}var iT=class{constructor(...e){}},iA=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,nH,2),enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},iS=nN("$ZodError",iA),iR=nN("$ZodError",iA,{Parent:Error}),iO=e=>(t,r,n)=>{let i=n?{...n,async:!1}:{async:!1},o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise)throw new nP;return o.issues.length?{success:!1,error:new(e??iS)(o.issues.map(e=>iw(e,i,nC())))}:{success:!0,data:o.value}},iI=iO(iR),ik=e=>async(t,r,n)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},o=t._zod.run({value:r,issues:[]},i);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(e=>iw(e,i,nC())))}:{success:!0,data:o.value}},iN=ik(iR),iP=nN("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),iU=nN("$ZodCheckMaxLength",(e,t)=>{var r;iP.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!nK(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??1/0;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let n=r.value;if(n.length<=t.maximum)return;let i=iv(n);r.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),iC=nN("$ZodCheckMinLength",(e,t)=>{var r;iP.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!nK(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??-1/0;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let n=r.value;if(n.length>=t.minimum)return;let i=iv(n);r.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),iD=nN("$ZodCheckLengthEquals",(e,t)=>{var r;iP.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return!nK(t)&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=r=>{let n=r.value,i=n.length;if(i===t.length)return;let o=iv(n),a=i>t.length;r.issues.push({origin:o,...a?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),iL=nN("$ZodCheckOverwrite",(e,t)=>{iP.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}}),ij=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let t=e.split("\n").filter(e=>e),r=Math.min(...t.map(e=>e.length-e.trimStart().length));for(let e of t.map(e=>e.slice(r)).map(e=>" ".repeat(2*this.indent)+e))this.content.push(e)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}},i$={major:4,minor:0,patch:0},iM=nN("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=i$;let n=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&n.unshift(e),n))for(let r of t._zod.onattach)r(e);if(0===n.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,r)=>{let n,i=ig(e);for(let o of t){if(o._zod.def.when){if(!o._zod.def.when(e))continue}else if(i)continue;let t=e.issues.length,a=o._zod.check(e);if(a instanceof Promise&&r?.async===!1)throw new nP;if(n||a instanceof Promise)n=(n??Promise.resolve()).then(async()=>{await a,e.issues.length!==t&&(i||(i=ig(e,t)))});else{if(e.issues.length===t)continue;i||(i=ig(e,t))}}return n?n.then(()=>e):e};e._zod.run=(r,i)=>{let o=e._zod.parse(r,i);if(o instanceof Promise){if(!1===i.async)throw new nP;return o.then(e=>t(e,n,i))}return t(o,n,i)}}e["~standard"]={validate:t=>{try{let r=iI(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return iN(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),iq=nN("$ZodUnknown",(e,t)=>{iM.init(e,t),e._zod.parse=e=>e}),iV=nN("$ZodNever",(e,t)=>{iM.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function iB(e,t,r){e.issues.length&&t.issues.push(...iy(r,e.issues)),t.value[r]=e.value}var iz=nN("$ZodArray",(e,t)=>{iM.init(e,t),e._zod.parse=(r,n)=>{let i=r.value;if(!Array.isArray(i))return r.issues.push({expected:"array",code:"invalid_type",input:i,inst:e}),r;r.value=Array(i.length);let o=[];for(let e=0;e<i.length;e++){let a=i[e],s=t.element._zod.run({value:a,issues:[]},n);s instanceof Promise?o.push(s.then(t=>iB(t,r,e))):iB(s,r,e)}return o.length?Promise.all(o).then(()=>r):r}});function iW(e,t,r){e.issues.length&&t.issues.push(...iy(r,e.issues)),t.value[r]=e.value}function iH(e,t,r,n){e.issues.length?void 0===n[r]?r in n?t.value[r]=void 0:t.value[r]=e.value:t.issues.push(...iy(r,e.issues)):void 0===e.value?r in n&&(t.value[r]=void 0):t.value[r]=e.value}var iF=nN("$ZodObject",(e,t)=>{let r,n;iM.init(e,t);let i=nF(()=>{let e=Object.keys(t.shape);for(let r of e)if(!(t.shape[r]instanceof iM))throw Error(`Invalid element at key "${r}": expected a Zod schema`);let r=ia(t.shape);return{shape:t.shape,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(r)}});nG(e._zod,"propValues",()=>{let e=t.shape,r={};for(let t in e){let n=e[t]._zod;if(n.values)for(let e of(r[t]??(r[t]=new Set),n.values))r[t].add(e)}return r});let o=!nU.jitless,a=o&&n6.value,s=t.catchall;e._zod.parse=(c,d)=>{n??(n=i.value);let l=c.value;if(!n5(l))return c.issues.push({expected:"object",code:"invalid_type",input:l,inst:e}),c;let u=[];if(o&&a&&d?.async===!1&&!0!==d.jitless)r||(r=(e=>{let t=new ij(["shape","payload","ctx"]),r=i.value,n=e=>{let t=n1(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");let o=Object.create(null),a=0;for(let e of r.keys)o[e]=`key_${a++}`;for(let e of(t.write("const newResult = {}"),r.keys))if(r.optionalKeys.has(e)){let r=o[e];t.write(`const ${r} = ${n(e)};`);let i=n1(e);t.write(`
        if (${r}.issues.length) {
          if (input[${i}] === undefined) {
            if (${i} in input) {
              newResult[${i}] = undefined;
            }
          } else {
            payload.issues = payload.issues.concat(
              ${r}.issues.map((iss) => ({
                ...iss,
                path: iss.path ? [${i}, ...iss.path] : [${i}],
              }))
            );
          }
        } else if (${r}.value === undefined) {
          if (${i} in input) newResult[${i}] = undefined;
        } else {
          newResult[${i}] = ${r}.value;
        }
        `)}else{let r=o[e];t.write(`const ${r} = ${n(e)};`),t.write(`
          if (${r}.issues.length) payload.issues = payload.issues.concat(${r}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${n1(e)}, ...iss.path] : [${n1(e)}]
          })));`),t.write(`newResult[${n1(e)}] = ${r}.value`)}t.write("payload.value = newResult;"),t.write("return payload;");let s=t.compile();return(t,r)=>s(e,t,r)})(t.shape)),c=r(c,d);else{c.value={};let e=n.shape;for(let t of n.keys){let r=e[t],n=r._zod.run({value:l[t],issues:[]},d),i="optional"===r._zod.optin&&"optional"===r._zod.optout;n instanceof Promise?u.push(n.then(e=>i?iH(e,c,t,l):iW(e,c,t))):i?iH(n,c,t,l):iW(n,c,t)}}if(!s)return u.length?Promise.all(u).then(()=>c):c;let p=[],f=n.keySet,h=s._zod,m=h.def.type;for(let e of Object.keys(l)){if(f.has(e))continue;if("never"===m){p.push(e);continue}let t=h.run({value:l[e],issues:[]},d);t instanceof Promise?u.push(t.then(t=>iW(t,c,e))):iW(t,c,e)}return(p.length&&c.issues.push({code:"unrecognized_keys",keys:p,input:l,inst:e}),u.length)?Promise.all(u).then(()=>c):c}});function iK(e,t,r,n){for(let r of e)if(0===r.issues.length)return t.value=r.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>iw(e,n,nC())))}),t}var iQ=nN("$ZodUnion",(e,t)=>{iM.init(e,t),nG(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),nG(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),nG(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),nG(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>nQ(e.source)).join("|")})$`)}}),e._zod.parse=(r,n)=>{let i=!1,o=[];for(let e of t.options){let t=e._zod.run({value:r.value,issues:[]},n);if(t instanceof Promise)o.push(t),i=!0;else{if(0===t.issues.length)return t;o.push(t)}}return i?Promise.all(o).then(t=>iK(t,r,e,n)):iK(o,r,e,n)}}),iZ=nN("$ZodIntersection",(e,t)=>{iM.init(e,t),e._zod.parse=(e,r)=>{let n=e.value,i=t.left._zod.run({value:n,issues:[]},r),o=t.right._zod.run({value:n,issues:[]},r);return i instanceof Promise||o instanceof Promise?Promise.all([i,o]).then(([t,r])=>iG(e,t,r)):iG(e,i,o)}});function iG(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),ig(e))return e;let n=function e(t,r){if(t===r||t instanceof Date&&r instanceof Date&&+t==+r)return{valid:!0,data:t};if(n3(t)&&n3(r)){let n=Object.keys(r),i=Object.keys(t).filter(e=>-1!==n.indexOf(e)),o={...t,...r};for(let n of i){let i=e(t[n],r[n]);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};o[n]=i.data}return{valid:!0,data:o}}if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return{valid:!1,mergeErrorPath:[]};let n=[];for(let i=0;i<t.length;i++){let o=e(t[i],r[i]);if(!o.valid)return{valid:!1,mergeErrorPath:[i,...o.mergeErrorPath]};n.push(o.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}(t.value,r.value);if(!n.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}var iY=nN("$ZodEnum",(e,t)=>{iM.init(e,t);let r=nz(t.entries);e._zod.values=new Set(r),e._zod.pattern=RegExp(`^(${r.filter(e=>n9.has(typeof e)).map(e=>"string"==typeof e?ie(e):e.toString()).join("|")})$`),e._zod.parse=(t,n)=>{let i=t.value;return e._zod.values.has(i)||t.issues.push({code:"invalid_value",values:r,input:i,inst:e}),t}}),iJ=nN("$ZodTransform",(e,t)=>{iM.init(e,t),e._zod.parse=(e,r)=>{let n=t.transform(e.value,e);if(r.async)return(n instanceof Promise?n:Promise.resolve(n)).then(t=>(e.value=t,e));if(n instanceof Promise)throw new nP;return e.value=n,e}}),iX=nN("$ZodOptional",(e,t)=>{iM.init(e,t),e._zod.optin="optional",e._zod.optout="optional",nG(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),nG(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${nQ(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>"optional"===t.innerType._zod.optin?t.innerType._zod.run(e,r):void 0===e.value?e:t.innerType._zod.run(e,r)}),i0=nN("$ZodNullable",(e,t)=>{iM.init(e,t),nG(e._zod,"optin",()=>t.innerType._zod.optin),nG(e._zod,"optout",()=>t.innerType._zod.optout),nG(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${nQ(e.source)}|null)$`):void 0}),nG(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,r)=>null===e.value?e:t.innerType._zod.run(e,r)}),i1=nN("$ZodDefault",(e,t)=>{iM.init(e,t),e._zod.optin="optional",nG(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if(void 0===e.value)return e.value=t.defaultValue,e;let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(e=>i2(e,t)):i2(n,t)}});function i2(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}var i5=nN("$ZodPrefault",(e,t)=>{iM.init(e,t),e._zod.optin="optional",nG(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>(void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,r))}),i6=nN("$ZodNonOptional",(e,t)=>{iM.init(e,t),nG(e._zod,"values",()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(r,n)=>{let i=t.innerType._zod.run(r,n);return i instanceof Promise?i.then(t=>i3(t,e)):i3(i,e)}});function i3(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}var i4=nN("$ZodCatch",(e,t)=>{iM.init(e,t),e._zod.optin="optional",nG(e._zod,"optout",()=>t.innerType._zod.optout),nG(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(n=>(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>iw(e,r,nC()))},input:e.value}),e.issues=[]),e)):(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>iw(e,r,nC()))},input:e.value}),e.issues=[]),e)}}),i8=nN("$ZodPipe",(e,t)=>{iM.init(e,t),nG(e._zod,"values",()=>t.in._zod.values),nG(e._zod,"optin",()=>t.in._zod.optin),nG(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(e,r)=>{let n=t.in._zod.run(e,r);return n instanceof Promise?n.then(e=>i9(e,t,r)):i9(n,t,r)}});function i9(e,t,r){return ig(e)?e:t.out._zod.run({value:e.value,issues:e.issues},r)}var i7=nN("$ZodReadonly",(e,t)=>{iM.init(e,t),nG(e._zod,"propValues",()=>t.innerType._zod.propValues),nG(e._zod,"values",()=>t.innerType._zod.values),nG(e._zod,"optin",()=>t.innerType._zod.optin),nG(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(e,r)=>{let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(oe):oe(n)}});function oe(e){return e.value=Object.freeze(e.value),e}var ot=nN("$ZodCustom",(e,t)=>{iP.init(e,t),iM.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=r=>{let n=r.value,i=t.fn(n);if(i instanceof Promise)return i.then(t=>or(t,r,n,e));or(i,r,n,e)}});function or(e,t,r,n){if(!e){let e={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(e.params=n._zod.def.params),t.issues.push(i_(e))}}Symbol("ZodOutput"),Symbol("ZodInput");var on=new class{constructor(){this._map=new Map,this._idmap=new Map}add(e,...t){let r=t[0];if(this._map.set(e,r),r&&"object"==typeof r&&"id"in r){if(this._idmap.has(r.id))throw Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new Map,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}};function oi(e,t){return new iC({check:"min_length",...ir(t),minimum:e})}var oo=(e,t)=>{iS.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>{let r,n,i;return r=t||function(e){return e.message},n={_errors:[]},(i=e=>{for(let t of e.issues)if("invalid_union"===t.code&&t.errors.length)t.errors.map(e=>i({issues:e}));else if("invalid_key"===t.code)i({issues:t.issues});else if("invalid_element"===t.code)i({issues:t.issues});else if(0===t.path.length)n._errors.push(r(t));else{let e=n,i=0;for(;i<t.path.length;){let n=t.path[i];i===t.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(r(t))):e[n]=e[n]||{_errors:[]},e=e[n],i++}}})(e),n}},flatten:{value:t=>(function(e,t=e=>e.message){let r={},n=[];for(let i of e.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(t(i))):n.push(t(i));return{formErrors:n,fieldErrors:r}})(e,t)},addIssue:{value:t=>e.issues.push(t)},addIssues:{value:t=>e.issues.push(...t)},isEmpty:{get:()=>0===e.issues.length}})};nN("ZodError",oo);var oa=nN("ZodError",oo,{Parent:Error}),os=(e,t,r,n)=>{let i=r?Object.assign(r,{async:!1}):{async:!1},o=e._zod.run({value:t,issues:[]},i);if(o instanceof Promise)throw new nP;if(o.issues.length){let e=new(n?.Err??oa)(o.issues.map(e=>iw(e,i,nC())));throw n2(e,n?.callee),e}return o.value},oc=async(e,t,r,n)=>{let i=r?Object.assign(r,{async:!0}):{async:!0},o=e._zod.run({value:t,issues:[]},i);if(o instanceof Promise&&(o=await o),o.issues.length){let e=new(n?.Err??oa)(o.issues.map(e=>iw(e,i,nC())));throw n2(e,n?.callee),e}return o.value},od=iO(oa),ol=ik(oa),ou=nN("ZodType",(e,t)=>(iM.init(e,t),e.def=t,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone({...t,checks:[...t.checks??[],...r.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,r)=>it(e,t,r),e.brand=()=>e,e.register=(t,r)=>(t.add(e,r),e),e.parse=(t,r)=>os(e,t,r,{callee:e.parse}),e.safeParse=(t,r)=>od(e,t,r),e.parseAsync=async(t,r)=>oc(e,t,r,{callee:e.parseAsync}),e.safeParseAsync=async(t,r)=>ol(e,t,r),e.spa=e.safeParseAsync,e.refine=(t,r)=>e.check(function(e,t={}){return new oP({type:"custom",check:"custom",fn:e,...ir(t)})}(t,r)),e.superRefine=t=>{var r,n;let i,o;return e.check((r=t,o=(n=e=>(e.addIssue=t=>{"string"==typeof t?e.issues.push(nD.issue(t,e.value,o._zod.def)):(t.fatal&&(t.continue=!1),t.code??(t.code="custom"),t.input??(t.input=e.value),t.inst??(t.inst=o),t.continue??(t.continue=!o._zod.def.abort),e.issues.push(nD.issue(t)))},r(e.value,e)),(i=new iP({check:"custom"}))._zod.check=n,i)))},e.overwrite=t=>e.check(new iL({check:"overwrite",tx:t})),e.optional=()=>o_(e),e.nullable=()=>oT(e),e.nullish=()=>o_(oT(e)),e.nonoptional=t=>{var r,n;return r=e,n=t,new oR({type:"nonoptional",innerType:r,...nD.normalizeParams(n)})},e.array=()=>(function(e,t){return new om({type:"array",element:e,...ir(void 0)})})(e),e.or=t=>new oy({type:"union",options:[e,t],...nD.normalizeParams(void 0)}),e.and=t=>{var r;return r=e,new ob({type:"intersection",left:r,right:t})},e.transform=t=>ok(e,new ox({type:"transform",transform:t})),e.default=t=>{var r,n;return r=e,n=t,new oA({type:"default",innerType:r,get defaultValue(){return"function"==typeof n?n():n}})},e.prefault=t=>{var r,n;return r=e,n=t,new oS({type:"prefault",innerType:r,get defaultValue(){return"function"==typeof n?n():n}})},e.catch=t=>{var r;return new oO({type:"catch",innerType:e,catchValue:"function"==typeof(r=t)?r:()=>r})},e.pipe=t=>ok(e,t),e.readonly=()=>new oN({type:"readonly",innerType:e}),e.describe=t=>{let r=e.clone();return on.add(r,{description:t}),r},Object.defineProperty(e,"description",{get:()=>on.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return on.get(e);let r=e.clone();return on.add(r,t[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),op=nN("ZodUnknown",(e,t)=>{iq.init(e,t),ou.init(e,t)});function of(){return new op({type:"unknown"})}var oh=nN("ZodNever",(e,t)=>{iV.init(e,t),ou.init(e,t)}),om=nN("ZodArray",(e,t)=>{iz.init(e,t),ou.init(e,t),e.element=t.element,e.min=(t,r)=>e.check(oi(t,r)),e.nonempty=t=>e.check(oi(1,t)),e.max=(t,r)=>e.check(new iU({check:"max_length",...ir(r),maximum:t})),e.length=(t,r)=>e.check(new iD({check:"length_equals",...ir(r),length:t})),e.unwrap=()=>e.element}),og=nN("ZodObject",(e,t)=>{iF.init(e,t),ou.init(e,t),nD.defineLazy(e,"shape",()=>t.shape),e.keyof=()=>{var t;return new ow({type:"enum",entries:Array.isArray(t=Object.keys(e._zod.def.shape))?Object.fromEntries(t.map(e=>[e,e])):t,...nD.normalizeParams(void 0)})},e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:of()}),e.loose=()=>e.clone({...e._zod.def,catchall:of()}),e.strict=()=>e.clone({...e._zod.def,catchall:new oh({type:"never",...ir(void 0)})}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>nD.extend(e,t),e.merge=t=>nD.merge(e,t),e.pick=t=>nD.pick(e,t),e.omit=t=>nD.omit(e,t),e.partial=(...t)=>nD.partial(ov,e,t[0]),e.required=(...t)=>nD.required(oR,e,t[0])}),oy=nN("ZodUnion",(e,t)=>{iQ.init(e,t),ou.init(e,t),e.options=t.options}),ob=nN("ZodIntersection",(e,t)=>{iZ.init(e,t),ou.init(e,t)}),ow=nN("ZodEnum",(e,t)=>{iY.init(e,t),ou.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);let r=new Set(Object.keys(t.entries));e.extract=(e,n)=>{let i={};for(let n of e)if(r.has(n))i[n]=t.entries[n];else throw Error(`Key ${n} not found in enum`);return new ow({...t,checks:[],...nD.normalizeParams(n),entries:i})},e.exclude=(e,n)=>{let i={...t.entries};for(let t of e)if(r.has(t))delete i[t];else throw Error(`Key ${t} not found in enum`);return new ow({...t,checks:[],...nD.normalizeParams(n),entries:i})}}),ox=nN("ZodTransform",(e,t)=>{iJ.init(e,t),ou.init(e,t),e._zod.parse=(r,n)=>{r.addIssue=n=>{"string"==typeof n?r.issues.push(nD.issue(n,r.value,t)):(n.fatal&&(n.continue=!1),n.code??(n.code="custom"),n.input??(n.input=r.value),n.inst??(n.inst=e),n.continue??(n.continue=!0),r.issues.push(nD.issue(n)))};let i=t.transform(r.value,r);return i instanceof Promise?i.then(e=>(r.value=e,r)):(r.value=i,r)}}),ov=nN("ZodOptional",(e,t)=>{iX.init(e,t),ou.init(e,t),e.unwrap=()=>e._zod.def.innerType});function o_(e){return new ov({type:"optional",innerType:e})}var oE=nN("ZodNullable",(e,t)=>{i0.init(e,t),ou.init(e,t),e.unwrap=()=>e._zod.def.innerType});function oT(e){return new oE({type:"nullable",innerType:e})}var oA=nN("ZodDefault",(e,t)=>{i1.init(e,t),ou.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap}),oS=nN("ZodPrefault",(e,t)=>{i5.init(e,t),ou.init(e,t),e.unwrap=()=>e._zod.def.innerType}),oR=nN("ZodNonOptional",(e,t)=>{i6.init(e,t),ou.init(e,t),e.unwrap=()=>e._zod.def.innerType}),oO=nN("ZodCatch",(e,t)=>{i4.init(e,t),ou.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap}),oI=nN("ZodPipe",(e,t)=>{i8.init(e,t),ou.init(e,t),e.in=t.in,e.out=t.out});function ok(e,t){return new oI({type:"pipe",in:e,out:t})}var oN=nN("ZodReadonly",(e,t)=>{i7.init(e,t),ou.init(e,t)}),oP=nN("ZodCustom",(e,t)=>{ot.init(e,t),ou.init(e,t)}),oU={};function oC(e){switch(e.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function oD(e){let t=[];return e.metadata?.openapi?.parameters?t.push(...e.metadata.openapi.parameters):e.query instanceof og&&Object.entries(e.query.shape).forEach(([e,r])=>{r instanceof og&&t.push({name:e,in:"query",schema:{type:oC(r),..."minLength"in r&&r.minLength?{minLength:r.minLength}:{},description:r.description}})}),t}function oL(e){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...e}}async function oj(e,t){return Object.entries(e).forEach(([e,t])=>{let r=t.options;if(!r.metadata?.SERVER_ONLY&&("GET"===r.method&&(oU[t.path]={get:{tags:["Default",...r.metadata?.openapi?.tags||[]],description:r.metadata?.openapi?.description,operationId:r.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:oD(r),responses:oL(r.metadata?.openapi?.responses)}}),"POST"===r.method)){let e=function(e){if(e.metadata?.openapi?.requestBody)return e.metadata.openapi.requestBody;if(e.body&&(e.body instanceof og||e.body instanceof ov)){let t=e.body.shape;if(!t)return;let r={},n=[];return Object.entries(t).forEach(([e,t])=>{t instanceof og&&(r[e]={type:oC(t),description:t.description},t instanceof ov||n.push(e))}),{required:!(e.body instanceof ov)&&!!e.body,content:{"application/json":{schema:{type:"object",properties:r,required:n}}}}}}(r);oU[t.path]={post:{tags:["Default",...r.metadata?.openapi?.tags||[]],description:r.metadata?.openapi?.description,operationId:r.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:oD(r),...e?{requestBody:e}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:oL(r.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:t?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:oU}}e.i(462690);var o$=e.i(319281);e.s(["default",0,o$],418291),e.i(418291),e.s(["$brand",()=>o$.$brand,"$input",()=>o$.$input,"$output",()=>o$.$output,"NEVER",()=>o$.NEVER,"TimePrecision",()=>o$.TimePrecision,"ZodAny",()=>o$.ZodAny,"ZodArray",()=>o$.ZodArray,"ZodBase64",()=>o$.ZodBase64,"ZodBase64URL",()=>o$.ZodBase64URL,"ZodBigInt",()=>o$.ZodBigInt,"ZodBigIntFormat",()=>o$.ZodBigIntFormat,"ZodBoolean",()=>o$.ZodBoolean,"ZodCIDRv4",()=>o$.ZodCIDRv4,"ZodCIDRv6",()=>o$.ZodCIDRv6,"ZodCUID",()=>o$.ZodCUID,"ZodCUID2",()=>o$.ZodCUID2,"ZodCatch",()=>o$.ZodCatch,"ZodCodec",()=>o$.ZodCodec,"ZodCustom",()=>o$.ZodCustom,"ZodCustomStringFormat",()=>o$.ZodCustomStringFormat,"ZodDate",()=>o$.ZodDate,"ZodDefault",()=>o$.ZodDefault,"ZodDiscriminatedUnion",()=>o$.ZodDiscriminatedUnion,"ZodE164",()=>o$.ZodE164,"ZodEmail",()=>o$.ZodEmail,"ZodEmoji",()=>o$.ZodEmoji,"ZodEnum",()=>o$.ZodEnum,"ZodError",()=>o$.ZodError,"ZodFile",()=>o$.ZodFile,"ZodFirstPartyTypeKind",()=>o$.ZodFirstPartyTypeKind,"ZodFunction",()=>o$.ZodFunction,"ZodGUID",()=>o$.ZodGUID,"ZodIPv4",()=>o$.ZodIPv4,"ZodIPv6",()=>o$.ZodIPv6,"ZodISODate",()=>o$.ZodISODate,"ZodISODateTime",()=>o$.ZodISODateTime,"ZodISODuration",()=>o$.ZodISODuration,"ZodISOTime",()=>o$.ZodISOTime,"ZodIntersection",()=>o$.ZodIntersection,"ZodIssueCode",()=>o$.ZodIssueCode,"ZodJWT",()=>o$.ZodJWT,"ZodKSUID",()=>o$.ZodKSUID,"ZodLazy",()=>o$.ZodLazy,"ZodLiteral",()=>o$.ZodLiteral,"ZodMap",()=>o$.ZodMap,"ZodNaN",()=>o$.ZodNaN,"ZodNanoID",()=>o$.ZodNanoID,"ZodNever",()=>o$.ZodNever,"ZodNonOptional",()=>o$.ZodNonOptional,"ZodNull",()=>o$.ZodNull,"ZodNullable",()=>o$.ZodNullable,"ZodNumber",()=>o$.ZodNumber,"ZodNumberFormat",()=>o$.ZodNumberFormat,"ZodObject",()=>o$.ZodObject,"ZodOptional",()=>o$.ZodOptional,"ZodPipe",()=>o$.ZodPipe,"ZodPrefault",()=>o$.ZodPrefault,"ZodPromise",()=>o$.ZodPromise,"ZodReadonly",()=>o$.ZodReadonly,"ZodRealError",()=>o$.ZodRealError,"ZodRecord",()=>o$.ZodRecord,"ZodSet",()=>o$.ZodSet,"ZodString",()=>o$.ZodString,"ZodStringFormat",()=>o$.ZodStringFormat,"ZodSuccess",()=>o$.ZodSuccess,"ZodSymbol",()=>o$.ZodSymbol,"ZodTemplateLiteral",()=>o$.ZodTemplateLiteral,"ZodTransform",()=>o$.ZodTransform,"ZodTuple",()=>o$.ZodTuple,"ZodType",()=>o$.ZodType,"ZodULID",()=>o$.ZodULID,"ZodURL",()=>o$.ZodURL,"ZodUUID",()=>o$.ZodUUID,"ZodUndefined",()=>o$.ZodUndefined,"ZodUnion",()=>o$.ZodUnion,"ZodUnknown",()=>o$.ZodUnknown,"ZodVoid",()=>o$.ZodVoid,"ZodXID",()=>o$.ZodXID,"_ZodString",()=>o$._ZodString,"_default",()=>o$._default,"_function",()=>o$._function,"any",()=>o$.any,"array",()=>o$.array,"base64",()=>o$.base64,"base64url",()=>o$.base64url,"bigint",()=>o$.bigint,"boolean",()=>o$.boolean,"catch",()=>o$.catch,"check",()=>o$.check,"cidrv4",()=>o$.cidrv4,"cidrv6",()=>o$.cidrv6,"clone",()=>o$.clone,"codec",()=>o$.codec,"coerce",()=>o$.coerce,"config",()=>o$.config,"core",()=>o$.core,"cuid",()=>o$.cuid,"cuid2",()=>o$.cuid2,"custom",()=>o$.custom,"date",()=>o$.date,"decode",()=>o$.decode,"decodeAsync",()=>o$.decodeAsync,"default",0,o$,"discriminatedUnion",()=>o$.discriminatedUnion,"e164",()=>o$.e164,"email",()=>o$.email,"emoji",()=>o$.emoji,"encode",()=>o$.encode,"encodeAsync",()=>o$.encodeAsync,"endsWith",()=>o$.endsWith,"enum",()=>o$.enum,"file",()=>o$.file,"flattenError",()=>o$.flattenError,"float32",()=>o$.float32,"float64",()=>o$.float64,"formatError",()=>o$.formatError,"function",()=>o$.function,"getErrorMap",()=>o$.getErrorMap,"globalRegistry",()=>o$.globalRegistry,"gt",()=>o$.gt,"gte",()=>o$.gte,"guid",()=>o$.guid,"hash",()=>o$.hash,"hex",()=>o$.hex,"hostname",()=>o$.hostname,"httpUrl",()=>o$.httpUrl,"includes",()=>o$.includes,"instanceof",()=>o$.instanceof,"int",()=>o$.int,"int32",()=>o$.int32,"int64",()=>o$.int64,"intersection",()=>o$.intersection,"ipv4",()=>o$.ipv4,"ipv6",()=>o$.ipv6,"iso",()=>o$.iso,"json",()=>o$.json,"jwt",()=>o$.jwt,"keyof",()=>o$.keyof,"ksuid",()=>o$.ksuid,"lazy",()=>o$.lazy,"length",()=>o$.length,"literal",()=>o$.literal,"locales",()=>o$.locales,"looseObject",()=>o$.looseObject,"lowercase",()=>o$.lowercase,"lt",()=>o$.lt,"lte",()=>o$.lte,"map",()=>o$.map,"maxLength",()=>o$.maxLength,"maxSize",()=>o$.maxSize,"mime",()=>o$.mime,"minLength",()=>o$.minLength,"minSize",()=>o$.minSize,"multipleOf",()=>o$.multipleOf,"nan",()=>o$.nan,"nanoid",()=>o$.nanoid,"nativeEnum",()=>o$.nativeEnum,"negative",()=>o$.negative,"never",()=>o$.never,"nonnegative",()=>o$.nonnegative,"nonoptional",()=>o$.nonoptional,"nonpositive",()=>o$.nonpositive,"normalize",()=>o$.normalize,"null",()=>o$.null,"nullable",()=>o$.nullable,"nullish",()=>o$.nullish,"number",()=>o$.number,"object",()=>o$.object,"optional",()=>o$.optional,"overwrite",()=>o$.overwrite,"parse",()=>o$.parse,"parseAsync",()=>o$.parseAsync,"partialRecord",()=>o$.partialRecord,"pipe",()=>o$.pipe,"positive",()=>o$.positive,"prefault",()=>o$.prefault,"preprocess",()=>o$.preprocess,"prettifyError",()=>o$.prettifyError,"promise",()=>o$.promise,"property",()=>o$.property,"readonly",()=>o$.readonly,"record",()=>o$.record,"refine",()=>o$.refine,"regex",()=>o$.regex,"regexes",()=>o$.regexes,"registry",()=>o$.registry,"safeDecode",()=>o$.safeDecode,"safeDecodeAsync",()=>o$.safeDecodeAsync,"safeEncode",()=>o$.safeEncode,"safeEncodeAsync",()=>o$.safeEncodeAsync,"safeParse",()=>o$.safeParse,"safeParseAsync",()=>o$.safeParseAsync,"set",()=>o$.set,"setErrorMap",()=>o$.setErrorMap,"size",()=>o$.size,"startsWith",()=>o$.startsWith,"strictObject",()=>o$.strictObject,"string",()=>o$.string,"stringFormat",()=>o$.stringFormat,"stringbool",()=>o$.stringbool,"success",()=>o$.success,"superRefine",()=>o$.superRefine,"symbol",()=>o$.symbol,"templateLiteral",()=>o$.templateLiteral,"toJSONSchema",()=>o$.toJSONSchema,"toLowerCase",()=>o$.toLowerCase,"toUpperCase",()=>o$.toUpperCase,"transform",()=>o$.transform,"treeifyError",()=>o$.treeifyError,"trim",()=>o$.trim,"tuple",()=>o$.tuple,"uint32",()=>o$.uint32,"uint64",()=>o$.uint64,"ulid",()=>o$.ulid,"undefined",()=>o$.undefined,"union",()=>o$.union,"unknown",()=>o$.unknown,"uppercase",()=>o$.uppercase,"url",()=>o$.url,"util",()=>o$.util,"uuid",()=>o$.uuid,"uuidv4",()=>o$.uuidv4,"uuidv6",()=>o$.uuidv6,"uuidv7",()=>o$.uuidv7,"void",()=>o$.void,"xid",()=>o$.xid,"z",0,o$],901577),e.i(901577);var oM=e.i(314539);let oq=(e,t="ms")=>new Date(Date.now()+("sec"===t?1e3*e:e)),oV=e=>{if("string"==typeof e&&(e=new TextEncoder().encode(e)),0===e.byteLength)return"";let t=new Uint8Array(e),r="";for(let e of t)r+=e.toString(16).padStart(2,"0");return r},oB=(e="SHA-256",t="none")=>{let r={importKey:async(t,r)=>na().importKey("raw","string"==typeof t?new TextEncoder().encode(t):t,{name:"HMAC",hash:{name:e}},!1,[r]),sign:async(e,n)=>{"string"==typeof e&&(e=await r.importKey(e,"sign"));let i=await na().sign("HMAC",e,"string"==typeof n?new TextEncoder().encode(n):n);return"hex"===t?oV(i):"base64"===t||"base64url"===t||"base64urlnopad"===t?t2.encode(i,{padding:"base64urlnopad"!==t}):i},verify:async(e,n,i)=>("string"==typeof e&&(e=await r.importKey(e,"verify")),"hex"===t&&(i=(e=>{if(!e)return"";if("string"==typeof e){if(e.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(e))throw Error("Invalid hexadecimal string");let t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.slice(r,r+2),16);return new TextDecoder().decode(t)}return new TextDecoder().decode(e)})(i)),("base64"===t||"base64url"===t||"base64urlnopad"===t)&&(i=await t1.decode(i)),na().verify("HMAC",e,"string"==typeof i?new TextEncoder().encode(i):i,"string"==typeof n?new TextEncoder().encode(n):n))};return r};function oz(e){try{if("string"!=typeof e)return e;return JSON.parse(e,function(e,t){if("string"==typeof t&&/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d+)?Z$/.test(t)){let e=new Date(t);if(!isNaN(e.getTime()))return e}return t})}catch(e){return tY.error("Error parsing JSON",{error:e}),null}}function oW(e,t="/api/auth"){if(function(e){try{let t=new URL(e).pathname.replace(/\/+$/,"")||"/";return"/"!==t}catch(t){throw new no(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}(e))return e;let r=e.replace(/\/+$/,"");return t&&"/"!==t?(t=t.startsWith("/")?t:`/${t}`,`${r}${t}`):r}function oH(e,t,r,n){if(e)return oW(e,t);if(!1!==n){let e=tS.BETTER_AUTH_URL||tS.NEXT_PUBLIC_BETTER_AUTH_URL||tS.PUBLIC_BETTER_AUTH_URL||tS.NUXT_PUBLIC_BETTER_AUTH_URL||tS.NUXT_PUBLIC_AUTH_URL||("/"!==tS.BASE_URL?tS.BASE_URL:void 0);if(e)return oW(e,t)}let i=r?.headers.get("x-forwarded-host"),o=r?.headers.get("x-forwarded-proto");if(i&&o)return oW(`${o}://${i}`,t);if(r){let e=oF(r.url);if(!e)throw new no("Could not get origin from request. Please provide a valid base URL.");return oW(e,t)}}function oF(e){try{return new URL(e).origin}catch(e){return null}}function oK(e){try{return new URL(e).protocol}catch(e){return null}}function oQ(e){try{return new URL(e).host}catch(e){return null}}let oZ=new Map,oG={decode:(e,t="utf-8")=>(oZ.has(t)||oZ.set(t,new TextDecoder(t)),oZ.get(t).decode(e)),encode:new TextEncoder().encode};function oY(e,t){if("string"==typeof e)return function(e){if("string"!=typeof e||0===e.length||e.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(e)}`);let t=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(e);if(!t?.groups)return NaN;let{value:r,unit:n="ms"}=t.groups,i=parseFloat(r),o=n.toLowerCase();switch(o){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"months":case"month":case"mo":return 26298e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return 864e5*i;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*i;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:throw Error(`Unknown unit "${o}" provided to ms.parse(). value=${JSON.stringify(e)}`)}}(e);if("number"==typeof e)return function(e,t){let r;if("number"!=typeof e||!Number.isFinite(e))throw Error("Value provided to ms.format() must be of type number.");return(r=Math.abs(e))>=315576e5?`${Math.round(e/315576e5)}y`:r>=26298e5?`${Math.round(e/26298e5)}mo`:r>=6048e5?`${Math.round(e/6048e5)}w`:r>=864e5?`${Math.round(e/864e5)}d`:r>=36e5?`${Math.round(e/36e5)}h`:r>=6e4?`${Math.round(e/6e4)}m`:r>=1e3?`${Math.round(e/1e3)}s`:`${e}ms`}(e);throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(e)}`)}function oJ(e){let t=(e.advanced?.useSecureCookies!==void 0?e.advanced?.useSecureCookies:void 0!==e.baseURL?!!e.baseURL.startsWith("https://"):tO)?"__Secure-":"",r=!!e.advanced?.crossSubDomainCookies?.enabled,n=r?e.advanced?.crossSubDomainCookies?.domain||(e.baseURL?new URL(e.baseURL).hostname:void 0):void 0;if(r&&!n)throw new no("baseURL is required when crossSubdomainCookies are enabled");return function(i,o={}){let a=e.advanced?.cookiePrefix||"better-auth",s=e.advanced?.cookies?.[i]?.name||`${a}.${i}`,c=e.advanced?.cookies?.[i]?.attributes;return{name:`${t}${s}`,attributes:{secure:!!t,sameSite:"lax",path:"/",httpOnly:!0,...r?{domain:n}:{},...e.advanced?.defaultCookieAttributes,...o,...c}}}}async function oX(e,t,r){if(e.context.options.session?.cookieCache?.enabled){let n={session:Object.entries(t.session).reduce((t,[r,n])=>{let i=e.context.options.session?.additionalFields?.[r];return i&&!1===i.returned||(t[r]=n),t},{}),user:t.user},i={...e.context.authCookies.sessionData.options,maxAge:r?void 0:e.context.authCookies.sessionData.options.maxAge},o=oq(i.maxAge||60,"sec").getTime(),a=t2.encode(JSON.stringify({session:n,expiresAt:o,signature:await oB("SHA-256","base64urlnopad").sign(e.context.secret,JSON.stringify({...n,expiresAt:o}))}),{padding:!1});if(a.length>4093)return void e.context?.logger?.error(`Session data exceeds cookie size limit (${a.length} bytes > 4093 bytes). Consider reducing session data size or disabling cookie cache. Session will not be cached in cookie.`);e.setCookie(e.context.authCookies.sessionData.name,a,i)}}async function o0(e,t,r,n){let i=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);r=void 0!==r?r:!!i;let o=e.context.authCookies.sessionToken.options,a=r?void 0:e.context.sessionConfig.expiresIn;await e.setSignedCookie(e.context.authCookies.sessionToken.name,t.session.token,e.context.secret,{...o,maxAge:a,...n}),r&&await e.setSignedCookie(e.context.authCookies.dontRememberToken.name,"true",e.context.secret,e.context.authCookies.dontRememberToken.options),await oX(e,t,r),e.context.setNewSession(t),e.context.options.secondaryStorage&&await e.context.secondaryStorage?.set(t.session.token,JSON.stringify({user:t.user,session:t.session}),Math.floor((new Date(t.session.expiresAt).getTime()-Date.now())/1e3))}function o1(e,t){e.setCookie(e.context.authCookies.sessionToken.name,"",{...e.context.authCookies.sessionToken.options,maxAge:0}),e.setCookie(e.context.authCookies.sessionData.name,"",{...e.context.authCookies.sessionData.options,maxAge:0}),t||e.setCookie(e.context.authCookies.dontRememberToken.name,"",{...e.context.authCookies.dontRememberToken.options,maxAge:0})}let o2=nI(async()=>({})),o5=nI.create({use:[o2,nI(async()=>({}))]}),o6=nk.create({use:[o2]});function o3(e){switch(e){case"a-z":return"abcdefghijklmnopqrstuvwxyz";case"A-Z":return"ABCDEFGHIJKLMNOPQRSTUVWXYZ";case"0-9":return"0123456789";case"-_":return"-_";default:throw Error(`Unsupported alphabet: ${e}`)}}function o4(...e){let t=e.map(o3).join("");if(0===t.length)throw Error("No valid characters provided for random string generation.");let r=t.length;return(e,...n)=>{let i;if(e<=0)throw Error("Length must be a positive integer.");let o=t,a=r;n.length>0&&(a=(o=n.map(o3).join("")).length);let s=Math.floor(256/a)*a,c=new Uint8Array(2*e),d=c.length,l="",u=d;for(;l.length<e;)u>=d&&(crypto.getRandomValues(c),u=0),(i=c[u++])<s&&(l+=o[i%a]);return l}}function o8(e){let t,r;if("string"!=typeof e)throw new rS("JWTs must use Compact JWS serialization, JWT must be a string");let{1:n,length:i}=e.split(".");if(5===i)throw new rS("Only JWTs using Compact JWS serialization can be decoded");if(3!==i)throw new rS("Invalid JWT");if(!n)throw new rS("JWTs must contain a payload");try{t=rb(n)}catch{throw new rS("Failed to base64url decode the payload")}try{r=JSON.parse(rg.decode(t))}catch{throw new rS("Failed to parse the decoded payload as JSON")}if(!rB(r))throw new rS("Invalid JWT Claims Set");return r}function o9(e){let t;if("string"==typeof e){let r=e.split(".");(3===r.length||5===r.length)&&([t]=r)}else if("object"==typeof e&&e)if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof t||!t)throw Error();let e=JSON.parse(rg.decode(rb(t)));if(!rB(e))throw Error();return e}catch{throw TypeError("Invalid Token or Protected Header formatting")}}async function o7(e,t,r){let n;if(!rB(e))throw TypeError("JWK must be an object");switch(t??=e.alg,n??=r?.extractable??e.ext,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return rb(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new rT('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return rY({...e,alg:t,ext:n});case"AKP":if("string"!=typeof e.alg||!e.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==t&&t!==e.alg)throw TypeError("JWK alg and alg option value mismatch");return rY({...e,ext:n});case"EC":case"OKP":return rY({...e,alg:t,ext:n});default:throw new rT('Unsupported "kty" (Key Type) Parameter value')}}function ae(e){return rB(e)}class at{#r;#n=new WeakMap;constructor(e){if(!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(ae)}(e))throw new rR("JSON Web Key Set malformed");this.#r=structuredClone(e)}jwks(){return this.#r}async getKey(e,t){let{alg:r,kid:n}={...e,...t?.header},i=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new rT('Unsupported "alg" value for a JSON Web Key Set')}}(r),o=this.#r.keys.filter(e=>{let t=i===e.kty;if(t&&"string"==typeof n&&(t=n===e.kid),t&&("string"==typeof e.alg||"AKP"===i)&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":case"EdDSA":t="Ed25519"===e.crv}return t}),{0:a,length:s}=o;if(0===s)throw new rO;if(1!==s){let e=new rI,t=this.#n;throw e[Symbol.asyncIterator]=async function*(){for(let e of o)try{yield await ar(t,e,r)}catch{}},e}return ar(this.#n,a,r)}}async function ar(e,t,r){let n=e.get(t)||e.set(t,{}).get(t);if(void 0===n[r]){let e=await o7({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new rR("JSON Web Key Set members must be public keys");n[r]=e}return n[r]}function an(e){let t=new at(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>structuredClone(t.jwks()),enumerable:!1,configurable:!1,writable:!1}}),r}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(n="jose/v6.1.0");let ai=Symbol();async function ao(e,t,r,n=fetch){let i=await n(e,{method:"GET",signal:r,redirect:"manual",headers:t}).catch(e=>{if("TimeoutError"===e.name)throw new rk;throw e});if(200!==i.status)throw new rx("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await i.json()}catch{throw new rx("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let aa=Symbol();class as{#i;#o;#a;#s;#c;#d;#l;#u;#p;#f;constructor(e,t){if(!(e instanceof URL))throw TypeError("url must be an instance of URL");this.#i=new URL(e.href),this.#o="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this.#a="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this.#s="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,this.#l=new Headers(t?.headers),n&&!this.#l.has("User-Agent")&&this.#l.set("User-Agent",n),this.#l.has("accept")||(this.#l.set("accept","application/json"),this.#l.append("accept","application/jwk-set+json")),this.#u=t?.[ai],t?.[aa]!==void 0&&(this.#f=t?.[aa],function(e,t){return!("object"!=typeof e||null===e||!("uat"in e)||"number"!=typeof e.uat||Date.now()-e.uat>=t)&&"jwks"in e&&!!rB(e.jwks)&&!!Array.isArray(e.jwks.keys)&&!!Array.prototype.every.call(e.jwks.keys,rB)}(t?.[aa],this.#s)&&(this.#c=this.#f.uat,this.#p=an(this.#f.jwks)))}pendingFetch(){return!!this.#d}coolingDown(){return"number"==typeof this.#c&&Date.now()<this.#c+this.#a}fresh(){return"number"==typeof this.#c&&Date.now()<this.#c+this.#s}jwks(){return this.#p?.jwks()}async getKey(e,t){this.#p&&this.fresh()||await this.reload();try{return await this.#p(e,t)}catch(r){if(r instanceof rO&&!1===this.coolingDown())return await this.reload(),this.#p(e,t);throw r}}async reload(){this.#d&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#d=void 0),this.#d||=ao(this.#i.href,this.#l,AbortSignal.timeout(this.#o),this.#u).then(e=>{this.#p=an(e),this.#f&&(this.#f.uat=Date.now(),this.#f.jwks=e),this.#c=Date.now(),this.#d=void 0}).catch(e=>{throw this.#d=void 0,e}),await this.#d}}let ac=async e=>{let{data:t}=await rh("https://appleid.apple.com/auth/keys");if(!t?.keys)throw new nh("BAD_REQUEST",{message:"Keys not found"});let r=t.keys.find(t=>t.kid===e);if(!r)throw Error(`JWK with kid ${e} not found`);return await o7(r,r.alg)},ad=async(e,t,r)=>{let n=`https://cognito-idp.${t}.amazonaws.com/${r}/.well-known/jwks.json`;try{let{data:t}=await rh(n);if(!t?.keys)throw new nh("BAD_REQUEST",{message:"Keys not found"});let r=t.keys.find(t=>t.kid===e);if(!r)throw Error(`JWK with kid ${e} not found`);return await o7(r,r.alg)}catch(e){throw tY.error("Failed to fetch Cognito public key:",e),e}},al=(e="")=>e.split("://").map(e=>e.replace(/\/{2,}/g,"/")).join("://"),au={apple:e=>({id:"apple",name:"Apple",async createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["email","name"];return e.scope&&i.push(...e.scope),r&&i.push(...r),await nt({id:"apple",options:e,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:i,state:t,redirectURI:n,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>nr({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);let{kid:n,alg:i}=o9(t);if(!n||!i)return!1;let o=await ac(n),{payload:a}=await r9(t,o,{algorithms:[i],issuer:"https://appleid.apple.com",audience:e.audience&&e.audience.length?e.audience:e.appBundleIdentifier?e.appBundleIdentifier:e.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(e=>{void 0!==a[e]&&(a[e]=!!a[e])}),(!r||a.nonce===r)&&!!a},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let r=o8(t.idToken);if(!r)return null;let n=t.user?`${t.user.name?.firstName} ${t.user.name?.lastName}`:r.name||r.email,i="boolean"==typeof r.email_verified?r.email_verified:"true"===r.email_verified,o={...r,name:n},a=await e.mapProfileToUser?.(o);return{user:{id:r.sub,name:o.name,emailVerified:i,email:r.email,...a},data:o}},options:e}),atlassian:e=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:i}){if(!e.clientId||!e.clientSecret)throw tY.error("Client Id and Secret are required for Atlassian"),new no("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new no("codeVerifier is required for Atlassian");let o=e.disableDefaultScope?[]:["read:jira-user","offline_access"];return e.scope&&o.push(...e.scope),r&&o.push(...r),nt({id:"atlassian",options:e,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:o,state:t,codeVerifier:n,redirectURI:i,additionalParams:{audience:"api.atlassian.com"},prompt:e.prompt})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>nr({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;try{let{data:r}=await rh("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(!r)return null;let n=await e.mapProfileToUser?.(r);return{user:{id:r.account_id,name:r.name,email:r.email,image:r.picture,emailVerified:!1,...n},data:r}}catch(e){return tY.error("Failed to fetch user info from Figma:",e),null}},options:e}),cognito:e=>{if(!e.domain||!e.region||!e.userPoolId)throw tY.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new no("DOMAIN_AND_REGION_REQUIRED");let t=e.domain.replace(/^https?:\/\//,""),r=`https://${t}/oauth2/authorize`,n=`https://${t}/oauth2/token`,i=`https://${t}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:t,scopes:n,codeVerifier:i,redirectURI:o}){if(!e.clientId)throw tY.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new no("CLIENT_ID_AND_SECRET_REQUIRED");if(e.requireClientSecret&&!e.clientSecret)throw tY.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new no("CLIENT_SECRET_REQUIRED");let a=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&a.push(...e.scope),n&&a.push(...n),await nt({id:"cognito",options:{...e},authorizationEndpoint:r,scopes:a,state:t,codeVerifier:i,redirectURI:o,prompt:e.prompt})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:i})=>nr({code:t,codeVerifier:r,redirectURI:i,options:e,tokenEndpoint:n}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:n}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);try{let{kid:n,alg:i}=o9(t);if(!n||!i)return!1;let o=await ad(n,e.region,e.userPoolId),a=`https://cognito-idp.${e.region}.amazonaws.com/${e.userPoolId}`,{payload:s}=await r9(t,o,{algorithms:[i],issuer:a,audience:e.clientId,maxTokenAge:"1h"});if(r&&s.nonce!==r)return!1;return!0}catch(e){return tY.error("Failed to verify ID token:",e),!1}},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(t.idToken)try{let r=o8(t.idToken);if(!r)return null;let n=r.name||r.given_name||r.username||r.email,i={...r,name:n},o=await e.mapProfileToUser?.(i);return{user:{id:r.sub,name:i.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...o},data:i}}catch(e){tY.error("Failed to decode ID token:",e)}if(t.accessToken)try{let{data:r}=await rh(i,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(r){let t=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name||r.given_name||r.username,email:r.email,image:r.picture,emailVerified:r.email_verified,...t},data:r}}}catch(e){tY.error("Failed to fetch user info from Cognito:",e)}return null},options:e}},discord:e=>({id:"discord",name:"Discord",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["identify","email"];r&&i.push(...r),e.scope&&i.push(...e.scope);let o=i.includes("bot")&&void 0!==e.permissions?`&permissions=${e.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${i.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}&prompt=${e.prompt||"none"}${o}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:r,options:e,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;if(null===r.avatar){let e="0"===r.discriminator?Number(BigInt(r.id)>>BigInt(22))%6:parseInt(r.discriminator)%5;r.image_url=`https://cdn.discordapp.com/embed/avatars/${e}.png`}else{let e=r.avatar.startsWith("a_")?"gif":"png";r.image_url=`https://cdn.discordapp.com/avatars/${r.id}/${r.avatar}.${e}`}let i=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.global_name||r.username||"",email:r.email,emailVerified:r.verified,image:r.image_url,...i},data:r}},options:e}),facebook:e=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:t,scopes:r,redirectURI:n,loginHint:i}){let o=e.disableDefaultScope?[]:["email","public_profile"];return e.scope&&o.push(...e.scope),r&&o.push(...r),await nt({id:"facebook",options:e,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:o,state:t,redirectURI:n,loginHint:i,additionalParams:e.configId?{config_id:e.configId}:{}})},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:r,options:e,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);if(3===t.split(".").length)try{var n;let i,o,{payload:a}=await r9(t,(n=new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/"),i=new as(n,void 0),o=async(e,t)=>i.getKey(e,t),Object.defineProperties(o,{coolingDown:{get:()=>i.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>i.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>i.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>i.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>i.jwks(),enumerable:!0,configurable:!1,writable:!1}}),o),{algorithms:["RS256"],audience:e.clientId,issuer:"https://www.facebook.com"});if(r&&a.nonce!==r)return!1;return!!a}catch(e){return!1}return!0},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(t.idToken&&3===t.idToken.split(".").length){let r=o8(t.idToken),n={id:r.sub,name:r.name,email:r.email,picture:{data:{url:r.picture,height:100,width:100,is_silhouette:!1}}},i=await e.mapProfileToUser?.({...n,email_verified:!0});return{user:{...n,emailVerified:!0,...i},data:r}}let r=["id","name","email","picture",...e?.fields||[]],{data:n,error:i}=await rh("https://graph.facebook.com/me?fields="+r.join(","),{auth:{type:"Bearer",token:t.accessToken}});if(i)return null;let o=await e.mapProfileToUser?.(n);return{user:{id:n.id,name:n.name,email:n.email,image:n.picture.data.url,emailVerified:n.email_verified,...o},data:n}},options:e}),figma:e=>({id:"figma",name:"Figma",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:i}){if(!e.clientId||!e.clientSecret)throw tY.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new no("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new no("codeVerifier is required for Figma");let o=e.disableDefaultScope?[]:["file_read"];return e.scope&&o.push(...e.scope),r&&o.push(...r),await nt({id:"figma",options:e,authorizationEndpoint:"https://www.figma.com/oauth",scopes:o,state:t,codeVerifier:n,redirectURI:i})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>nr({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://www.figma.com/api/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.figma.com/api/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);try{let{data:r}=await rh("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(!r)return tY.error("Failed to fetch user from Figma"),null;let n=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.handle,email:r.email,image:r.img_url,emailVerified:!!r.email,...n},data:r}}catch(e){return tY.error("Failed to fetch user info from Figma:",e),null}},options:e}),github:e=>({id:"github",name:"GitHub",createAuthorizationURL({state:t,scopes:r,loginHint:n,redirectURI:i}){let o=e.disableDefaultScope?[]:["read:user","user:email"];return e.scope&&o.push(...e.scope),r&&o.push(...r),nt({id:"github",options:e,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:o,state:t,redirectURI:i,loginHint:n,prompt:e.prompt})},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:r,options:e,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${t.accessToken}`}});if(n)return null;let{data:i}=await rh("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});!r.email&&i&&(r.email=(i.find(e=>e.primary)??i[0])?.email);let o=i?.find(e=>e.email===r.email)?.verified??!1,a=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name||r.login,email:r.email,image:r.avatar_url,emailVerified:o,...a},data:r}},options:e}),microsoft:e=>{let t=e.tenantId||"common",r=e.authority||"https://login.microsoftonline.com",n=`${r}/${t}/oauth2/v2.0/authorize`,i=`${r}/${t}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(t){let r=e.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return e.scope&&r.push(...e.scope),t.scopes&&r.push(...t.scopes),nt({id:"microsoft",options:e,authorizationEndpoint:n,state:t.state,codeVerifier:t.codeVerifier,scopes:r,redirectURI:t.redirectURI,prompt:e.prompt,loginHint:t.loginHint})},validateAuthorizationCode:({code:t,codeVerifier:r,redirectURI:n})=>nr({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:i}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let r=o8(t.idToken),n=e.profilePhotoSize||48;await rh(`https://graph.microsoft.com/v1.0/me/photos/${n}x${n}/$value`,{headers:{Authorization:`Bearer ${t.accessToken}`},async onResponse(t){if(!e.disableProfilePhoto&&t.response.ok)try{let e=t.response.clone(),n=await e.arrayBuffer(),i=t1.encode(n);r.picture=`data:image/jpeg;base64, ${i}`}catch(e){tY.error(e&&"object"==typeof e&&"name"in e?e.name:"",e)}}});let i=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:!0,...i},data:r}},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>{let r=e.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return e.scope&&r.push(...e.scope),nn({refreshToken:t,options:{clientId:e.clientId,clientSecret:e.clientSecret},extraParams:{scope:r.join(" ")},tokenEndpoint:i})},options:e}},google:e=>({id:"google",name:"Google",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:i,loginHint:o,display:a}){if(!e.clientId||!e.clientSecret)throw tY.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new no("CLIENT_ID_AND_SECRET_REQUIRED");if(!n)throw new no("codeVerifier is required for Google");let s=e.disableDefaultScope?[]:["email","profile","openid"];return e.scope&&s.push(...e.scope),r&&s.push(...r),await nt({id:"google",options:e,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:s,state:t,codeVerifier:n,redirectURI:i,prompt:e.prompt,accessType:e.accessType,display:a||e.display,loginHint:o,hd:e.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>nr({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);let n=`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${t}`,{data:i}=await rh(n);return!!i&&i.aud===e.clientId&&("https://accounts.google.com"===i.iss||"accounts.google.com"===i.iss)},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.idToken)return null;let r=o8(t.idToken),n=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,image:r.picture,emailVerified:r.email_verified,...n},data:r}},options:e}),huggingface:e=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:i}){let o=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&o.push(...e.scope),r&&o.push(...r),nt({id:"huggingface",options:e,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:o,state:t,codeVerifier:n,redirectURI:i})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>nr({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;let i=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name||r.preferred_username,email:r.email,image:r.picture,emailVerified:r.email_verified??!1,...i},data:r}},options:e}),slack:e=>({id:"slack",name:"Slack",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["openid","profile","email"];r&&i.push(...r),e.scope&&i.push(...e.scope);let o=new URL("https://slack.com/openid/connect/authorize");return o.searchParams.set("scope",i.join(" ")),o.searchParams.set("response_type","code"),o.searchParams.set("client_id",e.clientId),o.searchParams.set("redirect_uri",e.redirectURI||n),o.searchParams.set("state",t),o},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:r,options:e,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;let i=await e.mapProfileToUser?.(r);return{user:{id:r["https://slack.com/user_id"],name:r.name||"",email:r.email,emailVerified:r.email_verified,image:r.picture||r["https://slack.com/user_image_512"],...i},data:r}},options:e}),spotify:e=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:i}){let o=e.disableDefaultScope?[]:["user-read-email"];return e.scope&&o.push(...e.scope),r&&o.push(...r),nt({id:"spotify",options:e,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:o,state:t,codeVerifier:n,redirectURI:i})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>nr({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;let i=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name,email:r.email,image:r.images[0]?.url,emailVerified:!1,...i},data:r}},options:e}),twitch:e=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["user:read:email","openid"];return e.scope&&i.push(...e.scope),r&&i.push(...r),nt({id:"twitch",redirectURI:n,options:e,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:i,state:t,claims:e.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let r=t.idToken;if(!r)return tY.error("No idToken found in token"),null;let n=o8(r),i=await e.mapProfileToUser?.(n);return{user:{id:n.sub,name:n.preferred_username,email:n.email,image:n.picture,emailVerified:n.email_verified,...i},data:n}},options:e}),twitter:e=>({id:"twitter",name:"Twitter",createAuthorizationURL(t){let r=e.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return e.scope&&r.push(...e.scope),t.scopes&&r.push(...t.scopes),nt({id:"twitter",options:e,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:r,state:t.state,codeVerifier:t.codeVerifier,redirectURI:t.redirectURI})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>nr({code:t,codeVerifier:r,authentication:"basic",redirectURI:n,options:e,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;let{data:i,error:o}=await rh("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}}),a=!1;!o&&i?.data?.confirmed_email&&(r.data.email=i.data.confirmed_email,a=!0);let s=await e.mapProfileToUser?.(r);return{user:{id:r.data.id,name:r.data.name,email:r.data.email||r.data.username||null,image:r.data.profile_image_url,emailVerified:a,...s},data:r}},options:e}),dropbox:e=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:t,scopes:r,codeVerifier:n,redirectURI:i})=>{let o=e.disableDefaultScope?[]:["account_info.read"];e.scope&&o.push(...e.scope),r&&o.push(...r);let a={};return e.accessType&&(a.token_access_type=e.accessType),await nt({id:"dropbox",options:e,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:o,state:t,redirectURI:i,codeVerifier:n,additionalParams:a})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n})=>await nr({code:t,codeVerifier:r,redirectURI:n,options:e,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;let i=await e.mapProfileToUser?.(r);return{user:{id:r.account_id,name:r.name?.display_name,email:r.email,emailVerified:r.email_verified||!1,image:r.profile_photo_url,...i},data:r}},options:e}),kick:e=>({id:"kick",name:"Kick",createAuthorizationURL({state:t,scopes:r,redirectURI:n,codeVerifier:i}){let o=e.disableDefaultScope?[]:["user:read"];return e.scope&&o.push(...e.scope),r&&o.push(...r),nt({id:"kick",redirectURI:n,options:e,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:o,codeVerifier:i,state:t})},validateAuthorizationCode:async({code:t,redirectURI:r,codeVerifier:n})=>nr({code:t,redirectURI:r,options:e,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:n}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;let i=r.data[0],o=await e.mapProfileToUser?.(i);return{user:{id:i.user_id,name:i.name,email:i.email,image:i.profile_picture,emailVerified:!0,...o},data:i}},options:e}),linear:e=>{let t="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:t,scopes:r,loginHint:n,redirectURI:i}){let o=e.disableDefaultScope?[]:["read"];return e.scope&&o.push(...e.scope),r&&o.push(...r),nt({id:"linear",options:e,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:o,state:t,redirectURI:i,loginHint:n})},validateAuthorizationCode:async({code:r,redirectURI:n})=>nr({code:r,redirectURI:n,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>nn({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(n||!r?.data?.viewer)return null;let i=r.data.viewer,o=await e.mapProfileToUser?.(i);return{user:{id:r.data.viewer.id,name:r.data.viewer.name,email:r.data.viewer.email,image:r.data.viewer.avatarUrl,emailVerified:!0,...o},data:i}},options:e}},linkedin:e=>{let t="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:t,scopes:r,redirectURI:n,loginHint:i})=>{let o=e.disableDefaultScope?[]:["profile","email","openid"];return e.scope&&o.push(...e.scope),r&&o.push(...r),await nt({id:"linkedin",options:e,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:o,state:t,loginHint:i,redirectURI:n})},validateAuthorizationCode:async({code:r,redirectURI:n})=>await nr({code:r,redirectURI:n,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>nn({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${t.accessToken}`}});if(n)return null;let i=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.name,email:r.email,emailVerified:r.email_verified||!1,image:r.picture,...i},data:r}},options:e}},gitlab:e=>{let t,{authorizationEndpoint:r,tokenEndpoint:n,userinfoEndpoint:i}=(t=e.issuer||"https://gitlab.com",{authorizationEndpoint:al(`${t}/oauth/authorize`),tokenEndpoint:al(`${t}/oauth/token`),userinfoEndpoint:al(`${t}/api/v4/user`)}),o="gitlab";return{id:o,name:"Gitlab",createAuthorizationURL:async({state:t,scopes:n,codeVerifier:i,loginHint:a,redirectURI:s})=>{let c=e.disableDefaultScope?[]:["read_user"];return e.scope&&c.push(...e.scope),n&&c.push(...n),await nt({id:o,options:e,authorizationEndpoint:r,scopes:c,state:t,redirectURI:s,codeVerifier:i,loginHint:a})},validateAuthorizationCode:async({code:t,redirectURI:r,codeVerifier:i})=>nr({code:t,redirectURI:r,options:e,codeVerifier:i,tokenEndpoint:n}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:n}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh(i,{headers:{authorization:`Bearer ${t.accessToken}`}});if(n||"active"!==r.state||r.locked)return null;let o=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name??r.username,email:r.email,image:r.avatar_url,emailVerified:!0,...o},data:r}},options:e}},tiktok:e=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["user.info.profile"];return e.scope&&i.push(...e.scope),r&&i.push(...r),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${i.join(",")}&response_type=code&client_key=${e.clientKey}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:e.redirectURI||r,options:{clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientSecret:e.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:e.clientKey}}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${t.accessToken}`}});return n?null:{user:{email:r.data.user.email||r.data.user.username,id:r.data.user.open_id,name:r.data.user.display_name||r.data.user.username,image:r.data.user.avatar_large_url,emailVerified:!!r.data.user.email},data:r}},options:e}),reddit:e=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["identity"];return e.scope&&i.push(...e.scope),r&&i.push(...r),nt({id:"reddit",options:e,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:i,state:t,redirectURI:n,duration:e.duration})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{let n=new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:e.redirectURI||r}),i={"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${t1.encode(`${e.clientId}:${e.clientSecret}`)}`},{data:o,error:a}=await rh("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:i,body:n.toString()});if(a)throw a;return r7(o)},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"User-Agent":"better-auth"}});if(n)return null;let i=await e.mapProfileToUser?.(r);return{user:{id:r.id,name:r.name,email:r.oauth_client_id,emailVerified:r.has_verified_email,image:r.icon_img?.split("?")[0],...i},data:r}},options:e}),roblox:e=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["openid","profile"];return e.scope&&i.push(...e.scope),r&&i.push(...r),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${i.join("+")}&response_type=code&client_id=${e.clientId}&redirect_uri=${encodeURIComponent(e.redirectURI||n)}&state=${t}&prompt=${e.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:e.redirectURI||r,options:e,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});if(n)return null;let i=await e.mapProfileToUser?.(r);return{user:{id:r.sub,name:r.nickname||r.preferred_username||"",image:r.picture,email:r.preferred_username||null,emailVerified:!0,...i},data:{...r}}},options:e}),salesforce:e=>{let t="sandbox"===(e.environment??"production"),r=e.loginUrl?`https://${e.loginUrl}/services/oauth2/authorize`:t?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",n=e.loginUrl?`https://${e.loginUrl}/services/oauth2/token`:t?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",i=e.loginUrl?`https://${e.loginUrl}/services/oauth2/userinfo`:t?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:t,scopes:n,codeVerifier:i,redirectURI:o}){if(!e.clientId||!e.clientSecret)throw tY.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new no("CLIENT_ID_AND_SECRET_REQUIRED");if(!i)throw new no("codeVerifier is required for Salesforce");let a=e.disableDefaultScope?[]:["openid","email","profile"];return e.scope&&a.push(...e.scope),n&&a.push(...n),nt({id:"salesforce",options:e,authorizationEndpoint:r,scopes:a,state:t,codeVerifier:i,redirectURI:e.redirectURI||o})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:i})=>nr({code:t,codeVerifier:r,redirectURI:e.redirectURI||i,options:e,tokenEndpoint:n}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:n}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);try{let{data:r}=await rh(i,{headers:{Authorization:`Bearer ${t.accessToken}`}});if(!r)return tY.error("Failed to fetch user info from Salesforce"),null;let n=await e.mapProfileToUser?.(r);return{user:{id:r.user_id,name:r.name,email:r.email,image:r.photos?.picture||r.photos?.thumbnail,emailVerified:r.email_verified??!1,...n},data:r}}catch(e){return tY.error("Failed to fetch user info from Salesforce:",e),null}},options:e}},vk:e=>({id:"vk",name:"VK",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:i}){let o=e.disableDefaultScope?[]:["email","phone"];return e.scope&&o.push(...e.scope),r&&o.push(...r),nt({id:"vk",options:e,authorizationEndpoint:"https://id.vk.com/authorize",scopes:o,state:t,redirectURI:i,codeVerifier:n})},validateAuthorizationCode:async({code:t,codeVerifier:r,redirectURI:n,deviceId:i})=>nr({code:t,codeVerifier:r,redirectURI:e.redirectURI||n,options:e,deviceId:i,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return null;let r=new URLSearchParams({access_token:t.accessToken,client_id:e.clientId}).toString(),{data:n,error:i}=await rh("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r});if(i||!n.user.email)return null;let o=await e.mapProfileToUser?.(n);return{user:{id:n.user.user_id,first_name:n.user.first_name,last_name:n.user.last_name,email:n.user.email,image:n.user.avatar,emailVerified:!!n.user.email,birthday:n.user.birthday,sex:n.user.sex,name:`${n.user.first_name} ${n.user.last_name}`,...o},data:n}},options:e}),zoom:e=>{let t={pkce:!0,...e};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:e,redirectURI:r,codeVerifier:n})=>{let i=new URLSearchParams({response_type:"code",redirect_uri:t.redirectURI?t.redirectURI:r,client_id:t.clientId,state:e});if(t.pkce){let e=await ne(n);i.set("code_challenge_method","S256"),i.set("code_challenge",e)}let o=new URL("https://zoom.us/oauth/authorize");return o.search=i.toString(),o},validateAuthorizationCode:async({code:e,redirectURI:r,codeVerifier:n})=>nr({code:e,redirectURI:t.redirectURI||r,codeVerifier:n,options:t,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),async getUserInfo(e){if(t.getUserInfo)return t.getUserInfo(e);let{data:r,error:n}=await rh("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${e.accessToken}`}});if(n)return null;let i=await t.mapProfileToUser?.(r);return{user:{id:r.id,name:r.display_name,image:r.pic_url,email:r.email,emailVerified:!!r.verified,...i},data:{...r}}}}},notion:e=>{let t="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:t,scopes:r,loginHint:n,redirectURI:i}){let o=(e.disableDefaultScope,[]);return e.scope&&o.push(...e.scope),r&&o.push(...r),nt({id:"notion",options:e,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:o,state:t,redirectURI:i,loginHint:n,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:r,redirectURI:n})=>nr({code:r,redirectURI:n,options:e,tokenEndpoint:t,authentication:"basic"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>nn({refreshToken:r,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:t}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${t.accessToken}`,"Notion-Version":"2022-06-28"}});if(n||!r)return null;let i=r.bot?.owner?.user;if(!i)return null;let o=await e.mapProfileToUser?.(i);return{user:{id:i.id,name:i.name||"Notion User",email:i.person?.email||null,image:i.avatar_url,emailVerified:!!i.person?.email,...o},data:i}},options:e}},kakao:e=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return e.scope&&i.push(...e.scope),r&&i.push(...r),nt({id:"kakao",options:e,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:i,state:t,redirectURI:n})},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:r,options:e,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(n||!r)return null;let i=await e.mapProfileToUser?.(r),o=r.kakao_account||{},a=o.profile||{};return{user:{id:String(r.id),name:a.nickname||o.name||void 0,email:o.email,image:a.profile_image_url||a.thumbnail_image_url,emailVerified:!!o.is_email_valid&&!!o.is_email_verified,...i},data:r}},options:e}),naver:e=>({id:"naver",name:"Naver",createAuthorizationURL({state:t,scopes:r,redirectURI:n}){let i=e.disableDefaultScope?[]:["profile","email"];return e.scope&&i.push(...e.scope),r&&i.push(...r),nt({id:"naver",options:e,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:i,state:t,redirectURI:n})},validateAuthorizationCode:async({code:t,redirectURI:r})=>nr({code:t,redirectURI:r,options:e,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>nn({refreshToken:t,options:{clientId:e.clientId,clientKey:e.clientKey,clientSecret:e.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let{data:r,error:n}=await rh("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${t.accessToken}`}});if(n||!r||"00"!==r.resultcode)return null;let i=await e.mapProfileToUser?.(r),o=r.response||{};return{user:{id:o.id,name:o.name||o.nickname,email:o.email,image:o.profile_image,emailVerified:!1,...i},data:r}},options:e}),line:e=>{let t="https://api.line.me/oauth2/v2.1/token";return{id:"line",name:"LINE",async createAuthorizationURL({state:t,scopes:r,codeVerifier:n,redirectURI:i,loginHint:o}){let a=e.disableDefaultScope?[]:["openid","profile","email"];return e.scope&&a.push(...e.scope),r&&a.push(...r),await nt({id:"line",options:e,authorizationEndpoint:"https://access.line.me/oauth2/v2.1/authorize",scopes:a,state:t,codeVerifier:n,redirectURI:i,loginHint:o})},validateAuthorizationCode:async({code:r,codeVerifier:n,redirectURI:i})=>nr({code:r,codeVerifier:n,redirectURI:i,options:e,tokenEndpoint:t}),refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async r=>nn({refreshToken:r,options:{clientId:e.clientId,clientSecret:e.clientSecret},tokenEndpoint:t}),async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);let n=new URLSearchParams;n.set("id_token",t),n.set("client_id",e.clientId),r&&n.set("nonce",r);let{data:i,error:o}=await rh("https://api.line.me/oauth2/v2.1/verify",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:n});return!o&&!!i&&i.aud===e.clientId&&(!r||!i.nonce||i.nonce===r)},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);let r=null;if(t.idToken)try{r=o8(t.idToken)}catch{}if(!r){let{data:e}=await rh("https://api.line.me/oauth2/v2.1/userinfo",{headers:{authorization:`Bearer ${t.accessToken}`}});r=e||null}if(!r)return null;let n=await e.mapProfileToUser?.(r),i=r.sub||r.userId,o=r.name||r.displayName,a=r.picture||r.pictureUrl||void 0;return{user:{id:i,name:o,email:r.email,image:a,emailVerified:!1,...n},data:r}},options:e}},paypal:e=>{let t="sandbox"===(e.environment||"sandbox"),r=t?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",n=t?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",i=t?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:t,codeVerifier:n,redirectURI:i}){if(!e.clientId||!e.clientSecret)throw tY.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new no("CLIENT_ID_AND_SECRET_REQUIRED");return await nt({id:"paypal",options:e,authorizationEndpoint:r,scopes:[],state:t,codeVerifier:n,redirectURI:i,prompt:e.prompt})},validateAuthorizationCode:async({code:t,redirectURI:r})=>{let i=t1.encode(`${e.clientId}:${e.clientSecret}`);try{let e=await rh(n,{method:"POST",headers:{Authorization:`Basic ${i}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:t,redirect_uri:r}).toString()});if(!e.data)throw new no("FAILED_TO_GET_ACCESS_TOKEN");let o=e.data;return{accessToken:o.access_token,refreshToken:o.refresh_token,accessTokenExpiresAt:o.expires_in?new Date(Date.now()+1e3*o.expires_in):void 0,idToken:o.id_token}}catch(e){throw tY.error("PayPal token exchange failed:",e),new no("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:e.refreshAccessToken?e.refreshAccessToken:async t=>{let r=t1.encode(`${e.clientId}:${e.clientSecret}`);try{let e=await rh(n,{method:"POST",headers:{Authorization:`Basic ${r}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:t}).toString()});if(!e.data)throw new no("FAILED_TO_REFRESH_ACCESS_TOKEN");let i=e.data;return{accessToken:i.access_token,refreshToken:i.refresh_token,accessTokenExpiresAt:i.expires_in?new Date(Date.now()+1e3*i.expires_in):void 0}}catch(e){throw tY.error("PayPal token refresh failed:",e),new no("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(t,r){if(e.disableIdTokenSignIn)return!1;if(e.verifyIdToken)return e.verifyIdToken(t,r);try{return!!o8(t).sub}catch(e){return tY.error("Failed to verify PayPal ID token:",e),!1}},async getUserInfo(t){if(e.getUserInfo)return e.getUserInfo(t);if(!t.accessToken)return tY.error("Access token is required to fetch PayPal user info"),null;try{let r=await rh(`${i}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${t.accessToken}`,Accept:"application/json"}});if(!r.data)return tY.error("Failed to fetch user info from PayPal"),null;let n=r.data,o=await e.mapProfileToUser?.(n);return{user:{id:n.user_id,name:n.name,email:n.email,image:n.picture,emailVerified:n.email_verified,...o},data:n}}catch(e){return tY.error("Failed to fetch user info from PayPal:",e),null}},options:e}}},ap=Object.keys(au),af=oM.enum(ap).or(oM.string()),ah=oM.optional(oM.object({disableCookieCache:o$.coerce.boolean().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:o$.coerce.boolean().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()})),am=()=>o6("/get-session",{method:"GET",query:ah,requireHeaders:!0,metadata:{openapi:{description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async e=>{try{let t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)return null;let r=e.getCookie(e.context.authCookies.sessionData.name),n=r?oz(oG.decode(t2.decode(r))):null;if(n&&!await oB("SHA-256","base64urlnopad").verify(e.context.secret,JSON.stringify({...n.session,expiresAt:n.expiresAt}),n.signature)){let t=e.context.authCookies.sessionData.name;return e.setCookie(t,"",{maxAge:0}),e.json(null)}let i=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret);if(n?.session&&e.context.options.session?.cookieCache?.enabled&&!e.query?.disableCookieCache){let t=n.session;if(!(n.expiresAt<Date.now()||t.session.expiresAt<new Date))return e.context.session=t,e.json(t);{let t=e.context.authCookies.sessionData.name;e.setCookie(t,"",{maxAge:0})}}let o=await e.context.internalAdapter.findSession(t);if(e.context.session=o,!o||o.session.expiresAt<new Date)return o1(e),o&&await e.context.internalAdapter.deleteSession(o.session.token),e.json(null);if(i||e.query?.disableRefresh)return e.json(o);let a=e.context.sessionConfig.expiresIn,s=e.context.sessionConfig.updateAge;if(o.session.expiresAt.valueOf()-1e3*a+1e3*s<=Date.now()&&(!e.query?.disableRefresh||!e.context.options.session?.disableSessionRefresh)){let t=await e.context.internalAdapter.updateSession(o.session.token,{expiresAt:oq(e.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!t)return o1(e),e.json(null,{status:401});let r=(t.expiresAt.valueOf()-Date.now())/1e3;return await o0(e,{session:t,user:o.user},!1,{maxAge:r}),e.json({session:t,user:o.user})}return await oX(e,o,!!i),e.json(o)}catch(t){throw e.context.logger.error("INTERNAL_SERVER_ERROR",t),new nh("INTERNAL_SERVER_ERROR",{message:ni.FAILED_TO_GET_SESSION})}}),ag=async(e,t)=>{if(e.context.session)return e.context.session;let r=await am()({...e,asResponse:!1,headers:e.headers,returnHeaders:!1,query:{...t,...e.query}}).catch(e=>null);return e.context.session=r,r},ay=o5(async e=>{let t=await ag(e);if(!t?.session)throw new nh("UNAUTHORIZED");return{session:t}}),ab=o5(async e=>{let t=await ag(e,{disableCookieCache:!0});if(!t?.session)throw new nh("UNAUTHORIZED");return{session:t}});o5(async e=>{let t=await ag(e);if(!t?.session&&(e.request||e.headers))throw new nh("UNAUTHORIZED");return{session:t}});let aw=o5(async e=>{let t=await ag(e);if(!t?.session)throw new nh("UNAUTHORIZED");if(0===e.context.sessionConfig.freshAge)return{session:t};let r=e.context.sessionConfig.freshAge,n=t.session.updatedAt?.valueOf()||t.session.createdAt.valueOf();if(!(Date.now()-n<1e3*r))throw new nh("FORBIDDEN",{message:"Session is not fresh"});return{session:t}}),ax=o6("/revoke-session",{method:"POST",body:oM.object({token:oM.string().meta({description:"The token to revoke"})}),use:[ab],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async e=>{let t=e.body.token,r=await e.context.internalAdapter.findSession(t);if(!r)throw new nh("BAD_REQUEST",{message:"Session not found"});if(r.session.userId!==e.context.session.user.id)throw new nh("UNAUTHORIZED");try{await e.context.internalAdapter.deleteSession(t)}catch(t){throw e.context.logger.error(t&&"object"==typeof t&&"name"in t?t.name:"",t),new nh("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),av=o6("/revoke-sessions",{method:"POST",use:[ab],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{try{await e.context.internalAdapter.deleteSessions(e.context.session.user.id)}catch(t){throw e.context.logger.error(t&&"object"==typeof t&&"name"in t?t.name:"",t),new nh("INTERNAL_SERVER_ERROR")}return e.json({status:!0})}),a_=o6("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[ab],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async e=>{let t=e.context.session;if(!t.user)throw new nh("UNAUTHORIZED");let r=(await e.context.internalAdapter.listSessions(t.user.id)).filter(e=>e.expiresAt>new Date).filter(t=>t.token!==e.context.session.session.token);return await Promise.all(r.map(t=>e.context.internalAdapter.deleteSession(t.token))),e.json({status:!0})}),aE=e=>o4("a-z","A-Z","0-9")(e||32);function aT(e,t){return{digest:async r=>{let n=new TextEncoder,i="string"==typeof r?n.encode(r):r,o=await na().digest(e,i);return"hex"===t?Array.from(new Uint8Array(o)).map(e=>e.toString(16).padStart(2,"0")).join(""):"base64"===t||"base64url"===t||"base64urlnopad"===t?t.includes("url")?t2.encode(o,{padding:"base64urlnopad"!==t}):t1.encode(o):o}}}let aA=o4("a-z","0-9","A-Z","-_"),aS=new WeakMap;function aR(e,t){let r=t.fields,n={};for(let t in e){let i=r[t];if(!i){n[t]=e[t];continue}!1!==i.returned&&(n[t]=e[t])}return n}function aO(e,t){aS.has(e)||aS.set(e,new Map);let r=aS.get(e);if(r.has(t))return r.get(t);let n={..."user"===t?e.user?.additionalFields:{},..."session"===t?e.session?.additionalFields:{}};for(let r of e.plugins||[])r.schema&&r.schema[t]&&(n={...n,...r.schema[t].fields});return aS.get(e).set(t,n),n}function aI(e,t){return aR(t,{fields:aO(e,"user")})}function ak(e,t){return aR(t,{fields:aO(e,"session")})}function aN(e,t={},r){return function(e,t){let r=t.action||"create",n=t.fields,i=Object.assign(Object.create(null),null);for(let t in n){if(t in e){if(!1===n[t].input){if(void 0!==n[t].defaultValue&&"update"!==r){i[t]=n[t].defaultValue;continue}if(e[t])throw new nh("BAD_REQUEST",{message:`${t} is not allowed to be set`});continue}if(n[t].validator?.input&&void 0!==e[t]){i[t]=n[t].validator.input.parse(e[t]);continue}if(n[t].transform?.input&&void 0!==e[t]){i[t]=n[t].transform?.input(e[t]);continue}i[t]=e[t];continue}if(void 0!==n[t].defaultValue&&"create"===r){i[t]=n[t].defaultValue;continue}if(n[t].required&&"create"===r)throw new nh("BAD_REQUEST",{message:`${t} is required`})}return i}(t,{fields:aO(e,"user"),action:r})}function aP(e,t){if(!t)return e;for(let r in t){let n=t[r]?.modelName;for(let i in n&&(e[r].modelName=n),e[r].fields){let n=t[r]?.fields?.[i];n&&(e[r].fields[i].fieldName=n)}}return e}let aU=oM.object({id:oM.string(),createdAt:oM.date().default(()=>new Date),updatedAt:oM.date().default(()=>new Date)});function aC(e){if(null===e||"object"!=typeof e)return!1;let t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.iterator in e)&&(!(Symbol.toStringTag in e)||"[object Module]"===Object.prototype.toString.call(e))}function aD(e){return(...t)=>t.reduce((t,r)=>(function e(t,r,n=".",i){if(!aC(r))return e(t,{},n,i);let o=Object.assign({},r);for(let r in t){if("__proto__"===r||"constructor"===r)continue;let a=t[r];null!=a&&(i&&i(o,r,a,n)||(Array.isArray(a)&&Array.isArray(o[r])?o[r]=[...a,...o[r]]:aC(a)&&aC(o[r])?o[r]=e(a,o[r],(n?`${n}.`:"")+r.toString(),i):o[r]=a))}return o})(t,r,"",e),{})}aU.extend({email:oM.string().transform(e=>e.toLowerCase()),emailVerified:oM.boolean().default(!1),name:oM.string(),image:oM.string().nullish()}),aU.extend({providerId:oM.string(),accountId:oM.string(),userId:o$.coerce.string(),accessToken:oM.string().nullish(),refreshToken:oM.string().nullish(),idToken:oM.string().nullish(),accessTokenExpiresAt:oM.date().nullish(),refreshTokenExpiresAt:oM.date().nullish(),scope:oM.string().nullish(),password:oM.string().nullish()}),aU.extend({userId:o$.coerce.string(),expiresAt:oM.date(),token:oM.string(),ipAddress:oM.string().nullish(),userAgent:oM.string().nullish()}),aU.extend({value:oM.string(),expiresAt:oM.date(),identifier:oM.string()}),oM.object({key:oM.string(),count:oM.number(),lastRequest:oM.number()});let aL=aD();function aj(e){if("boolean"!=typeof e)throw Error(`boolean expected, not ${e}`)}function a$(e){if(!Number.isSafeInteger(e)||e<0)throw Error("positive integer expected, got "+e)}function aM(e,t,r=""){let n=e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name,i=e?.length,o=void 0!==t;if(!n||o&&i!==t)throw Error((r&&`"${r}" `)+"expected Uint8Array"+(o?` of length ${t}`:"")+", got "+(n?`length=${i}`:`type=${typeof e}`));return e}function aq(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function aV(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function aB(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}aD((e,t,r)=>{if(void 0!==e[t]&&"function"==typeof r)return e[t]=r(e[t]),!0}),aD((e,t,r)=>{if(Array.isArray(e[t])&&"function"==typeof r)return e[t]=r(e[t]),!0});let az=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],aW="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,aH=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function aF(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}function aK(e,t,r=!0){if(void 0===t)return new Uint8Array(e);if(t.length!==e)throw Error('"output" expected Uint8Array of length '+e+", got: "+t.length);if(r&&t.byteOffset%4!=0)throw Error("invalid output, must be aligned");return t}function aQ(e){return Uint8Array.from(e)}function aZ(e=32){let t="object"==typeof globalThis?globalThis.crypto:null;if("function"!=typeof t?.getRandomValues)throw Error("crypto.getRandomValues must be defined");return t.getRandomValues(new Uint8Array(e))}function aG(e,t=aZ){let{nonceLength:r}=e;a$(r);let n=(e,t)=>{let r=function(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];aM(n),t+=n.length}let r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){let i=e[t];r.set(i,n),n+=i.length}return r}(e,t);return t.fill(0),r};return(i,...o)=>({encrypt(a){aM(a);let s=t(r),c=e(i,s,...o).encrypt(a);return c instanceof Promise?c.then(e=>n(s,e)):n(s,c)},decrypt(t){aM(t);let n=t.subarray(0,r),a=t.subarray(r);return e(i,n,...o).decrypt(a)}})}let aY=e=>Uint8Array.from(e.split(""),e=>e.charCodeAt(0)),aJ=aY("expand 16-byte k"),aX=aY("expand 32-byte k"),a0=aV(aJ),a1=aV(aX);function a2(e,t){return e<<t|e>>>32-t}function a5(e){return e.byteOffset%4==0}let a6=0x100000000-1,a3=Uint32Array.of();function a4(e,t){let{allowShortKeys:r,extendNonceFn:n,counterLength:i,counterRight:o,rounds:a}=function(e,t){if(null==t||"object"!=typeof t)throw Error("options must be defined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!=typeof e)throw Error("core must be a function");return a$(i),a$(a),aj(o),aj(r),(t,s,c,d,l=0)=>{let u,p;aM(t,void 0,"key"),aM(s,void 0,"nonce"),aM(c,void 0,"data");let f=c.length;if(void 0===d&&(d=new Uint8Array(f)),aM(d,void 0,"output"),a$(l),l<0||l>=a6)throw Error("arx: counter overflow");if(d.length<f)throw Error(`arx: output (${d.length}) is shorter than data (${f})`);let h=[],m=t.length;if(32===m)h.push(u=aQ(t)),p=a1;else if(16===m&&r)(u=new Uint8Array(32)).set(t),u.set(t,16),p=a0,h.push(u);else throw aM(t,32,"arx key"),Error("invalid key size");a5(s)||h.push(s=aQ(s));let g=aV(u);if(n){if(24!==s.length)throw Error("arx: extended nonce must be 24 bytes");n(p,g,aV(s.subarray(0,16)),g),s=s.subarray(16)}let y=16-i;if(y!==s.length)throw Error(`arx: nonce must be ${y} or 16 bytes`);if(12!==y){let e=new Uint8Array(12);e.set(s,o?0:12-s.length),s=e,h.push(s)}return!function(e,t,r,n,i,o,a,s){let c=i.length,d=new Uint8Array(64),l=aV(d),u=a5(i)&&a5(o),p=u?aV(i):a3,f=u?aV(o):a3;for(let h=0;h<c;a++){if(e(t,r,n,l,a,s),a>=a6)throw Error("arx: counter overflow");let m=Math.min(64,c-h);if(u&&64===m){let e=h/4;if(h%4!=0)throw Error("arx: invalid block position");for(let t=0,r;t<16;t++)f[r=e+t]=p[r]^l[t];h+=64;continue}for(let e=0,t;e<m;e++)o[t=h+e]=i[t]^d[e];h+=m}}(e,p,g,aV(s),c,d,l,a),aB(...h),d}}function a8(e,t){return 255&e[t++]|(255&e[t++])<<8}class a9{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(e){const t=a8(e=aQ(aM(e,32,"key")),0),r=a8(e,2),n=a8(e,4),i=a8(e,6),o=a8(e,8),a=a8(e,10),s=a8(e,12),c=a8(e,14);this.r[0]=8191&t,this.r[1]=(t>>>13|r<<3)&8191,this.r[2]=(r>>>10|n<<6)&7939,this.r[3]=(n>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|s<<5)&8065,this.r[8]=(s>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=a8(e,16+2*t)}process(e,t,r=!1){let{h:n,r:i}=this,o=i[0],a=i[1],s=i[2],c=i[3],d=i[4],l=i[5],u=i[6],p=i[7],f=i[8],h=i[9],m=a8(e,t+0),g=a8(e,t+2),y=a8(e,t+4),b=a8(e,t+6),w=a8(e,t+8),x=a8(e,t+10),v=a8(e,t+12),_=a8(e,t+14),E=n[0]+(8191&m),T=n[1]+((m>>>13|g<<3)&8191),A=n[2]+((g>>>10|y<<6)&8191),S=n[3]+((y>>>7|b<<9)&8191),R=n[4]+((b>>>4|w<<12)&8191),O=n[5]+(w>>>1&8191),I=n[6]+((w>>>14|x<<2)&8191),k=n[7]+((x>>>11|v<<5)&8191),N=n[8]+((v>>>8|_<<8)&8191),P=n[9]+(_>>>5|2048*!r),U=0,C=0+E*o+5*h*T+5*f*A+5*p*S+5*u*R;U=C>>>13,C&=8191,C+=5*l*O+5*d*I+5*c*k+5*s*N+5*a*P,U+=C>>>13,C&=8191;let D=U+E*a+T*o+5*h*A+5*f*S+5*p*R;U=D>>>13,D&=8191,D+=5*u*O+5*l*I+5*d*k+5*c*N+5*s*P,U+=D>>>13,D&=8191;let L=U+E*s+T*a+A*o+5*h*S+5*f*R;U=L>>>13,L&=8191,L+=5*p*O+5*u*I+5*l*k+5*d*N+5*c*P,U+=L>>>13,L&=8191;let j=U+E*c+T*s+A*a+S*o+5*h*R;U=j>>>13,j&=8191,j+=5*f*O+5*p*I+5*u*k+5*l*N+5*d*P,U+=j>>>13,j&=8191;let $=U+E*d+T*c+A*s+S*a+R*o;U=$>>>13,$&=8191,$+=5*h*O+5*f*I+5*p*k+5*u*N+5*l*P,U+=$>>>13,$&=8191;let M=U+E*l+T*d+A*c+S*s+R*a;U=M>>>13,M&=8191,M+=O*o+5*h*I+5*f*k+5*p*N+5*u*P,U+=M>>>13,M&=8191;let q=U+E*u+T*l+A*d+S*c+R*s;U=q>>>13,q&=8191,q+=O*a+I*o+5*h*k+5*f*N+5*p*P,U+=q>>>13,q&=8191;let V=U+E*p+T*u+A*l+S*d+R*c;U=V>>>13,V&=8191,V+=O*s+I*a+k*o+5*h*N+5*f*P,U+=V>>>13,V&=8191;let B=U+E*f+T*p+A*u+S*l+R*d;U=B>>>13,B&=8191,B+=O*c+I*s+k*a+N*o+5*h*P,U+=B>>>13,B&=8191;let z=U+E*h+T*f+A*p+S*u+R*l;U=z>>>13,z&=8191,z+=O*d+I*c+k*s+N*a+P*o,U+=z>>>13,z&=8191,C=8191&(U=(U=(U<<2)+U|0)+C|0),U>>>=13,D+=U,n[0]=C,n[1]=D,n[2]=L,n[3]=j,n[4]=$,n[5]=M,n[6]=q,n[7]=V,n[8]=B,n[9]=z}finalize(){let{h:e,pad:t}=this,r=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=n,n=e[t]>>>13,e[t]&=8191;e[0]+=5*n,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let t=1;t<10;t++)r[t]=e[t]+n,n=r[t]>>>13,r[t]&=8191;r[9]-=8192;let i=(1^n)-1;for(let e=0;e<10;e++)r[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|r[t];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=65535&o;for(let r=1;r<8;r++)o=(e[r]+t[r]|0)+(o>>>16)|0,e[r]=65535&o;aB(r)}update(e){aq(this),aM(e);let{buffer:t,blockLen:r}=this,n=(e=aQ(e)).length;for(let i=0;i<n;){let o=Math.min(r-this.pos,n-i);if(o===r){for(;r<=n-i;i+=r)this.process(e,i);continue}t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){aB(this.h,this.r,this.buffer,this.pad)}digestInto(e){aq(this);aM(e,void 0,"output");let t=this.outputLen;if(e.length<t)throw Error("digestInto() expects output buffer of length at least "+t);this.finished=!0;let{buffer:r,h:n}=this,{pos:i}=this;if(i){for(r[i++]=1;i<16;i++)r[i]=0;this.process(r,0,!0)}this.finalize();let o=0;for(let t=0;t<8;t++)e[o++]=n[t]>>>0,e[o++]=n[t]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}}let a7=(eo=e=>new a9(e),(d=(e,t)=>eo(t).update(e).digest()).outputLen=(l=eo(new Uint8Array(32))).outputLen,d.blockLen=l.blockLen,d.create=e=>eo(e),d);function se(e,t,r,n,i,o=20){let a=e[0],s=e[1],c=e[2],d=e[3],l=t[0],u=t[1],p=t[2],f=t[3],h=t[4],m=t[5],g=t[6],y=t[7],b=r[0],w=r[1],x=r[2],v=a,_=s,E=c,T=d,A=l,S=u,R=p,O=f,I=h,k=m,N=g,P=y,U=i,C=b,D=w,L=x;for(let e=0;e<o;e+=2)I=I+(U=a2(U^(v=v+A|0),16))|0,v=v+(A=a2(A^I,12))|0,I=I+(U=a2(U^v,8))|0,A=a2(A^I,7),k=k+(C=a2(C^(_=_+S|0),16))|0,_=_+(S=a2(S^k,12))|0,k=k+(C=a2(C^_,8))|0,S=a2(S^k,7),N=N+(D=a2(D^(E=E+R|0),16))|0,E=E+(R=a2(R^N,12))|0,N=N+(D=a2(D^E,8))|0,R=a2(R^N,7),P=P+(L=a2(L^(T=T+O|0),16))|0,T=T+(O=a2(O^P,12))|0,P=P+(L=a2(L^T,8))|0,O=a2(O^P,7),N=N+(L=a2(L^(v=v+S|0),16))|0,v=v+(S=a2(S^N,12))|0,N=N+(L=a2(L^v,8))|0,S=a2(S^N,7),P=P+(U=a2(U^(_=_+R|0),16))|0,_=_+(R=a2(R^P,12))|0,P=P+(U=a2(U^_,8))|0,R=a2(R^P,7),I=I+(C=a2(C^(E=E+O|0),16))|0,E=E+(O=a2(O^I,12))|0,I=I+(C=a2(C^E,8))|0,O=a2(O^I,7),k=k+(D=a2(D^(T=T+A|0),16))|0,T=T+(A=a2(A^k,12))|0,k=k+(D=a2(D^T,8))|0,A=a2(A^k,7);let j=0;n[j++]=a+v|0,n[j++]=s+_|0,n[j++]=c+E|0,n[j++]=d+T|0,n[j++]=l+A|0,n[j++]=u+S|0,n[j++]=p+R|0,n[j++]=f+O|0,n[j++]=h+I|0,n[j++]=m+k|0,n[j++]=g+N|0,n[j++]=y+P|0,n[j++]=i+U|0,n[j++]=b+C|0,n[j++]=w+D|0,n[j++]=x+L|0}let st=a4(se,{counterRight:!1,counterLength:4,allowShortKeys:!1}),sr=a4(se,{counterRight:!1,counterLength:8,extendNonceFn:function(e,t,r,n){let i=e[0],o=e[1],a=e[2],s=e[3],c=t[0],d=t[1],l=t[2],u=t[3],p=t[4],f=t[5],h=t[6],m=t[7],g=r[0],y=r[1],b=r[2],w=r[3];for(let e=0;e<20;e+=2)p=p+(g=a2(g^(i=i+c|0),16))|0,i=i+(c=a2(c^p,12))|0,p=p+(g=a2(g^i,8))|0,c=a2(c^p,7),f=f+(y=a2(y^(o=o+d|0),16))|0,o=o+(d=a2(d^f,12))|0,f=f+(y=a2(y^o,8))|0,d=a2(d^f,7),h=h+(b=a2(b^(a=a+l|0),16))|0,a=a+(l=a2(l^h,12))|0,h=h+(b=a2(b^a,8))|0,l=a2(l^h,7),m=m+(w=a2(w^(s=s+u|0),16))|0,s=s+(u=a2(u^m,12))|0,m=m+(w=a2(w^s,8))|0,u=a2(u^m,7),h=h+(w=a2(w^(i=i+d|0),16))|0,i=i+(d=a2(d^h,12))|0,h=h+(w=a2(w^i,8))|0,d=a2(d^h,7),m=m+(g=a2(g^(o=o+l|0),16))|0,o=o+(l=a2(l^m,12))|0,m=m+(g=a2(g^o,8))|0,l=a2(l^m,7),p=p+(y=a2(y^(a=a+u|0),16))|0,a=a+(u=a2(u^p,12))|0,p=p+(y=a2(y^a,8))|0,u=a2(u^p,7),f=f+(b=a2(b^(s=s+c|0),16))|0,s=s+(c=a2(c^f,12))|0,f=f+(b=a2(b^s,8))|0,c=a2(c^f,7);let x=0;n[x++]=i,n[x++]=o,n[x++]=a,n[x++]=s,n[x++]=g,n[x++]=y,n[x++]=b,n[x++]=w},allowShortKeys:!1}),sn=new Uint8Array(16),si=(e,t)=>{e.update(t);let r=t.length%16;r&&e.update(sn.subarray(r))},so=new Uint8Array(32);function sa(e,t,r,n,i){var o,a;let s,c;void 0!==i&&aM(i,void 0,"AAD");let d=e(t,r,so),l=(o=n.length,a=i?i.length:0,aj(!0),(c=new DataView((s=new Uint8Array(16)).buffer,s.byteOffset,s.byteLength)).setBigUint64(0,BigInt(a),!0),c.setBigUint64(8,BigInt(o),!0),s),u=a7.create(d);i&&si(u,i),si(u,n),u.update(l);let p=u.digest();return aB(d,l),p}let ss=e=>(t,r,n)=>({encrypt(i,o){let a=i.length;(o=aK(a+16,o,!1)).set(i);let s=o.subarray(0,-16);e(t,r,s,s,1);let c=sa(e,t,r,s,n);return o.set(c,a),aB(c),o},decrypt(i,o){o=aK(i.length-16,o,!1);let a=i.subarray(0,-16),s=i.subarray(-16),c=sa(e,t,r,a,n);if(!function(e,t){if(e.length!==t.length)return!1;let r=0;for(let n=0;n<e.length;n++)r|=e[n]^t[n];return 0===r}(s,c))throw Error("invalid tag");return o.set(i.subarray(0,-16)),e(t,r,o,o,1),aB(c),o}});ss(st);let sc=((e,t)=>{function r(n,...i){if(aM(n,void 0,"key"),!az)throw Error("Non little-endian hardware is not yet supported");void 0!==e.nonceLength&&aM(i[0],e.varSizeNonce?void 0:e.nonceLength,"nonce");let o=e.tagLength;o&&void 0!==i[1]&&aM(i[1],void 0,"AAD");let a=t(n,...i),s=(e,t)=>{if(void 0!==t){if(2!==e)throw Error("cipher output not supported");aM(t,void 0,"output")}},c=!1;return{encrypt(e,t){if(c)throw Error("cannot encrypt() twice with same key + nonce");return c=!0,aM(e),s(a.encrypt.length,t),a.encrypt(e,t)},decrypt(e,t){if(aM(e),o&&e.length<o)throw Error('"ciphertext" expected length bigger than tagLength='+o);return s(a.decrypt.length,t),a.decrypt(e,t)}}}return Object.assign(r,e),r})({blockSize:64,nonceLength:24,tagLength:16},ss(sr)),sd=async(e,t,r)=>{let n=await rM(e,t,"sign");return rU(e,n),new Uint8Array(await crypto.subtle.sign(rP(e,n.algorithm),n,r))};class sl{#e;#h;#m;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#e=e}setProtectedHeader(e){if(this.#h)throw TypeError("setProtectedHeader can only be called once");return this.#h=e,this}setUnprotectedHeader(e){if(this.#m)throw TypeError("setUnprotectedHeader can only be called once");return this.#m=e,this}async sign(e,t){let r;if(!this.#h&&!this.#m)throw new rA("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!rV(this.#h,this.#m))throw new rA("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let n={...this.#h,...this.#m},i=rG(rA,new Map([["b64",!0]]),t?.crit,this.#h,n),o=!0;if(i.has("b64")&&"boolean"!=typeof(o=this.#h.b64))throw new rA('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=n;if("string"!=typeof a||!a)throw new rA('JWS "alg" (Algorithm) Header Parameter missing or invalid');rZ(a,e,"sign");let s=this.#e;o&&(s=rm.encode(rw(s)));let c=ry(r=this.#h?rm.encode(rw(JSON.stringify(this.#h))):rm.encode(""),rm.encode("."),s),d=await rX(e,a),l={signature:rw(await sd(a,d,c)),payload:""};return o&&(l.payload=rg.decode(s)),this.#m&&(l.header=this.#m),this.#h&&(l.protected=rg.decode(r)),l}}class su{#g;constructor(e){this.#g=new sl(e)}setProtectedHeader(e){return this.#g.setProtectedHeader(e),this}async sign(e,t){let r=await this.#g.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class sp{#h;#y;constructor(e={}){this.#y=new r8(e)}setIssuer(e){return this.#y.iss=e,this}setSubject(e){return this.#y.sub=e,this}setAudience(e){return this.#y.aud=e,this}setJti(e){return this.#y.jti=e,this}setNotBefore(e){return this.#y.nbf=e,this}setExpirationTime(e){return this.#y.exp=e,this}setIssuedAt(e){return this.#y.iat=e,this}setProtectedHeader(e){return this.#h=e,this}async sign(e,t){let r=new su(this.#y.data());if(r.setProtectedHeader(this.#h),Array.isArray(this.#h?.crit)&&this.#h.crit.includes("b64")&&!1===this.#h.b64)throw new rS("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}function sf(e,t=""){if(!Number.isSafeInteger(e)||e<0){let r=t&&`"${t}" `;throw Error(`${r}expected integer >= 0, got ${e}`)}}function sh(e,t,r=""){let n=e instanceof Uint8Array||ArrayBuffer.isView(e)&&"Uint8Array"===e.constructor.name,i=e?.length,o=void 0!==t;if(!n||o&&i!==t)throw Error((r&&`"${r}" `)+"expected Uint8Array"+(o?` of length ${t}`:"")+", got "+(n?`length=${i}`:`type=${typeof e}`));return e}function sm(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash must wrapped by utils.createHasher");sf(e.outputLen),sf(e.blockLen)}function sg(e,t=!0){if(e.destroyed)throw Error("Hash instance has been destroyed");if(t&&e.finished)throw Error("Hash#digest() has already been called")}function sy(e,t){sh(e,void 0,"digestInto() output");let r=t.outputLen;if(e.length<r)throw Error('"digestInto() output" expected to be of length >='+r)}function sb(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}function sw(...e){for(let t=0;t<e.length;t++)e[t].fill(0)}function sx(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function sv(e,t){return e<<32-t|e>>>t}function s_(e,t){return e<<t|e>>>32-t>>>0}let sE=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?e=>e:function(e){for(let r=0;r<e.length;r++){var t;e[r]=(t=e[r])<<24&0xff000000|t<<8&0xff0000|t>>>8&65280|t>>>24&255}return e},sT="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex;function sA(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:void 0}let sS=async()=>{};async function sR(e,t,r){let n=Date.now();for(let i=0;i<e;i++){r(i);let e=Date.now()-n;e>=0&&e<t||(await sS(),n+=e)}}function sO(e,t=""){if("string"==typeof e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}return sh(e,void 0,t)}function sI(e,t){if(void 0!==t&&"[object Object]"!==({}).toString.call(t))throw Error("options must be object or undefined");return Object.assign(e,t)}class sk{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,t){if(sm(e),sh(t,void 0,"key"),this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,n=new Uint8Array(r);n.set(t.length>r?e.create().update(t).digest():t);for(let e=0;e<n.length;e++)n[e]^=54;this.iHash.update(n),this.oHash=e.create();for(let e=0;e<n.length;e++)n[e]^=106;this.oHash.update(n),sw(n)}update(e){return sg(this),this.iHash.update(e),this}digestInto(e){sg(this),sh(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});let{oHash:t,iHash:r,finished:n,destroyed:i,blockLen:o,outputLen:a}=this;return e.finished=n,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let sN=(e,t,r)=>new sk(e,t).update(r).digest();function sP(e,t,r,n){var i;let o,{c:a,dkLen:s,DK:c,PRF:d,PRFSalt:l}=function(e,t,r,n){sm(e);let{c:i,dkLen:o,asyncTick:a}=sI({dkLen:32,asyncTick:10},n);if(sf(i,"c"),sf(o,"dkLen"),sf(a,"asyncTick"),i<1)throw Error("iterations (c) must be >= 1");let s=sO(t,"password"),c=sO(r,"salt"),d=new Uint8Array(o),l=sN.create(e,s),u=l._cloneInto().update(c);return{c:i,dkLen:o,asyncTick:a,DK:d,PRF:l,PRFSalt:u}}(e,t,r,n),u=new Uint8Array(4),p=sx(u),f=new Uint8Array(d.outputLen);for(let e=1,t=0;t<s;e++,t+=d.outputLen){let r=c.subarray(t,t+d.outputLen);p.setInt32(0,e,!1),(o=l._cloneInto(o)).update(u).digestInto(f),r.set(f.subarray(0,r.length));for(let e=1;e<a;e++){d._cloneInto(o).update(f).digestInto(f);for(let e=0;e<r.length;e++)r[e]^=f[e]}}return i=o,d.destroy(),l.destroy(),i&&i.destroy(),sw(f),c}sN.create=(e,t)=>new sk(e,t);class sU{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,t,r,n){this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=sx(this.buffer)}update(e){sg(this),sh(e);let{view:t,buffer:r,blockLen:n}=this,i=e.length;for(let o=0;o<i;){let a=Math.min(n-this.pos,i-o);if(a===n){let t=sx(e);for(;n<=i-o;o+=n)this.process(t,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){sg(this),sy(e,this),this.finished=!0;let{buffer:t,view:r,blockLen:n,isLE:i}=this,{pos:o}=this;t[o++]=128,sw(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(r,0),o=0);for(let e=o;e<n;e++)t[e]=0;r.setBigUint64(n-8,BigInt(8*this.length),i),this.process(r,0);let a=sx(e),s=this.outputLen;if(s%4)throw Error("_sha2: outputLen must be aligned to 32bit");let c=s/4,d=this.get();if(c>d.length)throw Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)a.setUint32(4*e,d[e],i)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){(e||=new this.constructor).set(...this.get());let{blockLen:t,buffer:r,length:n,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=n,e.pos=a,n%t&&e.buffer.set(r),e}clone(){return this._cloneInto()}}let sC=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),sD=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),sL=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),sj=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),s$=BigInt(0x100000000-1),sM=BigInt(32);function sq(e,t=!1){let r=e.length,n=new Uint32Array(r),i=new Uint32Array(r);for(let o=0;o<r;o++){let{h:r,l:a}=function(e,t=!1){return t?{h:Number(e&s$),l:Number(e>>sM&s$)}:{h:0|Number(e>>sM&s$),l:0|Number(e&s$)}}(e[o],t);[n[o],i[o]]=[r,a]}return[n,i]}let sV=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),sB=new Uint32Array(64);class sz extends sU{constructor(e){super(64,e,8,!1)}get(){let{A:e,B:t,C:r,D:n,E:i,F:o,G:a,H:s}=this;return[e,t,r,n,i,o,a,s]}set(e,t,r,n,i,o,a,s){this.A=0|e,this.B=0|t,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|o,this.G=0|a,this.H=0|s}process(e,t){for(let r=0;r<16;r++,t+=4)sB[r]=e.getUint32(t,!1);for(let e=16;e<64;e++){let t=sB[e-15],r=sB[e-2],n=sv(t,7)^sv(t,18)^t>>>3,i=sv(r,17)^sv(r,19)^r>>>10;sB[e]=i+sB[e-7]+n+sB[e-16]|0}let{A:r,B:n,C:i,D:o,E:a,F:s,G:c,H:d}=this;for(let e=0;e<64;e++){var l,u,p,f;let t=d+(sv(a,6)^sv(a,11)^sv(a,25))+((l=a)&s^~l&c)+sV[e]+sB[e]|0,h=(sv(r,2)^sv(r,13)^sv(r,22))+((u=r)&(p=n)^u&(f=i)^p&f)|0;d=c,c=s,s=a,a=o+t|0,o=i,i=n,n=r,r=t+h|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,s=s+this.F|0,c=c+this.G|0,d=d+this.H|0,this.set(r,n,i,o,a,s,c,d)}roundClean(){sw(sB)}destroy(){this.set(0,0,0,0,0,0,0,0),sw(this.buffer)}}class sW extends sz{A=0|sC[0];B=0|sC[1];C=0|sC[2];D=0|sC[3];E=0|sC[4];F=0|sC[5];G=0|sC[6];H=0|sC[7];constructor(){super(32)}}let sH=sq(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(e=>BigInt(e))),sF=sH[0],sK=sH[1],sQ=new Uint32Array(80),sZ=new Uint32Array(80),sG=function(e,t={}){let r=(t,r)=>e(r).update(t).digest(),n=e(void 0);return r.outputLen=n.outputLen,r.blockLen=n.blockLen,r.create=t=>e(t),Object.assign(r,t),Object.freeze(r)}(()=>new sW,{oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,1])});function sY(e,t,r,n,i,o){let a=e[t++]^r[n++],s=e[t++]^r[n++],c=e[t++]^r[n++],d=e[t++]^r[n++],l=e[t++]^r[n++],u=e[t++]^r[n++],p=e[t++]^r[n++],f=e[t++]^r[n++],h=e[t++]^r[n++],m=e[t++]^r[n++],g=e[t++]^r[n++],y=e[t++]^r[n++],b=e[t++]^r[n++],w=e[t++]^r[n++],x=e[t++]^r[n++],v=e[t++]^r[n++],_=a,E=s,T=c,A=d,S=l,R=u,O=p,I=f,k=h,N=m,P=g,U=y,C=b,D=w,L=x,j=v;for(let e=0;e<8;e+=2)S^=s_(_+C|0,7),k^=s_(S+_|0,9),C^=s_(k+S|0,13),_^=s_(C+k|0,18),N^=s_(R+E|0,7),D^=s_(N+R|0,9),E^=s_(D+N|0,13),R^=s_(E+D|0,18),L^=s_(P+O|0,7),T^=s_(L+P|0,9),O^=s_(T+L|0,13),P^=s_(O+T|0,18),A^=s_(j+U|0,7),I^=s_(A+j|0,9),U^=s_(I+A|0,13),j^=s_(U+I|0,18),E^=s_(_+A|0,7),T^=s_(E+_|0,9),A^=s_(T+E|0,13),_^=s_(A+T|0,18),O^=s_(R+S|0,7),I^=s_(O+R|0,9),S^=s_(I+O|0,13),R^=s_(S+I|0,18),U^=s_(P+N|0,7),k^=s_(U+P|0,9),N^=s_(k+U|0,13),P^=s_(N+k|0,18),C^=s_(j+L|0,7),D^=s_(C+j|0,9),L^=s_(D+C|0,13),j^=s_(L+D|0,18);i[o++]=a+_|0,i[o++]=s+E|0,i[o++]=c+T|0,i[o++]=d+A|0,i[o++]=l+S|0,i[o++]=u+R|0,i[o++]=p+O|0,i[o++]=f+I|0,i[o++]=h+k|0,i[o++]=m+N|0,i[o++]=g+P|0,i[o++]=y+U|0,i[o++]=b+C|0,i[o++]=w+D|0,i[o++]=x+L|0,i[o++]=v+j|0}function sJ(e,t,r,n,i){let o=n+0,a=n+16*i;for(let n=0;n<16;n++)r[a+n]=e[t+(2*i-1)*16+n];for(let n=0;n<i;n++,o+=16,t+=16)sY(r,a,e,t,r,o),n>0&&(a+=16),sY(r,o,e,t+=16,r,a)}async function sX(e,t,r){let n,{N:i,r:o,p:a,dkLen:s,blockSize32:c,V:d,B32:l,B:u,tmp:p,blockMixCb:f,asyncTick:h}=function(e,t,r){let{N:n,r:i,p:o,dkLen:a,asyncTick:s,maxmem:c,onProgress:d}=sI({dkLen:32,asyncTick:10,maxmem:0x40000400},r);if(sf(n,"N"),sf(i,"r"),sf(o,"p"),sf(a,"dkLen"),sf(s,"asyncTick"),sf(c,"maxmem"),void 0!==d&&"function"!=typeof d)throw Error("progressCb must be a function");let l=128*i,u=l/4;if(n<=1||(n&n-1)!=0||n>0x100000000)throw Error('"N" expected a power of 2, and 2^1 <= N <= 2^32');if(o<1||o>0x1fffffffe0/l)throw Error('"p" expected integer 1..((2^32 - 1) * 32) / (128 * r)');if(a<1||a>0x1fffffffe0)throw Error('"dkLen" expected integer 1..(2^32 - 1) * 32');if(l*(n+o)>c)throw Error('"maxmem" limit was hit, expected 128*r*(N+p) <= "maxmem"='+c);let p=sP(sG,e,t,{c:1,dkLen:l*o}),f=sb(p),h=sb(new Uint8Array(l*n)),m=sb(new Uint8Array(l)),g=()=>{};if(d){let e=2*n*o,t=Math.max(Math.floor(e/1e4),1),r=0;g=()=>{r++,d&&(!(r%t)||r===e)&&d(r/e)}}return{N:n,r:i,p:o,dkLen:a,blockSize32:u,V:h,B32:f,B:p,tmp:m,blockMixCb:g,asyncTick:s}}(e,t,r);sE(l);for(let e=0;e<a;e++){let t=c*e;for(let e=0;e<c;e++)d[e]=l[t+e];let r=0;await sR(i-1,h,()=>{sJ(d,r,d,r+=c,o),f()}),sJ(d,(i-1)*c,l,t,o),f(),await sR(i,h,()=>{let e=(l[t+c-16]&i-1)>>>0;for(let r=0;r<c;r++)p[r]=l[t+r]^d[e*c+r];sJ(p,0,l,t,o),f()})}return sE(l),n=sP(sG,e,u,{c:1,dkLen:s}),sw(u,d,p),n}async function s0(e,t,r=3600){return await new sp(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+r).sign(new TextEncoder().encode(t))}async function s1(e,t){return await sX(e.normalize("NFKC"),t,{N:16384,p:1,r:16,dkLen:64,maxmem:0x4000000})}let s2=async e=>{let t=oV(crypto.getRandomValues(new Uint8Array(16))),r=await s1(e,t);return`${t}:${oV(r)}`},s5=async({hash:e,password:t})=>{let[r,n]=e.split(":");if(!r||!n)throw new no("Invalid password hash");return function(e,t){let r=new Uint8Array(e),n=new Uint8Array(t),i=r.length^n.length,o=Math.max(r.length,n.length);for(let e=0;e<o;e++)i|=(e<r.length?r[e]:0)^(e<n.length?n[e]:0);return 0===i}(await s1(t,r),function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(sT)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=sA(e.charCodeAt(i)),o=sA(e.charCodeAt(i+1));if(void 0===r||void 0===o)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+o}return n}(n))},s6=async({key:e,data:t})=>{let r=await aT("SHA-256").digest(e),n=function(e){if("string"!=typeof e)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(e))}(t);var i=aG(sc)(new Uint8Array(r)).encrypt(n);if(aM(i),aW)return i.toHex();let o="";for(let e=0;e<i.length;e++)o+=aH[i[e]];return o},s3=async({key:e,data:t})=>{let r=await aT("SHA-256").digest(e),n=function(e){if("string"!=typeof e)throw Error("hex string expected, got "+typeof e);if(aW)return Uint8Array.fromHex(e);let t=e.length,r=t/2;if(t%2)throw Error("hex string expected, got unpadded hex of length "+t);let n=new Uint8Array(r);for(let t=0,i=0;t<r;t++,i+=2){let r=aF(e.charCodeAt(i)),o=aF(e.charCodeAt(i+1));if(void 0===r||void 0===o)throw Error('hex string expected, got non-hex character "'+(e[i]+e[i+1])+'" at index '+i);n[t]=16*r+o}return n}(t),i=aG(sc)(new Uint8Array(r));return new TextDecoder().decode(i.decrypt(n))};function s4(e){return"-"===e||"^"===e||"$"===e||"+"===e||"."===e||"("===e||")"===e||"|"===e||"["===e||"]"===e||"{"===e||"}"===e||"*"===e||"?"===e||"\\"===e?`\\${e}`:e}function s8(e,t){if("string"!=typeof t)throw TypeError(`Sample must be a string, but ${typeof t} given`);return e.test(t)}function s9(e,t){if("string"!=typeof e&&!Array.isArray(e))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof e} given`);if(("string"==typeof t||"boolean"==typeof t)&&(t={separator:t}),2==arguments.length&&!(void 0===t||"object"==typeof t&&null!==t&&!Array.isArray(t)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof t} given`);if("\\"===(t=t||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let r=function e(t,r=!0){if(Array.isArray(t)){let n=t.map(t=>`^${e(t,r)}$`);return`(?:${n.join("|")})`}let n="",i="",o=".";!0===r?(n="/",i="[/\\\\]",o="[^/\\\\]"):r&&((i=function(e){let t="";for(let r=0;r<e.length;r++)t+=s4(e[r]);return t}(n=r)).length>1?(i=`(?:${i})`,o=`((?!${i}).)`):o=`[^${i}]`);let a=r?`${i}+?`:"",s=r?`${i}*?`:"",c=r?t.split(n):[t],d="";for(let e=0;e<c.length;e++){let t=c[e],n=c[e+1],i="";if(t||!(e>0)){if(r&&(i=e===c.length-1?s:"**"!==n?a:""),r&&"**"===t){i&&(d+=0===e?"":i,d+=`(?:${o}*?${i})*?`);continue}for(let e=0;e<t.length;e++){let r=t[e];"\\"===r?e<t.length-1&&(d+=s4(t[e+1]),e++):"?"===r?d+=o:"*"===r?d+=`${o}*?`:d+=s4(r)}d+=i}}return d}(e,t.separator),n=RegExp(`^${r}$`,t.flags),i=s8.bind(null,n);return i.options=t,i.pattern=e,i.regexp=n,i}let s7=o5(async e=>{if(e.request?.method!=="POST"||!e.request)return;let t=e.request?.headers,r=e.request,{body:n,query:i,context:o}=e;if(function(e){let t=["accept","accept-language","content-language","content-type"],r=["application/x-www-form-urlencoded","multipart/form-data","text/plain"];for(let[n,i]of e.entries())if(!t.includes(n.toLowerCase())||"content-type"===n.toLowerCase()&&!r.includes(i?.split(";")[0]?.trim()?.toLowerCase()||""))return!1;return!0}(t)&&!e.context.skipCSRFCheck)throw new nh("FORBIDDEN",{message:"Invalid request"});let a=t?.get("origin")||t?.get("referer")||"",s=n?.callbackURL||i?.callbackURL,c=n?.redirectTo,d=n?.errorCallbackURL,l=n?.newUserCallbackURL,u=Array.isArray(o.options.trustedOrigins)?o.trustedOrigins:[...o.trustedOrigins,...await o.options.trustedOrigins?.(r)||[]],p=t?.has("cookie"),f=(t,r)=>{if(t&&!u.some(e=>((e,t)=>{if(e.startsWith("/"))return!1;if(t.includes("*")){if(t.includes("://"))return s9(t)(oF(e)||e);let r=oQ(e);return!!r&&s9(t)(r)}let r=oK(e);return"http:"!==r&&"https:"!==r&&r?e.startsWith(t):t===oF(e)})(t,e)||t?.startsWith("/")&&"origin"!==r&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(t)))throw e.context.logger.error(`Invalid ${r}: ${t}`),e.context.logger.info(`If it's a valid URL, please add ${t} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${u}`),new nh("FORBIDDEN",{message:`Invalid ${r}`})};if(p&&!e.context.skipCSRFCheck&&!e.context.skipOriginCheck){if(!a||"null"===a)throw new nh("FORBIDDEN",{message:"Missing or null Origin"});f(a,"origin")}s&&f(s,"callbackURL"),c&&f(c,"redirectURL"),d&&f(d,"errorCallbackURL"),l&&f(l,"newUserCallbackURL")}),ce=e=>o5(async t=>{if(!t.request)return;let{context:r}=t,n=e(t),i=Array.isArray(r.options.trustedOrigins)?r.trustedOrigins:[...r.trustedOrigins,...await r.options.trustedOrigins?.(t.request)||[]],o=(e,r)=>{if(e&&!i.some(t=>((e,t)=>{if(e.startsWith("/"))return!1;if(t.includes("*")){if(t.includes("://"))return s9(t)(oF(e)||e);let r=oQ(e);return!!r&&s9(t)(r)}let r=oK(e);return"http:"!==r&&"https:"!==r&&r?e.startsWith(t):t===oF(e)})(e,t)||e?.startsWith("/")&&"origin"!==r&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(e)))throw t.context.logger.error(`Invalid ${r}: ${e}`),t.context.logger.info(`If it's a valid URL, please add ${e} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${i}`),new nh("FORBIDDEN",{message:`Invalid ${r}`})};for(let e of Array.isArray(n)?n:[n])o(e,"callbackURL")});async function ct(e,t,r,n=3600){return await s0({email:t.toLowerCase(),updateTo:r},e,n)}async function cr(e,t){if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new nh("BAD_REQUEST",{message:"Verification email isn't enabled"});let r=await ct(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:t,url:n,token:r},e.request)}let cn=o6("/send-verification-email",{method:"POST",body:oM.object({email:oM.email().meta({description:"The email to send the verification email to"}),callbackURL:oM.string().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async e=>{if(!e.context.options.emailVerification?.sendVerificationEmail)throw e.context.logger.error("Verification email isn't enabled."),new nh("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:t}=e.body,r=await ag(e);if(!r){let r=await e.context.internalAdapter.findUserByEmail(t);return r&&await cr(e,r.user),e.json({status:!0})}if(r?.user.emailVerified)throw new nh("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(r?.user.email!==t)throw new nh("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await cr(e,r.user),e.json({status:!0})}),ci=o6("/verify-email",{method:"GET",query:oM.object({token:oM.string().meta({description:"The token to verify the email"}),callbackURL:oM.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[ce(e=>e.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string",description:"User ID"},email:{type:"string",description:"User email"},name:{type:"string",description:"User name"},image:{type:"string",description:"User image URL"},emailVerified:{type:"boolean",description:"Indicates if the user email is verified"},createdAt:{type:"string",description:"User creation date"},updatedAt:{type:"string",description:"User update date"}},required:["id","email","name","image","emailVerified","createdAt","updatedAt"]},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async e=>{let t;function r(t){if(e.query.callbackURL){if(e.query.callbackURL.includes("?"))throw e.redirect(`${e.query.callbackURL}&error=${t}`);throw e.redirect(`${e.query.callbackURL}?error=${t}`)}throw new nh("UNAUTHORIZED",{message:t})}let{token:n}=e.query;try{t=await r9(n,new TextEncoder().encode(e.context.secret),{algorithms:["HS256"]})}catch(e){if(e instanceof r_)return r("token_expired");return r("invalid_token")}let i=oM.object({email:oM.string().email(),updateTo:oM.string().optional()}).parse(t.payload),o=await e.context.internalAdapter.findUserByEmail(i.email);if(!o)return r("user_not_found");if(i.updateTo){let t=await ag(e);if(!t||t.user.email!==i.email){if(e.query.callbackURL)throw e.redirect(`${e.query.callbackURL}?error=unauthorized`);return r("unauthorized")}let n=await e.context.internalAdapter.updateUserByEmail(i.email,{email:i.updateTo,emailVerified:!1},e),o=await ct(e.context.secret,i.updateTo);if(await e.context.options.emailVerification?.sendVerificationEmail?.({user:n,url:`${e.context.baseURL}/verify-email?token=${o}&callbackURL=${e.query.callbackURL||"/"}`,token:o},e.request),await o0(e,{session:t.session,user:{...t.user,email:i.updateTo,emailVerified:!1}}),e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:{id:n.id,email:n.email,name:n.name,image:n.image,emailVerified:n.emailVerified,createdAt:n.createdAt,updatedAt:n.updatedAt}})}e.context.options.emailVerification?.onEmailVerification&&await e.context.options.emailVerification.onEmailVerification(o.user,e.request);let a=await e.context.internalAdapter.updateUserByEmail(i.email,{emailVerified:!0},e);if(e.context.options.emailVerification?.afterEmailVerification&&await e.context.options.emailVerification.afterEmailVerification(a,e.request),e.context.options.emailVerification?.autoSignInAfterVerification){let t=await ag(e);if(t&&t.user.email===i.email)await o0(e,{session:t.session,user:{...t.user,emailVerified:!0}});else{let t=await e.context.internalAdapter.createSession(o.user.id,e);if(!t)throw new nh("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await o0(e,{session:t,user:{...o.user,emailVerified:!0}})}}if(e.query.callbackURL)throw e.redirect(e.query.callbackURL);return e.json({status:!0,user:null})}),co={isAction:!1};async function ca(e,t){let r=e.body?.callbackURL||e.context.options.baseURL;if(!r)throw new nh("BAD_REQUEST",{message:"callbackURL is required"});let n=aA(128),i=aA(32),o=e.context.createAuthCookie("state",{maxAge:3e5});await e.setSignedCookie(o.name,i,e.context.secret,o.attributes);let a=JSON.stringify({callbackURL:r,codeVerifier:n,errorURL:e.body?.errorCallbackURL,newUserURL:e.body?.newUserCallbackURL,link:t,expiresAt:Date.now()+6e5,requestSignUp:e.body?.requestSignUp}),s=new Date;s.setMinutes(s.getMinutes()+10);let c=await e.context.internalAdapter.createVerificationValue({value:a,identifier:i,expiresAt:s},e);if(!c)throw e.context.logger.error("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database"),new nh("INTERNAL_SERVER_ERROR",{message:"Unable to create verification"});return{state:c.identifier,codeVerifier:n}}async function cs(e){let t=e.query.state||e.body.state,r=await e.context.internalAdapter.findVerificationValue(t);if(!r){e.context.logger.error("State Mismatch. Verification not found",{state:t});let r=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${r}?error=please_restart_the_process`)}let n=oM.object({callbackURL:oM.string(),codeVerifier:oM.string(),errorURL:oM.string().optional(),newUserURL:oM.string().optional(),expiresAt:oM.number(),link:oM.object({email:oM.string(),userId:o$.coerce.string()}).optional(),requestSignUp:oM.boolean().optional()}).parse(JSON.parse(r.value));n.errorURL||(n.errorURL=`${e.context.baseURL}/error`);let i=e.context.createAuthCookie("state"),o=await e.getSignedCookie(i.name,e.context.secret);if(!e.context.oauthConfig?.skipStateCookieCheck&&(!o||o!==t)){let t=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${t}?error=state_mismatch`)}if(e.setCookie(i.name,"",{maxAge:0}),n.expiresAt<Date.now()){await e.context.internalAdapter.deleteVerificationValue(r.id);let t=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${t}?error=please_restart_the_process`)}return await e.context.internalAdapter.deleteVerificationValue(r.id),n}function cc(e,t){return t.options.account?.encryptOAuthTokens&&e?s6({key:t.secret,data:e}):e}async function cd(e,{userInfo:t,account:r,callbackURL:n,disableSignUp:i,overrideUserInfo:o}){let a=await e.context.internalAdapter.findOAuthUser(t.email.toLowerCase(),r.accountId,r.providerId).catch(t=>{tY.error("Better auth was unable to query your database.\nError: ",t);let r=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;throw e.redirect(`${r}?error=internal_server_error`)}),s=a?.user,c=!s;if(a){let n=a.accounts.find(e=>e.providerId===r.providerId&&e.accountId===r.accountId);if(n){if(e.context.options.account?.updateAccountOnSignIn!==!1){let t=Object.fromEntries(Object.entries({idToken:r.idToken,accessToken:await cc(r.accessToken,e.context),refreshToken:await cc(r.refreshToken,e.context),accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope}).filter(([e,t])=>void 0!==t));Object.keys(t).length>0&&await e.context.internalAdapter.updateAccount(n.id,t,e)}t.emailVerified&&!a.user.emailVerified&&t.email.toLowerCase()===a.user.email&&await e.context.internalAdapter.updateUser(a.user.id,{emailVerified:!0})}else{let n=e.context.options.account?.accountLinking?.trustedProviders;if(!n?.includes(r.providerId)&&!t.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return tI()&&tY.warn(`User already exist but account isn't linked to ${r.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await e.context.internalAdapter.linkAccount({providerId:r.providerId,accountId:t.id.toString(),userId:a.user.id,accessToken:await cc(r.accessToken,e.context),refreshToken:await cc(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope},e)}catch(e){return tY.error("Unable to link account",e),{error:"unable to link account",data:null}}t.emailVerified&&!a.user.emailVerified&&t.email.toLowerCase()===a.user.email&&await e.context.internalAdapter.updateUser(a.user.id,{emailVerified:!0})}if(o){let{id:r,...n}=t;await e.context.internalAdapter.updateUser(a.user.id,{...n,email:t.email.toLowerCase(),emailVerified:t.email.toLowerCase()===a.user.email&&a.user.emailVerified||t.emailVerified})}}else{if(i)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:i,...o}=t;if(s=await e.context.internalAdapter.createOAuthUser({...o,email:t.email.toLowerCase()},{accessToken:await cc(r.accessToken,e.context),refreshToken:await cc(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scope,providerId:r.providerId,accountId:t.id.toString()},e).then(e=>e?.user),!t.emailVerified&&s&&e.context.options.emailVerification?.sendOnSignUp){let t=await ct(e.context.secret,s.email,void 0,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${n}`;await e.context.options.emailVerification?.sendVerificationEmail?.({user:s,url:r,token:t},e.request)}}catch(e){if(tY.error(e),e instanceof nh)return{error:e.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!s)return{error:"unable to create user",data:null,isRegister:!1};let d=await e.context.internalAdapter.createSession(s.id,e);return d?{data:{session:d,user:s},error:null,isRegister:c}:{error:"unable to create session",data:null,isRegister:!1}}let cl=o6("/sign-in/social",{method:"POST",body:oM.object({callbackURL:oM.string().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:oM.string().optional(),errorCallbackURL:oM.string().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:af,disableRedirect:oM.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:oM.optional(oM.object({token:oM.string().meta({description:"ID token from the provider"}),nonce:oM.string().meta({description:"Nonce used to generate the token"}).optional(),accessToken:oM.string().meta({description:"Access token from the provider"}).optional(),refreshToken:oM.string().meta({description:"Refresh token from the provider"}).optional(),expiresAt:oM.number().meta({description:"Expiry date of the token"}).optional()})),scopes:oM.array(oM.string()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:oM.boolean().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:oM.string().meta({description:"The login hint to use for the authorization code request"}).optional()}),metadata:{openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token",url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}}},required:["redirect","token","user"]}}}}}}}},async e=>{let t=e.context.socialProviders.find(t=>t.id===e.body.provider);if(!t)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new nh("NOT_FOUND",{message:ni.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!t.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new nh("NOT_FOUND",{message:ni.ID_TOKEN_NOT_SUPPORTED});let{token:r,nonce:n}=e.body.idToken;if(!await t.verifyIdToken(r,n))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new nh("UNAUTHORIZED",{message:ni.INVALID_TOKEN});let i=await t.getUserInfo({idToken:r,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!i||!i?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new nh("UNAUTHORIZED",{message:ni.FAILED_TO_GET_USER_INFO});if(!i.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new nh("UNAUTHORIZED",{message:ni.USER_EMAIL_NOT_FOUND});let o=await cd(e,{userInfo:{...i.user,email:i.user.email,id:String(i.user.id),name:i.user.name||"",image:i.user.image,emailVerified:i.user.emailVerified||!1},account:{providerId:t.id,accountId:String(i.user.id),accessToken:e.body.idToken.accessToken},callbackURL:e.body.callbackURL,disableSignUp:t.disableImplicitSignUp&&!e.body.requestSignUp||t.disableSignUp});if(o.error)throw new nh("UNAUTHORIZED",{message:o.error});return await o0(e,o.data),e.json({redirect:!1,token:o.data.session.token,url:void 0,user:{id:o.data.user.id,email:o.data.user.email,name:o.data.user.name,image:o.data.user.image,emailVerified:o.data.user.emailVerified,createdAt:o.data.user.createdAt,updatedAt:o.data.user.updatedAt}})}let{codeVerifier:r,state:n}=await ca(e),i=await t.createAuthorizationURL({state:n,codeVerifier:r,redirectURI:`${e.context.baseURL}/callback/${t.id}`,scopes:e.body.scopes,loginHint:e.body.loginHint});return e.json({url:i.toString(),redirect:!e.body.disableRedirect})}),cu=o6("/sign-in/email",{method:"POST",body:oM.object({email:oM.string().meta({description:"Email of the user"}),password:oM.string().meta({description:"Password of the user"}),callbackURL:oM.string().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:oM.boolean().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{openapi:{description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"null",nullable:!0},user:{type:"object",properties:{id:{type:"string"},email:{type:"string"},name:{type:"string",nullable:!0},image:{type:"string",nullable:!0},emailVerified:{type:"boolean"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"}},required:["id","email","emailVerified","createdAt","updatedAt"]}},required:["redirect","token","user"]}}}}}}}},async e=>{if(!e.context.options?.emailAndPassword?.enabled)throw e.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new nh("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:t,password:r}=e.body;if(!oM.string().email().safeParse(t).success)throw new nh("BAD_REQUEST",{message:ni.INVALID_EMAIL});let n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)throw await e.context.password.hash(r),e.context.logger.error("User not found",{email:t}),new nh("UNAUTHORIZED",{message:ni.INVALID_EMAIL_OR_PASSWORD});let i=n.accounts.find(e=>"credential"===e.providerId);if(!i)throw e.context.logger.error("Credential account not found",{email:t}),new nh("UNAUTHORIZED",{message:ni.INVALID_EMAIL_OR_PASSWORD});let o=i?.password;if(!o)throw e.context.logger.error("Password not found",{email:t}),new nh("UNAUTHORIZED",{message:ni.INVALID_EMAIL_OR_PASSWORD});if(!await e.context.password.verify({hash:o,password:r}))throw e.context.logger.error("Invalid password"),new nh("UNAUTHORIZED",{message:ni.INVALID_EMAIL_OR_PASSWORD});if(e.context.options?.emailAndPassword?.requireEmailVerification&&!n.user.emailVerified){if(!e.context.options?.emailVerification?.sendVerificationEmail)throw new nh("FORBIDDEN",{message:ni.EMAIL_NOT_VERIFIED});if(e.context.options?.emailVerification?.sendOnSignIn){let t=await ct(e.context.secret,n.user.email,void 0,e.context.options.emailVerification?.expiresIn),r=`${e.context.baseURL}/verify-email?token=${t}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:n.user,url:r,token:t},e.request)}throw new nh("FORBIDDEN",{message:ni.EMAIL_NOT_VERIFIED})}let a=await e.context.internalAdapter.createSession(n.user.id,e,!1===e.body.rememberMe);if(!a)throw e.context.logger.error("Failed to create session"),new nh("UNAUTHORIZED",{message:ni.FAILED_TO_CREATE_SESSION});return await o0(e,{session:a,user:n.user},!1===e.body.rememberMe),e.json({redirect:!!e.body.callbackURL,token:a.token,url:e.body.callbackURL,user:{id:n.user.id,email:n.user.email,name:n.user.name,image:n.user.image,emailVerified:n.user.emailVerified,createdAt:n.user.createdAt,updatedAt:n.user.updatedAt}})}),cp=oM.object({code:oM.string().optional(),error:oM.string().optional(),device_id:oM.string().optional(),error_description:oM.string().optional(),state:oM.string().optional(),user:oM.string().optional()}),cf=o6("/callback/:id",{method:["GET","POST"],body:cp.optional(),query:cp.optional(),metadata:co},async e=>{let t,r,n,i=e.context.options.onAPIError?.errorURL||`${e.context.baseURL}/error`;try{if("GET"===e.method)t=cp.parse(e.query);else if("POST"===e.method)t=cp.parse(e.body);else throw Error("Unsupported method")}catch(t){throw e.context.logger.error("INVALID_CALLBACK_REQUEST",t),e.redirect(`${i}?error=invalid_callback_request`)}let{code:o,error:a,state:s,error_description:c,device_id:d}=t;if(!s){e.context.logger.error("State not found",a);let t=i.includes("?")?"&":"?",r=`${i}${t}state=state_not_found`;throw e.redirect(r)}let{codeVerifier:l,callbackURL:u,link:p,errorURL:f,newUserURL:h,requestSignUp:m}=await cs(e);function g(t,r){let n=f??i,o=new URLSearchParams({error:t});r&&o.set("error_description",r);let a=n.includes("?")?"&":"?",s=`${n}${a}${o.toString()}`;throw e.redirect(s)}if(a&&g(a,c),!o)throw e.context.logger.error("Code not found"),g("no_code");let y=e.context.socialProviders.find(t=>t.id===e.params.id);if(!y)throw e.context.logger.error("Oauth provider with id",e.params.id,"not found"),g("oauth_provider_not_found");try{r=await y.validateAuthorizationCode({code:o,codeVerifier:l,deviceId:d,redirectURI:`${e.context.baseURL}/callback/${y.id}`})}catch(t){throw e.context.logger.error("",t),g("invalid_code")}let b=await y.getUserInfo({...r,user:e.body?.user?oz(e.body.user):void 0}).then(e=>e?.user);if(!b)return e.context.logger.error("Unable to get user info"),g("unable_to_get_user_info");if(!u)throw e.context.logger.error("No callback URL found"),g("no_callback_url");if(p){let t,n=e.context.options.account?.accountLinking?.trustedProviders;if(!n?.includes(y.id)&&!b.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)return e.context.logger.error("Unable to link account - untrusted provider"),g("unable_to_link_account");if(b.email!==p.email&&e.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return g("email_doesn't_match");let i=await e.context.internalAdapter.findAccount(String(b.id));if(i){if(i.userId.toString()!==p.userId.toString())return g("account_already_linked_to_different_user");let t=Object.fromEntries(Object.entries({accessToken:await cc(r.accessToken,e.context),refreshToken:await cc(r.refreshToken,e.context),idToken:r.idToken,accessTokenExpiresAt:r.accessTokenExpiresAt,refreshTokenExpiresAt:r.refreshTokenExpiresAt,scope:r.scopes?.join(",")}).filter(([e,t])=>void 0!==t));await e.context.internalAdapter.updateAccount(i.id,t)}else if(!await e.context.internalAdapter.createAccount({userId:p.userId,providerId:y.id,accountId:String(b.id),...r,accessToken:await cc(r.accessToken,e.context),refreshToken:await cc(r.refreshToken,e.context),scope:r.scopes?.join(",")},e))return g("unable_to_link_account");try{t=u.toString()}catch{t=u}throw e.redirect(t)}if(!b.email)return e.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),g("email_not_found");let w=await cd(e,{userInfo:{...b,id:String(b.id),email:b.email,name:b.name||b.email},account:{providerId:y.id,accountId:String(b.id),...r,scope:r.scopes?.join(",")},callbackURL:u,disableSignUp:y.disableImplicitSignUp&&!m||y.options?.disableSignUp,overrideUserInfo:y.options?.overrideUserInfoOnSignIn});if(w.error)return e.context.logger.error(w.error.split(" ").join("_")),g(w.error.split(" ").join("_"));let{session:x,user:v}=w.data;await o0(e,{session:x,user:v});try{n=(w.isRegister&&h||u).toString()}catch{n=w.isRegister&&h||u}throw e.redirect(n)}),ch=o6("/sign-out",{method:"POST",requireHeaders:!0,metadata:{openapi:{description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let t=await e.getSignedCookie(e.context.authCookies.sessionToken.name,e.context.secret);if(!t)throw o1(e),new nh("BAD_REQUEST",{message:ni.FAILED_TO_GET_SESSION});return await e.context.internalAdapter.deleteSession(t),o1(e),e.json({success:!0})});function cm(e,t,r){let n=t?new URL(t,e.baseURL):new URL(`${e.baseURL}/error`);return r&&Object.entries(r).forEach(([e,t])=>n.searchParams.set(e,t)),n.href}let cg=o6("/request-password-reset",{method:"POST",body:oM.object({email:oM.email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:oM.string().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new nh("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let i=oq(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),o=aE(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${o}`,expiresAt:i},e);let a=r?encodeURIComponent(r):"",s=`${e.context.baseURL}/reset-password/${o}?callbackURL=${a}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:s,token:o},e.request),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"})}),cy=o6("/forget-password",{method:"POST",body:oM.object({email:oM.string().email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:oM.string().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.emailAndPassword?.sendResetPassword)throw e.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new nh("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:t,redirectTo:r}=e.body,n=await e.context.internalAdapter.findUserByEmail(t,{includeAccounts:!0});if(!n)return e.context.logger.error("Reset Password: User not found",{email:t}),e.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let i=oq(e.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),o=aE(24);await e.context.internalAdapter.createVerificationValue({value:n.user.id,identifier:`reset-password:${o}`,expiresAt:i},e);let a=r?encodeURIComponent(r):"",s=`${e.context.baseURL}/reset-password/${o}?callbackURL=${a}`;return await e.context.options.emailAndPassword.sendResetPassword({user:n.user,url:s,token:o},e.request),e.json({status:!0})}),cb=o6("/reset-password/:token",{method:"GET",query:oM.object({callbackURL:oM.string().meta({description:"The URL to redirect the user to reset their password"})}),use:[ce(e=>e.query.callbackURL)],metadata:{openapi:{description:"Redirects the user to the callback URL with the token",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async e=>{var t,r;let n,{token:i}=e.params,{callbackURL:o}=e.query;if(!i||!o)throw e.redirect(cm(e.context,o,{error:"INVALID_TOKEN"}));let a=await e.context.internalAdapter.findVerificationValue(`reset-password:${i}`);if(!a||a.expiresAt<new Date)throw e.redirect(cm(e.context,o,{error:"INVALID_TOKEN"}));throw e.redirect((t=e.context,r={token:i},n=new URL(o,t.baseURL),r&&Object.entries(r).forEach(([e,t])=>n.searchParams.set(e,t)),n.href))}),cw=o6("/reset-password",{method:"POST",query:oM.object({token:oM.string().optional()}).optional(),body:oM.object({newPassword:oM.string().meta({description:"The new password to set"}),token:oM.string().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let t=e.body.token||e.query?.token;if(!t)throw new nh("BAD_REQUEST",{message:ni.INVALID_TOKEN});let{newPassword:r}=e.body,n=e.context.password?.config.minPasswordLength,i=e.context.password?.config.maxPasswordLength;if(r.length<n)throw new nh("BAD_REQUEST",{message:ni.PASSWORD_TOO_SHORT});if(r.length>i)throw new nh("BAD_REQUEST",{message:ni.PASSWORD_TOO_LONG});let o=`reset-password:${t}`,a=await e.context.internalAdapter.findVerificationValue(o);if(!a||a.expiresAt<new Date)throw new nh("BAD_REQUEST",{message:ni.INVALID_TOKEN});let s=a.value,c=await e.context.password.hash(r);if((await e.context.internalAdapter.findAccounts(s)).find(e=>"credential"===e.providerId)?await e.context.internalAdapter.updatePassword(s,c,e):await e.context.internalAdapter.createAccount({userId:s,providerId:"credential",password:c,accountId:s},e),await e.context.internalAdapter.deleteVerificationValue(a.id),e.context.options.emailAndPassword?.onPasswordReset){let t=await e.context.internalAdapter.findUserById(s);t&&await e.context.options.emailAndPassword.onPasswordReset({user:t},e.request)}return e.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await e.context.internalAdapter.deleteSessions(s),e.json({status:!0})}),cx=o6("/change-password",{method:"POST",body:oM.object({newPassword:oM.string().meta({description:"The new password to set"}),currentPassword:oM.string().meta({description:"The current password is required"}),revokeOtherSessions:oM.boolean().meta({description:"Must be a boolean value"}).optional()}),use:[ab],metadata:{openapi:{description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async e=>{let{newPassword:t,currentPassword:r,revokeOtherSessions:n}=e.body,i=e.context.session,o=e.context.password.config.minPasswordLength;if(t.length<o)throw e.context.logger.error("Password is too short"),new nh("BAD_REQUEST",{message:ni.PASSWORD_TOO_SHORT});let a=e.context.password.config.maxPasswordLength;if(t.length>a)throw e.context.logger.error("Password is too long"),new nh("BAD_REQUEST",{message:ni.PASSWORD_TOO_LONG});let s=(await e.context.internalAdapter.findAccounts(i.user.id)).find(e=>"credential"===e.providerId&&e.password);if(!s||!s.password)throw new nh("BAD_REQUEST",{message:ni.CREDENTIAL_ACCOUNT_NOT_FOUND});let c=await e.context.password.hash(t);if(!await e.context.password.verify({hash:s.password,password:r}))throw new nh("BAD_REQUEST",{message:ni.INVALID_PASSWORD});await e.context.internalAdapter.updateAccount(s.id,{password:c});let d=null;if(n){await e.context.internalAdapter.deleteSessions(i.user.id);let t=await e.context.internalAdapter.createSession(i.user.id,e);if(!t)throw new nh("INTERNAL_SERVER_ERROR",{message:ni.FAILED_TO_GET_SESSION});await o0(e,{session:t,user:i.user}),d=t.token}return e.json({token:d,user:{id:i.user.id,email:i.user.email,name:i.user.name,image:i.user.image,emailVerified:i.user.emailVerified,createdAt:i.user.createdAt,updatedAt:i.user.updatedAt}})}),cv=o6("/set-password",{method:"POST",body:oM.object({newPassword:oM.string().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[ab]},async e=>{let{newPassword:t}=e.body,r=e.context.session,n=e.context.password.config.minPasswordLength;if(t.length<n)throw e.context.logger.error("Password is too short"),new nh("BAD_REQUEST",{message:ni.PASSWORD_TOO_SHORT});let i=e.context.password.config.maxPasswordLength;if(t.length>i)throw e.context.logger.error("Password is too long"),new nh("BAD_REQUEST",{message:ni.PASSWORD_TOO_LONG});let o=(await e.context.internalAdapter.findAccounts(r.user.id)).find(e=>"credential"===e.providerId&&e.password),a=await e.context.password.hash(t);if(!o)return await e.context.internalAdapter.linkAccount({userId:r.user.id,providerId:"credential",accountId:r.user.id,password:a},e),e.json({status:!0});throw new nh("BAD_REQUEST",{message:"user already has a password"})}),c_=o6("/delete-user",{method:"POST",use:[ab],body:oM.object({callbackURL:oM.string().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:oM.string().meta({description:"The password of the user is required to delete the user"}).optional(),token:oM.string().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{description:"Delete the user",responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new nh("NOT_FOUND");let t=e.context.session;if(e.body.password){let r=(await e.context.internalAdapter.findAccounts(t.user.id)).find(e=>"credential"===e.providerId&&e.password);if(!r||!r.password)throw new nh("BAD_REQUEST",{message:ni.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await e.context.password.verify({hash:r.password,password:e.body.password}))throw new nh("BAD_REQUEST",{message:ni.INVALID_PASSWORD})}if(e.body.token)return await cE({...e,query:{token:e.body.token}}),e.json({success:!0,message:"User deleted"});if(e.context.options.user.deleteUser?.sendDeleteAccountVerification){let r=aA(32,"0-9","a-z");await e.context.internalAdapter.createVerificationValue({value:t.user.id,identifier:`delete-account-${r}`,expiresAt:new Date(Date.now()+1e3*(e.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))},e);let n=`${e.context.baseURL}/delete-user/callback?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.deleteUser.sendDeleteAccountVerification({user:t.user,url:n,token:r},e.request),e.json({success:!0,message:"Verification email sent"})}if(!e.body.password&&0!==e.context.sessionConfig.freshAge){let r=new Date(t.session.createdAt).getTime(),n=1e3*e.context.sessionConfig.freshAge;if(Date.now()-r>1e3*n)throw new nh("BAD_REQUEST",{message:ni.SESSION_EXPIRED})}let r=e.context.options.user.deleteUser?.beforeDelete;r&&await r(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),o1(e);let n=e.context.options.user.deleteUser?.afterDelete;return n&&await n(t.user,e.request),e.json({success:!0,message:"User deleted"})}),cE=o6("/delete-user/callback",{method:"GET",query:oM.object({token:oM.string().meta({description:"The token to verify the deletion request"}),callbackURL:oM.string().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[ce(e=>e.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async e=>{if(!e.context.options.user?.deleteUser?.enabled)throw e.context.logger.error("Delete user is disabled. Enable it in the options"),new nh("NOT_FOUND");let t=await ag(e);if(!t)throw new nh("NOT_FOUND",{message:ni.FAILED_TO_GET_USER_INFO});let r=await e.context.internalAdapter.findVerificationValue(`delete-account-${e.query.token}`);if(!r||r.expiresAt<new Date||r.value!==t.user.id)throw new nh("NOT_FOUND",{message:ni.INVALID_TOKEN});let n=e.context.options.user.deleteUser?.beforeDelete;n&&await n(t.user,e.request),await e.context.internalAdapter.deleteUser(t.user.id),await e.context.internalAdapter.deleteSessions(t.user.id),await e.context.internalAdapter.deleteAccounts(t.user.id),await e.context.internalAdapter.deleteVerificationValue(r.id),o1(e);let i=e.context.options.user.deleteUser?.afterDelete;if(i&&await i(t.user,e.request),e.query.callbackURL)throw e.redirect(e.query.callbackURL||"/");return e.json({success:!0,message:"User deleted"})}),cT=o6("/change-email",{method:"POST",body:oM.object({newEmail:oM.email().meta({description:"The new email address to set must be a valid email address"}),callbackURL:oM.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[ab],metadata:{openapi:{responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async e=>{if(!e.context.options.user?.changeEmail?.enabled)throw e.context.logger.error("Change email is disabled."),new nh("BAD_REQUEST",{message:"Change email is disabled"});let t=e.body.newEmail.toLowerCase();if(t===e.context.session.user.email)throw e.context.logger.error("Email is the same"),new nh("BAD_REQUEST",{message:"Email is the same"});if(await e.context.internalAdapter.findUserByEmail(t))throw e.context.logger.error("Email already exists"),new nh("BAD_REQUEST",{message:"Couldn't update your email"});if(!0!==e.context.session.user.emailVerified){if(await e.context.internalAdapter.findUserByEmail(t))throw new nh("UNPROCESSABLE_ENTITY",{message:ni.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(await e.context.internalAdapter.updateUserByEmail(e.context.session.user.email,{email:t},e),await o0(e,{session:e.context.session.session,user:{...e.context.session.user,email:t}}),e.context.options.emailVerification?.sendVerificationEmail){let r=await ct(e.context.secret,t,void 0,e.context.options.emailVerification?.expiresIn),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;await e.context.options.emailVerification.sendVerificationEmail({user:{...e.context.session.user,email:t},url:n,token:r},e.request)}return e.json({status:!0})}if(!e.context.options.user.changeEmail.sendChangeEmailVerification)throw e.context.logger.error("Verification email isn't enabled."),new nh("BAD_REQUEST",{message:"Verification email isn't enabled"});let r=await ct(e.context.secret,e.context.session.user.email,t,e.context.options.emailVerification?.expiresIn),n=`${e.context.baseURL}/verify-email?token=${r}&callbackURL=${e.body.callbackURL||"/"}`;return await e.context.options.user.changeEmail.sendChangeEmailVerification({user:e.context.session.user,newEmail:t,url:n,token:r},e.request),e.json({status:!0})}),cA=o6("/error",{method:"GET",metadata:{...co,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async e=>new Response(((e="Unknown")=>`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Error</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #000000;
            --error-color: #dc3545;
            --border-color: #e9ecef;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.5;
        }
        .error-container {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            padding: 2.5rem;
            text-align: center;
            max-width: 90%;
            width: 400px;
        }
        h1 {
            color: var(--error-color);
            font-size: 1.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        p {
            margin-bottom: 1.5rem;
            color: #495057;
        }
        .btn {
            background-color: var(--accent-color);
            color: #ffffff;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
            display: inline-block;
            font-weight: 500;
            border: 2px solid var(--accent-color);
        }
        .btn:hover {
            background-color: #131721;
        }
        .error-code {
            font-size: 0.875rem;
            color: #6c757d;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }
        .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <div class="error-container">
        <div class="icon">\u26A0\uFE0F</div>
        <h1>Better Auth Error</h1>
        <p>We encountered an issue while processing your request. Please try again or contact the application owner if the problem persists.</p>
        <a href="/" id="returnLink" class="btn">Return to Application</a>
        <div class="error-code">Error Code: <span id="errorCode">${e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}</span></div>
    </div>
</body>
</html>`)(new URL(e.request?.url||"").searchParams.get("error")||"Unknown"),{headers:{"Content-Type":"text/html"}})),cS=o6("/ok",{method:"GET",metadata:{...co,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async e=>e.json({ok:!0})),cR=o6("/list-accounts",{method:"GET",use:[ay],metadata:{openapi:{description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","scopes"]}}}}}}}}},async e=>{let t=e.context.session,r=await e.context.internalAdapter.findAccounts(t.user.id);return e.json(r.map(e=>({id:e.id,providerId:e.providerId,createdAt:e.createdAt,updatedAt:e.updatedAt,accountId:e.accountId,scopes:e.scope?.split(",")||[]})))}),cO=o6("/link-social",{method:"POST",requireHeaders:!0,body:oM.object({callbackURL:oM.string().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:af,idToken:oM.object({token:oM.string(),nonce:oM.string().optional(),accessToken:oM.string().optional(),refreshToken:oM.string().optional(),scopes:oM.array(oM.string()).optional()}).optional(),requestSignUp:oM.boolean().optional(),scopes:oM.array(oM.string()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:oM.string().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:oM.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional()}),use:[ay],metadata:{openapi:{description:"Link a social account to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async e=>{let t=e.context.session,r=e.context.socialProviders.find(t=>t.id===e.body.provider);if(!r)throw e.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:e.body.provider}),new nh("NOT_FOUND",{message:ni.PROVIDER_NOT_FOUND});if(e.body.idToken){if(!r.verifyIdToken)throw e.context.logger.error("Provider does not support id token verification",{provider:e.body.provider}),new nh("NOT_FOUND",{message:ni.ID_TOKEN_NOT_SUPPORTED});let{token:n,nonce:i}=e.body.idToken;if(!await r.verifyIdToken(n,i))throw e.context.logger.error("Invalid id token",{provider:e.body.provider}),new nh("UNAUTHORIZED",{message:ni.INVALID_TOKEN});let o=await r.getUserInfo({idToken:n,accessToken:e.body.idToken.accessToken,refreshToken:e.body.idToken.refreshToken});if(!o||!o?.user)throw e.context.logger.error("Failed to get user info",{provider:e.body.provider}),new nh("UNAUTHORIZED",{message:ni.FAILED_TO_GET_USER_INFO});let a=String(o.user.id);if(!o.user.email)throw e.context.logger.error("User email not found",{provider:e.body.provider}),new nh("UNAUTHORIZED",{message:ni.USER_EMAIL_NOT_FOUND});if((await e.context.internalAdapter.findAccounts(t.user.id)).find(e=>e.providerId===r.id&&e.accountId===a))return e.json({url:"",status:!0,redirect:!1});let s=e.context.options.account?.accountLinking?.trustedProviders;if(!s?.includes(r.id)&&!o.user.emailVerified||e.context.options.account?.accountLinking?.enabled===!1)throw new nh("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(o.user.email!==t.user.email&&e.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new nh("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await e.context.internalAdapter.createAccount({userId:t.user.id,providerId:r.id,accountId:a,accessToken:e.body.idToken.accessToken,idToken:n,refreshToken:e.body.idToken.refreshToken,scope:e.body.idToken.scopes?.join(",")},e)}catch(e){throw new nh("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(e.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await e.context.internalAdapter.updateUser(t.user.id,{name:o.user?.name,image:o.user?.image})}catch(e){console.warn("Could not update user - "+e.toString())}return e.json({url:"",status:!0,redirect:!1})}let n=await ca(e,{userId:t.user.id,email:t.user.email}),i=await r.createAuthorizationURL({state:n.state,codeVerifier:n.codeVerifier,redirectURI:`${e.context.baseURL}/callback/${r.id}`,scopes:e.body.scopes});return e.json({url:i.toString(),redirect:!e.body.disableRedirect})}),cI=o6("/unlink-account",{method:"POST",body:oM.object({providerId:oM.string(),accountId:oM.string().optional()}),use:[aw],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{let{providerId:t,accountId:r}=e.body,n=await e.context.internalAdapter.findAccounts(e.context.session.user.id);if(1===n.length&&!e.context.options.account?.accountLinking?.allowUnlinkingAll)throw new nh("BAD_REQUEST",{message:ni.FAILED_TO_UNLINK_LAST_ACCOUNT});let i=n.find(e=>r?e.accountId===r&&e.providerId===t:e.providerId===t);if(!i)throw new nh("BAD_REQUEST",{message:ni.ACCOUNT_NOT_FOUND});return await e.context.internalAdapter.deleteAccount(i.id),e.json({status:!0})}),ck=o6("/get-access-token",{method:"POST",body:oM.object({providerId:oM.string().meta({description:"The provider ID for the OAuth provider"}),accountId:oM.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:oM.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{let{providerId:t,accountId:r,userId:n}=e.body,i=e.request,o=await ag(e);if(i&&!o)throw e.error("UNAUTHORIZED");let a=o?.user?.id||n;if(!a)throw new nh("BAD_REQUEST",{message:"Either userId or session is required"});if(!e.context.socialProviders.find(e=>e.id===t))throw new nh("BAD_REQUEST",{message:`Provider ${t} is not supported.`});let s=(await e.context.internalAdapter.findAccounts(a)).find(e=>r?e.id===r&&e.providerId===t:e.providerId===t);if(!s)throw new nh("BAD_REQUEST",{message:"Account not found"});let c=e.context.socialProviders.find(e=>e.id===t);if(!c)throw new nh("BAD_REQUEST",{message:`Provider ${t} not found.`});try{var d,l;let t=null,r=s.accessTokenExpiresAt&&new Date(s.accessTokenExpiresAt).getTime()-Date.now()<5e3;s.refreshToken&&r&&c.refreshAccessToken&&(t=await c.refreshAccessToken(s.refreshToken),await e.context.internalAdapter.updateAccount(s.id,{accessToken:await cc(t.accessToken,e.context),accessTokenExpiresAt:t.accessTokenExpiresAt,refreshToken:await cc(t.refreshToken,e.context),refreshTokenExpiresAt:t.refreshTokenExpiresAt}));let n={accessToken:await (d=t?.accessToken??s.accessToken??"",l=e.context,!d?d:l.options.account?.encryptOAuthTokens?s3({key:l.secret,data:d}):d),accessTokenExpiresAt:t?.accessTokenExpiresAt??s.accessTokenExpiresAt??void 0,scopes:s.scope?.split(",")??[],idToken:t?.idToken??s.idToken??void 0};return e.json(n)}catch(e){throw new nh("BAD_REQUEST",{message:"Failed to get a valid access token",cause:e})}}),cN=o6("/refresh-token",{method:"POST",body:oM.object({providerId:oM.string().meta({description:"The provider ID for the OAuth provider"}),accountId:oM.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:oM.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async e=>{let{providerId:t,accountId:r,userId:n}=e.body,i=e.request,o=await ag(e);if(i&&!o)throw e.error("UNAUTHORIZED");let a=o?.user?.id||n;if(!a)throw new nh("BAD_REQUEST",{message:"Either userId or session is required"});let s=(await e.context.internalAdapter.findAccounts(a)).find(e=>r?e.id===r&&e.providerId===t:e.providerId===t);if(!s)throw new nh("BAD_REQUEST",{message:"Account not found"});let c=e.context.socialProviders.find(e=>e.id===t);if(!c)throw new nh("BAD_REQUEST",{message:`Provider ${t} not found.`});if(!c.refreshAccessToken)throw new nh("BAD_REQUEST",{message:`Provider ${t} does not support token refreshing.`});try{let t=await c.refreshAccessToken(s.refreshToken);return await e.context.internalAdapter.updateAccount(s.id,{accessToken:await cc(t.accessToken,e.context),refreshToken:await cc(t.refreshToken,e.context),accessTokenExpiresAt:t.accessTokenExpiresAt,refreshTokenExpiresAt:t.refreshTokenExpiresAt}),e.json(t)}catch(e){throw new nh("BAD_REQUEST",{message:"Failed to refresh access token",cause:e})}}),cP=o6("/account-info",{method:"POST",use:[ay],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},body:oM.object({accountId:oM.string().meta({description:"The provider given account id for which to get the account info"})})},async e=>{let t=await e.context.internalAdapter.findAccount(e.body.accountId);if(!t||t.userId!==e.context.session.user.id)throw new nh("BAD_REQUEST",{message:"Account not found"});let r=e.context.socialProviders.find(e=>e.id===t.providerId);if(!r)throw new nh("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${t.providerId} but it is not configured`});let n=await ck({...e,body:{accountId:t.id,providerId:t.providerId},returnHeaders:!1});if(!n.accessToken)throw new nh("BAD_REQUEST",{message:"Access token not found"});let i=await r.getUserInfo({...n,accessToken:n.accessToken});return e.json(i)}),cU=aD((e,t,r)=>{if(Array.isArray(e[t])&&Array.isArray(r))return e[t]=r,!0});async function cC(e,t){let r={};for(let n of t)if(n.matcher(e)){let t=await n.handler({...e,returnHeaders:!1}).catch(t=>{throw t instanceof nh&&tQ(e.context.logger.level,"debug")&&(t.stack=t.errorStack),t});if(t&&"object"==typeof t){if("context"in t&&"object"==typeof t.context){let{headers:e,...n}=t.context;e instanceof Headers&&(r.headers?e.forEach((e,t)=>{r.headers?.set(t,e)}):r.headers=e),r=cU(n,r);continue}return t}}return{context:r}}async function cD(e,t){for(let r of t)if(r.matcher(e)){let t=await r.handler(e).catch(t=>{if(t instanceof nh)return tQ(e.context.logger.level,"debug")&&(t.stack=t.errorStack),{response:t,headers:t.headers?new Headers(t.headers):null};throw t});t.headers&&t.headers.forEach((t,r)=>{e.context.responseHeaders?"set-cookie"===r.toLowerCase()?e.context.responseHeaders.append(r,t):e.context.responseHeaders.set(r,t):e.context.responseHeaders=new Headers({[r]:t})}),t.response&&(e.context.returned=t.response)}return{response:e.context.returned,headers:e.context.responseHeaders}}var cL=e.i(730847);function cj(e,t){if(t.advanced?.ipAddress?.disableIpTracking)return null;if(tk()||tI())return"127.0.0.1";let r="headers"in e?e.headers:e;for(let e of t.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let t="get"in r?r.get(e):r[e];if("string"==typeof t){var n;let e=t.split(",")[0].trim();if(n=e,cL.z.ipv4().safeParse(n).success||cL.z.ipv6().safeParse(n).success)return e}}return null}let c$=new Map;async function cM(e,t){if(!t.rateLimit.enabled)return;let r=new URL(e.url).pathname.replace(t.options.basePath||"/api/auth",""),n=t.rateLimit.window,i=t.rateLimit.max,o=cj(e,t.options);if(!o)return;let a=o+r,s=[{pathMatcher:e=>e.startsWith("/sign-in")||e.startsWith("/sign-up")||e.startsWith("/change-password")||e.startsWith("/change-email"),window:10,max:3}].find(e=>e.pathMatcher(r));for(let e of(s&&(n=s.window,i=s.max),t.options.plugins||[]))if(e.rateLimit){let t=e.rateLimit.find(e=>e.pathMatcher(r));if(t){n=t.window,i=t.max;break}}if(t.rateLimit.customRules){let o=Object.keys(t.rateLimit.customRules).find(e=>e.includes("*")?s9(e)(r):e===r);if(o){let r=t.rateLimit.customRules[o],a="function"==typeof r?await r(e):r;if(a&&(n=a.window,i=a.max),!1===a)return}}let c=function(e,t){let r,n;if(e.options.rateLimit?.customStorage)return e.options.rateLimit.customStorage;let i=e.rateLimit.storage;return"secondary-storage"===i?{get:async t=>{let r=await e.options.secondaryStorage?.get(t);return r?oz(r):void 0},set:async(r,n,i)=>{let o=t?.window??e.options.rateLimit?.window??10;await e.options.secondaryStorage?.set?.(r,JSON.stringify(n),o)}}:"memory"===i?{get:async e=>c$.get(e),async set(e,t,r){c$.set(e,t)}}:(r="rateLimit",n=e.adapter,{get:async e=>{let t=(await n.findMany({model:r,where:[{field:"key",value:e}]}))[0];return"bigint"==typeof t?.lastRequest&&(t.lastRequest=Number(t.lastRequest)),t},set:async(t,i,o)=>{try{o?await n.updateMany({model:r,where:[{field:"key",value:t}],update:{count:i.count,lastRequest:i.lastRequest}}):await n.create({model:r,data:{key:t,count:i.count,lastRequest:i.lastRequest}})}catch(t){e.logger.error("Error setting rate limit",t)}}})}(t,{window:n}),d=await c.get(a),l=Date.now();if(d){var u,p,f;let e=l-d.lastRequest;if(u=i,p=n,Date.now()-d.lastRequest<1e3*p&&d.count>=u)return f=Math.ceil((d.lastRequest+1e3*n-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":f.toString()}});e>1e3*n?await c.set(a,{...d,count:1,lastRequest:l},!0):await c.set(a,{...d,count:d.count+1,lastRequest:l},!0)}else await c.set(a,{key:a,count:1,lastRequest:l})}function cq(e,t){let r=t.plugins?.reduce((e,t)=>({...e,...t.endpoints}),{})??{},n=t.plugins?.map(t=>t.middlewares?.map(t=>{let r=async r=>{let n=await e;return t.middleware({...r,context:{...n,...r.context}})};return r.options=t.middleware.options,{path:t.path,middleware:r}})).filter(e=>void 0!==e).flat()||[];return{api:function(e,t){let r={};for(let[n,i]of Object.entries(e))r[n]=async e=>{let r=await t,n={...e,context:{...r,returned:void 0,responseHeaders:void 0,session:null},path:i.path,headers:e?.headers?new Headers(e?.headers):void 0},{beforeHooks:o,afterHooks:a}=function(e){let t=e.options.plugins||[],r=[],n=[];e.options.hooks?.before&&r.push({matcher:()=>!0,handler:e.options.hooks.before}),e.options.hooks?.after&&n.push({matcher:()=>!0,handler:e.options.hooks.after});let i=t.map(e=>{if(e.hooks?.before)return e.hooks.before}).filter(e=>void 0!==e).flat(),o=t.map(e=>{if(e.hooks?.after)return e.hooks.after}).filter(e=>void 0!==e).flat();return i.length&&r.push(...i),o.length&&n.push(...o),{beforeHooks:r,afterHooks:n}}(r),s=await cC(n,o);if("context"in s&&s.context&&"object"==typeof s.context){let{headers:e,...t}=s.context;e&&e.forEach((e,t)=>{n.headers.set(t,e)}),n=cU(t,n)}else if(s)return e?.asResponse?ny(s,{headers:e?.headers}):e?.returnHeaders?{headers:e?.headers,response:s}:s;n.asResponse=!1,n.returnHeaders=!0;let c=await i(n).catch(e=>{if(e instanceof nh)return{response:e,headers:e.headers?new Headers(e.headers):null};throw e});if(c&&c instanceof Response)return c;n.context.returned=c.response,n.context.responseHeaders=c.headers;let d=await cD(n,a);if(d.response&&(c.response=d.response),c.response instanceof nh&&tQ(r.logger.level,"debug")&&(c.response.stack=c.response.errorStack),c.response instanceof nh&&!e?.asResponse)throw c.response;return e?.asResponse?ny(c.response,{headers:c.headers}):e?.returnHeaders?{headers:c.headers,response:c.response}:c.response},r[n].path=i.path,r[n].options=i.options;return r}({...{signInSocial:cl,callbackOAuth:cf,getSession:am(),signOut:ch,signUpEmail:o6("/sign-up/email",{method:"POST",body:oM.record(oM.string(),oM.any()),metadata:{$Infer:{body:{}},openapi:{description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async e=>{let t;if(!e.context.options.emailAndPassword?.enabled||e.context.options.emailAndPassword?.disableSignUp)throw new nh("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let r=e.body,{name:n,email:i,password:o,image:a,callbackURL:s,rememberMe:c,...d}=r;if(!oM.email().safeParse(i).success)throw new nh("BAD_REQUEST",{message:ni.INVALID_EMAIL});let l=e.context.password.config.minPasswordLength;if(o.length<l)throw e.context.logger.error("Password is too short"),new nh("BAD_REQUEST",{message:ni.PASSWORD_TOO_SHORT});let u=e.context.password.config.maxPasswordLength;if(o.length>u)throw e.context.logger.error("Password is too long"),new nh("BAD_REQUEST",{message:ni.PASSWORD_TOO_LONG});let p=await e.context.internalAdapter.findUserByEmail(i);if(p?.user)throw e.context.logger.info(`Sign-up attempt for existing email: ${i}`),new nh("UNPROCESSABLE_ENTITY",{message:ni.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});let f=await e.context.password.hash(o);try{let r=aN(e.context.options,d,"create");if(!(t=await e.context.internalAdapter.createUser({email:i.toLowerCase(),name:n,image:a,...r,emailVerified:!1},e)))throw new nh("BAD_REQUEST",{message:ni.FAILED_TO_CREATE_USER})}catch(t){if(tI()&&e.context.logger.error("Failed to create user",t),t instanceof nh)throw t;throw e.context.logger?.error("Failed to create user",t),new nh("UNPROCESSABLE_ENTITY",{message:ni.FAILED_TO_CREATE_USER,details:t})}if(!t)throw new nh("UNPROCESSABLE_ENTITY",{message:ni.FAILED_TO_CREATE_USER});if(await e.context.internalAdapter.linkAccount({userId:t.id,providerId:"credential",accountId:t.id,password:f},e),e.context.options.emailVerification?.sendOnSignUp||e.context.options.emailAndPassword.requireEmailVerification){let n=await ct(e.context.secret,t.email,void 0,e.context.options.emailVerification?.expiresIn),i=`${e.context.baseURL}/verify-email?token=${n}&callbackURL=${r.callbackURL||"/"}`,o=e.request?[{user:t,url:i,token:n},e.request]:[{user:t,url:i,token:n}];await e.context.options.emailVerification?.sendVerificationEmail?.(...o)}if(!1===e.context.options.emailAndPassword.autoSignIn||e.context.options.emailAndPassword.requireEmailVerification)return e.json({token:null,user:{id:t.id,email:t.email,name:t.name,image:t.image,emailVerified:t.emailVerified,createdAt:t.createdAt,updatedAt:t.updatedAt}});let h=await e.context.internalAdapter.createSession(t.id,e,!1===c);if(!h)throw new nh("BAD_REQUEST",{message:ni.FAILED_TO_CREATE_SESSION});return await o0(e,{session:h,user:t},!1===c),e.json({token:h.token,user:{id:t.id,email:t.email,name:t.name,image:t.image,emailVerified:t.emailVerified,createdAt:t.createdAt,updatedAt:t.updatedAt}})}),signInEmail:cu,forgetPassword:cy,resetPassword:cw,verifyEmail:ci,sendVerificationEmail:cn,changeEmail:cT,changePassword:cx,setPassword:cv,updateUser:o6("/update-user",{method:"POST",body:oM.record(oM.string().meta({description:"Field name must be a string"}),oM.any()),use:[ay],metadata:{$Infer:{body:{}},openapi:{description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user"}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the update was successful"}}}}}}}}}},async e=>{let t=e.body;if(t.email)throw new nh("BAD_REQUEST",{message:ni.EMAIL_CAN_NOT_BE_UPDATED});let{name:r,image:n,...i}=t,o=e.context.session,a=aN(e.context.options,i,"update");if(void 0===n&&void 0===r&&0===Object.keys(a).length)throw new nh("BAD_REQUEST",{message:"No fields to update"});let s=await e.context.internalAdapter.updateUser(o.user.id,{name:r,image:n,...a},e);return await o0(e,{session:o.session,user:s}),e.json({status:!0})}),deleteUser:c_,forgetPasswordCallback:cb,requestPasswordReset:cg,requestPasswordResetCallback:cb,listSessions:o6("/list-sessions",{method:"GET",use:[ay],requireHeaders:!0,metadata:{openapi:{description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async e=>{try{let t=(await e.context.internalAdapter.listSessions(e.context.session.user.id)).filter(e=>e.expiresAt>new Date);return e.json(t)}catch(t){throw e.context.logger.error(t),e.error("INTERNAL_SERVER_ERROR")}}),revokeSession:ax,revokeSessions:av,revokeOtherSessions:a_,linkSocialAccount:cO,listUserAccounts:cR,deleteUserCallback:cE,unlinkAccount:cI,refreshToken:cN,getAccessToken:ck,accountInfo:cP},...r,ok:cS,error:cA},e),middlewares:n}}let cV=e=>{let t=(e.plugins??[]).reduce((e,t)=>{let r=t.schema;if(!r)return e;for(let[t,n]of Object.entries(r))e[t]={fields:{...e[t]?.fields,...n.fields},modelName:n.modelName||t};return e},{}),r=e.rateLimit?.storage==="database",n={rateLimit:{modelName:e.rateLimit?.modelName||"rateLimit",fields:{key:{type:"string",fieldName:e.rateLimit?.fields?.key||"key"},count:{type:"number",fieldName:e.rateLimit?.fields?.count||"count"},lastRequest:{type:"number",bigint:!0,fieldName:e.rateLimit?.fields?.lastRequest||"lastRequest"}}}},{user:i,session:o,account:a,...s}=t,c={session:{modelName:e.session?.modelName||"session",fields:{expiresAt:{type:"date",required:!0,fieldName:e.session?.fields?.expiresAt||"expiresAt"},token:{type:"string",required:!0,fieldName:e.session?.fields?.token||"token",unique:!0},createdAt:{type:"date",required:!0,fieldName:e.session?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:e.session?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},ipAddress:{type:"string",required:!1,fieldName:e.session?.fields?.ipAddress||"ipAddress"},userAgent:{type:"string",required:!1,fieldName:e.session?.fields?.userAgent||"userAgent"},userId:{type:"string",fieldName:e.session?.fields?.userId||"userId",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0},...o?.fields,...e.session?.additionalFields},order:2}};return{user:{modelName:e.user?.modelName||"user",fields:{name:{type:"string",required:!0,fieldName:e.user?.fields?.name||"name",sortable:!0},email:{type:"string",unique:!0,required:!0,fieldName:e.user?.fields?.email||"email",sortable:!0},emailVerified:{type:"boolean",defaultValue:!1,required:!0,fieldName:e.user?.fields?.emailVerified||"emailVerified",input:!1},image:{type:"string",required:!1,fieldName:e.user?.fields?.image||"image"},createdAt:{type:"date",defaultValue:()=>new Date,required:!0,fieldName:e.user?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",defaultValue:()=>new Date,onUpdate:()=>new Date,required:!0,fieldName:e.user?.fields?.updatedAt||"updatedAt"},...i?.fields,...e.user?.additionalFields},order:1},...!e.secondaryStorage||e.session?.storeSessionInDatabase?c:{},account:{modelName:e.account?.modelName||"account",fields:{accountId:{type:"string",required:!0,fieldName:e.account?.fields?.accountId||"accountId"},providerId:{type:"string",required:!0,fieldName:e.account?.fields?.providerId||"providerId"},userId:{type:"string",references:{model:e.user?.modelName||"user",field:"id",onDelete:"cascade"},required:!0,fieldName:e.account?.fields?.userId||"userId"},accessToken:{type:"string",required:!1,fieldName:e.account?.fields?.accessToken||"accessToken"},refreshToken:{type:"string",required:!1,fieldName:e.account?.fields?.refreshToken||"refreshToken"},idToken:{type:"string",required:!1,fieldName:e.account?.fields?.idToken||"idToken"},accessTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.accessTokenExpiresAt||"accessTokenExpiresAt"},refreshTokenExpiresAt:{type:"date",required:!1,fieldName:e.account?.fields?.refreshTokenExpiresAt||"refreshTokenExpiresAt"},scope:{type:"string",required:!1,fieldName:e.account?.fields?.scope||"scope"},password:{type:"string",required:!1,fieldName:e.account?.fields?.password||"password"},createdAt:{type:"date",required:!0,fieldName:e.account?.fields?.createdAt||"createdAt",defaultValue:()=>new Date},updatedAt:{type:"date",required:!0,fieldName:e.account?.fields?.updatedAt||"updatedAt",onUpdate:()=>new Date},...a?.fields,...e.account?.additionalFields},order:3},verification:{modelName:e.verification?.modelName||"verification",fields:{identifier:{type:"string",required:!0,fieldName:e.verification?.fields?.identifier||"identifier"},value:{type:"string",required:!0,fieldName:e.verification?.fields?.value||"value"},expiresAt:{type:"date",required:!0,fieldName:e.verification?.fields?.expiresAt||"expiresAt"},createdAt:{type:"date",required:!0,defaultValue:()=>new Date,fieldName:e.verification?.fields?.createdAt||"createdAt"},updatedAt:{type:"date",required:!0,defaultValue:()=>new Date,onUpdate:()=>new Date,fieldName:e.verification?.fields?.updatedAt||"updatedAt"}},order:4},...s,...r?n:{}}};var cB=e.i(399980),cz=e.i(700231),cW=e.i(870950);function cH(e,t){return cW.RawNode.createWithChildren([cW.RawNode.createWithSql(`${e} `),cz.IdentifierNode.create(t)])}var cF=e.i(671723),cK=e.i(245792),cQ=e.i(145923);class cZ{#b;#w=new cY;#x;#v;constructor(e){this.#b=(0,cK.freeze)({...e})}async init(){this.#x=(0,cK.isFunction)(this.#b.database)?await this.#b.database():this.#b.database,this.#v=new cG(this.#x),this.#b.onCreateConnection&&await this.#b.onCreateConnection(this.#v)}async acquireConnection(){return await this.#w.lock(),this.#v}async beginTransaction(e){await e.executeQuery(cF.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(cF.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(cF.CompiledQuery.raw("rollback"))}async savepoint(e,t,r){await e.executeQuery(r(cH("savepoint",t),(0,cQ.createQueryId)()))}async rollbackToSavepoint(e,t,r){await e.executeQuery(r(cH("rollback to",t),(0,cQ.createQueryId)()))}async releaseSavepoint(e,t,r){await e.executeQuery(r(cH("release",t),(0,cQ.createQueryId)()))}async releaseConnection(){this.#w.unlock()}async destroy(){this.#x?.close()}}class cG{#x;constructor(e){this.#x=e}executeQuery(e){let{sql:t,parameters:r}=e,n=this.#x.prepare(t);if(n.reader)return Promise.resolve({rows:n.all(r)});let{changes:i,lastInsertRowid:o}=n.run(r);return Promise.resolve({numAffectedRows:null!=i?BigInt(i):void 0,insertId:null!=o?BigInt(o):void 0,rows:[]})}async *streamQuery(e,t){let{sql:r,parameters:n,query:i}=e,o=this.#x.prepare(r);if(cB.SelectQueryNode.is(i))for(let e of o.iterate(n))yield{rows:[e]};else throw Error("Sqlite driver only supports streaming of select queries")}}class cY{#_;#E;async lock(){for(;this.#_;)await this.#_;this.#_=new Promise(e=>{this.#E=e})}unlock(){let e=this.#E;this.#_=void 0,this.#E=void 0,e?.()}}var cJ=e.i(287448);let cX=/"/g;class c0 extends cJ.DefaultQueryCompiler{visitOrAction(e){this.append("or "),this.append(e.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(cX,'""')}visitDefaultInsertValue(e){this.append("null")}}var c1=e.i(199210),c2=e.i(208089);class c5{#x;constructor(e){this.#x=e}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){return await this.#T(e)}async getMetadata(e){return{tables:await this.getTables(e)}}#A(e,t){let r=e.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return t.withInternalKyselyTables||(r=r.where("name","!=",c1.DEFAULT_MIGRATION_TABLE).where("name","!=",c1.DEFAULT_MIGRATION_LOCK_TABLE)),r}async #T(e){let t=await this.#A(this.#x,e).execute(),r=await this.#x.with("table_list",t=>this.#A(t,e)).selectFrom(["table_list as tl",c2.sql`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),n={};for(let e of r)n[e.table]??=[],n[e.table].push(e);return t.map(({name:e,sql:t,type:r})=>{let i=t?.split(/[\(\),]/)?.find(e=>e.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),o=n[e]??[];if(!i){let e=o.filter(e=>e.pk>0);1===e.length&&"integer"===e[0].type.toLowerCase()&&(i=e[0].name)}return{name:e,isView:"view"===r,columns:o.map(e=>({name:e.name,dataType:e.type,isNullable:!e.notnull,isAutoIncrementing:e.name===i,hasDefaultValue:null!=e.dflt_value,comment:void 0}))}})}}class c6{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class c3 extends c6{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}class c4{#b;constructor(e){this.#b=(0,cK.freeze)({...e})}createDriver(){return new cZ(this.#b)}createQueryCompiler(){return new c0}createAdapter(){return new c3}createIntrospector(e){return new c5(e)}}function c8(e,t){var r;if(r=e,(0,cK.isObject)(r)&&(0,cK.isString)(r.stack)&&t.stack){let r=t.stack.split("\n").slice(1).join("\n");e.stack+=`
${r}`}return e}let c9=Symbol();class c7{#b;#S=new WeakMap;#R;constructor(e){this.#b=(0,cK.freeze)({...e})}async init(){this.#R=(0,cK.isFunction)(this.#b.pool)?await this.#b.pool():this.#b.pool}async acquireConnection(){let e=await this.#O(),t=this.#S.get(e);return!t&&(t=new de(e),this.#S.set(e,t),this.#b?.onCreateConnection&&await this.#b.onCreateConnection(t)),this.#b?.onReserveConnection&&await this.#b.onReserveConnection(t),t}async #O(){return new Promise((e,t)=>{this.#R.getConnection(async(r,n)=>{r?t(r):e(n)})})}async beginTransaction(e,t){if(t.isolationLevel||t.accessMode){let r=[];t.isolationLevel&&r.push(`isolation level ${t.isolationLevel}`),t.accessMode&&r.push(t.accessMode);let n=`set transaction ${r.join(", ")}`;await e.executeQuery(cF.CompiledQuery.raw(n))}await e.executeQuery(cF.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(cF.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(cF.CompiledQuery.raw("rollback"))}async savepoint(e,t,r){await e.executeQuery(r(cH("savepoint",t),(0,cQ.createQueryId)()))}async rollbackToSavepoint(e,t,r){await e.executeQuery(r(cH("rollback to",t),(0,cQ.createQueryId)()))}async releaseSavepoint(e,t,r){await e.executeQuery(r(cH("release savepoint",t),(0,cQ.createQueryId)()))}async releaseConnection(e){e[c9]()}async destroy(){return new Promise((e,t)=>{this.#R.end(r=>{r?t(r):e()})})}}class de{#I;constructor(e){this.#I=e}async executeQuery(e){try{let t=await this.#k(e);if((0,cK.isObject)(t)&&"insertId"in t&&"affectedRows"in t){let{insertId:e,affectedRows:r,changedRows:n}=t;return{insertId:null!=e&&"0"!==e.toString()?BigInt(e):void 0,numAffectedRows:null!=r?BigInt(r):void 0,numChangedRows:null!=n?BigInt(n):void 0,rows:[]}}if(Array.isArray(t))return{rows:t};return{rows:[]}}catch(e){throw c8(e,Error())}}#k(e){return new Promise((t,r)=>{this.#I.query(e.sql,e.parameters,(e,n)=>{e?r(e):t(n)})})}async *streamQuery(e,t){let r=this.#I.query(e.sql,e.parameters).stream({objectMode:!0});try{for await(let e of r)yield{rows:[e]}}catch(e){if(e&&"object"==typeof e&&"code"in e&&"ERR_STREAM_PREMATURE_CLOSE"===e.code)return;throw e}}[c9](){this.#I.release()}}var dt=cJ;let dr=/`/g;class dn extends dt.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(e){return e.replace(dr,"``")}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.using&&(this.append(" using "),this.visitNode(e.using)),e.table&&(this.append(" on "),this.visitNode(e.table)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.where&&(this.append(" "),this.visitNode(e.where))}}class di{#x;constructor(e){this.#x=e}async getSchemas(){return(await this.#x.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(e=>({name:e.SCHEMA_NAME}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#x.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",e=>e.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",c2.sql`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();e.withInternalKyselyTables||(t=t.where("columns.TABLE_NAME","!=",c1.DEFAULT_MIGRATION_TABLE).where("columns.TABLE_NAME","!=",c1.DEFAULT_MIGRATION_LOCK_TABLE));let r=await t.execute();return this.#N(r)}async getMetadata(e){return{tables:await this.getTables(e)}}#N(e){return e.reduce((e,t)=>{let r=e.find(e=>e.name===t.TABLE_NAME);return r||(r=(0,cK.freeze)({name:t.TABLE_NAME,isView:"VIEW"===t.TABLE_TYPE,schema:t.TABLE_SCHEMA,columns:[]}),e.push(r)),r.columns.push((0,cK.freeze)({name:t.COLUMN_NAME,dataType:t.DATA_TYPE,isNullable:"YES"===t.IS_NULLABLE,isAutoIncrementing:t.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==t.COLUMN_DEFAULT,comment:""===t.COLUMN_COMMENT?void 0:t.COLUMN_COMMENT})),e},[])}}let da="ea586330-2c93-47c8-908d-981d9d270f9d";class ds extends c6{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(e,t){await c2.sql`select get_lock(${c2.sql.lit(da)}, ${c2.sql.lit(3600)})`.execute(e)}async releaseMigrationLock(e,t){await c2.sql`select release_lock(${c2.sql.lit(da)})`.execute(e)}}class dc{#b;constructor(e){this.#b=e}createDriver(){return new c7(this.#b)}createQueryCompiler(){return new dn}createAdapter(){return new ds}createIntrospector(e){return new di(e)}}let dd=Symbol();class dl{#b;#S=new WeakMap;#R;constructor(e){this.#b=(0,cK.freeze)({...e})}async init(){this.#R=(0,cK.isFunction)(this.#b.pool)?await this.#b.pool():this.#b.pool}async acquireConnection(){let e=await this.#R.connect(),t=this.#S.get(e);return!t&&(t=new du(e,{cursor:this.#b.cursor??null}),this.#S.set(e,t),this.#b.onCreateConnection&&await this.#b.onCreateConnection(t)),this.#b.onReserveConnection&&await this.#b.onReserveConnection(t),t}async beginTransaction(e,t){if(t.isolationLevel||t.accessMode){let r="start transaction";t.isolationLevel&&(r+=` isolation level ${t.isolationLevel}`),t.accessMode&&(r+=` ${t.accessMode}`),await e.executeQuery(cF.CompiledQuery.raw(r))}else await e.executeQuery(cF.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(cF.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(cF.CompiledQuery.raw("rollback"))}async savepoint(e,t,r){await e.executeQuery(r(cH("savepoint",t),(0,cQ.createQueryId)()))}async rollbackToSavepoint(e,t,r){await e.executeQuery(r(cH("rollback to",t),(0,cQ.createQueryId)()))}async releaseSavepoint(e,t,r){await e.executeQuery(r(cH("release",t),(0,cQ.createQueryId)()))}async releaseConnection(e){e[dd]()}async destroy(){if(this.#R){let e=this.#R;this.#R=void 0,await e.end()}}}class du{#P;#U;constructor(e,t){this.#P=e,this.#U=t}async executeQuery(e){try{let{command:t,rowCount:r,rows:n}=await this.#P.query(e.sql,[...e.parameters]);return{numAffectedRows:"INSERT"===t||"UPDATE"===t||"DELETE"===t||"MERGE"===t?BigInt(r):void 0,rows:n??[]}}catch(e){throw c8(e,Error())}}async *streamQuery(e,t){if(!this.#U.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(t)||t<=0)throw Error("chunkSize must be a positive integer");let r=this.#P.query(new this.#U.cursor(e.sql,e.parameters.slice()));try{for(;;){let e=await r.read(t);if(0===e.length)break;yield{rows:e}}}finally{await r.close()}}[dd](){this.#P.release()}}class dp{#x;constructor(e){this.#x=e}async getSchemas(){return(await this.#x.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(e=>({name:e.nspname}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#x.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",c2.sql`col_description(a.attrelid, a.attnum)`.as("column_description"),c2.sql`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where(c2.sql`has_schema_privilege(ns.nspname, 'USAGE')`).where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();e.withInternalKyselyTables||(t=t.where("c.relname","!=",c1.DEFAULT_MIGRATION_TABLE).where("c.relname","!=",c1.DEFAULT_MIGRATION_LOCK_TABLE));let r=await t.execute();return this.#N(r)}async getMetadata(e){return{tables:await this.getTables(e)}}#N(e){return e.reduce((e,t)=>{let r=e.find(e=>e.name===t.table&&e.schema===t.schema);return r||(r=(0,cK.freeze)({name:t.table,isView:"v"===t.table_type,schema:t.schema,columns:[]}),e.push(r)),r.columns.push((0,cK.freeze)({name:t.column,dataType:t.type,dataTypeSchema:t.type_schema,isNullable:!t.not_null,isAutoIncrementing:null!==t.auto_incrementing,hasDefaultValue:t.has_default,comment:t.column_description??void 0})),e},[])}}var df=cJ;let dh=/"/g;class dm extends df.DefaultQueryCompiler{sanitizeIdentifier(e){return e.replace(dh,'""')}}let dg=BigInt("3853314791062309107");class dy extends c6{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e,t){await c2.sql`select pg_advisory_xact_lock(${c2.sql.lit(dg)})`.execute(e)}async releaseMigrationLock(e,t){}}class db{#b;constructor(e){this.#b=e}createDriver(){return new dl(this.#b)}createQueryCompiler(){return new dm}createAdapter(){return new dy}createIntrospector(e){return new dp(e)}}class dw extends c6{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(e){await c2.sql`exec sp_getapplock @DbPrincipal = ${c2.sql.lit("dbo")}, @Resource = ${c2.sql.lit(c1.DEFAULT_MIGRATION_TABLE)}, @LockMode = ${c2.sql.lit("Exclusive")}`.execute(e)}async releaseMigrationLock(){}}var dx=e.i(436090),dv=e.i(177040);let d_=Symbol(),dE=Symbol(),dT=Symbol();class dA{#b;#R;constructor(e){this.#b=(0,cK.freeze)({...e});const{tarn:t,tedious:r,validateConnections:n}=this.#b,{validateConnections:i,...o}=t.options;this.#R=new t.Pool({...o,create:async()=>{let e=await r.connectionFactory();return await new dS(e,r).connect()},destroy:async e=>{await e[dE]()},validate:!1===n||!1===i?void 0:e=>e[dT]()})}async init(){}async acquireConnection(){return await this.#R.acquire().promise}async beginTransaction(e,t){await e.beginTransaction(t)}async commitTransaction(e){await e.commitTransaction()}async rollbackTransaction(e){await e.rollbackTransaction()}async savepoint(e,t){await e.savepoint(t)}async rollbackToSavepoint(e,t){await e.rollbackTransaction(t)}async releaseConnection(e){(this.#b.resetConnectionsOnRelease||this.#b.tedious.resetConnectionOnRelease)&&await e[d_](),this.#R.release(e)}async destroy(){await this.#R.destroy()}}class dS{#v;#C;#D;constructor(e,t){this.#v=e,this.#C=!1,this.#D=t}async beginTransaction(e){let{isolationLevel:t}=e;await new Promise((e,r)=>this.#v.beginTransaction(t=>{t?r(t):e(void 0)},t?(0,dx.randomString)(8):void 0,t?this.#L(t):void 0))}async commitTransaction(){await new Promise((e,t)=>this.#v.commitTransaction(r=>{r?t(r):e(void 0)}))}async connect(){let{promise:e,reject:t,resolve:r}=new dv.Deferred;function n(){t(Error("The connection ended without ever completing the connection"))}return this.#v.connect(e=>{if(e)return t(e);r()}),this.#v.on("error",e=>{e instanceof Error&&"code"in e&&"ESOCKET"===e.code&&(this.#C=!0),console.error(e),t(e)}),this.#v.once("end",n),await e,this.#v.off("end",n),this}async executeQuery(e){try{let t=new dv.Deferred,r=new dR({compiledQuery:e,tedious:this.#D,onDone:t});this.#v.execSql(r.request);let{rowCount:n,rows:i}=await t.promise;return{numAffectedRows:void 0!==n?BigInt(n):void 0,rows:i}}catch(e){throw c8(e,Error())}}async rollbackTransaction(e){await new Promise((t,r)=>this.#v.rollbackTransaction(e=>{e?r(e):t(void 0)},e))}async savepoint(e){await new Promise((t,r)=>this.#v.saveTransaction(e=>{e?r(e):t(void 0)},e))}async *streamQuery(e,t){if(!Number.isInteger(t)||t<=0)throw Error("chunkSize must be a positive integer");let r=new dR({compiledQuery:e,streamChunkSize:t,tedious:this.#D});this.#v.execSql(r.request);try{for(;;){let e=await r.readChunk();if(0===e.length||(yield{rows:e},e.length<t))break}}finally{await this.#j(r)}}#L(e){let{ISOLATION_LEVEL:t}=this.#D,r={"read committed":t.READ_COMMITTED,"read uncommitted":t.READ_UNCOMMITTED,"repeatable read":t.REPEATABLE_READ,serializable:t.SERIALIZABLE,snapshot:t.SNAPSHOT}[e];if(void 0===r)throw Error(`Unknown isolation level: ${e}`);return r}#j(e){return new Promise(t=>{e.request.once("requestCompleted",t),this.#v.cancel()||(e.request.off("requestCompleted",t),t())})}[dE](){return"closed"in this.#v&&this.#v.closed?Promise.resolve():new Promise(e=>{this.#v.once("end",e),this.#v.close()})}async [d_](){await new Promise((e,t)=>{this.#v.reset(r=>{if(r)return t(r);e()})})}async [dT](){if(this.#C||this.#$())return!1;try{let e=new dv.Deferred,t=new dR({compiledQuery:cF.CompiledQuery.raw("select 1"),onDone:e,tedious:this.#D});return this.#v.execSql(t.request),await e.promise,!0}catch{return!1}}#$(){return"closed"in this.#v&&!!this.#v.closed}}class dR{#M;#q;#V;#B;#D;#z;constructor(e){const{compiledQuery:t,onDone:r,streamChunkSize:n,tedious:i}=e;if(this.#q=[],this.#V=n,this.#B={},this.#D=i,r){const e="onDone";this.#B[e]=(t,n)=>{if("chunkReady"!==t){if(delete this.#B[e],"error"===t)return r.reject(n);r.resolve({rowCount:this.#z,rows:this.#q})}}}this.#M=new this.#D.Request(t.sql,(e,t)=>{if(e)return Object.values(this.#B).forEach(t=>t("error",e instanceof AggregateError?e.errors:e));this.#z=t}),this.#W(t.parameters),this.#H()}get request(){return this.#M}readChunk(){let e=this.readChunk.name;return new Promise((t,r)=>{this.#B[e]=(n,i)=>{if(delete this.#B[e],"error"===n)return r(i);t(this.#q.splice(0,this.#V))},this.#M.resume()})}#W(e){for(let t=0;t<e.length;t++){let r=e[t];this.#M.addParameter(String(t+1),this.#F(r),r)}}#H(){let e=this.#V?()=>{this.#V<=this.#q.length&&(this.#M.pause(),Object.values(this.#B).forEach(e=>e("chunkReady")))}:()=>{},t=t=>{let r={};for(let e of t)r[e.metadata.colName]=e.value;this.#q.push(r),e()};this.#M.on("row",t),this.#M.once("requestCompleted",()=>{Object.values(this.#B).forEach(e=>e("completed")),this.#M.off("row",t)})}#F(e){if((0,cK.isNull)(e)||(0,cK.isUndefined)(e)||(0,cK.isString)(e))return this.#D.TYPES.NVarChar;if((0,cK.isBigInt)(e)||(0,cK.isNumber)(e)&&e%1==0)if(e<-0x80000000||e>0x7fffffff)return this.#D.TYPES.BigInt;else return this.#D.TYPES.Int;return(0,cK.isNumber)(e)?this.#D.TYPES.Float:(0,cK.isBoolean)(e)?this.#D.TYPES.Bit:(0,cK.isDate)(e)?this.#D.TYPES.DateTime:(0,cK.isBuffer)(e)?this.#D.TYPES.VarBinary:this.#D.TYPES.NVarChar}}class dO{#x;constructor(e){this.#x=e}async getSchemas(){return await this.#x.selectFrom("sys.schemas").select("name").execute()}async getTables(e={withInternalKyselyTables:!1}){let t=await this.#x.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",e=>e.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!e.withInternalKyselyTables,e=>e.where("tables.name","!=",c1.DEFAULT_MIGRATION_TABLE).where("tables.name","!=",c1.DEFAULT_MIGRATION_LOCK_TABLE)).select(["tables.name as table_name",e=>e.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#x.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",e=>e.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),r={};for(let e of t){let t=`${e.table_schema_name}.${e.table_name}`;(r[t]=r[t]||(0,cK.freeze)({columns:[],isView:"V "===e.table_type,name:e.table_name,schema:e.table_schema_name??void 0})).columns.push((0,cK.freeze)({dataType:e.type_name,dataTypeSchema:e.type_schema_name??void 0,hasDefaultValue:e.column_default_object_id>0||"NOT_APPLICABLE"!==e.column_generated_always_type||e.column_is_identity||e.column_is_computed||e.column_is_rowguidcol,isAutoIncrementing:e.column_is_identity,isNullable:e.column_is_nullable&&e.type_is_nullable,name:e.column_name,comment:e.column_comment??void 0}))}return Object.values(r)}async getMetadata(e){return{tables:await this.getTables(e)}}}var dI=cJ;let dk=/^[a-z0-9_]$/i;class dN extends dI.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(e){super.visitOffset(e),this.append(" rows")}compileColumnAlterations(e){let t={};for(let r of e)t[r.kind]||(t[r.kind]=[]),t[r.kind].push(r);let r=!0;t.AddColumnNode&&(this.append("add "),this.compileList(t.AddColumnNode),r=!1),t.AlterColumnNode&&(r||this.append(", "),this.compileList(t.AlterColumnNode)),t.DropColumnNode&&(r||this.append(", "),this.append("drop column "),this.compileList(t.DropColumnNode)),t.ModifyColumnNode&&(r||this.append(", "),this.compileList(t.ModifyColumnNode)),t.RenameColumnNode&&(r||this.append(", "),this.compileList(t.RenameColumnNode))}visitAddColumn(e){this.visitNode(e.column)}visitDropColumn(e){this.visitNode(e.column)}visitMergeQuery(e){super.visitMergeQuery(e),this.append(";")}visitCollate(e){this.append("collate ");let{name:t}=e.collation;for(let e of t)if(!dk.test(e))throw Error(`Invalid collation: ${t}`);this.append(t)}announcesNewColumnDataType(){return!1}}class dP{#b;constructor(e){this.#b=e}createDriver(){return new dA(this.#b)}createQueryCompiler(){return new dN}createAdapter(){return new dw}createIntrospector(e){return new dO(e)}}let dU=(0,cK.freeze)({is:e=>"AlterTableNode"===e.kind,create:e=>(0,cK.freeze)({kind:"AlterTableNode",table:e}),cloneWithTableProps:(e,t)=>(0,cK.freeze)({...e,...t}),cloneWithColumnAlteration:(e,t)=>(0,cK.freeze)({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,t]:[t]})}),dC=(0,cK.freeze)({is:e=>"CreateIndexNode"===e.kind,create:e=>(0,cK.freeze)({kind:"CreateIndexNode",name:cz.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t}),cloneWithColumns:(e,t)=>(0,cK.freeze)({...e,columns:[...e.columns||[],...t]})}),dD=(0,cK.freeze)({is:e=>"CreateSchemaNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"CreateSchemaNode",schema:cz.IdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})});var dL=e.i(363038),dj=e.i(987623);let d$=(0,cK.freeze)({is:e=>"DropIndexNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"DropIndexNode",name:dj.SchemableIdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})}),dM=(0,cK.freeze)({is:e=>"DropSchemaNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"DropSchemaNode",schema:cz.IdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})}),dq=(0,cK.freeze)({is:e=>"DropTableNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"DropTableNode",table:e,...t}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})});var dV=e.i(852394);let dB=(0,cK.freeze)({is:e=>"AddColumnNode"===e.kind,create:e=>(0,cK.freeze)({kind:"AddColumnNode",column:e})});var dz=e.i(583818);let dW=(0,cK.freeze)({is:e=>"ColumnDefinitionNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"ColumnDefinitionNode",column:dz.ColumnNode.create(e),dataType:t}),cloneWithFrontModifier:(e,t)=>(0,cK.freeze)({...e,frontModifiers:e.frontModifiers?(0,cK.freeze)([...e.frontModifiers,t]):[t]}),cloneWithEndModifier:(e,t)=>(0,cK.freeze)({...e,endModifiers:e.endModifiers?(0,cK.freeze)([...e.endModifiers,t]):[t]}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})}),dH=(0,cK.freeze)({is:e=>"DropColumnNode"===e.kind,create:e=>(0,cK.freeze)({kind:"DropColumnNode",column:dz.ColumnNode.create(e)})}),dF=(0,cK.freeze)({is:e=>"RenameColumnNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"RenameColumnNode",column:dz.ColumnNode.create(e),renameTo:dz.ColumnNode.create(t)})}),dK=(0,cK.freeze)({is:e=>"CheckConstraintNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"CheckConstraintNode",expression:e,name:t?cz.IdentifierNode.create(t):void 0})}),dQ=["no action","restrict","cascade","set null","set default"],dZ=(0,cK.freeze)({is:e=>"ReferencesNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"ReferencesNode",table:e,columns:(0,cK.freeze)([...t])}),cloneWithOnDelete:(e,t)=>(0,cK.freeze)({...e,onDelete:t}),cloneWithOnUpdate:(e,t)=>(0,cK.freeze)({...e,onUpdate:t})});var dG=e.i(505574),dY=e.i(897179),dJ=e.i(263899),dX=e.i(128887);function d0(e){return(0,dJ.isOperationNodeSource)(e)?e.toOperationNode():dX.ValueNode.createImmediate(e)}let d1=(0,cK.freeze)({is:e=>"GeneratedNode"===e.kind,create:e=>(0,cK.freeze)({kind:"GeneratedNode",...e}),createWithExpression:e=>(0,cK.freeze)({kind:"GeneratedNode",always:!0,expression:e}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})}),d2=(0,cK.freeze)({is:e=>"DefaultValueNode"===e.kind,create:e=>(0,cK.freeze)({kind:"DefaultValueNode",defaultValue:e})});function d5(e){if(dQ.includes(e))return e;throw Error(`invalid OnModifyForeignAction ${e}`)}class d6{#K;constructor(e){this.#K=e}autoIncrement(){return new d6(dW.cloneWith(this.#K,{autoIncrement:!0}))}identity(){return new d6(dW.cloneWith(this.#K,{identity:!0}))}primaryKey(){return new d6(dW.cloneWith(this.#K,{primaryKey:!0}))}references(e){let t=(0,dY.parseStringReference)(e);if(!t.table||dG.SelectAllNode.is(t.column))throw Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new d6(dW.cloneWith(this.#K,{references:dZ.create(t.table,[t.column])}))}onDelete(e){if(!this.#K.references)throw Error("on delete constraint can only be added for foreign keys");return new d6(dW.cloneWith(this.#K,{references:dZ.cloneWithOnDelete(this.#K.references,d5(e))}))}onUpdate(e){if(!this.#K.references)throw Error("on update constraint can only be added for foreign keys");return new d6(dW.cloneWith(this.#K,{references:dZ.cloneWithOnUpdate(this.#K.references,d5(e))}))}unique(){return new d6(dW.cloneWith(this.#K,{unique:!0}))}notNull(){return new d6(dW.cloneWith(this.#K,{notNull:!0}))}unsigned(){return new d6(dW.cloneWith(this.#K,{unsigned:!0}))}defaultTo(e){return new d6(dW.cloneWith(this.#K,{defaultTo:d2.create(d0(e))}))}check(e){return new d6(dW.cloneWith(this.#K,{check:dK.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new d6(dW.cloneWith(this.#K,{generated:d1.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new d6(dW.cloneWith(this.#K,{generated:d1.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new d6(dW.cloneWith(this.#K,{generated:d1.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#K.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new d6(dW.cloneWith(this.#K,{generated:d1.cloneWith(this.#K.generated,{stored:!0})}))}modifyFront(e){return new d6(dW.cloneWithFrontModifier(this.#K,e.toOperationNode()))}nullsNotDistinct(){return new d6(dW.cloneWith(this.#K,{nullsNotDistinct:!0}))}ifNotExists(){return new d6(dW.cloneWith(this.#K,{ifNotExists:!0}))}modifyEnd(e){return new d6(dW.cloneWithEndModifier(this.#K,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#K}}let d3=(0,cK.freeze)({is:e=>"ModifyColumnNode"===e.kind,create:e=>(0,cK.freeze)({kind:"ModifyColumnNode",column:e})});var d4=e.i(830163);let d8=(0,cK.freeze)({is:e=>"ForeignKeyConstraintNode"===e.kind,create:(e,t,r,n)=>(0,cK.freeze)({kind:"ForeignKeyConstraintNode",columns:e,references:dZ.create(t,r),name:n?cz.IdentifierNode.create(n):void 0}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})});class d9{#K;constructor(e){this.#K=e}onDelete(e){return new d9(d8.cloneWith(this.#K,{onDelete:d5(e)}))}onUpdate(e){return new d9(d8.cloneWith(this.#K,{onUpdate:d5(e)}))}deferrable(){return new d9(d8.cloneWith(this.#K,{deferrable:!0}))}notDeferrable(){return new d9(d8.cloneWith(this.#K,{deferrable:!1}))}initiallyDeferred(){return new d9(d8.cloneWith(this.#K,{initiallyDeferred:!0}))}initiallyImmediate(){return new d9(d8.cloneWith(this.#K,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#K}}let d7=(0,cK.freeze)({is:e=>"AddConstraintNode"===e.kind,create:e=>(0,cK.freeze)({kind:"AddConstraintNode",constraint:e})}),le=(0,cK.freeze)({is:e=>"UniqueConstraintNode"===e.kind,create:(e,t,r)=>(0,cK.freeze)({kind:"UniqueConstraintNode",columns:(0,cK.freeze)(e.map(dz.ColumnNode.create)),name:t?cz.IdentifierNode.create(t):void 0,nullsNotDistinct:r}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})}),lt=(0,cK.freeze)({is:e=>"DropConstraintNode"===e.kind,create:e=>(0,cK.freeze)({kind:"DropConstraintNode",constraintName:cz.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})}),lr=(0,cK.freeze)({is:e=>"AlterColumnNode"===e.kind,create:(e,t,r)=>(0,cK.freeze)({kind:"AlterColumnNode",column:dz.ColumnNode.create(e),[t]:r})});class ln{#Q;constructor(e){this.#Q=e}setDataType(e){return new li(lr.create(this.#Q,"dataType",(0,d4.parseDataTypeExpression)(e)))}setDefault(e){return new li(lr.create(this.#Q,"setDefault",d0(e)))}dropDefault(){return new li(lr.create(this.#Q,"dropDefault",!0))}setNotNull(){return new li(lr.create(this.#Q,"setNotNull",!0))}dropNotNull(){return new li(lr.create(this.#Q,"dropNotNull",!0))}$call(e){return e(this)}}class li{#Z;constructor(e){this.#Z=e}toOperationNode(){return this.#Z}}class lo{#G;constructor(e){this.#G=(0,cK.freeze)(e)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class la{#G;constructor(e){this.#G=(0,cK.freeze)(e)}onDelete(e){return new la({...this.#G,constraintBuilder:this.#G.constraintBuilder.onDelete(e)})}onUpdate(e){return new la({...this.#G,constraintBuilder:this.#G.constraintBuilder.onUpdate(e)})}deferrable(){return new la({...this.#G,constraintBuilder:this.#G.constraintBuilder.deferrable()})}notDeferrable(){return new la({...this.#G,constraintBuilder:this.#G.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new la({...this.#G,constraintBuilder:this.#G.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new la({...this.#G,constraintBuilder:this.#G.constraintBuilder.initiallyImmediate()})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(dU.cloneWithTableProps(this.#G.node,{addConstraint:d7.create(this.#G.constraintBuilder.toOperationNode())}),this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class ls{#G;constructor(e){this.#G=(0,cK.freeze)(e)}ifExists(){return new ls({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{dropConstraint:lt.cloneWith(this.#G.node.dropConstraint,{ifExists:!0})})})}cascade(){return new ls({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{dropConstraint:lt.cloneWith(this.#G.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new ls({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{dropConstraint:lt.cloneWith(this.#G.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}let lc=(0,cK.freeze)({is:e=>"PrimaryKeyConstraintNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"PrimaryKeyConstraintNode",columns:(0,cK.freeze)(e.map(dz.ColumnNode.create)),name:t?cz.IdentifierNode.create(t):void 0}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})}),ld=(0,cK.freeze)({is:e=>"AddIndexNode"===e.kind,create:e=>(0,cK.freeze)({kind:"AddIndexNode",name:cz.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t}),cloneWithColumns:(e,t)=>(0,cK.freeze)({...e,columns:[...e.columns||[],...t]})});class ll{#G;constructor(e){this.#G=(0,cK.freeze)(e)}unique(){return new ll({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addIndex:ld.cloneWith(this.#G.node.addIndex,{unique:!0})})})}column(e){return new ll({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addIndex:ld.cloneWithColumns(this.#G.node.addIndex,[(0,dY.parseOrderedColumnName)(e)])})})}columns(e){return new ll({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addIndex:ld.cloneWithColumns(this.#G.node.addIndex,e.map(dY.parseOrderedColumnName))})})}expression(e){return new ll({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addIndex:ld.cloneWithColumns(this.#G.node.addIndex,[e.toOperationNode()])})})}using(e){return new ll({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addIndex:ld.cloneWith(this.#G.node.addIndex,{using:cW.RawNode.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class lu{#K;constructor(e){this.#K=e}nullsNotDistinct(){return new lu(le.cloneWith(this.#K,{nullsNotDistinct:!0}))}deferrable(){return new lu(le.cloneWith(this.#K,{deferrable:!0}))}notDeferrable(){return new lu(le.cloneWith(this.#K,{deferrable:!1}))}initiallyDeferred(){return new lu(le.cloneWith(this.#K,{initiallyDeferred:!0}))}initiallyImmediate(){return new lu(le.cloneWith(this.#K,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#K}}class lp{#K;constructor(e){this.#K=e}deferrable(){return new lp(lc.cloneWith(this.#K,{deferrable:!0}))}notDeferrable(){return new lp(lc.cloneWith(this.#K,{deferrable:!1}))}initiallyDeferred(){return new lp(lc.cloneWith(this.#K,{initiallyDeferred:!0}))}initiallyImmediate(){return new lp(lc.cloneWith(this.#K,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#K}}class lf{#K;constructor(e){this.#K=e}$call(e){return e(this)}toOperationNode(){return this.#K}}let lh=(0,cK.freeze)({is:e=>"RenameConstraintNode"===e.kind,create:(e,t)=>(0,cK.freeze)({kind:"RenameConstraintNode",oldName:cz.IdentifierNode.create(e),newName:cz.IdentifierNode.create(t)})});class lm{#G;constructor(e){this.#G=(0,cK.freeze)(e)}renameTo(e){return new lo({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{renameTo:(0,dV.parseTable)(e)})})}setSchema(e){return new lo({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{setSchema:cz.IdentifierNode.create(e)})})}alterColumn(e,t){let r=t(new ln(e));return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,r.toOperationNode())})}dropColumn(e){return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,dH.create(e))})}renameColumn(e,t){return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,dF.create(e,t))})}addColumn(e,t,r=cK.noop){let n=r(new d6(dW.create(e,(0,d4.parseDataTypeExpression)(t))));return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,dB.create(n.toOperationNode()))})}modifyColumn(e,t,r=cK.noop){let n=r(new d6(dW.create(e,(0,d4.parseDataTypeExpression)(t))));return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,d3.create(n.toOperationNode()))})}addUniqueConstraint(e,t,r=cK.noop){let n=r(new lu(le.create(t,e)));return new lo({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addConstraint:d7.create(n.toOperationNode())})})}addCheckConstraint(e,t,r=cK.noop){let n=r(new lf(dK.create(t.toOperationNode(),e)));return new lo({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addConstraint:d7.create(n.toOperationNode())})})}addForeignKeyConstraint(e,t,r,n,i=cK.noop){let o=i(new d9(d8.create(t.map(dz.ColumnNode.create),(0,dV.parseTable)(r),n.map(dz.ColumnNode.create),e)));return new la({...this.#G,constraintBuilder:o})}addPrimaryKeyConstraint(e,t,r=cK.noop){let n=r(new lp(lc.create(t,e)));return new lo({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addConstraint:d7.create(n.toOperationNode())})})}dropConstraint(e){return new ls({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{dropConstraint:lt.create(e)})})}renameConstraint(e,t){return new ls({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{renameConstraint:lh.create(e,t)})})}addIndex(e){return new ll({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{addIndex:ld.create(e)})})}dropIndex(e){return new lo({...this.#G,node:dU.cloneWithTableProps(this.#G.node,{dropIndex:d$.create(e)})})}$call(e){return e(this)}}class lg{#G;constructor(e){this.#G=(0,cK.freeze)(e)}alterColumn(e,t){let r=t(new ln(e));return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,r.toOperationNode())})}dropColumn(e){return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,dH.create(e))})}renameColumn(e,t){return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,dF.create(e,t))})}addColumn(e,t,r=cK.noop){let n=r(new d6(dW.create(e,(0,d4.parseDataTypeExpression)(t))));return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,dB.create(n.toOperationNode()))})}modifyColumn(e,t,r=cK.noop){let n=r(new d6(dW.create(e,(0,d4.parseDataTypeExpression)(t))));return new lg({...this.#G,node:dU.cloneWithColumnAlteration(this.#G.node,d3.create(n.toOperationNode()))})}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}var ly=e.i(547222),lb=e.i(143396),lw=e.i(49115),lx=e.i(837769);class lv extends lw.OperationNodeTransformer{transformPrimitiveValueList(e){return lx.ValueListNode.create(e.values.map(dX.ValueNode.createImmediate))}transformValue(e){return dX.ValueNode.createImmediate(e.value)}}class l_{#G;constructor(e){this.#G=(0,cK.freeze)(e)}ifNotExists(){return new l_({...this.#G,node:dC.cloneWith(this.#G.node,{ifNotExists:!0})})}unique(){return new l_({...this.#G,node:dC.cloneWith(this.#G.node,{unique:!0})})}nullsNotDistinct(){return new l_({...this.#G,node:dC.cloneWith(this.#G.node,{nullsNotDistinct:!0})})}on(e){return new l_({...this.#G,node:dC.cloneWith(this.#G.node,{table:(0,dV.parseTable)(e)})})}column(e){return new l_({...this.#G,node:dC.cloneWithColumns(this.#G.node,[(0,dY.parseOrderedColumnName)(e)])})}columns(e){return new l_({...this.#G,node:dC.cloneWithColumns(this.#G.node,e.map(dY.parseOrderedColumnName))})}expression(e){return new l_({...this.#G,node:dC.cloneWithColumns(this.#G.node,[e.toOperationNode()])})}using(e){return new l_({...this.#G,node:dC.cloneWith(this.#G.node,{using:cW.RawNode.createWithSql(e)})})}where(...e){let t=new lv;return new l_({...this.#G,node:lb.QueryNode.cloneWithWhere(this.#G.node,t.transformNode((0,ly.parseValueBinaryOperationOrExpression)(e),this.#G.queryId))})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class lE{#G;constructor(e){this.#G=(0,cK.freeze)(e)}ifNotExists(){return new lE({...this.#G,node:dD.cloneWith(this.#G.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}var lT=e.i(637809);class lA{#G;constructor(e){this.#G=(0,cK.freeze)(e)}temporary(){return new lA({...this.#G,node:dL.CreateTableNode.cloneWith(this.#G.node,{temporary:!0})})}onCommit(e){return new lA({...this.#G,node:dL.CreateTableNode.cloneWith(this.#G.node,{onCommit:function(e){if(dL.ON_COMMIT_ACTIONS.includes(e))return e;throw Error(`invalid OnCommitAction ${e}`)}(e)})})}ifNotExists(){return new lA({...this.#G,node:dL.CreateTableNode.cloneWith(this.#G.node,{ifNotExists:!0})})}addColumn(e,t,r=cK.noop){let n=r(new d6(dW.create(e,(0,d4.parseDataTypeExpression)(t))));return new lA({...this.#G,node:dL.CreateTableNode.cloneWithColumn(this.#G.node,n.toOperationNode())})}addPrimaryKeyConstraint(e,t,r=cK.noop){let n=r(new lp(lc.create(t,e)));return new lA({...this.#G,node:dL.CreateTableNode.cloneWithConstraint(this.#G.node,n.toOperationNode())})}addUniqueConstraint(e,t,r=cK.noop){let n=r(new lu(le.create(t,e)));return new lA({...this.#G,node:dL.CreateTableNode.cloneWithConstraint(this.#G.node,n.toOperationNode())})}addCheckConstraint(e,t,r=cK.noop){let n=r(new lf(dK.create(t.toOperationNode(),e)));return new lA({...this.#G,node:dL.CreateTableNode.cloneWithConstraint(this.#G.node,n.toOperationNode())})}addForeignKeyConstraint(e,t,r,n,i=cK.noop){let o=i(new d9(d8.create(t.map(dz.ColumnNode.create),(0,dV.parseTable)(r),n.map(dz.ColumnNode.create),e)));return new lA({...this.#G,node:dL.CreateTableNode.cloneWithConstraint(this.#G.node,o.toOperationNode())})}modifyFront(e){return new lA({...this.#G,node:dL.CreateTableNode.cloneWithFrontModifier(this.#G.node,e.toOperationNode())})}modifyEnd(e){return new lA({...this.#G,node:dL.CreateTableNode.cloneWithEndModifier(this.#G.node,e.toOperationNode())})}as(e){return new lA({...this.#G,node:dL.CreateTableNode.cloneWith(this.#G.node,{selectQuery:(0,lT.parseExpression)(e)})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class lS{#G;constructor(e){this.#G=(0,cK.freeze)(e)}on(e){return new lS({...this.#G,node:d$.cloneWith(this.#G.node,{table:(0,dV.parseTable)(e)})})}ifExists(){return new lS({...this.#G,node:d$.cloneWith(this.#G.node,{ifExists:!0})})}cascade(){return new lS({...this.#G,node:d$.cloneWith(this.#G.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class lR{#G;constructor(e){this.#G=(0,cK.freeze)(e)}ifExists(){return new lR({...this.#G,node:dM.cloneWith(this.#G.node,{ifExists:!0})})}cascade(){return new lR({...this.#G,node:dM.cloneWith(this.#G.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class lO{#G;constructor(e){this.#G=(0,cK.freeze)(e)}ifExists(){return new lO({...this.#G,node:dq.cloneWith(this.#G.node,{ifExists:!0})})}cascade(){return new lO({...this.#G,node:dq.cloneWith(this.#G.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}var lI=e.i(642071),lk=e.i(89994);class lN{#Y=new lv;transformQuery(e){return this.#Y.transformNode(e.node,e.queryId)}transformResult(e){return Promise.resolve(e.result)}}class lP{#G;constructor(e){this.#G=(0,cK.freeze)(e)}temporary(){return new lP({...this.#G,node:lk.CreateViewNode.cloneWith(this.#G.node,{temporary:!0})})}materialized(){return new lP({...this.#G,node:lk.CreateViewNode.cloneWith(this.#G.node,{materialized:!0})})}ifNotExists(){return new lP({...this.#G,node:lk.CreateViewNode.cloneWith(this.#G.node,{ifNotExists:!0})})}orReplace(){return new lP({...this.#G,node:lk.CreateViewNode.cloneWith(this.#G.node,{orReplace:!0})})}columns(e){return new lP({...this.#G,node:lk.CreateViewNode.cloneWith(this.#G.node,{columns:e.map(dY.parseColumnName)})})}as(e){let t=e.withPlugin(new lN).toOperationNode();return new lP({...this.#G,node:lk.CreateViewNode.cloneWith(this.#G.node,{as:t})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}let lU=(0,cK.freeze)({is:e=>"DropViewNode"===e.kind,create:e=>(0,cK.freeze)({kind:"DropViewNode",name:dj.SchemableIdentifierNode.create(e)}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})});class lC{#G;constructor(e){this.#G=(0,cK.freeze)(e)}materialized(){return new lC({...this.#G,node:lU.cloneWith(this.#G.node,{materialized:!0})})}ifExists(){return new lC({...this.#G,node:lU.cloneWith(this.#G.node,{ifExists:!0})})}cascade(){return new lC({...this.#G,node:lU.cloneWith(this.#G.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}let lD=(0,cK.freeze)({is:e=>"CreateTypeNode"===e.kind,create:e=>(0,cK.freeze)({kind:"CreateTypeNode",name:e}),cloneWithEnum:(e,t)=>(0,cK.freeze)({...e,enum:lx.ValueListNode.create(t.map(dX.ValueNode.createImmediate))})});class lL{#G;constructor(e){this.#G=(0,cK.freeze)(e)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}asEnum(e){return new lL({...this.#G,node:lD.cloneWithEnum(this.#G.node,e)})}$call(e){return e(this)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}let lj=(0,cK.freeze)({is:e=>"DropTypeNode"===e.kind,create:e=>(0,cK.freeze)({kind:"DropTypeNode",name:e}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})});class l${#G;constructor(e){this.#G=(0,cK.freeze)(e)}ifExists(){return new l$({...this.#G,node:lj.cloneWith(this.#G.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}function lM(e){if(!e.includes("."))return dj.SchemableIdentifierNode.create(e);{let t=e.split(".").map(lq);if(2===t.length)return dj.SchemableIdentifierNode.createWithSchema(t[0],t[1]);throw Error(`invalid schemable identifier ${e}`)}}function lq(e){return e.trim()}let lV=(0,cK.freeze)({is:e=>"RefreshMaterializedViewNode"===e.kind,create:e=>(0,cK.freeze)({kind:"RefreshMaterializedViewNode",name:dj.SchemableIdentifierNode.create(e)}),cloneWith:(e,t)=>(0,cK.freeze)({...e,...t})});class lB{#G;constructor(e){this.#G=(0,cK.freeze)(e)}concurrently(){return new lB({...this.#G,node:lV.cloneWith(this.#G.node,{concurrently:!0,withNoData:!1})})}withData(){return new lB({...this.#G,node:lV.cloneWith(this.#G.node,{withNoData:!1})})}withNoData(){return new lB({...this.#G,node:lV.cloneWith(this.#G.node,{withNoData:!0,concurrently:!1})})}$call(e){return e(this)}toOperationNode(){return this.#G.executor.transformQuery(this.#G.node,this.#G.queryId)}compile(){return this.#G.executor.compileQuery(this.toOperationNode(),this.#G.queryId)}async execute(){await this.#G.executor.executeQuery(this.compile())}}class lz{#J;constructor(e){this.#J=e}createTable(e){return new lA({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:dL.CreateTableNode.create((0,dV.parseTable)(e))})}dropTable(e){return new lO({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:dq.create((0,dV.parseTable)(e))})}createIndex(e){return new l_({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:dC.create(e)})}dropIndex(e){return new lS({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:d$.create(e)})}createSchema(e){return new lE({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:dD.create(e)})}dropSchema(e){return new lR({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:dM.create(e)})}alterTable(e){return new lm({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:dU.create((0,dV.parseTable)(e))})}createView(e){return new lP({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:lk.CreateViewNode.create(e)})}refreshMaterializedView(e){return new lB({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:lV.create(e)})}dropView(e){return new lC({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:lU.create(e)})}createType(e){return new lL({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:lD.create(lM(e))})}dropType(e){return new l$({queryId:(0,cQ.createQueryId)(),executor:this.#J,node:lj.create(lM(e))})}withPlugin(e){return new lz(this.#J.withPlugin(e))}withoutPlugins(){return new lz(this.#J.withoutPlugins())}withSchema(e){return new lz(this.#J.withPluginAtFront(new lI.WithSchemaPlugin(e)))}}var lW=e.i(952121),lH=e.i(378586);class lF{ref(e){return new lW.DynamicReferenceBuilder(e)}table(e){return new lH.DynamicTableBuilder(e)}}class lK{#X;constructor(e){this.#X=e}async provideConnection(e){let t=await this.#X.acquireConnection();try{return await e(t)}finally{await this.#X.releaseConnection(t)}}}var lQ=e.i(596879),lZ=e.i(329374);class lG extends lZ.QueryExecutorBase{#ee;#et;#er;constructor(e,t,r,n=[]){super(n),this.#ee=e,this.#et=t,this.#er=r}get adapter(){return this.#et}compileQuery(e,t){return this.#ee.compileQuery(e,t)}provideConnection(e){return this.#er.provideConnection(e)}withPlugins(e){return new lG(this.#ee,this.#et,this.#er,[...this.plugins,...e])}withPlugin(e){return new lG(this.#ee,this.#et,this.#er,[...this.plugins,e])}withPluginAtFront(e){return new lG(this.#ee,this.#et,this.#er,[e,...this.plugins])}withConnectionProvider(e){return new lG(this.#ee,this.#et,e,[...this.plugins])}withoutPlugins(){return new lG(this.#ee,this.#et,this.#er,[])}}function lY(){return"undefined"!=typeof performance&&(0,cK.isFunction)(performance.now)?performance.now():Date.now()}class lJ{#X;#en;#ei;#eo;#ea;#S=new WeakSet;constructor(e,t){this.#eo=!1,this.#X=e,this.#en=t}async init(){if(this.#ea)throw Error("driver has already been destroyed");this.#ei||(this.#ei=this.#X.init().then(()=>{this.#eo=!0}).catch(e=>(this.#ei=void 0,Promise.reject(e)))),await this.#ei}async acquireConnection(){if(this.#ea)throw Error("driver has already been destroyed");this.#eo||await this.init();let e=await this.#X.acquireConnection();return this.#S.has(e)||(this.#es()&&this.#ec(e),this.#S.add(e)),e}async releaseConnection(e){await this.#X.releaseConnection(e)}beginTransaction(e,t){return this.#X.beginTransaction(e,t)}commitTransaction(e){return this.#X.commitTransaction(e)}rollbackTransaction(e){return this.#X.rollbackTransaction(e)}savepoint(e,t,r){if(this.#X.savepoint)return this.#X.savepoint(e,t,r);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(e,t,r){if(this.#X.rollbackToSavepoint)return this.#X.rollbackToSavepoint(e,t,r);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(e,t,r){if(this.#X.releaseSavepoint)return this.#X.releaseSavepoint(e,t,r);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#ei&&(await this.#ei,this.#ea||(this.#ea=this.#X.destroy().catch(e=>(this.#ea=void 0,Promise.reject(e)))),await this.#ea)}#es(){return this.#en.isLevelEnabled("query")||this.#en.isLevelEnabled("error")}#ec(e){let t=e.executeQuery,r=e.streamQuery,n=this;e.executeQuery=async r=>{let i,o=lY();try{return await t.call(e,r)}catch(e){throw i=e,await n.#ed(e,r,o),e}finally{i||await n.#el(r,o)}},e.streamQuery=async function*(t,i){let o,a=lY();try{for await(let n of r.call(e,t,i))yield n}catch(e){throw o=e,await n.#ed(e,t,a),e}finally{o||await n.#el(t,a,!0)}}}async #ed(e,t,r){await this.#en.error(()=>({level:"error",error:e,query:t,queryDurationMillis:this.#eu(r)}))}async #el(e,t,r=!1){await this.#en.query(()=>({level:"query",isStream:r,query:e,queryDurationMillis:this.#eu(t)}))}#eu(e){return lY()-e}}let lX=()=>{};class l0{#v;#ep;constructor(e){this.#v=e}async provideConnection(e){for(;this.#ep;)await this.#ep.catch(lX);return this.#ep=this.#ef(e).finally(()=>{this.#ep=void 0}),this.#ep}async #ef(e){return await e(this.#v)}}let l1=["read only","read write"],l2=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function l5(e){if(e.accessMode&&!l1.includes(e.accessMode))throw Error(`invalid transaction access mode ${e.accessMode}`);if(e.isolationLevel&&!l2.includes(e.isolationLevel))throw Error(`invalid transaction isolation level ${e.isolationLevel}`)}var l6=e.i(536168);(0,cK.freeze)(["query","error"]);class l3{#eh;#em;constructor(e){(0,cK.isFunction)(e)?(this.#em=e,this.#eh=(0,cK.freeze)({query:!0,error:!0})):(this.#em=l4,this.#eh=(0,cK.freeze)({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#eh[e]}async query(e){this.#eh.query&&await this.#em(e())}async error(e){this.#eh.error&&await this.#em(e())}}function l4(e){if("query"===e.level){let t=`kysely:query:${e.isStream?"stream:":""}`;console.log(`${t} ${e.query.sql}`),console.log(`${t} duration: ${e.queryDurationMillis.toFixed(1)}ms`)}else"error"===e.level&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}var l8=e.i(970051),l9=e.i(274615),l7=e.i(711833),ue=e.i(394102);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class ut extends lQ.QueryCreator{#G;constructor(e){let t,r;if(function(e){return(0,cK.isObject)(e)&&(0,cK.isObject)(e.config)&&(0,cK.isObject)(e.driver)&&(0,cK.isObject)(e.executor)&&(0,cK.isObject)(e.dialect)}(e))t={executor:e.executor},r={...e};else{const n=e.dialect,i=n.createDriver(),o=n.createQueryCompiler(),a=n.createAdapter(),s=new lJ(i,new l3(e.log??[])),c=new lG(o,a,new lK(s),e.plugins??[]);t={executor:c},r={config:e,executor:c,dialect:n,driver:s}}super(t),this.#G=(0,cK.freeze)(r)}get schema(){return new lz(this.#G.executor)}get dynamic(){return new lF}get introspection(){return this.#G.dialect.createIntrospector(this.withoutPlugins())}case(e){return new l8.CaseBuilder({node:l9.CaseNode.create((0,cK.isUndefined)(e)?void 0:(0,lT.parseExpression)(e))})}get fn(){return(0,l6.createFunctionModule)()}transaction(){return new ui({...this.#G})}startTransaction(){return new uo({...this.#G})}connection(){return new un({...this.#G})}withPlugin(e){return new ut({...this.#G,executor:this.#G.executor.withPlugin(e)})}withoutPlugins(){return new ut({...this.#G,executor:this.#G.executor.withoutPlugins()})}withSchema(e){return new ut({...this.#G,executor:this.#G.executor.withPluginAtFront(new lI.WithSchemaPlugin(e))})}withTables(){return new ut({...this.#G})}async destroy(){await this.#G.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#G.executor}executeQuery(e,t){void 0!==t&&(0,ue.logOnce)("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");let r=(0,cK.isObject)(e)&&(0,cK.isFunction)(e.compile)?e.compile():e;return this.getExecutor().executeQuery(r)}async [Symbol.asyncDispose](){await this.destroy()}}class ur extends ut{#G;constructor(e){super(e),this.#G=e}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new ur({...this.#G,executor:this.#G.executor.withPlugin(e)})}withoutPlugins(){return new ur({...this.#G,executor:this.#G.executor.withoutPlugins()})}withSchema(e){return new ur({...this.#G,executor:this.#G.executor.withPluginAtFront(new lI.WithSchemaPlugin(e))})}withTables(){return new ur({...this.#G})}}class un{#G;constructor(e){this.#G=(0,cK.freeze)(e)}async execute(e){return this.#G.executor.provideConnection(async t=>{let r=this.#G.executor.withConnectionProvider(new l0(t)),n=new ut({...this.#G,executor:r});return await e(n)})}}class ui{#G;constructor(e){this.#G=(0,cK.freeze)(e)}setAccessMode(e){return new ui({...this.#G,accessMode:e})}setIsolationLevel(e){return new ui({...this.#G,isolationLevel:e})}async execute(e){let{isolationLevel:t,accessMode:r,...n}=this.#G,i={isolationLevel:t,accessMode:r};return l5(i),this.#G.executor.provideConnection(async t=>{let r=this.#G.executor.withConnectionProvider(new l0(t)),o=new ur({...n,executor:r}),a=!1;try{await this.#G.driver.beginTransaction(t,i),a=!0;let r=await e(o);return await this.#G.driver.commitTransaction(t),r}catch(e){throw a&&await this.#G.driver.rollbackTransaction(t),e}})}}class uo{#G;constructor(e){this.#G=(0,cK.freeze)(e)}setAccessMode(e){return new uo({...this.#G,accessMode:e})}setIsolationLevel(e){return new uo({...this.#G,isolationLevel:e})}async execute(){let{isolationLevel:e,accessMode:t,...r}=this.#G,n={isolationLevel:e,accessMode:t};l5(n);let i=await (0,l7.provideControlledConnection)(this.#G.executor);return await this.#G.driver.beginTransaction(i.connection,n),new ua({...r,connection:i,executor:this.#G.executor.withConnectionProvider(new l0(i.connection))})}}class ua extends ur{#G;#eg;#ey;constructor(e){const t={isCommitted:!1,isRolledBack:!1},{connection:r,...n}=e={...e,executor:new ud(e.executor,t)};super(n),this.#G=(0,cK.freeze)(e),this.#ey=t;const i=(0,cQ.createQueryId)();this.#eg=t=>e.executor.compileQuery(t,i)}get isCommitted(){return this.#ey.isCommitted}get isRolledBack(){return this.#ey.isRolledBack}commit(){return uc(this.#ey),new us(async()=>{await this.#G.driver.commitTransaction(this.#G.connection.connection),this.#ey.isCommitted=!0,this.#G.connection.release()})}rollback(){return uc(this.#ey),new us(async()=>{await this.#G.driver.rollbackTransaction(this.#G.connection.connection),this.#ey.isRolledBack=!0,this.#G.connection.release()})}savepoint(e){return uc(this.#ey),new us(async()=>(await this.#G.driver.savepoint?.(this.#G.connection.connection,e,this.#eg),new ua({...this.#G})))}rollbackToSavepoint(e){return uc(this.#ey),new us(async()=>(await this.#G.driver.rollbackToSavepoint?.(this.#G.connection.connection,e,this.#eg),new ua({...this.#G})))}releaseSavepoint(e){return uc(this.#ey),new us(async()=>(await this.#G.driver.releaseSavepoint?.(this.#G.connection.connection,e,this.#eg),new ua({...this.#G})))}withPlugin(e){return new ua({...this.#G,executor:this.#G.executor.withPlugin(e)})}withoutPlugins(){return new ua({...this.#G,executor:this.#G.executor.withoutPlugins()})}withSchema(e){return new ua({...this.#G,executor:this.#G.executor.withPluginAtFront(new lI.WithSchemaPlugin(e))})}withTables(){return new ua({...this.#G})}}class us{#eb;constructor(e){this.#eb=e}async execute(){return await this.#eb()}}function uc(e){if(e.isCommitted)throw Error("Transaction is already committed");if(e.isRolledBack)throw Error("Transaction is already rolled back")}class ud{#J;#ey;constructor(e,t){e instanceof ud?this.#J=e.#J:this.#J=e,this.#ey=t}get adapter(){return this.#J.adapter}get plugins(){return this.#J.plugins}transformQuery(e,t){return this.#J.transformQuery(e,t)}compileQuery(e,t){return this.#J.compileQuery(e,t)}provideConnection(e){return this.#J.provideConnection(e)}executeQuery(e){return uc(this.#ey),this.#J.executeQuery(e)}stream(e,t){return uc(this.#ey),this.#J.stream(e,t)}withConnectionProvider(e){return new ud(this.#J.withConnectionProvider(e),this.#ey)}withPlugin(e){return new ud(this.#J.withPlugin(e),this.#ey)}withPlugins(e){return new ud(this.#J.withPlugins(e),this.#ey)}withPluginAtFront(e){return new ud(this.#J.withPluginAtFront(e),this.#ey)}withoutPlugins(){return new ud(this.#J.withoutPlugins(),this.#ey)}}let ul=[],uu=-1,up=({adapter:e,config:t})=>r=>{let n=Math.random().toString(36).substring(2,15),i={...t,supportsBooleans:t.supportsBooleans??!0,supportsDates:t.supportsDates??!0,supportsJSON:t.supportsJSON??!1,adapterName:t.adapterName??t.adapterId,supportsNumericIds:t.supportsNumericIds??!0,transaction:t.transaction??!1,disableTransformInput:t.disableTransformInput??!1,disableTransformOutput:t.disableTransformOutput??!1};if(r.advanced?.database?.useNumberId===!0&&!1===i.supportsNumericIds)throw Error(`[${i.adapterName}] Your database or database adapter does not support numeric ids. Please disable "useNumberId" in your config.`);let o=cV(r),a=({field:e,model:t})=>{if("id"===e||"_id"===e)return"id";let r=s(t),n=o[r]?.fields[e];if(!n){let t=Object.entries(o[r].fields).find(([t,r])=>r.fieldName===e);t&&(n=t[1],e=t[0])}if(!n)throw l(`Field ${e} not found in model ${r}`),l("Schema:",o),Error(`Field ${e} not found in model ${r}`);return e},s=e=>{if(i.usePlural&&"s"===e.charAt(e.length-1)){let t=e.slice(0,-1),r=o[t]?t:void 0;if(r||(r=Object.entries(o).find(([e,r])=>r.modelName===t)?.[0]),r)return r}let t=o[e]?e:void 0;if(t||(t=Object.entries(o).find(([t,r])=>r.modelName===e)?.[0]),!t)throw l(`Model "${e}" not found in schema`),l("Schema:",o),Error(`Model "${e}" not found in schema`);return t},c=e=>{let t=s(e),r=i&&i.usePlural;return o&&o[t]&&o[t].modelName!==e?r?`${o[t].modelName}s`:o[t].modelName:r?`${e}s`:e};function d({model:e,field:t}){let r=s(e),n=a({model:r,field:t});return o[r]?.fields[n]?.fieldName||n}let l=(...e)=>{if(!0===i.debugLogs||"object"==typeof i.debugLogs){if("object"==typeof i.debugLogs&&"isRunningAdapterTests"in i.debugLogs){i.debugLogs.isRunningAdapterTests&&(e.shift(),ul.push({instance:n,args:e}));return}if("object"!=typeof i.debugLogs||!i.debugLogs.logCondition||i.debugLogs.logCondition?.())if("object"==typeof e[0]&&"method"in e[0]){let t=e.shift().method;if("object"==typeof i.debugLogs){if("create"===t&&!i.debugLogs.create)return;else if("update"===t&&!i.debugLogs.update)return;else if("updateMany"===t&&!i.debugLogs.updateMany)return;else if("findOne"===t&&!i.debugLogs.findOne)return;else if("findMany"===t&&!i.debugLogs.findMany)return;else if("delete"===t&&!i.debugLogs.delete)return;else if("deleteMany"===t&&!i.debugLogs.deleteMany)return;else if("count"===t&&!i.debugLogs.count)return}tY.info(`[${i.adapterName}]`,...e)}else tY.info(`[${i.adapterName}]`,...e)}},u=({customModelName:e,forceAllowId:t})=>{let n=!i.disableIdGeneration&&!r.advanced?.database?.useNumberId&&!t,o=s(e??"id");return{type:r.advanced?.database?.useNumberId?"number":"string",required:!!n,...n?{defaultValue(){if(i.disableIdGeneration)return;let e=r.advanced?.database?.useNumberId,t=r.advanced?.database?.generateId;if(r.advanced?.generateId!==void 0&&(tY.warn("Your Better Auth config includes advanced.generateId which is deprecated. Please use advanced.database.generateId instead. This will be removed in future releases."),t=r.advanced?.generateId),!1!==t&&!e)return t?t({model:o}):i.customIdGenerator?i.customIdGenerator({model:o}):aE()}}:{}}},p=({model:e,field:t})=>{let r=s(e),n=a({field:t,model:r}),i=o[r].fields;return i.id=u({customModelName:r}),i[n]},f=async(e,t,n,a)=>{let s={},c=o[t].fields,d=i.mapKeysTransformInput??{};for(let l in i.disableIdGeneration||r.advanced?.database?.useNumberId||(c.id=u({customModelName:t,forceAllowId:a&&"id"in e})),c){let a=e[l],u=c[l],p=d[l]||c[l].fieldName||l;if(void 0===a&&(void 0===u.defaultValue&&!u.transform?.input&&!("update"===n&&u.onUpdate)||"update"===n&&!u.onUpdate))continue;let f=function(e,t,r){if("update"===r)return void 0===e&&void 0!==t.onUpdate?"function"==typeof t.onUpdate?t.onUpdate():t.onUpdate:e;return null==e&&void 0!==t.defaultValue?"function"==typeof t.defaultValue?t.defaultValue():t.defaultValue:e}(a,u,n);u.transform?.input&&(f=await u.transform.input(f)),u.references?.field==="id"&&r.advanced?.database?.useNumberId?f=Array.isArray(f)?f.map(e=>null!==e?Number(e):null):null!==f?Number(f):null:!1===i.supportsJSON&&"object"==typeof f&&"json"===u.type?f=JSON.stringify(f):!1===i.supportsDates&&f instanceof Date&&"date"===u.type?f=f.toISOString():!1===i.supportsBooleans&&"boolean"==typeof f&&(f=+!!f),i.customTransformInput&&(f=i.customTransformInput({data:f,action:n,field:p,fieldAttributes:u,model:t,schema:o,options:r})),void 0!==f&&(s[p]=f)}return s},h=async(e,t,n=[])=>{if(!e)return null;let a=i.mapKeysTransformOutput??{},s={},c=o[t].fields;for(let d in c[Object.entries(a).find(([e,t])=>"id"===t)?.[0]??"id"]={type:r.advanced?.database?.useNumberId?"number":"string"},c){if(n.length&&!n.includes(d))continue;let l=c[d];if(l){let c=l.fieldName||d,u=e[Object.entries(a).find(([e,t])=>t===c)?.[0]||c];l.transform?.output&&(u=await l.transform.output(u));let p=a[d]||d;"id"===c||l.references?.field==="id"?null!=u&&(u=String(u)):!1===i.supportsJSON&&"string"==typeof u&&"json"===l.type?u=oz(u):!1===i.supportsDates&&"string"==typeof u&&"date"===l.type?u=new Date(u):!1===i.supportsBooleans&&"number"==typeof u&&"boolean"===l.type&&(u=1===u),i.customTransformOutput&&(u=i.customTransformOutput({data:u,field:p,fieldAttributes:l,select:n,model:t,schema:o,options:r})),s[p]=u}}return s},m=({model:e,where:t})=>{if(!t)return;let n=i.mapKeysTransformInput??{};return t.map(t=>{let{field:i,value:o,operator:c="eq",connector:l="AND"}=t;if("in"===c&&!Array.isArray(o))throw Error("Value must be an array");let u=s(e),f=a({field:i,model:e}),h=n[f]||d({field:f,model:u}),m=p({field:f,model:u});return("id"===f||m.references?.field==="id")&&r.advanced?.database?.useNumberId?Array.isArray(o)?{operator:c,connector:l,field:h,value:o.map(Number)}:{operator:c,connector:l,field:h,value:Number(o)}:{operator:c,connector:l,field:h,value:o}})},g=e({options:r,schema:o,debugLog:l,getFieldName:d,getModelName:c,getDefaultModelName:s,getDefaultFieldName:a,getFieldAttributes:p,transformInput:f,transformOutput:h,transformWhereClause:m}),y=null,b={transaction:async e=>{if(!y)if(i.transaction)tY.debug(`[${i.adapterName}] - Using provided transaction implementation.`),y=i.transaction;else"object"==typeof i.debugLogs&&"isRunningAdapterTests"in i.debugLogs&&i.debugLogs.isRunningAdapterTests||tY.warn(`[${i.adapterName}] - Transactions are not supported. Executing operations sequentially.`),y=e=>e(b);return y(e)},create:async({data:e,model:t,select:r,forceAllowId:n=!1})=>{let o=++uu,a=c(t);if(t=s(t),"id"in e&&!n){tY.warn(`[${i.adapterName}] - You are trying to create a record with an id. This is not allowed as we handle id generation for you, unless you pass in the \`forceAllowId\` parameter. The id will be ignored.`);let t=Error();console.log(t.stack?.split("\n").filter((e,t)=>1!==t).join("\n").replace("Error:","Create method with `id` being called at:")),e.id=void 0}l({method:"create"},`${uf(o)} ${uh(1,4)}`,`${um("create")} ${ug("Unsafe Input")}:`,{model:a,data:e});let d=e;i.disableTransformInput||(d=await f(e,t,"create",n)),l({method:"create"},`${uf(o)} ${uh(2,4)}`,`${um("create")} ${ug("Parsed Input")}:`,{model:a,data:d});let u=await g.create({data:d,model:a});l({method:"create"},`${uf(o)} ${uh(3,4)}`,`${um("create")} ${ug("DB Result")}:`,{model:a,res:u});let p=u;return i.disableTransformOutput||(p=await h(u,t,r)),l({method:"create"},`${uf(o)} ${uh(4,4)}`,`${um("create")} ${ug("Parsed Result")}:`,{model:a,data:p}),p},update:async({model:e,where:t,update:r})=>{let n=++uu,o=c(e=s(e)),a=m({model:e,where:t});l({method:"update"},`${uf(n)} ${uh(1,4)}`,`${um("update")} ${ug("Unsafe Input")}:`,{model:o,data:r});let d=r;i.disableTransformInput||(d=await f(r,e,"update")),l({method:"update"},`${uf(n)} ${uh(2,4)}`,`${um("update")} ${ug("Parsed Input")}:`,{model:o,data:d});let u=await g.update({model:o,where:a,update:d});l({method:"update"},`${uf(n)} ${uh(3,4)}`,`${um("update")} ${ug("DB Result")}:`,{model:o,data:u});let p=u;return i.disableTransformOutput||(p=await h(u,e)),l({method:"update"},`${uf(n)} ${uh(4,4)}`,`${um("update")} ${ug("Parsed Result")}:`,{model:o,data:p}),p},updateMany:async({model:e,where:t,update:r})=>{let n=++uu,o=c(e),a=m({model:e,where:t});e=s(e),l({method:"updateMany"},`${uf(n)} ${uh(1,4)}`,`${um("updateMany")} ${ug("Unsafe Input")}:`,{model:o,data:r});let d=r;i.disableTransformInput||(d=await f(r,e,"update")),l({method:"updateMany"},`${uf(n)} ${uh(2,4)}`,`${um("updateMany")} ${ug("Parsed Input")}:`,{model:o,data:d});let u=await g.updateMany({model:o,where:a,update:d});return l({method:"updateMany"},`${uf(n)} ${uh(3,4)}`,`${um("updateMany")} ${ug("DB Result")}:`,{model:o,data:u}),l({method:"updateMany"},`${uf(n)} ${uh(4,4)}`,`${um("updateMany")} ${ug("Parsed Result")}:`,{model:o,data:u}),u},findOne:async({model:e,where:t,select:r})=>{let n=++uu,o=c(e),a=m({model:e,where:t});e=s(e),l({method:"findOne"},`${uf(n)} ${uh(1,3)}`,`${um("findOne")}:`,{model:o,where:a,select:r});let d=await g.findOne({model:o,where:a,select:r});l({method:"findOne"},`${uf(n)} ${uh(2,3)}`,`${um("findOne")} ${ug("DB Result")}:`,{model:o,data:d});let u=d;return i.disableTransformOutput||(u=await h(d,e,r)),l({method:"findOne"},`${uf(n)} ${uh(3,3)}`,`${um("findOne")} ${ug("Parsed Result")}:`,{model:o,data:u}),u},findMany:async({model:e,where:t,limit:n,sortBy:o,offset:a})=>{let d=++uu,u=n??r.advanced?.database?.defaultFindManyLimit??100,p=c(e),f=m({model:e,where:t});e=s(e),l({method:"findMany"},`${uf(d)} ${uh(1,3)}`,`${um("findMany")}:`,{model:p,where:f,limit:u,sortBy:o,offset:a});let y=await g.findMany({model:p,where:f,limit:u,sortBy:o,offset:a});l({method:"findMany"},`${uf(d)} ${uh(2,3)}`,`${um("findMany")} ${ug("DB Result")}:`,{model:p,data:y});let b=y;return i.disableTransformOutput||(b=await Promise.all(y.map(async t=>await h(t,e)))),l({method:"findMany"},`${uf(d)} ${uh(3,3)}`,`${um("findMany")} ${ug("Parsed Result")}:`,{model:p,data:b}),b},delete:async({model:e,where:t})=>{let r=++uu,n=c(e),i=m({model:e,where:t});e=s(e),l({method:"delete"},`${uf(r)} ${uh(1,2)}`,`${um("delete")}:`,{model:n,where:i}),await g.delete({model:n,where:i}),l({method:"delete"},`${uf(r)} ${uh(2,2)}`,`${um("delete")} ${ug("DB Result")}:`,{model:n})},deleteMany:async({model:e,where:t})=>{let r=++uu,n=c(e),i=m({model:e,where:t});e=s(e),l({method:"deleteMany"},`${uf(r)} ${uh(1,2)}`,`${um("deleteMany")} ${ug("DeleteMany")}:`,{model:n,where:i});let o=await g.deleteMany({model:n,where:i});return l({method:"deleteMany"},`${uf(r)} ${uh(2,2)}`,`${um("deleteMany")} ${ug("DB Result")}:`,{model:n,data:o}),o},count:async({model:e,where:t})=>{let r=++uu,n=c(e),i=m({model:e,where:t});e=s(e),l({method:"count"},`${uf(r)} ${uh(1,2)}`,`${um("count")}:`,{model:n,where:i});let o=await g.count({model:n,where:i});return l({method:"count"},`${uf(r)} ${uh(2,2)}`,`${um("count")}:`,{model:n,data:o}),o},createSchema:g.createSchema?async(e,t)=>{let n=cV(r);return r.secondaryStorage&&!r.session?.storeSessionInDatabase&&delete n.session,r.rateLimit&&"database"===r.rateLimit.storage&&(void 0===r.rateLimit.enabled||!0===r.rateLimit.enabled)&&(n.ratelimit={modelName:r.rateLimit.modelName??"ratelimit",fields:{key:{type:"string",unique:!0,required:!0,fieldName:r.rateLimit.fields?.key??"key"},count:{type:"number",required:!0,fieldName:r.rateLimit.fields?.count??"count"},lastRequest:{type:"number",required:!0,bigint:!0,defaultValue:()=>Date.now(),fieldName:r.rateLimit.fields?.lastRequest??"lastRequest"}}}),g.createSchema({file:t,tables:n})}:void 0,options:{adapterConfig:i,...g.options??{}},id:i.adapterId,...i.debugLogs?.isRunningAdapterTests?{adapterTestDebugLogs:{resetDebugLogs(){ul=ul.filter(e=>e.instance!==n)},printDebugLogs(){let e=`\u2500`.repeat(80),t=ul.filter(e=>e.instance===n);0===t.length||console.log(...t.reverse().map(e=>(e.args[0]=`
${e.args[0]}`,[...e.args,"\n"])).reduce((e,t)=>[...t,...e],[`
${e}`]))}}}:{}};return b};function uf(e){return 8>tj()?`#${e}`:`${tH}#${e}${t$}`}function uh(e,t){return`${tF}${tz}[${e}/${t}]${t$}`}function um(e){return`${tM}${e}${t$}`}function ug(e){return`${tq}(${e})${t$}`}function uy(e){if(!e)return null;if("dialect"in e)return uy(e.dialect);if("createDriver"in e){if(e instanceof c4)return"sqlite";if(e instanceof dc)return"mysql";if(e instanceof db)return"postgres";if(e instanceof dP)return"mssql"}return"aggregate"in e?"sqlite":"getConnection"in e?"mysql":"connect"in e?"postgres":"fileControl"in e||"open"in e&&"close"in e&&"prepare"in e?"sqlite":null}let ub=async t=>{let r,n=t.database;if(!n)return{kysely:null,databaseType:null,transaction:void 0};if("db"in n)return{kysely:n.db,databaseType:n.type,transaction:n.transaction};if("dialect"in n)return{kysely:new ut({dialect:n.dialect}),databaseType:n.type,transaction:n.transaction};let i=uy(n);if("createDriver"in n&&(r=n),"aggregate"in n&&!("createSession"in n)&&(r=new c4({database:n})),"getConnection"in n&&(r=new dc(n)),"connect"in n&&(r=new db({pool:n})),"fileControl"in n){let{BunSqliteDialect:t}=await e.A(16296);r=new t({database:n})}if("createSession"in n){let t;try{({DatabaseSync:t}=await import("node:sqlite"))}catch(e){if(null!==e&&"object"==typeof e&&"code"in e&&"ERR_UNKNOWN_BUILTIN_MODULE"!==e.code)throw e}if(t&&n instanceof t){let{NodeSqliteDialect:t}=await e.A(536752);r=new t({database:n})}}return{kysely:r?new ut({dialect:r}):null,databaseType:i,transaction:void 0}},uw=(e,t)=>{let r,n=t.logger,i=t.options,o=i.secondaryStorage,a=i.session?.expiresIn||604800,{createWithHooks:s,updateWithHooks:c,updateManyWithHooks:d}=(r=t.hooks,{createWithHooks:async function(t,n,i,o,a){let s=t;for(let e of r||[]){let t=e[n]?.create?.before;if(t){let e=await t(s,o);if(!1===e)return null;"object"==typeof e&&"data"in e&&(s={...s,...e.data})}}let c=i?await i.fn(s):null,d=!i||i.executeMainFn?await (a||e).create({model:n,data:s,forceAllowId:!0}):c;for(let e of r||[]){let t=e[n]?.create?.after;t&&await t(d,o)}return d},updateWithHooks:async function(t,n,i,o,a,s){let c=t;for(let e of r||[]){let r=e[i]?.update?.before;if(r){let e=await r(t,a);if(!1===e)return null;c="object"==typeof e?e.data:e}}let d=o?await o.fn(c):null,l=!o||o.executeMainFn?await (s||e).update({model:i,update:c,where:n}):d;for(let e of r||[]){let t=e[i]?.update?.after;t&&await t(l,a)}return l},updateManyWithHooks:async function(t,n,i,o,a,s){let c=t;for(let e of r||[]){let r=e[i]?.update?.before;if(r){let e=await r(t,a);if(!1===e)return null;c="object"==typeof e?e.data:e}}let d=o?await o.fn(c):null,l=!o||o.executeMainFn?await (s||e).updateMany({model:i,update:c,where:n}):d;for(let e of r||[]){let t=e[i]?.update?.after;t&&await t(l,a)}return l}});async function l(e){if(!o)return;let t=await o.get(`active-sessions-${e.id}`);if(!t)return;let r=Date.now(),n=(oz(t)||[]).filter(e=>e.expiresAt>r);await Promise.all(n.map(async({token:t})=>{let n=await o.get(t);if(!n)return;let i=oz(n);if(!i)return;let a=Math.max(Math.floor(new Date(i.session.expiresAt).getTime()-r)/1e3,0);await o.set(t,JSON.stringify({session:i.session,user:e}),Math.floor(a))}))}return{createOAuthUser:async(t,r,n)=>e.transaction(async e=>{let i=await s({createdAt:new Date,updatedAt:new Date,...t},"user",void 0,n,e),o=await s({...r,userId:i.id,createdAt:new Date,updatedAt:new Date},"account",void 0,n,e);return{user:i,account:o}}),createUser:async(e,t,r)=>await s({createdAt:new Date,updatedAt:new Date,...e,email:e.email?.toLowerCase()},"user",void 0,t,r),createAccount:async(e,t,r)=>await s({createdAt:new Date,updatedAt:new Date,...e},"account",void 0,t,r),listSessions:async(r,n)=>{if(o){let e=await o.get(`active-sessions-${r}`);if(!e)return[];let n=oz(e)||[],i=Date.now(),a=n.filter(e=>e.expiresAt>i),s=[];for(let e of a){let r=await o.get(e.token);if(r){let e=oz(r);if(!e)return[];let n=ak(t.options,{...e.session,expiresAt:new Date(e.session.expiresAt)});s.push(n)}}return s}return await (n||e).findMany({model:"session",where:[{field:"userId",value:r}]})},listUsers:async(t,r,n,i,o)=>await (o||e).findMany({model:"user",limit:t,offset:r,sortBy:n,where:i}),countTotalUsers:async(t,r)=>{let n=await (r||e).count({model:"user",where:t});return"string"==typeof n?parseInt(n):n},deleteUser:async(t,r)=>{o&&await o.delete(`active-sessions-${t}`),(!o||i.session?.storeSessionInDatabase)&&await (r||e).deleteMany({model:"session",where:[{field:"userId",value:t}]}),await (r||e).deleteMany({model:"account",where:[{field:"userId",value:t}]}),await (r||e).delete({model:"user",where:[{field:"id",value:t}]})},createSession:async(t,r,n,c,d,l)=>{let u=r.headers||r.request?.headers,{id:p,...f}=c||{},h={ipAddress:(r.request||r.headers)&&cj(r.request||r.headers,r.context.options)||"",userAgent:u?.get("user-agent")||"",...f,expiresAt:n?oq(86400,"sec"):oq(a,"sec"),userId:t,token:aE(32),createdAt:new Date,updatedAt:new Date,...d?f:{}};return await s(h,"session",o?{fn:async r=>{let n=await o.get(`active-sessions-${t}`),i=[],a=Date.now();n&&(i=(i=oz(n)||[]).filter(e=>e.expiresAt>a));let s=i.sort((e,t)=>e.expiresAt-t.expiresAt),c=s.at(-1)?.expiresAt;s.push({token:h.token,expiresAt:h.expiresAt.getTime()}),(!c||c<h.expiresAt.getTime())&&(c=h.expiresAt.getTime());let d=Math.max(Math.floor((c-a)/1e3),0);d>0&&await o.set(`active-sessions-${t}`,JSON.stringify(s),d);let l=await e.findOne({model:"user",where:[{field:"id",value:t}]}),u=Math.max(Math.floor((h.expiresAt.getTime()-a)/1e3),0);return u>0&&await o.set(h.token,JSON.stringify({session:r,user:l}),u),r},executeMainFn:i.session?.storeSessionInDatabase}:void 0,r,l)},findSession:async(r,n)=>{if(o){let e=await o.get(r);if(!e&&!i.session?.storeSessionInDatabase)return null;if(e){let r=oz(e);return r?{session:ak(t.options,{...r.session,expiresAt:new Date(r.session.expiresAt),createdAt:new Date(r.session.createdAt),updatedAt:new Date(r.session.updatedAt)}),user:aI(t.options,{...r.user,createdAt:new Date(r.user.createdAt),updatedAt:new Date(r.user.updatedAt)})}:null}}let a=await (n||e).findOne({model:"session",where:[{value:r,field:"token"}]});if(!a)return null;let s=await (n||e).findOne({model:"user",where:[{value:a.userId,field:"id"}]});return s?{session:ak(t.options,a),user:aI(t.options,s)}:null},findSessions:async(t,r)=>{if(o){let e=[];for(let r of t){let t=await o.get(r);if(t){let r=oz(t);if(!r)return[];let n={session:{...r.session,expiresAt:new Date(r.session.expiresAt)},user:{...r.user,createdAt:new Date(r.user.createdAt),updatedAt:new Date(r.user.updatedAt)}};e.push(n)}}return e}let n=await (r||e).findMany({model:"session",where:[{field:"token",value:t,operator:"in"}]}),i=n.map(e=>e.userId);if(!i.length)return[];let a=await (r||e).findMany({model:"user",where:[{field:"id",value:i,operator:"in"}]});return n.map(e=>{let t=a.find(t=>t.id===e.userId);return t?{session:e,user:t}:null})},updateSession:async(e,t,r,n)=>await c(t,[{field:"token",value:e}],"session",o?{async fn(t){let r=await o.get(e);if(!r)return null;{let e=oz(r);return e?{...e.session,...t}:null}},executeMainFn:i.session?.storeSessionInDatabase}:void 0,r,n),deleteSession:async(r,a)=>{if(o){let e=await o.get(r);if(e){let{session:t}=oz(e)??{};if(!t)return void n.error("Session not found in secondary storage");let i=t.userId,a=await o.get(`active-sessions-${i}`);if(a){let e=oz(a)||[],t=Date.now(),n=e.filter(e=>e.expiresAt>t&&e.token!==r),s=n.sort((e,t)=>e.expiresAt-t.expiresAt),c=s.at(-1)?.expiresAt;n.length>0&&c&&c>Date.now()?await o.set(`active-sessions-${i}`,JSON.stringify(n),Math.floor((c-t)/1e3)):await o.delete(`active-sessions-${i}`)}else n.error("Active sessions list not found in secondary storage")}if(await o.delete(r),!i.session?.storeSessionInDatabase||t.options.session?.preserveSessionInDatabase)return}await (a||e).delete({model:"session",where:[{field:"token",value:r}]})},deleteAccounts:async(t,r)=>{await (r||e).deleteMany({model:"account",where:[{field:"userId",value:t}]})},deleteAccount:async(t,r)=>{await (r||e).delete({model:"account",where:[{field:"id",value:t}]})},deleteSessions:async(r,n)=>{if(o){if("string"==typeof r){let e=await o.get(`active-sessions-${r}`),t=e?oz(e):[];if(!t)return;for(let e of t)await o.delete(e.token)}else for(let e of r)await o.get(e)&&await o.delete(e);if(!i.session?.storeSessionInDatabase||t.options.session?.preserveSessionInDatabase)return}await (n||e).deleteMany({model:"session",where:[{field:Array.isArray(r)?"token":"userId",value:r,operator:Array.isArray(r)?"in":void 0}]})},findOAuthUser:async(t,r,n,i)=>{let o=await (i||e).findMany({model:"account",where:[{value:r,field:"accountId"}]}).then(e=>e.find(e=>e.providerId===n));if(o){let r=await (i||e).findOne({model:"user",where:[{value:o.userId,field:"id"}]});if(r)return{user:r,accounts:[o]};{let r=await (i||e).findOne({model:"user",where:[{value:t.toLowerCase(),field:"email"}]});return r?{user:r,accounts:[o]}:null}}{let r=await (i||e).findOne({model:"user",where:[{value:t.toLowerCase(),field:"email"}]});if(!r)return null;{let t=await (i||e).findMany({model:"account",where:[{value:r.id,field:"userId"}]});return{user:r,accounts:t||[]}}}},findUserByEmail:async(t,r,n)=>{let i=await (n||e).findOne({model:"user",where:[{value:t.toLowerCase(),field:"email"}]});if(!i)return null;if(r?.includeAccounts){let t=await (n||e).findMany({model:"account",where:[{value:i.id,field:"userId"}]});return{user:i,accounts:t}}return{user:i,accounts:[]}},findUserById:async(t,r)=>await (r||e).findOne({model:"user",where:[{field:"id",value:t}]}),linkAccount:async(e,t,r)=>await s({createdAt:new Date,updatedAt:new Date,...e},"account",void 0,t,r),updateUser:async(e,t,r,n)=>{let i=await c(t,[{field:"id",value:e}],"user",void 0,r,n);return await l(i),await l(i),i},updateUserByEmail:async(e,t,r,n)=>{let i=await c(t,[{field:"email",value:e.toLowerCase()}],"user",void 0,r,n);return await l(i),await l(i),i},updatePassword:async(e,t,r,n)=>{await d({password:t},[{field:"userId",value:e},{field:"providerId",value:"credential"}],"account",void 0,r,n)},findAccounts:async(t,r)=>await (r||e).findMany({model:"account",where:[{field:"userId",value:t}]}),findAccount:async(t,r)=>await (r||e).findOne({model:"account",where:[{field:"accountId",value:t}]}),findAccountByProviderId:async(t,r,n)=>await (n||e).findOne({model:"account",where:[{field:"accountId",value:t},{field:"providerId",value:r}]}),findAccountByUserId:async(t,r)=>await (r||e).findMany({model:"account",where:[{field:"userId",value:t}]}),updateAccount:async(e,t,r,n)=>await c(t,[{field:"id",value:e}],"account",void 0,r,n),createVerificationValue:async(e,t,r)=>await s({createdAt:new Date,updatedAt:new Date,...e},"verification",void 0,t,r),findVerificationValue:async(t,r)=>{let n=await (r||e).findMany({model:"verification",where:[{field:"identifier",value:t}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return i.verification?.disableCleanup||await (r||e).deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),n[0]},deleteVerificationValue:async(t,r)=>{await (r||e).delete({model:"verification",where:[{field:"id",value:t}]})},deleteVerificationByIdentifier:async(t,r)=>{await (r||e).delete({model:"verification",where:[{field:"identifier",value:t}]})},updateVerificationValue:async(e,t,r,n)=>await c(t,[{field:"id",value:e}],"verification",void 0,r,n)}};async function ux(e){var t,r;let n,i,o,a;if(!e.database){let r,n,i=Object.keys(cV(e)).reduce((e,t)=>(e[t]=[],e),{});return tY.warn("No database configuration provided. Using memory adapter in development"),(r=null,n=up({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:t?.debugLogs||!1,customTransformInput:e=>e.options.advanced?.database?.useNumberId&&"id"===e.field&&"create"===e.action?i[e.model].length+1:e.data,transaction:async e=>{let t=structuredClone(i);try{return await e(n(r))}catch(e){throw Object.keys(i).forEach(e=>{i[e]=t[e]}),e}}},adapter:({getFieldName:e,options:t,debugLog:r})=>{function n(e,t){let r=i[t];if(!r)throw tY.error(`[MemoryAdapter] Model ${t} not found in the DB`,Object.keys(i)),Error(`Model ${t} not found`);let n=(e,t)=>{let{field:r,value:n,operator:i}=t;switch(i){case"in":if(!Array.isArray(n))throw Error("Value must be an array");return n.includes(e[r]);case"not_in":if(!Array.isArray(n))throw Error("Value must be an array");return!n.includes(e[r]);case"contains":return e[r].includes(n);case"starts_with":return e[r].startsWith(n);case"ends_with":return e[r].endsWith(n);case"ne":return e[r]!==n;case"gt":return null!=n&&e[r]>n;case"gte":return null!=n&&e[r]>=n;case"lt":return null!=n&&e[r]<n;case"lte":return null!=n&&e[r]<=n;default:return e[r]===n}};return r.filter(t=>{if(!e.length||0===e.length)return!0;let r=n(t,e[0]);for(let i of e){let e=n(t,i);r="OR"===i.connector?r||e:r&&e}return r})}return{create:async({model:e,data:r})=>(t.advanced?.database?.useNumberId&&(r.id=i[e].length+1),i[e]||(i[e]=[]),i[e].push(r),r),findOne:async({model:e,where:t})=>n(t,e)[0]||null,findMany:async({model:t,where:r,sortBy:o,limit:a,offset:s})=>{let c=i[t];return r&&(c=n(r,t)),o&&(c=c.sort((r,n)=>{let i=e({model:t,field:o.field}),a=r[i],s=n[i],c=0;return c=null==a&&null==s?0:null==a?-1:null==s?1:"string"==typeof a&&"string"==typeof s?a.localeCompare(s):a instanceof Date&&s instanceof Date?a.getTime()-s.getTime():"number"==typeof a&&"number"==typeof s?a-s:"boolean"==typeof a&&"boolean"==typeof s?a===s?0:a?1:-1:String(a).localeCompare(String(s)),"asc"===o.direction?c:-c})),void 0!==s&&(c=c.slice(s)),void 0!==a&&(c=c.slice(0,a)),c||[]},count:async({model:e,where:t})=>t?n(t,e).length:i[e].length,update:async({model:e,where:t,update:r})=>{let i=n(t,e);return i.forEach(e=>{Object.assign(e,r)}),i[0]||null},delete:async({model:e,where:t})=>{let r=i[e],o=n(t,e);i[e]=r.filter(e=>!o.includes(e))},deleteMany:async({model:e,where:t})=>{let r=i[e],o=n(t,e),a=0;return i[e]=r.filter(e=>o.includes(e)?(a++,!1):!o.includes(e)),a},updateMany({model:e,where:t,update:r}){let i=n(t,e);return i.forEach(e=>{Object.assign(e,r)}),i[0]||null}}}}),e=>(r=e,n(e)))(e)}if("function"==typeof e.database)return e.database(e);let{kysely:s,databaseType:c,transaction:d}=await ub(e);if(!s)throw new no("Failed to initialize database adapter");return(r={type:c||"sqlite",debugLogs:"debugLogs"in e.database&&e.database.debugLogs,transaction:d},n=null,i=e=>({getFieldName:t,schema:n,getDefaultModelName:i})=>{let o=async(n,i,o,a)=>{if(r?.type==="mysql"){await i.execute();let r=n.id?"id":a.length>0&&a[0]?.field?a[0].field:"id";if(!n.id&&0===a.length)return await e.selectFrom(o).selectAll().orderBy(t({model:o,field:r}),"desc").limit(1).executeTakeFirst();let s=n[r]||a[0]?.value;return await e.selectFrom(o).selectAll().orderBy(t({model:o,field:r}),"desc").where(t({model:o,field:r}),"=",s).limit(1).executeTakeFirst()}return r?.type==="mssql"?await i.outputAll("inserted").executeTakeFirst():await i.returningAll().executeTakeFirst()};function a(e){function t(e){for(let n in e){if(!Object.prototype.hasOwnProperty.call(e,n))continue;let i=e[n];i instanceof Date&&r?.type==="mysql"||"object"==typeof i&&null!==i&&t(i)}}if(Array.isArray(e))for(let r=0;r<e.length;r++){let n=e[r];"object"==typeof n&&null!==n&&t(n)}else"object"==typeof e&&null!==e&&t(e);return e}function s(e,i){if(!i)return{and:null,or:null};let o=[],a=[];return i.forEach(i=>{let{field:s,value:c,operator:d="=",connector:l="AND"}=i,u=t({model:e,field:s});c=function(e,t,i){if("id"===i)return e;let{type:o="sqlite"}=r||{},a=n[t]?.fields[i];return(a||(a=Object.values(n).find(e=>e.modelName===t)),"boolean"===a.type&&("sqlite"===o||"mssql"===o)&&null!=e)?+!!e:"date"===a.type&&e&&e instanceof Date&&"sqlite"===o?e.toISOString():e}(c,e,s);let p=e=>"in"===d.toLowerCase()?e(u,"in",Array.isArray(c)?c:[c]):"not_in"===d.toLowerCase()?e(u,"not in",Array.isArray(c)?c:[c]):"contains"===d?e(u,"like",`%${c}%`):"starts_with"===d?e(u,"like",`${c}%`):"ends_with"===d?e(u,"like",`%${c}`):e(u,"eq"===d?"=":"ne"===d?"<>":"gt"===d?">":"gte"===d?">=":"lt"===d?"<":"lte"===d?"<=":d,c);"OR"===l?a.push(p):o.push(p)}),{and:o.length?o:null,or:a.length?a:null}}return{async create({data:t,model:r}){let n=e.insertInto(r).values(t);return a(await o(t,n,r,[]))},async findOne({model:t,where:r,select:n}){let{and:i,or:o}=s(t,r),c=e.selectFrom(t).selectAll();i&&(c=c.where(e=>e.and(i.map(t=>t(e))))),o&&(c=c.where(e=>e.or(o.map(t=>t(e)))));let d=await c.executeTakeFirst();return d?a(d):null},async findMany({model:n,where:i,limit:o,offset:c,sortBy:d}){let{and:l,or:u}=s(n,i),p=e.selectFrom(n);l&&(p=p.where(e=>e.and(l.map(t=>t(e))))),u&&(p=p.where(e=>e.or(u.map(t=>t(e))))),r?.type==="mssql"?c||(p=p.top(o||100)):p=p.limit(o||100),d&&(p=p.orderBy(t({model:n,field:d.field}),d.direction)),c&&(r?.type==="mssql"?(d||(p=p.orderBy(t({model:n,field:"id"}))),p=p.offset(c).fetch(o||100)):p=p.offset(c));let f=await p.selectAll().execute();return f?a(f):[]},async update({model:t,where:r,update:n}){let{and:i,or:c}=s(t,r),d=e.updateTable(t).set(n);return i&&(d=d.where(e=>e.and(i.map(t=>t(e))))),c&&(d=d.where(e=>e.or(c.map(t=>t(e))))),a(await o(n,d,t,r))},async updateMany({model:t,where:r,update:n}){let{and:i,or:o}=s(t,r),a=e.updateTable(t).set(n);return i&&(a=a.where(e=>e.and(i.map(t=>t(e))))),o&&(a=a.where(e=>e.or(o.map(t=>t(e))))),(await a.execute()).length},async count({model:t,where:r}){let{and:n,or:i}=s(t,r),o=e.selectFrom(t).select(e.fn.count("id").as("count"));n&&(o=o.where(e=>e.and(n.map(t=>t(e))))),i&&(o=o.where(e=>e.or(i.map(t=>t(e)))));let a=await o.execute();return"number"==typeof a[0].count?a[0].count:"bigint"==typeof a[0].count?Number(a[0].count):parseInt(a[0].count)},async delete({model:t,where:r}){let{and:n,or:i}=s(t,r),o=e.deleteFrom(t);n&&(o=o.where(e=>e.and(n.map(t=>t(e))))),i&&(o=o.where(e=>e.or(i.map(t=>t(e))))),await o.execute()},async deleteMany({model:t,where:r}){let{and:n,or:i}=s(t,r),o=e.deleteFrom(t);return n&&(o=o.where(e=>e.and(n.map(t=>t(e))))),i&&(o=o.where(e=>e.or(i.map(t=>t(e))))),(await o.execute()).length},options:r}},o=null,o={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:r?.usePlural,debugLogs:r?.debugLogs,supportsBooleans:r?.type!=="sqlite"&&r?.type!=="mssql"&&r?.type!=="mysql"&&!!r?.type,supportsDates:r?.type!=="sqlite"&&r?.type!=="mssql"&&!!r?.type,supportsJSON:!1,transaction:!!r?.transaction&&(e=>s.transaction().execute(t=>e(up({config:o.config,adapter:i(t)})(n))))},adapter:i(s)},a=up(o),e=>(n=e,a(e)))(e)}let uv={postgres:{string:["character varying","varchar","text"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamptz","timestamp","date"],json:["json","jsonb"]},mysql:{string:["varchar","text"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"],json:["json"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"],json:["TEXT"]},mssql:{string:["varchar","nvarchar"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime2","date","datetime"],json:["varchar","nvarchar"]}};async function u_(e){try{let t=await c2.sql`SHOW search_path`.execute(e);if(t.rows[0]?.search_path)return t.rows[0].search_path.split(",").map(e=>e.trim()).map(e=>e.replace(/^["']|["']$/g,"")).filter(e=>!e.startsWith("$"))[0]||"public"}catch(e){}return"public"}async function uE(e){let t=function(e){let t=cV(e),r={};for(let e in t){let n=t[e],i=n.fields,o={};if(Object.entries(i).forEach(([e,r])=>{if(o[r.fieldName||e]=r,r.references){let n=t[r.references.model];n&&(o[r.fieldName||e].references={...r.references,model:n.modelName,field:r.references.field})}}),r[n.modelName]){r[n.modelName].fields={...r[n.modelName].fields,...o};continue}r[n.modelName]={fields:o,order:n.order||1/0}}return r}(e),r=tG(e.logger),{kysely:n,databaseType:i}=await ub(e);i||(r.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),i="sqlite"),n||(r.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let o="public";if("postgres"===i){o=await u_(n),r.debug(`PostgreSQL migration: Using schema '${o}' (from search_path)`);try{(await c2.sql`
				SELECT schema_name 
				FROM information_schema.schemata 
				WHERE schema_name = ${o}
			`.execute(n)).rows[0]||r.warn(`Schema '${o}' does not exist. Tables will be inspected from available schemas. Consider creating the schema first or checking your database configuration.`)}catch(e){r.debug(`Could not verify schema existence: ${e instanceof Error?e.message:String(e)}`)}}let a=await n.introspection.getTables(),s=a;if("postgres"===i)try{let e=await c2.sql`
				SELECT table_name 
				FROM information_schema.tables 
				WHERE table_schema = ${o}
				AND table_type = 'BASE TABLE'
			`.execute(n),t=new Set(e.rows.map(e=>e.table_name));s=a.filter(e=>e.schema===o&&t.has(e.name)),r.debug(`Found ${s.length} table(s) in schema '${o}': ${s.map(e=>e.name).join(", ")||"(none)"}`)}catch(e){r.warn(`Could not filter tables by schema. Using all discovered tables. Error: ${e instanceof Error?e.message:String(e)}`)}let c=[],d=[];for(let[e,n]of Object.entries(t)){let t=s.find(t=>t.name===e);if(!t){let t=c.findIndex(t=>t.table===e),r={table:e,fields:n.fields,order:n.order||1/0},i=c.findIndex(e=>(e.order||1/0)>r.order);-1===i?-1===t?c.push(r):c[t].fields={...c[t].fields,...n.fields}:c.splice(i,0,r);continue}let o={};for(let[a,s]of Object.entries(n.fields)){let n=t.columns.find(e=>e.name===a);if(!n){o[a]=s;continue}!function(e,t,r){if("string[]"===t||"number[]"===t)return e.toLowerCase().includes("json");let n=uv[r];return(Array.isArray(t)?n.string.map(e=>e.toLowerCase()):n[t].map(e=>e.toLowerCase())).includes(e.toLowerCase().split("(")[0].trim())}(n.dataType,s.type,i)&&r.warn(`Field ${a} in table ${e} has a different type in the database. Expected ${s.type} but got ${n.dataType}.`)}Object.keys(o).length>0&&d.push({table:e,fields:o,order:n.order||1/0})}let l=[];function u(t,r){let n=t.type,o={string:{sqlite:"text",postgres:"text",mysql:t.unique?"varchar(255)":t.references?"varchar(36)":"text",mssql:t.unique||t.sortable?"varchar(255)":t.references?"varchar(36)":"varchar(8000)"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:t.bigint?"bigint":"integer",postgres:t.bigint?"bigint":"integer",mysql:t.bigint?"bigint":"integer",mssql:t.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamptz",mysql:"timestamp(3)",mssql:c2.sql`datetime2(3)`},json:{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},id:{postgres:e.advanced?.database?.useNumberId?"serial":"text",mysql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:e.advanced?.database?.useNumberId?"integer":"text"},foreignKeyId:{postgres:e.advanced?.database?.useNumberId?"integer":"text",mysql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",mssql:e.advanced?.database?.useNumberId?"integer":"varchar(36)",sqlite:e.advanced?.database?.useNumberId?"integer":"text"}};return"id"===r||t.references?.field==="id"?"id"===r?o.id[i]:o.foreignKeyId[i]:"sqlite"===i&&("string[]"===n||"number[]"===n)?"text":"string[]"===n||"number[]"===n?"jsonb":Array.isArray(n)?"text":o[n][i||"sqlite"]}if(d.length)for(let e of d)for(let[t,r]of Object.entries(e.fields)){let o=u(r,t),a=n.schema.alterTable(e.table).addColumn(t,o,e=>(e=!1!==r.required?e.notNull():e,r.references&&(e=e.references(`${r.references.model}.${r.references.field}`).onDelete(r.references.onDelete||"cascade")),r.unique&&(e=e.unique()),"date"===r.type&&"function"==typeof r.defaultValue&&("postgres"===i||"mysql"===i||"mssql"===i)&&(e="mysql"===i?e.defaultTo(c2.sql`CURRENT_TIMESTAMP(3)`):e.defaultTo(c2.sql`CURRENT_TIMESTAMP`)),e));l.push(a)}if(c.length)for(let t of c){let r=n.schema.createTable(t.table).addColumn("id",e.advanced?.database?.useNumberId?"postgres"===i?"serial":"integer":"mysql"===i||"mssql"===i?"varchar(36)":"text",t=>e.advanced?.database?.useNumberId?"postgres"===i||"sqlite"===i?t.primaryKey().notNull():"mssql"===i?t.identity().primaryKey().notNull():t.autoIncrement().primaryKey().notNull():t.primaryKey().notNull());for(let[e,n]of Object.entries(t.fields)){let t=u(n,e);r=r.addColumn(e,t,e=>(e=!1!==n.required?e.notNull():e,n.references&&(e=e.references(`${n.references.model}.${n.references.field}`).onDelete(n.references.onDelete||"cascade")),n.unique&&(e=e.unique()),"date"===n.type&&"function"==typeof n.defaultValue&&("postgres"===i||"mysql"===i||"mssql"===i)&&(e="mysql"===i?e.defaultTo(c2.sql`CURRENT_TIMESTAMP(3)`):e.defaultTo(c2.sql`CURRENT_TIMESTAMP`)),e))}l.push(r)}return{toBeCreated:c,toBeAdded:d,runMigrations:async function(){for(let e of l)await e.execute()},compileMigrations:async function(){return l.map(e=>e.compile().sql).join(";\n\n")+";"}}}async function uT(e,t){let r=await t.context.internalAdapter.findAccounts(e),n=r?.find(e=>"credential"===e.providerId),i=n?.password;if(!n||!i||!t.body.password)throw new nh("BAD_REQUEST",{message:"No password credential found"});if(!await t.context.password.verify({hash:i,password:t.body.password}))throw new nh("BAD_REQUEST",{message:"Invalid password"});return!0}async function uA(e){let t=await aT("SHA-256").digest(e);return t1.encode(t)}async function uS(){if(i)return i;try{let e="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!e)return;let[{default:t},{default:r}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),n=await t.readFile(r.join(e,"package.json"),"utf-8");return i=JSON.parse(n)}catch{}}async function uR(e){if(i)return i.dependencies?.[e]||i.devDependencies?.[e]||i.peerDependencies?.[e];try{let t="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!t)throw Error("no-cwd");let[{default:r},{default:n}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),i=n.join(t,"node_modules",e,"package.json"),o=await r.readFile(i,"utf-8");return JSON.parse(o).version||await uO(e)||void 0}catch{}return await uO(e)}async function uO(e){let t=await uS();if(t)return({...t.dependencies,...t.devDependencies,...t.peerDependencies})[e]}async function uI(){let e=await uS();return e?.name}let uk=null;async function uN(e){if(uk)return uk;let t=await uI();return t?uk=await uA(e?e+t:t):e?uk=await uA(e):uk=o4("a-z","A-Z","0-9")(32)}function uP(){let e=(...e)=>e.some(e=>!!tS[e]);return e("CF_PAGES","CF_PAGES_URL","CF_ACCOUNT_ID")||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent?"cloudflare":e("VERCEL","VERCEL_URL","VERCEL_ENV")?"vercel":e("NETLIFY","NETLIFY_URL")?"netlify":e("RENDER","RENDER_URL","RENDER_INTERNAL_HOSTNAME","RENDER_SERVICE_ID")?"render":e("AWS_LAMBDA_FUNCTION_NAME","AWS_EXECUTION_ENV","LAMBDA_TASK_ROOT")?"aws":e("GOOGLE_CLOUD_FUNCTION_NAME","GOOGLE_CLOUD_PROJECT","GCP_PROJECT","K_SERVICE")?"gcp":e("AZURE_FUNCTION_NAME","FUNCTIONS_WORKER_RUNTIME","WEBSITE_INSTANCE_ID","WEBSITE_SITE_NAME")?"azure":e("DENO_DEPLOYMENT_ID","DENO_REGION")?"deno-deploy":e("FLY_APP_NAME","FLY_REGION","FLY_ALLOC_ID")?"fly-io":e("RAILWAY_STATIC_URL","RAILWAY_ENVIRONMENT_NAME")?"railway":e("DYNO","HEROKU_APP_NAME")?"heroku":e("DO_DEPLOYMENT_ID","DO_APP_NAME","DIGITALOCEAN")?"digitalocean":e("KOYEB","KOYEB_DEPLOYMENT_ID","KOYEB_APP_NAME")?"koyeb":null}async function uU(){try{if("cloudflare"===uP())return"cloudflare";let e=await Function("mm","return import(mm)")("os"),t=e.cpus();return{deploymentVendor:uP(),systemPlatform:e.platform(),systemRelease:e.release(),systemArchitecture:e.arch(),cpuCount:t.length,cpuModel:t.length?t[0].model:null,cpuSpeed:t.length?t[0].speed:null,memory:e.totalmem(),isWSL:await uj(),isDocker:await uL(),isTTY:"undefined"!=typeof process&&process.stdout?process.stdout.isTTY:null}}catch(e){return{systemPlatform:null,systemRelease:null,systemArchitecture:null,cpuCount:null,cpuModel:null,cpuSpeed:null,memory:null,isWSL:null,isDocker:null,isTTY:null}}}async function uC(){if("cloudflare"===uP())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/.dockerenv"),!0}catch{return!1}}async function uD(){if("cloudflare"===uP())return!1;try{return(await Function("mm","return import(mm)")("fs")).readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}async function uL(){return"cloudflare"!==uP()&&(void 0===o&&(o=await uC()||await uD()),o)}async function uj(){try{if("cloudflare"===uP()||"undefined"==typeof process||process?.platform!=="linux")return!1;let e=await Function("mm","return import(mm)")("fs");if((await Function("mm","return import(mm)")("os")).release().toLowerCase().includes("microsoft")){if(await uM())return!1;return!0}return!!e.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!await uM()}catch{return!1}}let u$=async()=>{if("cloudflare"===uP())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/run/.containerenv"),!0}catch{return!1}};async function uM(){return void 0===a&&(a=await u$()||await uL()),a}let uq={pg:"postgresql",mysql:"mysql",mariadb:"mariadb",sqlite3:"sqlite","better-sqlite3":"sqlite","@prisma/client":"prisma",mongoose:"mongodb",mongodb:"mongodb","drizzle-orm":"drizzle"};async function uV(){for(let[e,t]of Object.entries(uq)){let r=await uR(e);if(r)return{name:t,version:r}}}let uB={next:"next",nuxt:"nuxt","@remix-run/server-runtime":"remix",astro:"astro","@sveltejs/kit":"sveltekit","solid-start":"solid-start","tanstack-start":"tanstack-start",hono:"hono",express:"express",elysia:"elysia",expo:"expo"};async function uz(){for(let[e,t]of Object.entries(uB)){let r=await uR(e);if(r)return{name:t,version:r}}}async function uW(e,t){let r,n=e.telemetry?.debug||tP("BETTER_AUTH_TELEMETRY_DEBUG",!1),i=tU.BETTER_AUTH_TELEMETRY_ENDPOINT,o=async e=>{try{t?.customTrack?await t.customTrack(e):n?await Promise.resolve(tY.info("telemetry event",JSON.stringify(e,null,2))):await rh(i,{method:"POST",body:e})}catch{}},a=async()=>{let r=e.telemetry?.enabled!==void 0&&e.telemetry.enabled;return(tP("BETTER_AUTH_TELEMETRY",!1)||r)&&(t?.skipTestCheck||!tk())},s=await a();s&&(r=await uN(e.baseURL),o({type:"init",payload:{config:{database:void 0,adapter:void 0,emailVerification:{sendVerificationEmail:!!e.emailVerification?.sendVerificationEmail,sendOnSignUp:!!e.emailVerification?.sendOnSignUp,sendOnSignIn:!!e.emailVerification?.sendOnSignIn,autoSignInAfterVerification:!!e.emailVerification?.autoSignInAfterVerification,expiresIn:e.emailVerification?.expiresIn,onEmailVerification:!!e.emailVerification?.onEmailVerification,afterEmailVerification:!!e.emailVerification?.afterEmailVerification},emailAndPassword:{enabled:!!e.emailAndPassword?.enabled,disableSignUp:!!e.emailAndPassword?.disableSignUp,requireEmailVerification:!!e.emailAndPassword?.requireEmailVerification,maxPasswordLength:e.emailAndPassword?.maxPasswordLength,minPasswordLength:e.emailAndPassword?.minPasswordLength,sendResetPassword:!!e.emailAndPassword?.sendResetPassword,resetPasswordTokenExpiresIn:e.emailAndPassword?.resetPasswordTokenExpiresIn,onPasswordReset:!!e.emailAndPassword?.onPasswordReset,password:{hash:!!e.emailAndPassword?.password?.hash,verify:!!e.emailAndPassword?.password?.verify},autoSignIn:!!e.emailAndPassword?.autoSignIn,revokeSessionsOnPasswordReset:!!e.emailAndPassword?.revokeSessionsOnPasswordReset},socialProviders:Object.keys(e.socialProviders||{}).map(t=>{let r=e.socialProviders?.[t];return r?{id:t,mapProfileToUser:!!r.mapProfileToUser,disableDefaultScope:!!r.disableDefaultScope,disableIdTokenSignIn:!!r.disableIdTokenSignIn,disableImplicitSignUp:r.disableImplicitSignUp,disableSignUp:r.disableSignUp,getUserInfo:!!r.getUserInfo,overrideUserInfoOnSignIn:!!r.overrideUserInfoOnSignIn,prompt:r.prompt,verifyIdToken:!!r.verifyIdToken,scope:r.scope,refreshAccessToken:!!r.refreshAccessToken}:{}}),plugins:e.plugins?.map(e=>e.id.toString()),user:{modelName:e.user?.modelName,fields:e.user?.fields,additionalFields:e.user?.additionalFields,changeEmail:{enabled:e.user?.changeEmail?.enabled,sendChangeEmailVerification:!!e.user?.changeEmail?.sendChangeEmailVerification}},verification:{modelName:e.verification?.modelName,disableCleanup:e.verification?.disableCleanup,fields:e.verification?.fields},session:{modelName:e.session?.modelName,additionalFields:e.session?.additionalFields,cookieCache:{enabled:e.session?.cookieCache?.enabled,maxAge:e.session?.cookieCache?.maxAge},disableSessionRefresh:e.session?.disableSessionRefresh,expiresIn:e.session?.expiresIn,fields:e.session?.fields,freshAge:e.session?.freshAge,preserveSessionInDatabase:e.session?.preserveSessionInDatabase,storeSessionInDatabase:e.session?.storeSessionInDatabase,updateAge:e.session?.updateAge},account:{modelName:e.account?.modelName,fields:e.account?.fields,encryptOAuthTokens:e.account?.encryptOAuthTokens,updateAccountOnSignIn:e.account?.updateAccountOnSignIn,accountLinking:{enabled:e.account?.accountLinking?.enabled,trustedProviders:e.account?.accountLinking?.trustedProviders,updateUserInfoOnLink:e.account?.accountLinking?.updateUserInfoOnLink,allowUnlinkingAll:e.account?.accountLinking?.allowUnlinkingAll}},hooks:{after:!!e.hooks?.after,before:!!e.hooks?.before},secondaryStorage:!!e.secondaryStorage,advanced:{cookiePrefix:!!e.advanced?.cookiePrefix,cookies:!!e.advanced?.cookies,crossSubDomainCookies:{domain:!!e.advanced?.crossSubDomainCookies?.domain,enabled:e.advanced?.crossSubDomainCookies?.enabled,additionalCookies:e.advanced?.crossSubDomainCookies?.additionalCookies},database:{useNumberId:!!e.advanced?.database?.useNumberId,generateId:e.advanced?.database?.generateId,defaultFindManyLimit:e.advanced?.database?.defaultFindManyLimit},useSecureCookies:e.advanced?.useSecureCookies,ipAddress:{disableIpTracking:e.advanced?.ipAddress?.disableIpTracking,ipAddressHeaders:e.advanced?.ipAddress?.ipAddressHeaders},disableCSRFCheck:e.advanced?.disableCSRFCheck,cookieAttributes:{expires:e.advanced?.defaultCookieAttributes?.expires,secure:e.advanced?.defaultCookieAttributes?.secure,sameSite:e.advanced?.defaultCookieAttributes?.sameSite,domain:!!e.advanced?.defaultCookieAttributes?.domain,path:e.advanced?.defaultCookieAttributes?.path,httpOnly:e.advanced?.defaultCookieAttributes?.httpOnly}},trustedOrigins:e.trustedOrigins?.length,rateLimit:{storage:e.rateLimit?.storage,modelName:e.rateLimit?.modelName,window:e.rateLimit?.window,customStorage:!!e.rateLimit?.customStorage,enabled:e.rateLimit?.enabled,max:e.rateLimit?.max},onAPIError:{errorURL:e.onAPIError?.errorURL,onError:!!e.onAPIError?.onError,throw:e.onAPIError?.throw},logger:{disabled:e.logger?.disabled,level:e.logger?.level,log:!!e.logger?.log},databaseHooks:{user:{create:{after:!!e.databaseHooks?.user?.create?.after,before:!!e.databaseHooks?.user?.create?.before},update:{after:!!e.databaseHooks?.user?.update?.after,before:!!e.databaseHooks?.user?.update?.before}},session:{create:{after:!!e.databaseHooks?.session?.create?.after,before:!!e.databaseHooks?.session?.create?.before},update:{after:!!e.databaseHooks?.session?.update?.after,before:!!e.databaseHooks?.session?.update?.before}},account:{create:{after:!!e.databaseHooks?.account?.create?.after,before:!!e.databaseHooks?.account?.create?.before},update:{after:!!e.databaseHooks?.account?.update?.after,before:!!e.databaseHooks?.account?.update?.before}},verification:{create:{after:!!e.databaseHooks?.verification?.create?.after,before:!!e.databaseHooks?.verification?.create?.before},update:{after:!!e.databaseHooks?.verification?.update?.after,before:!!e.databaseHooks?.verification?.update?.before}}}},runtime:"undefined"!=typeof Deno?{name:"deno",version:Deno?.version?.deno??null}:"undefined"!=typeof Bun?{name:"bun",version:Bun?.version??null}:"undefined"!=typeof process&&process?.versions?.node?{name:"node",version:process.versions.node??null}:{name:"edge",version:null},database:await uV(),framework:await uz(),environment:"production"===tN("NODE_ENV")?"production":"false"!==tS.CI&&("BUILD_ID"in tS||"BUILD_NUMBER"in tS||"CI"in tS||"CI_APP_ID"in tS||"CI_BUILD_ID"in tS||"CI_BUILD_NUMBER"in tS||"CI_NAME"in tS||"CONTINUOUS_INTEGRATION"in tS||"RUN_ID"in tS)?"ci":tk()?"test":"development",systemInfo:await uU(),packageManager:function(){let e=tS.npm_config_user_agent;if(!e)return;let t=e.split(" ")[0],r=t.lastIndexOf("/"),n=t.substring(0,r);return{name:"npminstall"===n?"cnpm":n,version:t.substring(r+1)}}()},anonymousId:r}));return{publish:async t=>{s&&(r||(r=await uN(e.baseURL)),await o({type:t.type,payload:t.payload,anonymousId:r}))}}}let uH="better-auth-secret-123456789";function uF(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof e.then}let uK=async e=>{var t,r;let n,i,o,a,s,c=await ux(e),d=e.plugins||[],l=(r=e,r.advanced?.crossSubDomainCookies?.enabled,[]),u=tG(e.logger),p=oH(e.baseURL,e.basePath),f=e.secret||tS.BETTER_AUTH_SECRET||tS.AUTH_SECRET||uH;f===uH&&tO&&u.error("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config."),function(e,t){let r=new Map;e.plugins?.forEach(e=>{if(e.endpoints){for(let[t,n]of Object.entries(e.endpoints))if(n&&"path"in n){let i=n.path,o=[];n.options&&"method"in n.options&&(Array.isArray(n.options.method)?o=n.options.method:"string"==typeof n.options.method&&(o=[n.options.method])),0===o.length&&(o=["*"]),r.has(i)||r.set(i,[]),r.get(i).push({pluginId:e.id,endpointKey:t,methods:o})}}});let n=[];for(let[e,t]of r.entries())if(t.length>1){let r=new Map,i=!1;for(let e of t)for(let n of e.methods)r.has(n)||r.set(n,[]),r.get(n).push(e.pluginId),r.get(n).length>1&&(i=!0),"*"===n&&t.length>1?i=!0:"*"!==n&&r.has("*")&&(i=!0);if(i){let i=[...new Set(t.map(e=>e.pluginId))],o=[];for(let[e,n]of r.entries())(n.length>1||"*"===e&&t.length>1||"*"!==e&&r.has("*"))&&o.push(e);n.push({path:e,plugins:i,conflictingMethods:o})}}if(n.length>0){let e=n.map(e=>`  - "${e.path}" [${e.conflictingMethods.join(", ")}] used by plugins: ${e.plugins.join(", ")}`).join("\n");t.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${e}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}(e={...e,secret:f,baseURL:p?new URL(p).origin:"",basePath:e.basePath||"/api/auth",plugins:d.concat(l)},u);let h=(o=(i=oJ(t=e))("session_token",{maxAge:t.session?.expiresIn||oY("7d")/1e3}),a=i("session_data",{maxAge:t.session?.cookieCache?.maxAge||300}),s=i("dont_remember"),{sessionToken:{name:o.name,options:o.attributes},sessionData:{name:a.name,options:a.attributes},dontRememberToken:{name:s.name,options:s.attributes}}),m=cV(e),g=Object.entries(e.socialProviders||{}).map(([e,t])=>{if(null==t||!1===t.enabled)return null;t.clientId||u.warn(`Social provider ${e} is missing clientId or clientSecret`);let r=au[e](t);return r.disableImplicitSignUp=t.disableImplicitSignUp,r}).filter(e=>null!==e),{publish:y}=await uW(e,{adapter:c.id,database:"function"==typeof e.database?"adapter":uy(e.database)||"unknown"}),b={appName:e.appName||"Better Auth",socialProviders:g,options:e,tables:m,trustedOrigins:function(e){let t=oH(e.baseURL,e.basePath);if(!t)return[];let r=[new URL(t).origin];e.trustedOrigins&&Array.isArray(e.trustedOrigins)&&r.push(...e.trustedOrigins);let n=tS.BETTER_AUTH_TRUSTED_ORIGINS;if(n&&r.push(...n.split(",")),r.filter(e=>!e).length)throw new no("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");return r}(e),baseURL:p||"",sessionConfig:{updateAge:e.session?.updateAge!==void 0?e.session.updateAge:86400,expiresIn:e.session?.expiresIn||604800,freshAge:e.session?.freshAge===void 0?86400:e.session.freshAge},secret:f,rateLimit:{...e.rateLimit,enabled:e.rateLimit?.enabled??tO,window:e.rateLimit?.window||10,max:e.rateLimit?.max||100,storage:e.rateLimit?.storage||(e.secondaryStorage?"secondary-storage":"memory")},authCookies:h,logger:u,generateId:({model:t,size:r})=>"function"==typeof e.advanced?.generateId?e.advanced.generateId({model:t,size:r}):"function"==typeof e?.advanced?.database?.generateId?e.advanced.database.generateId({model:t,size:r}):aE(r),session:null,secondaryStorage:e.secondaryStorage,password:{hash:e.emailAndPassword?.password?.hash||s2,verify:e.emailAndPassword?.password?.verify||s5,config:{minPasswordLength:e.emailAndPassword?.minPasswordLength||8,maxPasswordLength:e.emailAndPassword?.maxPasswordLength||128},checkPassword:uT},setNewSession(e){this.newSession=e},newSession:null,adapter:c,internalAdapter:uw(c,{options:e,logger:u,hooks:e.databaseHooks?[e.databaseHooks]:[]}),createAuthCookie:oJ(e),async runMigrations(){if(!e.database||"updateMany"in e.database)throw new no("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:t}=await uE(e);await t()},publishTelemetry:y,skipCSRFCheck:!!e.advanced?.disableCSRFCheck,skipOriginCheck:e.advanced?.disableOriginCheck!==void 0?e.advanced.disableOriginCheck:!!tk()},w=uQ(b);return uF(w)?{context:n}=await w:{context:n}=w,n};async function uQ(e){let t=e.options,r=t.plugins||[],n=e,i=[];for(let e of r)if(e.init){let r,o=e.init(n);if("object"==typeof(r=uF(o)?await o:o)){if(r.options){let{databaseHooks:e,...n}=r.options;e&&i.push(e),t=aL(t,n)}r.context&&(n={...n,...r.context})}}return i.push(t.databaseHooks),n.internalAdapter=uw(e.adapter,{options:t,logger:e.logger,hooks:i.filter(e=>void 0!==e),generateId:e.generateId}),n.options=t,{context:n}}var uZ=e.i(110724);o5(async()=>({})),o5({use:[ay]},async e=>({session:e.context.session}));let uG=oM.string(),uY=oM.enum(["pending","accepted","rejected","canceled"]).default("pending");oM.object({id:oM.string().default(aE),name:oM.string(),slug:oM.string(),logo:oM.string().nullish().optional(),metadata:oM.record(oM.string(),oM.unknown()).or(oM.string().transform(e=>JSON.parse(e))).optional(),createdAt:oM.date()}),oM.object({id:oM.string().default(aE),organizationId:oM.string(),userId:o$.coerce.string(),role:uG,createdAt:oM.date().default(()=>new Date)}),oM.object({id:oM.string().default(aE),organizationId:oM.string(),email:oM.string(),role:uG,status:uY,teamId:oM.string().nullish(),inviterId:oM.string(),expiresAt:oM.date()}),oM.object({id:oM.string().default(aE),name:oM.string().min(1),organizationId:oM.string(),createdAt:oM.date(),updatedAt:oM.date().optional()}),oM.object({id:oM.string().default(aE),teamId:oM.string(),userId:oM.string(),createdAt:oM.date().default(()=>new Date)}),oM.object({id:oM.string().default(aE),organizationId:oM.string(),role:oM.string(),permission:oM.record(oM.string(),oM.array(oM.string())),createdAt:oM.date().default(()=>new Date),updatedAt:oM.date().optional()});let uJ=["admin","member","owner"];function uX(e){return{newRole:e=>{var t;return{authorize(e,r="AND"){let n=!1;for(let[i,o]of Object.entries(e)){let e=t[i];if(!e)return{success:!1,error:`You are not allowed to access resource: ${i}`};if(Array.isArray(o))n=o.every(t=>e.includes(t));else if("object"==typeof o)n="OR"===o.connector?o.actions.some(t=>e.includes(t)):o.actions.every(t=>e.includes(t));else throw new no("Invalid access control request");if(n&&"OR"===r)return{success:n};if(!n&&"AND"===r)return{success:!1,error:`unauthorized to access resource "${i}"`}}return n?{success:n}:{success:!1,error:"Not authorized"}},statements:t=e}},statements:e}}oM.union([oM.enum(uJ),oM.array(oM.enum(uJ))]);let u0=uX({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]});u0.newRole({organization:["update"],invitation:["create","cancel"],member:["create","update","delete"],team:["create","update","delete"],ac:["create","read","update","delete"]}),u0.newRole({organization:["update","delete"],member:["create","update","delete"],invitation:["create","cancel"],team:["create","update","delete"],ac:["create","read","update","delete"]}),u0.newRole({organization:[],member:[],invitation:[],team:[],ac:["read"]});let u1={INVALID_PHONE_NUMBER:"Invalid phone number",PHONE_NUMBER_EXIST:"Phone number already exists",INVALID_PHONE_NUMBER_OR_PASSWORD:"Invalid phone number or password",UNEXPECTED_ERROR:"Unexpected error",OTP_NOT_FOUND:"OTP not found",OTP_EXPIRED:"OTP expired",INVALID_OTP:"Invalid OTP",PHONE_NUMBER_NOT_VERIFIED:"Phone number not verified"};function u2(e){return aA(e,"0-9")}let u5=async e=>{let t=e.context.returned;return t?t instanceof Response?200!==t.status?null:await t.clone().json():t instanceof nh?null:t:null},u6={FAILED_TO_CREATE_USER:"Failed to create user",USER_ALREADY_EXISTS:"User already exists.",USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL:"User already exists. Use another email.",YOU_CANNOT_BAN_YOURSELF:"You cannot ban yourself",YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE:"You are not allowed to change users role",YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS:"You are not allowed to create users",YOU_ARE_NOT_ALLOWED_TO_LIST_USERS:"You are not allowed to list users",YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS:"You are not allowed to list users sessions",YOU_ARE_NOT_ALLOWED_TO_BAN_USERS:"You are not allowed to ban users",YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS:"You are not allowed to impersonate users",YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS:"You are not allowed to revoke users sessions",YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS:"You are not allowed to delete users",YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD:"You are not allowed to set users password",BANNED_USER:"You have been banned from this application",YOU_ARE_NOT_ALLOWED_TO_GET_USER:"You are not allowed to get user",NO_DATA_TO_UPDATE:"No data to update",YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS:"You are not allowed to update users",YOU_CANNOT_REMOVE_YOURSELF:"You cannot remove yourself",YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE:"You are not allowed to set a non-existent role value"},u3=uX({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),u4={admin:u3.newRole({user:["create","list","set-role","ban","impersonate","delete","set-password","get","update"],session:["list","revoke","delete"]}),user:u3.newRole({user:[],session:[]})},u8=e=>{if(e.userId&&e.options?.adminUserIds?.includes(e.userId))return!0;if(!e.permissions&&!e.permission)return!1;let t=(e.role||e.options?.defaultRole||"user").split(","),r=e.options?.roles||u4;for(let n of t){let t=r[n],i=t?.authorize(e.permission??e.permissions);if(i?.success)return!0}return!1};function u9(e){return Array.isArray(e)?e.join(","):e}let u7=async e=>{let t=await aT("SHA-256").digest(new TextEncoder().encode(e));return t2.encode(new Uint8Array(t),{padding:!1})};function pe(e){let t=e.lastIndexOf(":");return -1===t?[e,""]:[e.slice(0,t),e.slice(t+1)]}let pt=["email-verification","sign-in","forget-password"],pr=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,pn=e=>aA(e.otpLength??6,"0-9");oM.optional(oM.object({disableCookieCache:oM.boolean().meta({description:"Disable cookie cache and fetch session from database"}).or(oM.string().transform(e=>"true"===e)).optional(),disableRefresh:oM.boolean().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}));oM.object({id:oM.string(),deviceCode:oM.string(),userCode:oM.string(),userId:oM.string().optional(),expiresAt:oM.date(),status:oM.string(),lastPolledAt:oM.date().optional(),pollingInterval:oM.number().optional(),clientId:oM.string().optional(),scope:oM.string().optional()});let pi=oM.custom(e=>{try{oY(e)}catch(e){return!1}return!0},{message:"Invalid time string format. Use formats like '30m', '5s', '1h', etc."});oM.object({expiresIn:pi.default("30m").describe("Time in seconds until the device code expires. Use formats like '30m', '5s', '1h', etc."),interval:pi.default("5s").describe("Time in seconds between polling attempts. Use formats like '30m', '5s', '1h', etc."),deviceCodeLength:oM.number().int().positive().default(40).describe("Length of the device code to be generated. Default is 40 characters."),userCodeLength:oM.number().int().positive().default(8).describe("Length of the user code to be generated. Default is 8 characters."),generateDeviceCode:oM.custom(e=>"function"==typeof e,{message:"generateDeviceCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a device code. If not provided, a default random string generator will be used."),generateUserCode:oM.custom(e=>"function"==typeof e,{message:"generateUserCode must be a function that returns a string or a promise that resolves to a string."}).optional().describe("Function to generate a user code. If not provided, a default random string generator will be used."),validateClient:oM.custom(e=>"function"==typeof e,{message:"validateClient must be a function that returns a boolean or a promise that resolves to a boolean."}).optional().describe("Function to validate the client ID. If not provided, no validation will be performed."),onDeviceAuthRequest:oM.custom(e=>"function"==typeof e,{message:"onDeviceAuthRequest must be a function that returns void or a promise that resolves to void."}).optional().describe("Function to handle device authorization requests. If not provided, no additional actions will be taken."),schema:oM.custom(()=>!0)});let po=BigInt(0),pa=BigInt(1),ps=BigInt(2),pc=BigInt(7),pd=BigInt(256),pl=BigInt(113),pu=[],pp=[],pf=[];for(let e=0,t=pa,r=1,n=0;e<24;e++){[r,n]=[n,(2*r+3*n)%5],pu.push(2*(5*n+r)),pp.push((e+1)*(e+2)/2%64);let i=po;for(let e=0;e<7;e++)(t=(t<<pa^(t>>pc)*pl)%pd)&ps&&(i^=pa<<(pa<<BigInt(e))-pa);pf.push(i)}let ph=sq(pf,!0),pm=ph[0],pg=ph[1];var py=e.i(254799);function pb(e,t){if("number"!=typeof(e=e||pA))throw Error("Illegal arguments: "+typeof e+", "+typeof t);e<4?e=4:e>31&&(e=31);var r=[];return r.push("$2b$"),e<10&&r.push("0"),r.push(e.toString()),r.push("$"),r.push(pE(function(e){try{return crypto.getRandomValues(new Uint8Array(e))}catch{}try{return py.default.randomBytes(e)}catch{}!0;throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative")}(pT),pT)),r.join("")}function pw(e,t,r,n){function i(r){"string"==typeof e&&"number"==typeof t?function(e,t,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof e&&(r=e,e=void 0),void 0===e)e=pA;else if("number"!=typeof e)throw Error("illegal arguments: "+typeof e);function n(t){px(function(){try{t(null,pb(e))}catch(e){t(e)}})}if(!r)return new Promise(function(e,t){n(function(r,n){r?t(r):e(n)})});if("function"!=typeof r)throw Error("Illegal callback: "+typeof r);n(r)}(t,function(t,i){pU(e,i,r,n)}):"string"==typeof e&&"string"==typeof t?pU(e,t,r,n):px(r.bind(this,Error("Illegal arguments: "+typeof e+", "+typeof t)))}if(!r)return new Promise(function(e,t){i(function(r,n){r?t(r):e(n)})});if("function"!=typeof r)throw Error("Illegal callback: "+typeof r);i(r)}var px="function"==typeof setImmediate?setImmediate:"object"==typeof scheduler&&"function"==typeof scheduler.postTask?scheduler.postTask.bind(scheduler):setTimeout,pv="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),p_=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function pE(e,t){var r,n,i=0,o=[];if(t<=0||t>e.length)throw Error("Illegal len: "+t);for(;i<t;){if(r=255&e[i++],o.push(pv[r>>2&63]),r=(3&r)<<4,i>=t||(r|=(n=255&e[i++])>>4&15,o.push(pv[63&r]),r=(15&n)<<2,i>=t)){o.push(pv[63&r]);break}r|=(n=255&e[i++])>>6&3,o.push(pv[63&r]),o.push(pv[63&n])}return o.join("")}var pT=16,pA=10,pS=[0x243f6a88,0x85a308d3,0x13198a2e,0x3707344,0xa4093822,0x299f31d0,0x82efa98,0xec4e6c89,0x452821e6,0x38d01377,0xbe5466cf,0x34e90c6c,0xc0ac29b7,0xc97c50dd,0x3f84d5b5,0xb5470917,0x9216d5d9,0x8979fb1b],pR=[0xd1310ba6,0x98dfb5ac,0x2ffd72db,0xd01adfb7,0xb8e1afed,0x6a267e96,0xba7c9045,0xf12c7f99,0x24a19947,0xb3916cf7,0x801f2e2,0x858efc16,0x636920d8,0x71574e69,0xa458fea3,0xf4933d7e,0xd95748f,0x728eb658,0x718bcd58,0x82154aee,0x7b54a41d,0xc25a59b5,0x9c30d539,0x2af26013,0xc5d1b023,0x286085f0,0xca417918,0xb8db38ef,0x8e79dcb0,0x603a180e,0x6c9e0e8b,0xb01e8a3e,0xd71577c1,0xbd314b27,0x78af2fda,0x55605c60,0xe65525f3,0xaa55ab94,0x57489862,0x63e81440,0x55ca396a,0x2aab10b6,0xb4cc5c34,0x1141e8ce,0xa15486af,0x7c72e993,0xb3ee1411,0x636fbc2a,0x2ba9c55d,0x741831f6,0xce5c3e16,0x9b87931e,0xafd6ba33,0x6c24cf5c,0x7a325381,0x28958677,0x3b8f4898,0x6b4bb9af,0xc4bfe81b,0x66282193,0x61d809cc,0xfb21a991,0x487cac60,0x5dec8032,0xef845d5d,0xe98575b1,0xdc262302,0xeb651b88,0x23893e81,0xd396acc5,0xf6d6ff3,0x83f44239,0x2e0b4482,0xa4842004,0x69c8f04a,0x9e1f9b5e,0x21c66842,0xf6e96c9a,0x670c9c61,0xabd388f0,0x6a51a0d2,0xd8542f68,0x960fa728,0xab5133a3,0x6eef0b6c,0x137a3be4,0xba3bf050,0x7efb2a98,0xa1f1651d,0x39af0176,0x66ca593e,0x82430e88,0x8cee8619,0x456f9fb4,0x7d84a5c3,0x3b8b5ebe,0xe06f75d8,0x85c12073,0x401a449f,0x56c16aa6,0x4ed3aa62,0x363f7706,0x1bfedf72,0x429b023d,0x37d0d724,0xd00a1248,0xdb0fead3,0x49f1c09b,0x75372c9,0x80991b7b,0x25d479d8,0xf6e8def7,0xe3fe501a,0xb6794c3b,0x976ce0bd,0x4c006ba,0xc1a94fb6,0x409f60c4,0x5e5c9ec2,0x196a2463,0x68fb6faf,0x3e6c53b5,0x1339b2eb,0x3b52ec6f,0x6dfc511f,0x9b30952c,0xcc814544,0xaf5ebd09,0xbee3d004,0xde334afd,0x660f2807,0x192e4bb3,0xc0cba857,0x45c8740f,0xd20b5f39,0xb9d3fbdb,0x5579c0bd,0x1a60320a,0xd6a100c6,0x402c7279,0x679f25fe,0xfb1fa3cc,0x8ea5e9f8,0xdb3222f8,0x3c7516df,0xfd616b15,0x2f501ec8,0xad0552ab,0x323db5fa,0xfd238760,0x53317b48,0x3e00df82,0x9e5c57bb,0xca6f8ca0,0x1a87562e,0xdf1769db,0xd542a8f6,0x287effc3,0xac6732c6,0x8c4f5573,0x695b27b0,0xbbca58c8,0xe1ffa35d,0xb8f011a0,0x10fa3d98,0xfd2183b8,0x4afcb56c,0x2dd1d35b,0x9a53e479,0xb6f84565,0xd28e49bc,0x4bfb9790,0xe1ddf2da,0xa4cb7e33,0x62fb1341,0xcee4c6e8,0xef20cada,0x36774c01,0xd07e9efe,0x2bf11fb4,0x95dbda4d,0xae909198,0xeaad8e71,0x6b93d5a0,0xd08ed1d0,0xafc725e0,0x8e3c5b2f,0x8e7594b7,0x8ff6e2fb,0xf2122b64,0x8888b812,0x900df01c,0x4fad5ea0,0x688fc31c,0xd1cff191,0xb3a8c1ad,0x2f2f2218,0xbe0e1777,0xea752dfe,0x8b021fa1,0xe5a0cc0f,0xb56f74e8,0x18acf3d6,0xce89e299,0xb4a84fe0,0xfd13e0b7,0x7cc43b81,0xd2ada8d9,0x165fa266,0x80957705,0x93cc7314,0x211a1477,0xe6ad2065,0x77b5fa86,0xc75442f5,0xfb9d35cf,0xebcdaf0c,0x7b3e89a0,0xd6411bd3,0xae1e7e49,2428461,0x2071b35e,0x226800bb,0x57b8e0af,0x2464369b,0xf009b91e,0x5563911d,0x59dfa6aa,0x78c14389,0xd95a537f,0x207d5ba2,0x2e5b9c5,0x83260376,0x6295cfa9,0x11c81968,0x4e734a41,0xb3472dca,0x7b14a94a,0x1b510052,0x9a532915,0xd60f573f,0xbc9bc6e4,0x2b60a476,0x81e67400,0x8ba6fb5,0x571be91f,0xf296ec6b,0x2a0dd915,0xb6636521,0xe7b9f9b6,0xff34052e,0xc5855664,0x53b02d5d,0xa99f8fa1,0x8ba4799,0x6e85076a,0x4b7a70e9,0xb5b32944,0xdb75092e,0xc4192623,290971e4,0x49a7df7d,0x9cee60b8,0x8fedb266,0xecaa8c71,0x699a17ff,0x5664526c,0xc2b19ee1,0x193602a5,0x75094c29,0xa0591340,0xe4183a3e,0x3f54989a,0x5b429d65,0x6b8fe4d6,0x99f73fd6,0xa1d29c07,0xefe830f5,0x4d2d38e6,0xf0255dc1,0x4cdd2086,0x8470eb26,0x6382e9c6,0x21ecc5e,0x9686b3f,0x3ebaefc9,0x3c971814,0x6b6a70a1,0x687f3584,0x52a0e286,0xb79c5305,0xaa500737,0x3e07841c,0x7fdeae5c,0x8e7d44ec,0x5716f2b8,0xb03ada37,0xf0500c0d,0xf01c1f04,0x200b3ff,0xae0cf51a,0x3cb574b2,0x25837a58,0xdc0921bd,0xd19113f9,0x7ca92ff6,0x94324773,0x22f54701,0x3ae5e581,0x37c2dadc,0xc8b57634,0x9af3dda7,0xa9446146,0xfd0030e,0xecc8c73e,0xa4751e41,0xe238cd99,0x3bea0e2f,0x3280bba1,0x183eb331,0x4e548b38,0x4f6db908,0x6f420d03,0xf60a04bf,0x2cb81290,0x24977c79,0x5679b072,0xbcaf89af,0xde9a771f,0xd9930810,0xb38bae12,0xdccf3f2e,0x5512721f,0x2e6b7124,0x501adde6,0x9f84cd87,0x7a584718,0x7408da17,0xbc9f9abc,0xe94b7d8c,0xec7aec3a,0xdb851dfa,0x63094366,0xc464c3d2,0xef1c1847,0x3215d908,0xdd433b37,0x24c2ba16,0x12a14d43,0x2a65c451,0x50940002,0x133ae4dd,0x71dff89e,0x10314e55,0x81ac77d6,0x5f11199b,0x43556f1,0xd7a3c76b,0x3c11183b,0x5924a509,0xf28fe6ed,0x97f1fbfa,0x9ebabf2c,0x1e153c6e,0x86e34570,0xeae96fb1,0x860e5e0a,0x5a3e2ab3,0x771fe71c,0x4e3d06fa,0x2965dcb9,0x99e71d0f,0x803e89d6,0x5266c825,0x2e4cc978,0x9c10b36a,0xc6150eba,0x94e2ea78,0xa5fc3c53,0x1e0a2df4,0xf2f74ea7,0x361d2b3d,0x1939260f,0x19c27960,0x5223a708,0xf71312b6,0xebadfe6e,0xeac31f66,0xe3bc4595,0xa67bc883,0xb17f37d1,0x18cff28,0xc332ddef,0xbe6c5aa5,0x65582185,0x68ab9802,0xeecea50f,0xdb2f953b,0x2aef7dad,0x5b6e2f84,0x1521b628,0x29076170,0xecdd4775,0x619f1510,0x13cca830,0xeb61bd96,0x334fe1e,0xaa0363cf,0xb5735c90,0x4c70a239,0xd59e9e0b,0xcbaade14,0xeecc86bc,0x60622ca7,0x9cab5cab,0xb2f3846e,0x648b1eaf,0x19bdf0ca,0xa02369b9,0x655abb50,0x40685a32,0x3c2ab4b3,0x319ee9d5,0xc021b8f7,0x9b540b19,0x875fa099,0x95f7997e,0x623d7da8,0xf837889a,0x97e32d77,0x11ed935f,0x16681281,0xe358829,0xc7e61fd6,0x96dedfa1,0x7858ba99,0x57f584a5,0x1b227263,0x9b83c3ff,0x1ac24696,0xcdb30aeb,0x532e3054,0x8fd948e4,0x6dbc3128,0x58ebf2ef,0x34c6ffea,0xfe28ed61,0xee7c3c73,0x5d4a14d9,0xe864b7e3,0x42105d14,0x203e13e0,0x45eee2b6,0xa3aaabea,0xdb6c4f15,0xfacb4fd0,0xc742f442,0xef6abbb5,0x654f3b1d,0x41cd2105,0xd81e799e,0x86854dc7,0xe44b476a,0x3d816250,0xcf62a1f2,0x5b8d2646,0xfc8883a0,0xc1c7b6a3,0x7f1524c3,0x69cb7492,0x47848a0b,0x5692b285,0x95bbf00,0xad19489d,0x1462b174,0x23820e00,0x58428d2a,0xc55f5ea,0x1dadf43e,0x233f7061,0x3372f092,0x8d937e41,0xd65fecf1,0x6c223bdb,0x7cde3759,0xcbee7460,0x4085f2a7,0xce77326e,0xa6078084,0x19f8509e,0xe8efd855,0x61d99735,0xa969a7aa,0xc50c06c2,0x5a04abfc,0x800bcadc,0x9e447a2e,0xc3453484,0xfdd56705,0xe1e9ec9,0xdb73dbd3,0x105588cd,0x675fda79,0xe3674340,0xc5c43465,0x713e38d8,0x3d28f89e,0xf16dff20,0x153e21e7,0x8fb03d4a,0xe6e39f2b,0xdb83adf7,0xe93d5a68,0x948140f7,0xf64c261c,0x94692934,0x411520f7,0x7602d4f7,0xbcf46b2e,0xd4a20068,0xd4082471,0x3320f46a,0x43b7d4b7,0x500061af,0x1e39f62e,0x97244546,0x14214f74,0xbf8b8840,0x4d95fc1d,0x96b591af,0x70f4ddd3,0x66a02f45,0xbfbc09ec,0x3bd9785,0x7fac6dd0,0x31cb8504,0x96eb27b3,0x55fd3941,0xda2547e6,0xabca0a9a,0x28507825,0x530429f4,0xa2c86da,0xe9b66dfb,0x68dc1462,0xd7486900,0x680ec0a4,0x27a18dee,0x4f3ffea2,0xe887ad8c,0xb58ce006,0x7af4d6b6,0xaace1e7c,0xd3375fec,0xce78a399,0x406b2a42,0x20fe9e35,0xd9f385b9,0xee39d7ab,0x3b124e8b,0x1dc9faf7,0x4b6d1856,0x26a36631,0xeae397b2,0x3a6efa74,0xdd5b4332,0x6841e7f7,0xca7820fb,0xfb0af54e,0xd8feb397,0x454056ac,0xba489527,0x55533a3a,0x20838d87,0xfe6ba9b7,0xd096954b,0x55a867bc,0xa1159a58,0xcca92963,0x99e1db33,0xa62a4a56,0x3f3125f9,0x5ef47e1c,0x9029317c,0xfdf8e802,0x4272f70,0x80bb155c,0x5282ce3,0x95c11548,0xe4c66d22,0x48c1133f,0xc70f86dc,0x7f9c9ee,0x41041f0f,0x404779a4,0x5d886e17,0x325f51eb,0xd59bc0d1,0xf2bcc18f,0x41113564,0x257b7834,0x602a9c60,0xdff8e8a3,0x1f636c1b,0xe12b4c2,0x2e1329e,0xaf664fd1,0xcad18115,0x6b2395e0,0x333e92e1,0x3b240b62,0xeebeb922,0x85b2a20e,0xe6ba0d99,0xde720c8c,0x2da2f728,0xd0127845,0x95b794fd,0x647d0862,0xe7ccf5f0,0x5449a36f,0x877d48fa,0xc39dfd27,0xf33e8d1e,0xa476341,0x992eff74,0x3a6f6eab,0xf4f8fd37,0xa812dc60,0xa1ebddf8,0x991be14c,0xdb6e6b0d,0xc67b5510,0x6d672c37,0x2765d43b,0xdcd0e804,0xf1290dc7,0xcc00ffa3,0xb5390f92,0x690fed0b,0x667b9ffb,0xcedb7d9c,0xa091cf0b,0xd9155ea3,0xbb132f88,0x515bad24,0x7b9479bf,0x763bd6eb,0x37392eb3,0xcc115979,0x8026e297,0xf42e312d,0x6842ada7,0xc66a2b3b,0x12754ccc,0x782ef11c,0x6a124237,0xb79251e7,0x6a1bbe6,0x4bfb6350,0x1a6b1018,0x11caedfa,0x3d25bdd8,0xe2e1c3c9,0x44421659,0xa121386,0xd90cec6e,0xd5abea2a,0x64af674e,0xda86a85f,0xbebfe988,0x64e4c3fe,0x9dbc8057,0xf0f7c086,0x60787bf8,0x6003604d,0xd1fd8346,0xf6381fb0,0x7745ae04,0xd736fccc,0x83426b33,0xf01eab71,0xb0804187,0x3c005e5f,0x77a057be,0xbde8ae24,0x55464299,0xbf582e61,0x4e58f48f,0xf2ddfda2,0xf474ef38,0x8789bdc2,0x5366f9c3,0xc8b38e74,0xb475f255,0x46fcd9b9,0x7aeb2661,0x8b1ddf84,0x846a0e79,0x915f95e2,0x466e598e,0x20b45770,0x8cd55591,0xc902de4c,0xb90bace1,0xbb8205d0,0x11a86248,0x7574a99e,0xb77f19b6,0xe0a9dc09,0x662d09a1,0xc4324633,0xe85a1f02,0x9f0be8c,0x4a99a025,0x1d6efe10,0x1ab93d1d,0xba5a4df,0xa186f20f,0x2868f169,0xdcb7da83,0x573906fe,0xa1e2ce9b,0x4fcd7f52,0x50115e01,0xa70683fa,0xa002b5c4,0xde6d027,0x9af88c27,0x773f8641,0xc3604c06,0x61a806b5,0xf0177a28,0xc0f586e0,6314154,0x30dc7d62,0x11e69ed7,0x2338ea63,0x53c2dd94,0xc2c21634,0xbbcbee56,0x90bcb6de,0xebfc7da1,0xce591d76,0x6f05e409,0x4b7c0188,0x39720a3d,0x7c927c24,0x86e3725f,0x724d9db9,0x1ac15bb4,0xd39eb8fc,0xed545578,0x8fca5b5,0xd83d7cd3,0x4dad0fc4,0x1e50ef5e,0xb161e6f8,0xa28514d9,0x6c51133c,0x6fd5c7e7,0x56e14ec4,0x362abfce,0xddc6c837,0xd79a3234,0x92638212,0x670efa8e,0x406000e0,0x3a39ce37,0xd3faf5cf,0xabc27737,0x5ac52d1b,0x5cb0679e,0x4fa33742,0xd3822740,0x99bc9bbe,0xd5118e9d,0xbf0f7315,0xd62d1c7e,0xc700c47b,0xb78c1b6b,0x21a19045,0xb26eb1be,0x6a366eb4,0x5748ab2f,0xbc946e79,0xc6a376d2,0x6549c2c8,0x530ff8ee,0x468dde7d,0xd5730a1d,0x4cd04dc6,0x2939bbdb,0xa9ba4650,0xac9526e8,0xbe5ee304,0xa1fad5f0,0x6a2d519a,0x63ef8ce2,0x9a86ee22,0xc089c2b8,0x43242ef6,0xa51e03aa,0x9cf2d0a4,0x83c061ba,0x9be96a4d,0x8fe51550,0xba645bd6,0x2826a2f9,0xa73a3ae1,0x4ba99586,0xef5562e9,0xc72fefd3,0xf752f7da,0x3f046f69,0x77fa0a59,0x80e4a915,0x87b08601,0x9b09e6ad,0x3b3ee593,0xe990fd5a,0x9e34d797,0x2cf0b7d9,0x22b8b51,0x96d5ac3a,0x17da67d,0xd1cf3ed6,0x7c7d2d28,0x1f9f25cf,0xadf2b89b,0x5ad6b472,0x5a88f54c,0xe029ac71,0xe019a5e6,0x47b0acfd,0xed93fa9b,0xe8d3c48d,0x283b57cc,0xf8d56629,0x79132e28,0x785f0191,0xed756055,0xf7960e44,0xe3d35e8c,0x15056dd4,0x88f46dba,0x3a16125,0x564f0bd,0xc3eb9e15,0x3c9057a2,0x97271aec,0xa93a072a,0x1b3f6d9b,0x1e6321f5,0xf59c66fb,0x26dcf319,0x7533d928,0xb155fdf5,0x3563482,0x8aba3cbb,0x28517711,0xc20ad9f8,0xabcc5167,0xccad925f,0x4de81751,0x3830dc8e,0x379d5862,0x9320f991,0xea7a90c2,0xfb3e7bce,0x5121ce64,0x774fbe32,0xa8b6e37e,0xc3293d46,0x48de5369,0x6413e680,0xa2ae0810,0xdd6db224,0x69852dfd,0x9072166,0xb39a460a,0x6445c0dd,0x586cdecf,0x1c20c8ae,0x5bbef7dd,0x1b588d40,0xccd2017f,0x6bb4e3bb,0xdda26a7e,0x3a59ff45,0x3e350a44,0xbcb4cdd5,0x72eacea8,0xfa6484bb,0x8d6612ae,0xbf3c6f47,0xd29be463,0x542f5d9e,0xaec2771b,0xf64e6370,0x740e0d8d,0xe75b1357,0xf8721671,0xaf537d5d,0x4040cb08,0x4eb4e2cc,0x34d2466a,0x115af84,3786409e3,0x95983a1d,0x6b89fb4,0xce6ea048,0x6f3f3b82,0x3520ab82,0x11a1d4b,0x277227f8,0x611560b1,0xe7933fdc,0xbb3a792b,0x344525bd,0xa08839e1,0x51ce794b,0x2f32c9b7,0xa01fbac9,0xe01cc87e,0xbcc7d1f6,0xcf0111c3,0xa1e8aac7,0x1a908749,0xd44fbd9a,0xd0dadecb,0xd50ada38,0x339c32a,0xc6913667,0x8df9317c,0xe0b12b4f,0xf79e59b7,0x43f5bb3a,0xf2d519ff,0x27d9459c,0xbf97222c,0x15e6fc2a,0xf91fc71,0x9b941525,0xfae59361,0xceb69ceb,0xc2a86459,0x12baa8d1,0xb6c1075e,0xe3056a0c,0x10d25065,0xcb03a442,0xe0ec6e0e,0x1698db3b,0x4c98a0be,0x3278e964,0x9f1f9532,0xe0d392df,0xd3a0342b,0x8971f21e,0x1b0a7441,0x4ba3348c,0xc5be7120,0xc37632d8,0xdf359f8d,0x9b992f2e,0xe60b6f47,0xfe3f11d,0xe54cda54,0x1edad891,0xce6279cf,0xcd3e7e6f,0x1618b166,0xfd2c1d05,0x848fd2c5,0xf6fb2299,0xf523f357,0xa6327623,0x93a83531,0x56cccd02,0xacf08162,0x5a75ebb5,0x6e163697,0x88d273cc,0xde966292,0x81b949d0,0x4c50901b,0x71c65614,0xe6c6c7bd,0x327a140a,0x45e1d006,0xc3f27b9a,0xc9aa53fd,0x62a80f00,0xbb25bfe2,0x35bdd2f6,0x71126905,0xb2040222,0xb6cbcf7c,0xcd769c2b,0x53113ec0,0x1640e3d3,0x38abbd60,0x2547adf0,0xba38209c,0xf746ce76,0x77afa1c5,0x20756060,0x85cbfe4e,0x8ae88dd8,0x7aaaf9b0,0x4cf9aa7e,0x1948c25c,0x2fb8a8c,0x1c36ae4,0xd6ebe1f9,0x90d4f869,0xa65cdea0,0x3f09252d,0xc208e69f,0xb74e6132,0xce77e25b,0x578fdfe3,0x3ac372e6],pO=[0x4f727068,0x65616e42,0x65686f6c,0x64657253,0x63727944,0x6f756274];function pI(e,t,r,n){var i=e[t],o=e[t+1];return i^=r[0],o^=(n[i>>>24]+n[256|i>>16&255]^n[512|i>>8&255])+n[768|255&i]^r[1],i^=(n[o>>>24]+n[256|o>>16&255]^n[512|o>>8&255])+n[768|255&o]^r[2],o^=(n[i>>>24]+n[256|i>>16&255]^n[512|i>>8&255])+n[768|255&i]^r[3],i^=(n[o>>>24]+n[256|o>>16&255]^n[512|o>>8&255])+n[768|255&o]^r[4],o^=(n[i>>>24]+n[256|i>>16&255]^n[512|i>>8&255])+n[768|255&i]^r[5],i^=(n[o>>>24]+n[256|o>>16&255]^n[512|o>>8&255])+n[768|255&o]^r[6],o^=(n[i>>>24]+n[256|i>>16&255]^n[512|i>>8&255])+n[768|255&i]^r[7],i^=(n[o>>>24]+n[256|o>>16&255]^n[512|o>>8&255])+n[768|255&o]^r[8],o^=(n[i>>>24]+n[256|i>>16&255]^n[512|i>>8&255])+n[768|255&i]^r[9],i^=(n[o>>>24]+n[256|o>>16&255]^n[512|o>>8&255])+n[768|255&o]^r[10],o^=(n[i>>>24]+n[256|i>>16&255]^n[512|i>>8&255])+n[768|255&i]^r[11],i^=(n[o>>>24]+n[256|o>>16&255]^n[512|o>>8&255])+n[768|255&o]^r[12],o^=(n[i>>>24]+n[256|i>>16&255]^n[512|i>>8&255])+n[768|255&i]^r[13],i^=(n[o>>>24]+n[256|o>>16&255]^n[512|o>>8&255])+n[768|255&o]^r[14],o^=(n[i>>>24]+n[256|i>>16&255]^n[512|i>>8&255])+n[768|255&i]^r[15],i^=(n[o>>>24]+n[256|o>>16&255]^n[512|o>>8&255])+n[768|255&o]^r[16],e[t]=o^r[17],e[t+1]=i,e}function pk(e,t){for(var r=0,n=0;r<4;++r)n=n<<8|255&e[t],t=(t+1)%e.length;return{key:n,offp:t}}function pN(e,t,r){for(var n,i=0,o=[0,0],a=t.length,s=r.length,c=0;c<a;c++)i=(n=pk(e,i)).offp,t[c]=t[c]^n.key;for(c=0;c<a;c+=2)o=pI(o,0,t,r),t[c]=o[0],t[c+1]=o[1];for(c=0;c<s;c+=2)o=pI(o,0,t,r),r[c]=o[0],r[c+1]=o[1]}function pP(e,t,r,n,i){var o,a,s=pO.slice(),c=s.length;if(r<4||r>31){if(a=Error("Illegal number of rounds (4-31): "+r),n)return void px(n.bind(this,a));throw a}if(t.length!==pT){if(a=Error("Illegal salt length: "+t.length+" != "+pT),n)return void px(n.bind(this,a));throw a}r=1<<r>>>0;var d,l,u,p=0;function f(){if(i&&i(p/r),p<r)for(var o=Date.now();p<r&&(p+=1,pN(e,d,l),pN(t,d,l),!(Date.now()-o>100)););else{for(p=0;p<64;p++)for(u=0;u<c>>1;u++)pI(s,u<<1,d,l);var a=[];for(p=0;p<c;p++)a.push((s[p]>>24&255)>>>0),a.push((s[p]>>16&255)>>>0),a.push((s[p]>>8&255)>>>0),a.push((255&s[p])>>>0);return n?void n(null,a):a}n&&px(f)}if("function"==typeof Int32Array?(d=new Int32Array(pS),l=new Int32Array(pR)):(d=pS.slice(),l=pR.slice()),!function(e,t,r,n){for(var i,o=0,a=[0,0],s=r.length,c=n.length,d=0;d<s;d++)o=(i=pk(t,o)).offp,r[d]=r[d]^i.key;for(d=0,o=0;d<s;d+=2)o=(i=pk(e,o)).offp,a[0]^=i.key,o=(i=pk(e,o)).offp,a[1]^=i.key,a=pI(a,0,r,n),r[d]=a[0],r[d+1]=a[1];for(d=0;d<c;d+=2)o=(i=pk(e,o)).offp,a[0]^=i.key,o=(i=pk(e,o)).offp,a[1]^=i.key,a=pI(a,0,r,n),n[d]=a[0],n[d+1]=a[1]}(t,e,d,l),void 0!==n)f();else for(;;)if(void 0!==(o=f()))return o||[]}function pU(e,t,r,n){if("string"!=typeof e||"string"!=typeof t){if(i=Error("Invalid string / salt: Not a string"),r)return void px(r.bind(this,i));throw i}if("$"!==t.charAt(0)||"2"!==t.charAt(1)){if(i=Error("Invalid salt version: "+t.substring(0,2)),r)return void px(r.bind(this,i));throw i}if("$"===t.charAt(2))o="\0",a=3;else{if("a"!==(o=t.charAt(2))&&"b"!==o&&"y"!==o||"$"!==t.charAt(3)){if(i=Error("Invalid salt revision: "+t.substring(2,4)),r)return void px(r.bind(this,i));throw i}a=4}if(t.charAt(a+2)>"$"){if(i=Error("Missing salt rounds"),r)return void px(r.bind(this,i));throw i}var i,o,a,s=10*parseInt(t.substring(a,a+1),10)+parseInt(t.substring(a+1,a+2),10),c=t.substring(a+3,a+25),d=function(e){for(var t,r,n=0,i=Array(function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t}(e)),o=0,a=e.length;o<a;++o)(t=e.charCodeAt(o))<128?i[n++]=t:(t<2048?i[n++]=t>>6|192:((64512&t)==55296&&(64512&(r=e.charCodeAt(o+1)))==56320?(t=65536+((1023&t)<<10)+(1023&r),++o,i[n++]=t>>18|240,i[n++]=t>>12&63|128):i[n++]=t>>12|224,i[n++]=t>>6&63|128),i[n++]=63&t|128);return i}(e+=o>="a"?"\0":""),l=function(e,t){var r,n,i,o,a,s=0,c=e.length,d=0,l=[];if(t<=0)throw Error("Illegal len: "+t);for(;s<c-1&&d<t&&(r=(a=e.charCodeAt(s++))<p_.length?p_[a]:-1,n=(a=e.charCodeAt(s++))<p_.length?p_[a]:-1,-1!=r&&-1!=n)&&(o=r<<2>>>0|(48&n)>>4,l.push(String.fromCharCode(o)),!(++d>=t||s>=c||-1==(i=(a=e.charCodeAt(s++))<p_.length?p_[a]:-1)||(o=(15&n)<<4>>>0|(60&i)>>2,l.push(String.fromCharCode(o)),++d>=t||s>=c)));){;o=(3&i)<<6>>>0|((a=e.charCodeAt(s++))<p_.length?p_[a]:-1),l.push(String.fromCharCode(o)),++d}var u=[];for(s=0;s<d;s++)u.push(l[s].charCodeAt(0));return u}(c,pT);function u(e){var t=[];return t.push("$2"),o>="a"&&t.push(o),t.push("$"),s<10&&t.push("0"),t.push(s.toString()),t.push("$"),t.push(pE(l,l.length)),t.push(pE(e,4*pO.length-1)),t.join("")}if(void 0===r)return u(pP(d,l,s));pP(d,l,s,function(e,t){e?r(e,null):r(null,u(t))},n)}let pC=function(e,t,r,n){function i(r){"string"!=typeof e||"string"!=typeof t?px(r.bind(this,Error("Illegal arguments: "+typeof e+", "+typeof t))):60!==t.length?px(r.bind(this,null,!1)):pw(e,t.substring(0,29),function(e,n){e?r(e):r(null,function(e,t){for(var r=e.length^t.length,n=0;n<e.length;++n)r|=e.charCodeAt(n)^t.charCodeAt(n);return 0===r}(n,t))},n)}if(!r)return new Promise(function(e,t){i(function(r,n){r?t(r):e(n)})});if("function"!=typeof r)throw Error("Illegal callback: "+typeof r);i(r)};var pD=e.i(189374);let pL=(e=>{let t=uK(e),{api:r}=cq(t,e),n=e.plugins?.reduce((e,t)=>t.$ERROR_CODES?{...e,...t.$ERROR_CODES}:e,{});return{handler:async r=>{let n=await t,i=n.options.basePath||"/api/auth";if(!n.options.baseURL){let e=oH(void 0,i,r);if(e)n.baseURL=e,n.options.baseURL=oF(n.baseURL)||void 0;else throw new no("Could not get base URL from request. Please provide a valid base URL.")}n.trustedOrigins=[...e.trustedOrigins?Array.isArray(e.trustedOrigins)?e.trustedOrigins:await e.trustedOrigins(r):[],n.options.baseURL];let{handler:o}=((e,t)=>{let{api:r,middlewares:n}=cq(e,t),i=new URL(e.baseURL).pathname;return((e,t)=>{if(!t?.openapi?.disabled){let r={path:"/api/reference",...t?.openapi};e.openapi=nk(r.path,{method:"GET"},async t=>{let n,i;return new Response((n=await oj(e),i=r.scalar,`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(n)}
    </script>
	 <script>
      var configuration = {
	  	favicon: ${i?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(i.logo)}`:void 0} ,
	   	theme: ${i?.theme||"saturn"},
        metaData: {
			title: ${i?.title||"Open API Reference"},
			description: ${i?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`),{headers:{"Content-Type":"text/html"}})})}let r=nc(),n=nc();for(let t of Object.values(e))if(!(!t.options||t.options?.metadata?.SERVER_ONLY))for(let e of Array.isArray(t.options?.method)?t.options.method:[t.options?.method])nu(r,e,t.path,t);if(t?.routerMiddleware?.length)for(let{path:e,middleware:r}of t.routerMiddleware)nu(n,"*",e,r);let i=async e=>{let i=new URL(e.url),o=t?.basePath?i.pathname.split(t.basePath).reduce((e,r,n)=>(0!==n&&(n>1?e.push(`${t.basePath}${r}`):e.push(r)),e),[]).join(""):i.pathname;if(!o?.length)return new Response(null,{status:404,statusText:"Not Found"});let a=function(e,t="",r,n){"/"===r[r.length-1]&&(r=r.slice(0,-1));let i=e.static[r];if(i&&i.methods){let e=i.methods[t]||i.methods[""];if(void 0!==e)return e[0]}let o=nd(r),a=function e(t,r,n,i,o){if(o===i.length){if(r.methods){let e=r.methods[n]||r.methods[""];if(e)return e}if(r.param&&r.param.methods){let e=r.param.methods[n]||r.param.methods[""];if(e){let t=e[0].paramsMap;if(t?.[t?.length-1]?.[2])return e}}if(r.wildcard&&r.wildcard.methods){let e=r.wildcard.methods[n]||r.wildcard.methods[""];if(e){let t=e[0].paramsMap;if(t?.[t?.length-1]?.[2])return e}}return}let a=i[o];if(r.static){let s=r.static[a];if(s){let r=e(t,s,n,i,o+1);if(r)return r}}if(r.param){let a=e(t,r.param,n,i,o+1);if(a)return a}if(r.wildcard&&r.wildcard.methods)return r.wildcard.methods[n]||r.wildcard.methods[""]}(e,e.root,t,o,0)?.[0];if(void 0!==a)return{data:a.data,params:a.paramsMap?nl(o,a.paramsMap):void 0}}(r,e.method,o);if(!a?.data)return new Response(null,{status:404,statusText:"Not Found"});let s={};i.searchParams.forEach((e,t)=>{t in s?Array.isArray(s[t])?s[t].push(e):s[t]=[s[t],e]:s[t]=e});let c=a.data,d={path:o,method:e.method,headers:e.headers,params:a.params?JSON.parse(JSON.stringify(a.params)):{},request:e,body:c.options.disableBody?void 0:await nm(c.options.cloneRequest?e.clone():e),query:s,_flag:"router",asResponse:!0,context:t?.routerContext};try{let e=function(e,t="",r,n){"/"===r[r.length-1]&&(r=r.slice(0,-1));let i=nd(r);return(function e(t,r,n,i,o,a=[]){let s=i[o];if(r.wildcard&&r.wildcard.methods){let e=r.wildcard.methods[n]||r.wildcard.methods[""];e&&a.push(...e)}if(r.param&&(e(t,r.param,n,i,o+1,a),o===i.length&&r.param.methods)){let e=r.param.methods[n]||r.param.methods[""];e&&a.push(...e)}let c=r.static?.[s];if(c&&e(t,c,n,i,o+1,a),o===i.length&&r.methods){let e=r.methods[n]||r.methods[""];e&&a.push(...e)}return a})(e,e.root,t,i,0).map(e=>({data:e.data,params:e.paramsMap?nl(i,e.paramsMap):void 0}))}(n,"*",o);if(e?.length)for(let{data:t,params:r}of e){let e=await t({...d,params:r,asResponse:!1});if(e instanceof Response)return e}return await c(d)}catch(e){if(t?.onError)try{let r=await t.onError(e);if(r instanceof Response)return ny(r)}catch(e){if(ng(e))return ny(e);throw e}if(t?.throwError)throw e;if(ng(e))return ny(e);return console.error("# SERVER_ERROR: ",e),new Response(null,{status:500,statusText:"Internal Server Error"})}};return{handler:async e=>{let r=await t?.onRequest?.(e);if(r instanceof Response)return r;let n=r instanceof Request?r:e,o=await i(n),a=await t?.onResponse?.(o);return a instanceof Response?a:o},endpoints:e}})(r,{routerContext:e,openapi:{disabled:!0},basePath:i,routerMiddleware:[{path:"/**",middleware:s7},...n],async onRequest(t){let r=e.options.disabledPaths||[],n=new URL(t.url).pathname.replace(i,"");if(r.includes(n))return new Response("Not Found",{status:404});for(let r of e.options.plugins||[])if(r.onRequest){let n=await r.onRequest(t,e);if(n&&"response"in n)return n.response;if(n&&"request"in n){let t=await cM(n.request,e);if(t)return t;return n.request}}return cM(t,e)},async onResponse(t){for(let r of e.options.plugins||[])if(r.onResponse){let n=await r.onResponse(t,e);if(n)return n.response}return t},onError(r){if(r instanceof nh&&"FOUND"===r.status)return;if(t.onAPIError?.throw)throw r;if(t.onAPIError?.onError)return void t.onAPIError.onError(r,e);let n=t.logger?.level,i="error"===n||"warn"===n||"debug"===n?tY:void 0;if(t.logger?.disabled!==!0){if(r&&"object"==typeof r&&"message"in r&&"string"==typeof r.message&&(r.message.includes("no column")||r.message.includes("column")||r.message.includes("relation")||r.message.includes("table")||r.message.includes("does not exist")))return void e.logger?.error(r.message);r instanceof nh?("INTERNAL_SERVER_ERROR"===r.status&&e.logger.error(r.status,r),i?.error(r.message)):e.logger?.error(r&&"object"==typeof r&&"name"in r?r.name:"",r)}}})})(n,e);return o(r)},api:r,options:e,$context:t,$Infer:{},$ERROR_CODES:{...n,...ni}}})({database:(ea=new uZ.PrismaClient,es={provider:"postgresql"},u=null,p=e=>({getFieldName:t})=>{let r=(e,r)=>{if(e&&r)return e.reduce((e,n)=>({...e,[t({model:r,field:n})]:!0}),{})};function n(e){switch(e){case"starts_with":return"startsWith";case"ends_with":return"endsWith";case"ne":return"not";case"not_in":return"notIn";default:return e}}let i=(e,r)=>{if(!r||!r.length)return{};if(1===r.length){let i=r[0];if(!i)return;return{[t({model:e,field:i.field})]:"eq"!==i.operator&&i.operator?{[n(i.operator)]:i.value}:i.value}}let i=r.filter(e=>"AND"===e.connector||!e.connector),o=r.filter(e=>"OR"===e.connector),a=i.map(r=>({[t({model:e,field:r.field})]:"eq"!==r.operator&&r.operator?{[n(r.operator)]:r.value}:r.value})),s=o.map(r=>({[t({model:e,field:r.field})]:"eq"!==r.operator&&r.operator?{[n(r.operator)]:r.value}:r.value}));return{...a.length?{AND:a}:{},...s.length?{OR:s}:{}}};return{async create({model:t,data:n,select:i}){if(!e[t])throw new no(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return await e[t].create({data:n,select:r(i,t)})},async findOne({model:t,where:n,select:o}){let a=i(t,n);if(!e[t])throw new no(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return await e[t].findFirst({where:a,select:r(o,t)})},async findMany({model:r,where:n,limit:o,offset:a,sortBy:s}){let c=i(r,n);if(!e[r])throw new no(`Model ${r} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return await e[r].findMany({where:c,take:o||100,skip:a||0,...s?.field?{orderBy:{[t({model:r,field:s.field})]:"desc"===s.direction?"desc":"asc"}}:{}})},async count({model:t,where:r}){let n=i(t,r);if(!e[t])throw new no(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);return await e[t].count({where:n})},async update({model:t,where:r,update:n}){if(!e[t])throw new no(`Model ${t} does not exist in the database. If you haven't generated the Prisma client, you need to run 'npx prisma generate'`);let o=i(t,r);return await e[t].update({where:o,data:n})},async updateMany({model:t,where:r,update:n}){let o=i(t,r),a=await e[t].updateMany({where:o,data:n});return a?a.count:0},async delete({model:t,where:r}){let n=i(t,r);try{await e[t].delete({where:n})}catch(e){}},async deleteMany({model:t,where:r}){let n=i(t,r),o=await e[t].deleteMany({where:n});return o?o.count:0},options:es}},f=null,f={config:{adapterId:"prisma",adapterName:"Prisma Adapter",usePlural:es.usePlural??!1,debugLogs:es.debugLogs??!1,transaction:!!es.transaction&&(e=>ea.$transaction(t=>e(up({config:f.config,adapter:p(t)})(u))))},adapter:p(ea)},h=up(f),e=>(u=e,h(e))),baseURL:pD.env.BETTER_AUTH_URL,basePath:"/api/auth",secret:pD.env.BETTER_AUTH_SECRET,trustedOrigins:[pD.env.BETTER_AUTH_URL,"http://localhost:3000","https://mimisalon.pet","https://staging.mimisalon.pet"],emailAndPassword:{enabled:!0,requireEmailVerification:!0,sendResetPassword:async({user:t,url:r})=>{let{sendEmail:n}=await e.A(901694),{generatePasswordResetTemplate:i}=await e.A(644151),o=await i(t.name||t.email,r);await n({to:t.email,subject:"  - ",html:o})},password:{hash:async e=>await pw(e,10),verify:async({hash:e,password:t})=>pC(t,e)}},emailVerification:{sendVerificationEmail:async({user:t,url:r})=>{let{sendEmail:n}=await e.A(901694),{generateEmailVerificationTemplate:i}=await e.A(644151),o=await i(t.name||t.email,r);await n({to:t.email,subject:"  - ",html:o})},sendOnSignUp:!0,autoSignInAfterVerification:!0},session:{expiresIn:2592e3,updateAge:86400,cookieCache:{enabled:!0,maxAge:300}},account:{accountLinking:{enabled:!0,trustedProviders:["credential"]}},socialProviders:{},plugins:[(ec={impersonationSessionDuration:3600},m={defaultRole:ec?.defaultRole??"user",adminRoles:ec?.adminRoles??["admin"],bannedUserMessage:ec?.bannedUserMessage??"You have been banned from this application. Please contact support if you believe this is an error.",...ec},g=o5(async e=>{let t=await ag(e);if(!t)throw new nh("UNAUTHORIZED");return{session:t}}),{id:"admin",init:()=>({options:{databaseHooks:{user:{create:{before:async e=>({data:{role:ec?.defaultRole??"user",...e}})}},session:{create:{async before(e,t){if(!t)return;let r=await t.context.internalAdapter.findUserById(e.userId);if(r.banned){if(r.banExpires&&new Date(r.banExpires).getTime()<Date.now())return void await t.context.internalAdapter.updateUser(e.userId,{banned:!1,banReason:null,banExpires:null});if(t&&(t.path.startsWith("/callback")||t.path.startsWith("/oauth2/callback"))){let e=t.context.options.onAPIError?.errorURL||`${t.context.baseURL}/error`;throw t.redirect(`${e}?error=banned&error_description=${m.bannedUserMessage}`)}throw new nh("FORBIDDEN",{message:m.bannedUserMessage,code:"BANNED_USER"})}}}}}}}),hooks:{after:[{matcher:e=>"/list-sessions"===e.path,handler:o5(async e=>{let t=await u5(e);if(!t)return;let r=t.filter(e=>!e.impersonatedBy);return e.json(r)})}]},endpoints:{setRole:o6("/admin/set-role",{method:"POST",body:oM.object({userId:o$.coerce.string().meta({description:"The user id"}),role:oM.union([oM.string().meta({description:"The role to set. `admin` or `user` by default"}),oM.array(oM.string().meta({description:"The roles to set. `admin` or `user` by default"}))]).meta({description:"The role to set, this can be a string or an array of strings. Eg: `admin` or `[admin, user]`"})}),requireHeaders:!0,use:[g],metadata:{openapi:{operationId:"setRole",summary:"Set the role of a user",description:"Set the role of a user",responses:{200:{description:"User role updated",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},async e=>{if(!u8({userId:e.context.session.user.id,role:e.context.session.user.role,options:m,permissions:{user:["set-role"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_CHANGE_USERS_ROLE});let t=m.roles;if(t){for(let r of Array.isArray(e.body.role)?e.body.role:[e.body.role])if(!t[r])throw new nh("BAD_REQUEST",{message:u6.YOU_ARE_NOT_ALLOWED_TO_SET_NON_EXISTENT_VALUE})}let r=await e.context.internalAdapter.updateUser(e.body.userId,{role:u9(e.body.role)},e);return e.json({user:r})}),getUser:o6("/admin/get-user",{method:"GET",query:oM.object({id:oM.string().meta({description:"The id of the User"})}),use:[g],metadata:{openapi:{operationId:"getUser",summary:"Get an existing user",description:"Get an existing user",responses:{200:{description:"User",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{let{id:t}=e.query;if(!u8({userId:e.context.session.user.id,role:e.context.session.user.role,options:m,permissions:{user:["get"]}}))throw e.error("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_GET_USER,code:"YOU_ARE_NOT_ALLOWED_TO_GET_USER"});let r=await e.context.internalAdapter.findUserById(t);if(!r)throw new nh("NOT_FOUND",{message:ni.USER_NOT_FOUND});return aI(e.context.options,r)}),createUser:o6("/admin/create-user",{method:"POST",body:oM.object({email:oM.string().meta({description:"The email of the user"}),password:oM.string().meta({description:"The password of the user"}),name:oM.string().meta({description:"The name of the user"}),role:oM.union([oM.string().meta({description:"The role of the user"}),oM.array(oM.string().meta({description:"The roles of user"}))]).optional().meta({description:'A string or array of strings representing the roles to apply to the new user. Eg: "user"'}),data:oM.record(oM.string(),oM.any()).optional().meta({description:"Extra fields for the user. Including custom additional fields."})}),metadata:{openapi:{operationId:"createUser",summary:"Create a new user",description:"Create a new user",responses:{200:{description:"User created",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},async e=>{let t=await ag(e);if(!t&&(e.request||e.headers))throw e.error("UNAUTHORIZED");if(t&&!u8({userId:t.user.id,role:t.user.role,options:m,permissions:{user:["create"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_CREATE_USERS});if(await e.context.internalAdapter.findUserByEmail(e.body.email))throw new nh("BAD_REQUEST",{message:u6.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});let r=await e.context.internalAdapter.createUser({email:e.body.email,name:e.body.name,role:(e.body.role&&u9(e.body.role))??ec?.defaultRole??"user",...e.body.data},e);if(!r)throw new nh("INTERNAL_SERVER_ERROR",{message:u6.FAILED_TO_CREATE_USER});let n=await e.context.password.hash(e.body.password);return await e.context.internalAdapter.linkAccount({accountId:r.id,providerId:"credential",password:n,userId:r.id},e),e.json({user:r})}),adminUpdateUser:o6("/admin/update-user",{method:"POST",body:oM.object({userId:o$.coerce.string().meta({description:"The user id"}),data:oM.record(oM.any(),oM.any()).meta({description:"The user data to update"})}),use:[g],metadata:{openapi:{operationId:"updateUser",summary:"Update a user",description:"Update a user's details",responses:{200:{description:"User updated",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{if(!u8({userId:e.context.session.user.id,role:e.context.session.user.role,options:m,permissions:{user:["update"]}}))throw e.error("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS,code:"YOU_ARE_NOT_ALLOWED_TO_UPDATE_USERS"});if(0===Object.keys(e.body.data).length)throw new nh("BAD_REQUEST",{message:u6.NO_DATA_TO_UPDATE});e.body.data?.role&&(e.body.data.role=u9(e.body.data.role));let t=await e.context.internalAdapter.updateUser(e.body.userId,e.body.data,e);return e.json(t)}),listUsers:o6("/admin/list-users",{method:"GET",use:[g],query:oM.object({searchValue:oM.string().optional().meta({description:'The value to search for. Eg: "some name"'}),searchField:oM.enum(["email","name"]).meta({description:'The field to search in, defaults to email. Can be `email` or `name`. Eg: "name"'}).optional(),searchOperator:oM.enum(["contains","starts_with","ends_with"]).meta({description:'The operator to use for the search. Can be `contains`, `starts_with` or `ends_with`. Eg: "contains"'}).optional(),limit:oM.string().meta({description:"The number of users to return"}).or(oM.number()).optional(),offset:oM.string().meta({description:"The offset to start from"}).or(oM.number()).optional(),sortBy:oM.string().meta({description:"The field to sort by"}).optional(),sortDirection:oM.enum(["asc","desc"]).meta({description:"The direction to sort by"}).optional(),filterField:oM.string().meta({description:"The field to filter by"}).optional(),filterValue:oM.string().meta({description:"The value to filter by"}).or(oM.number()).or(oM.boolean()).optional(),filterOperator:oM.enum(["eq","ne","lt","lte","gt","gte","contains"]).meta({description:"The operator to use for the filter"}).optional()}),metadata:{openapi:{operationId:"listUsers",summary:"List users",description:"List users",responses:{200:{description:"List of users",content:{"application/json":{schema:{type:"object",properties:{users:{type:"array",items:{$ref:"#/components/schemas/User"}},total:{type:"number"},limit:{type:"number"},offset:{type:"number"}},required:["users","total"]}}}}}}}},async e=>{let t=e.context.session;if(!u8({userId:e.context.session.user.id,role:t.user.role,options:m,permissions:{user:["list"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS});let r=[];e.query?.searchValue&&r.push({field:e.query.searchField||"email",operator:e.query.searchOperator||"contains",value:e.query.searchValue}),e.query?.filterValue&&r.push({field:e.query.filterField||"email",operator:e.query.filterOperator||"eq",value:e.query.filterValue});try{let t=await e.context.internalAdapter.listUsers(Number(e.query?.limit)||void 0,Number(e.query?.offset)||void 0,e.query?.sortBy?{field:e.query.sortBy,direction:e.query.sortDirection||"asc"}:void 0,r.length?r:void 0),n=await e.context.internalAdapter.countTotalUsers(r.length?r:void 0);return e.json({users:t,total:n,limit:Number(e.query?.limit)||void 0,offset:Number(e.query?.offset)||void 0})}catch(t){return e.json({users:[],total:0})}}),listUserSessions:o6("/admin/list-user-sessions",{method:"POST",use:[g],body:oM.object({userId:o$.coerce.string().meta({description:"The user id"})}),metadata:{openapi:{operationId:"listUserSessions",summary:"List user sessions",description:"List user sessions",responses:{200:{description:"List of user sessions",content:{"application/json":{schema:{type:"object",properties:{sessions:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}}}},async e=>{let t=e.context.session;if(!u8({userId:e.context.session.user.id,role:t.user.role,options:m,permissions:{session:["list"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_LIST_USERS_SESSIONS});return{sessions:await e.context.internalAdapter.listSessions(e.body.userId)}}),unbanUser:o6("/admin/unban-user",{method:"POST",body:oM.object({userId:o$.coerce.string().meta({description:"The user id"})}),use:[g],metadata:{openapi:{operationId:"unbanUser",summary:"Unban a user",description:"Unban a user",responses:{200:{description:"User unbanned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{let t=e.context.session;if(!u8({userId:e.context.session.user.id,role:t.user.role,options:m,permissions:{user:["ban"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS});let r=await e.context.internalAdapter.updateUser(e.body.userId,{banned:!1,banExpires:null,banReason:null,updatedAt:new Date});return e.json({user:r})}),banUser:o6("/admin/ban-user",{method:"POST",body:oM.object({userId:o$.coerce.string().meta({description:"The user id"}),banReason:oM.string().meta({description:"The reason for the ban"}).optional(),banExpiresIn:oM.number().meta({description:"The number of seconds until the ban expires"}).optional()}),use:[g],metadata:{openapi:{operationId:"banUser",summary:"Ban a user",description:"Ban a user",responses:{200:{description:"User banned",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{let t=e.context.session;if(!u8({userId:e.context.session.user.id,role:t.user.role,options:m,permissions:{user:["ban"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_BAN_USERS});if(!await e.context.internalAdapter.findUserById(e.body.userId))throw new nh("NOT_FOUND",{message:ni.USER_NOT_FOUND});if(e.body.userId===e.context.session.user.id)throw new nh("BAD_REQUEST",{message:u6.YOU_CANNOT_BAN_YOURSELF});let r=await e.context.internalAdapter.updateUser(e.body.userId,{banned:!0,banReason:e.body.banReason||ec?.defaultBanReason||"No reason",banExpires:e.body.banExpiresIn?oq(e.body.banExpiresIn,"sec"):ec?.defaultBanExpiresIn?oq(ec.defaultBanExpiresIn,"sec"):void 0,updatedAt:new Date},e);return await e.context.internalAdapter.deleteSessions(e.body.userId),e.json({user:r})}),impersonateUser:o6("/admin/impersonate-user",{method:"POST",body:oM.object({userId:o$.coerce.string().meta({description:"The user id"})}),use:[g],metadata:{openapi:{operationId:"impersonateUser",summary:"Impersonate a user",description:"Impersonate a user",responses:{200:{description:"Impersonation session created",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}}}},async e=>{if(!u8({userId:e.context.session.user.id,role:e.context.session.user.role,options:m,permissions:{user:["impersonate"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_IMPERSONATE_USERS});let t=await e.context.internalAdapter.findUserById(e.body.userId);if(!t)throw new nh("NOT_FOUND",{message:"User not found"});let r=await e.context.internalAdapter.createSession(t.id,e,!0,{impersonatedBy:e.context.session.user.id,expiresAt:ec?.impersonationSessionDuration?oq(ec.impersonationSessionDuration,"sec"):oq(3600,"sec")},!0);if(!r)throw new nh("INTERNAL_SERVER_ERROR",{message:u6.FAILED_TO_CREATE_USER});let n=e.context.authCookies;o1(e);let i=await e.getSignedCookie(e.context.authCookies.dontRememberToken.name,e.context.secret),o=e.context.createAuthCookie("admin_session");return await e.setSignedCookie(o.name,`${e.context.session.session.token}:${i||""}`,e.context.secret,n.sessionToken.options),await o0(e,{session:r,user:t},!0),e.json({session:r,user:t})}),stopImpersonating:o6("/admin/stop-impersonating",{method:"POST",requireHeaders:!0},async e=>{let t=await ag(e);if(!t)throw new nh("UNAUTHORIZED");if(!t.session.impersonatedBy)throw new nh("BAD_REQUEST",{message:"You are not impersonating anyone"});let r=await e.context.internalAdapter.findUserById(t.session.impersonatedBy);if(!r)throw new nh("INTERNAL_SERVER_ERROR",{message:"Failed to find user"});let n=e.context.createAuthCookie("admin_session").name,i=await e.getSignedCookie(n,e.context.secret);if(!i)throw new nh("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});let[o,a]=i?.split(":"),s=await e.context.internalAdapter.findSession(o);if(!s||s.session.userId!==r.id)throw new nh("INTERNAL_SERVER_ERROR",{message:"Failed to find admin session"});return await e.context.internalAdapter.deleteSession(t.session.token),await o0(e,s,!!a),e.json(s)}),revokeUserSession:o6("/admin/revoke-user-session",{method:"POST",body:oM.object({sessionToken:oM.string().meta({description:"The session token"})}),use:[g],metadata:{openapi:{operationId:"revokeUserSession",summary:"Revoke a user session",description:"Revoke a user session",responses:{200:{description:"Session revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let t=e.context.session;if(!u8({userId:e.context.session.user.id,role:t.user.role,options:m,permissions:{session:["revoke"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS});return await e.context.internalAdapter.deleteSession(e.body.sessionToken),e.json({success:!0})}),revokeUserSessions:o6("/admin/revoke-user-sessions",{method:"POST",body:oM.object({userId:o$.coerce.string().meta({description:"The user id"})}),use:[g],metadata:{openapi:{operationId:"revokeUserSessions",summary:"Revoke all user sessions",description:"Revoke all user sessions",responses:{200:{description:"Sessions revoked",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let t=e.context.session;if(!u8({userId:e.context.session.user.id,role:t.user.role,options:m,permissions:{session:["revoke"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_REVOKE_USERS_SESSIONS});return await e.context.internalAdapter.deleteSessions(e.body.userId),e.json({success:!0})}),removeUser:o6("/admin/remove-user",{method:"POST",body:oM.object({userId:o$.coerce.string().meta({description:"The user id"})}),use:[g],metadata:{openapi:{operationId:"removeUser",summary:"Remove a user",description:"Delete a user and all their sessions and accounts. Cannot be undone.",responses:{200:{description:"User removed",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async e=>{let t=e.context.session;if(!u8({userId:e.context.session.user.id,role:t.user.role,options:m,permissions:{user:["delete"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_DELETE_USERS});if(e.body.userId===e.context.session.user.id)throw new nh("BAD_REQUEST",{message:u6.YOU_CANNOT_REMOVE_YOURSELF});if(!await e.context.internalAdapter.findUserById(e.body.userId))throw new nh("NOT_FOUND",{message:"User not found"});return await e.context.internalAdapter.deleteUser(e.body.userId),e.json({success:!0})}),setUserPassword:o6("/admin/set-user-password",{method:"POST",body:oM.object({newPassword:oM.string().meta({description:"The new password"}),userId:o$.coerce.string().meta({description:"The user id"})}),use:[g],metadata:{openapi:{operationId:"setUserPassword",summary:"Set a user's password",description:"Set a user's password",responses:{200:{description:"Password set",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async e=>{if(!u8({userId:e.context.session.user.id,role:e.context.session.user.role,options:m,permissions:{user:["set-password"]}}))throw new nh("FORBIDDEN",{message:u6.YOU_ARE_NOT_ALLOWED_TO_SET_USERS_PASSWORD});let t=await e.context.password.hash(e.body.newPassword);return await e.context.internalAdapter.updatePassword(e.body.userId,t),e.json({status:!0})}),userHasPermission:o6("/admin/has-permission",{method:"POST",body:oM.object({userId:o$.coerce.string().optional().meta({description:'The user id. Eg: "user-id"'}),role:oM.string().optional().meta({description:'The role to check permission for. Eg: "admin"'})}).and(oM.union([oM.object({permission:oM.record(oM.string(),oM.array(oM.string())),permissions:oM.undefined()}),oM.object({permission:oM.undefined(),permissions:oM.record(oM.string(),oM.array(oM.string()))})])),metadata:{openapi:{description:"Check if the user has permission",requestBody:{content:{"application/json":{schema:{type:"object",properties:{permission:{type:"object",description:"The permission to check",deprecated:!0},permissions:{type:"object",description:"The permission to check"}},required:["permissions"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{error:{type:"string"},success:{type:"boolean"}},required:["success"]}}}}}},$Infer:{body:{}}}},async e=>{if(!e.body?.permission&&!e.body?.permissions)throw new nh("BAD_REQUEST",{message:"invalid permission check. no permission(s) were passed."});let t=await ag(e);if(!t&&(e.request||e.headers))throw new nh("UNAUTHORIZED");if(!t&&!e.body.userId&&!e.body.role)throw new nh("BAD_REQUEST",{message:"user id or role is required"});let r=t?.user||(e.body.role?{id:e.body.userId||"",role:e.body.role}:null)||await e.context.internalAdapter.findUserById(e.body.userId);if(!r)throw new nh("BAD_REQUEST",{message:"user not found"});let n=u8({userId:r.id,role:r.role,options:ec,permissions:e.body.permissions??e.body.permission});return e.json({error:null,success:n})})},$ERROR_CODES:u6,schema:aP({user:{fields:{role:{type:"string",required:!1,input:!1},banned:{type:"boolean",defaultValue:!1,required:!1,input:!1},banReason:{type:"string",required:!1,input:!1},banExpires:{type:"date",required:!1,input:!1}}},session:{fields:{impersonatedBy:{type:"string",required:!1}}}},m.schema),options:ec}),(e=>{let t={expiresIn:300,generateOTP:()=>pn(e),storeOTP:"plain",...e},r={OTP_EXPIRED:"otp expired",INVALID_OTP:"Invalid OTP",INVALID_EMAIL:"Invalid email",USER_NOT_FOUND:"User not found",TOO_MANY_ATTEMPTS:"Too many attempts"};async function n(e,r){return"encrypted"===t.storeOTP?await s6({key:e.context.secret,data:r}):"hashed"===t.storeOTP?await u7(r):"object"==typeof t.storeOTP&&"hash"in t.storeOTP?await t.storeOTP.hash(r):"object"==typeof t.storeOTP&&"encrypt"in t.storeOTP?await t.storeOTP.encrypt(r):r}async function i(e,r,n){return"encrypted"===t.storeOTP?await s3({key:e.context.secret,data:r})===n:"hashed"===t.storeOTP?await u7(n)===r:"object"==typeof t.storeOTP&&"hash"in t.storeOTP?await t.storeOTP.hash(n)===r:"object"==typeof t.storeOTP&&"decrypt"in t.storeOTP?await t.storeOTP.decrypt(r)===n:n===r}let o={sendVerificationOTP:o6("/email-otp/send-verification-otp",{method:"POST",body:oM.object({email:oM.string({}).meta({description:"Email address to send the OTP"}),type:oM.enum(pt).meta({description:"Type of the OTP"})}),metadata:{openapi:{description:"Send verification OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async i=>{if(!e?.sendVerificationOTP)throw i.context.logger.error("send email verification is not implemented"),new nh("BAD_REQUEST",{message:"send email verification is not implemented"});let o=i.body.email;if(!pr.test(o))throw i.error("BAD_REQUEST",{message:r.INVALID_EMAIL});if(t.disableSignUp){if(!await i.context.internalAdapter.findUserByEmail(o))throw new nh("BAD_REQUEST",{message:r.USER_NOT_FOUND})}else if("forget-password"===i.body.type&&!await i.context.internalAdapter.findUserByEmail(o))return i.json({success:!0});let a=t.generateOTP({email:o,type:i.body.type},i.request)||pn(t),s=await n(i,a);return await i.context.internalAdapter.createVerificationValue({value:`${s}:0`,identifier:`${i.body.type}-otp-${o}`,expiresAt:oq(t.expiresIn,"sec")},i).catch(async e=>{await i.context.internalAdapter.deleteVerificationByIdentifier(`${i.body.type}-otp-${o}`),await i.context.internalAdapter.createVerificationValue({value:`${s}:0`,identifier:`${i.body.type}-otp-${o}`,expiresAt:oq(t.expiresIn,"sec")},i)}),await e.sendVerificationOTP({email:o,otp:a,type:i.body.type},i.request),i.json({success:!0})})};return{id:"email-otp",init(e){if(t.overrideDefaultEmailVerification)return{options:{emailVerification:{async sendVerificationEmail(t,r){await o.sendVerificationOTP({context:e,request:r,body:{email:t.user.email,type:"email-verification"},ctx:e})}}}}},endpoints:{...o,createVerificationOTP:o6("/email-otp/create-verification-otp",{method:"POST",body:oM.object({email:oM.string({}).meta({description:"Email address to send the OTP"}),type:oM.enum(pt).meta({required:!0,description:"Type of the OTP"})}),metadata:{SERVER_ONLY:!0,openapi:{description:"Create verification OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"string"}}}}}}}},async e=>{let r=e.body.email,i=t.generateOTP({email:r,type:e.body.type},e.request)||pn(t),o=await n(e,i);return await e.context.internalAdapter.createVerificationValue({value:`${o}:0`,identifier:`${e.body.type}-otp-${r}`,expiresAt:oq(t.expiresIn,"sec")},e),i}),getVerificationOTP:o6("/email-otp/get-verification-otp",{method:"GET",query:oM.object({email:oM.string({}).meta({description:"Email address the OTP was sent to"}),type:oM.enum(pt).meta({required:!0,description:"Type of the OTP"})}),metadata:{SERVER_ONLY:!0,openapi:{description:"Get verification OTP",responses:{200:{description:"OTP retrieved successfully or not found/expired",content:{"application/json":{schema:{type:"object",properties:{otp:{type:"string",nullable:!0,description:"The stored OTP, or null if not found or expired"}},required:["otp"]}}}}}}}},async e=>{let r=e.query.email,n=await e.context.internalAdapter.findVerificationValue(`${e.query.type}-otp-${r}`);if(!n||n.expiresAt<new Date)return e.json({otp:null});if("hashed"===t.storeOTP||"object"==typeof t.storeOTP&&"hash"in t.storeOTP)throw new nh("BAD_REQUEST",{message:"OTP is hashed, cannot return the plain text OTP"});let[i,o]=pe(n.value),a=i;return"encrypted"===t.storeOTP&&(a=await s3({key:e.context.secret,data:i})),"object"==typeof t.storeOTP&&"decrypt"in t.storeOTP&&(a=await t.storeOTP.decrypt(i)),e.json({otp:a})}),checkVerificationOTP:o6("/email-otp/check-verification-otp",{method:"POST",body:oM.object({email:oM.string().meta({description:"Email address the OTP was sent to"}),type:oM.enum(pt).meta({required:!0,description:"Type of the OTP"}),otp:oM.string().meta({required:!0,description:"OTP to verify"})}),metadata:{openapi:{description:"Check if a verification OTP is valid",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async t=>{let n=t.body.email;if(!pr.test(n))throw new nh("BAD_REQUEST",{message:r.INVALID_EMAIL});if(!await t.context.internalAdapter.findUserByEmail(n))throw new nh("BAD_REQUEST",{message:r.USER_NOT_FOUND});let o=await t.context.internalAdapter.findVerificationValue(`${t.body.type}-otp-${n}`);if(!o)throw new nh("BAD_REQUEST",{message:r.INVALID_OTP});if(o.expiresAt<new Date)throw await t.context.internalAdapter.deleteVerificationValue(o.id),new nh("BAD_REQUEST",{message:r.OTP_EXPIRED});let[a,s]=pe(o.value),c=e?.allowedAttempts||3;if(s&&parseInt(s)>=c)throw await t.context.internalAdapter.deleteVerificationValue(o.id),new nh("FORBIDDEN",{message:r.TOO_MANY_ATTEMPTS});if(!await i(t,a,t.body.otp))throw await t.context.internalAdapter.updateVerificationValue(o.id,{value:`${a}:${parseInt(s||"0")+1}`}),new nh("BAD_REQUEST",{message:r.INVALID_OTP});return t.json({success:!0})}),verifyEmailOTP:o6("/email-otp/verify-email",{method:"POST",body:oM.object({email:oM.string({}).meta({description:"Email address to verify"}),otp:oM.string().meta({required:!0,description:"OTP to verify"})}),metadata:{openapi:{description:"Verify email with OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the verification was successful",enum:[!0]},token:{type:"string",nullable:!0,description:"Session token if autoSignInAfterVerification is enabled, otherwise null"},user:{$ref:"#/components/schemas/User"}},required:["status","token","user"]}}}}}}}},async t=>{let n=t.body.email;if(!pr.test(n))throw new nh("BAD_REQUEST",{message:r.INVALID_EMAIL});let o=await t.context.internalAdapter.findVerificationValue(`email-verification-otp-${n}`);if(!o)throw new nh("BAD_REQUEST",{message:r.INVALID_OTP});if(o.expiresAt<new Date)throw new nh("BAD_REQUEST",{message:r.OTP_EXPIRED});let[a,s]=pe(o.value),c=e?.allowedAttempts||3;if(s&&parseInt(s)>=c)throw await t.context.internalAdapter.deleteVerificationValue(o.id),new nh("FORBIDDEN",{message:r.TOO_MANY_ATTEMPTS});if(!await i(t,a,t.body.otp))throw await t.context.internalAdapter.updateVerificationValue(o.id,{value:`${a}:${parseInt(s||"0")+1}`}),new nh("BAD_REQUEST",{message:r.INVALID_OTP});await t.context.internalAdapter.deleteVerificationValue(o.id);let d=await t.context.internalAdapter.findUserByEmail(n);if(!d)throw new nh("BAD_REQUEST",{message:r.USER_NOT_FOUND});let l=await t.context.internalAdapter.updateUser(d.user.id,{email:n,emailVerified:!0},t);if(await t.context.options.emailVerification?.onEmailVerification?.(l,t.request),t.context.options.emailVerification?.autoSignInAfterVerification){let e=await t.context.internalAdapter.createSession(l.id,t);return await o0(t,{session:e,user:l}),t.json({status:!0,token:e.token,user:{id:l.id,email:l.email,emailVerified:l.emailVerified,name:l.name,image:l.image,createdAt:l.createdAt,updatedAt:l.updatedAt}})}return t.json({status:!0,token:null,user:{id:l.id,email:l.email,emailVerified:l.emailVerified,name:l.name,image:l.image,createdAt:l.createdAt,updatedAt:l.updatedAt}})}),signInEmailOTP:o6("/sign-in/email-otp",{method:"POST",body:oM.object({email:oM.string({}).meta({description:"Email address to sign in"}),otp:oM.string().meta({required:!0,description:"OTP sent to the email"})}),metadata:{openapi:{description:"Sign in with OTP",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"Session token for the authenticated session"},user:{$ref:"#/components/schemas/User"}},required:["token","user"]}}}}}}}},async n=>{let o=n.body.email,a=await n.context.internalAdapter.findVerificationValue(`sign-in-otp-${o}`);if(!a)throw new nh("BAD_REQUEST",{message:r.INVALID_OTP});if(a.expiresAt<new Date)throw new nh("BAD_REQUEST",{message:r.OTP_EXPIRED});let[s,c]=pe(a.value),d=e?.allowedAttempts||3;if(c&&parseInt(c)>=d)throw await n.context.internalAdapter.deleteVerificationValue(a.id),new nh("FORBIDDEN",{message:r.TOO_MANY_ATTEMPTS});if(!await i(n,s,n.body.otp))throw await n.context.internalAdapter.updateVerificationValue(a.id,{value:`${s}:${parseInt(c||"0")+1}`}),new nh("BAD_REQUEST",{message:r.INVALID_OTP});await n.context.internalAdapter.deleteVerificationValue(a.id);let l=await n.context.internalAdapter.findUserByEmail(o);if(!l){if(t.disableSignUp)throw new nh("BAD_REQUEST",{message:r.USER_NOT_FOUND});let e=await n.context.internalAdapter.createUser({email:o,emailVerified:!0,name:""},n),i=await n.context.internalAdapter.createSession(e.id,n);return await o0(n,{session:i,user:e}),n.json({token:i.token,user:{id:e.id,email:e.email,emailVerified:e.emailVerified,name:e.name,image:e.image,createdAt:e.createdAt,updatedAt:e.updatedAt}})}l.user.emailVerified||await n.context.internalAdapter.updateUser(l.user.id,{emailVerified:!0},n);let u=await n.context.internalAdapter.createSession(l.user.id,n);return await o0(n,{session:u,user:l.user}),n.json({token:u.token,user:{id:l.user.id,email:l.user.email,emailVerified:l.user.emailVerified,name:l.user.name,image:l.user.image,createdAt:l.user.createdAt,updatedAt:l.user.updatedAt}})}),forgetPasswordEmailOTP:o6("/forget-password/email-otp",{method:"POST",body:oM.object({email:oM.string().meta({description:"Email address to send the OTP"})}),metadata:{openapi:{description:"Send a password reset OTP to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the OTP was sent successfully"}}}}}}}}}},async i=>{let o=i.body.email;if(!await i.context.internalAdapter.findUserByEmail(o))throw new nh("BAD_REQUEST",{message:r.USER_NOT_FOUND});let a=t.generateOTP({email:o,type:"forget-password"},i.request)||pn(t),s=await n(i,a);return await i.context.internalAdapter.createVerificationValue({value:`${s}:0`,identifier:`forget-password-otp-${o}`,expiresAt:oq(t.expiresIn,"sec")},i),await e.sendVerificationOTP({email:o,otp:a,type:"forget-password"},i.request),i.json({success:!0})}),resetPasswordEmailOTP:o6("/email-otp/reset-password",{method:"POST",body:oM.object({email:oM.string().meta({description:"Email address to reset the password"}),otp:oM.string().meta({description:"OTP sent to the email"}),password:oM.string().meta({description:"New password"})}),metadata:{openapi:{description:"Reset user password with OTP",responses:{200:{description:"Success",contnt:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async t=>{let n=t.body.email,o=await t.context.internalAdapter.findUserByEmail(n,{includeAccounts:!0});if(!o)throw new nh("BAD_REQUEST",{message:r.USER_NOT_FOUND});let a=await t.context.internalAdapter.findVerificationValue(`forget-password-otp-${n}`);if(!a)throw new nh("BAD_REQUEST",{message:r.INVALID_OTP});if(a.expiresAt<new Date)throw await t.context.internalAdapter.deleteVerificationValue(a.id),new nh("BAD_REQUEST",{message:r.OTP_EXPIRED});let[s,c]=pe(a.value),d=e?.allowedAttempts||3;if(c&&parseInt(c)>=d)throw await t.context.internalAdapter.deleteVerificationValue(a.id),new nh("FORBIDDEN",{message:r.TOO_MANY_ATTEMPTS});if(!await i(t,s,t.body.otp))throw await t.context.internalAdapter.updateVerificationValue(a.id,{value:`${s}:${parseInt(c||"0")+1}`}),new nh("BAD_REQUEST",{message:r.INVALID_OTP});await t.context.internalAdapter.deleteVerificationValue(a.id);let l=await t.context.password.hash(t.body.password);return o.accounts.find(e=>"credential"===e.providerId)?await t.context.internalAdapter.updatePassword(o.user.id,l,t):await t.context.internalAdapter.createAccount({userId:o.user.id,providerId:"credential",accountId:o.user.id,password:l},t),t.context.options.emailAndPassword?.onPasswordReset&&await t.context.options.emailAndPassword.onPasswordReset({user:o.user},t.request),o.user.emailVerified||await t.context.internalAdapter.updateUser(o.user.id,{emailVerified:!0},t),t.json({success:!0})})},hooks:{after:[{matcher:e=>!!(e.path?.startsWith("/sign-up")&&t.sendVerificationOnSignUp),handler:o5(async r=>{let i=await u5(r),o=i?.user.email;if(o){let i=t.generateOTP({email:o,type:r.body.type},r.request)||pn(t),a=await n(r,i);await r.context.internalAdapter.createVerificationValue({value:`${a}:0`,identifier:`email-verification-otp-${o}`,expiresAt:oq(t.expiresIn,"sec")},r),await e.sendVerificationOTP({email:o,otp:i,type:"email-verification"},r.request)}})}]},$ERROR_CODES:r,rateLimit:[{pathMatcher:e=>"/email-otp/send-verification-otp"===e,window:60,max:3},{pathMatcher:e=>"/email-otp/check-verification-otp"===e,window:60,max:3},{pathMatcher:e=>"/email-otp/verify-email"===e,window:60,max:3},{pathMatcher:e=>"/sign-in/email-otp"===e,window:60,max:3}]}})({async sendVerificationOTP({email:t,otp:r,type:n}){console.log("Sending OTP to:",t,"with code:",r);{let{sendEmail:i}=await e.A(901694),{generateOTPEmailTemplate:o}=await e.A(644151),a=await o(t,r,n);await i({to:t,subject:"sign-in"===n?"  - ":"email-verification"===n?"  - ":"   - ",html:a})}},otpLength:6,expiresIn:600,disableSignUp:!1,allowedAttempts:5}),(ed={async sendOTP({phoneNumber:t,code:r},n){console.log("Sending SMS OTP to:",t,"with code:",r);{let{sendSMSCode:n}=await e.A(576284),i=await n(t,r);if(!i.success)throw Error(i.error||"Failed to send SMS")}console.log("SMS OTP sent successfully to:",t)},otpLength:6,expiresIn:600,allowedAttempts:3},y={expiresIn:ed?.expiresIn||300,otpLength:ed?.otpLength||6,...ed,phoneNumber:"phoneNumber",phoneNumberVerified:"phoneNumberVerified",code:"code",createdAt:"createdAt"},{id:"phone-number",endpoints:{signInPhoneNumber:o6("/sign-in/phone-number",{method:"POST",body:oM.object({phoneNumber:oM.string().meta({description:'Phone number to sign in. Eg: "+1234567890"'}),password:oM.string().meta({description:"Password to use for sign in."}),rememberMe:oM.boolean().meta({description:"Remember the session. Eg: true"}).optional()}),metadata:{openapi:{summary:"Sign in with phone number",description:"Use this endpoint to sign in with phone number",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{$ref:"#/components/schemas/User"},session:{$ref:"#/components/schemas/Session"}}}}}},400:{description:"Invalid phone number or password"}}}}},async e=>{let{password:t,phoneNumber:r}=e.body;if(y.phoneNumberValidator&&!await y.phoneNumberValidator(e.body.phoneNumber))throw new nh("BAD_REQUEST",{message:u1.INVALID_PHONE_NUMBER});let n=await e.context.adapter.findOne({model:"user",where:[{field:"phoneNumber",value:r}]});if(!n)throw new nh("UNAUTHORIZED",{message:u1.INVALID_PHONE_NUMBER_OR_PASSWORD});if(y.requireVerification&&!n.phoneNumberVerified){let t=u2(y.otpLength);throw await e.context.internalAdapter.createVerificationValue({value:t,identifier:r,expiresAt:oq(y.expiresIn,"sec")},e),await y.sendOTP?.({phoneNumber:r,code:t},e.request),new nh("UNAUTHORIZED",{message:u1.PHONE_NUMBER_NOT_VERIFIED})}let i=(await e.context.internalAdapter.findAccountByUserId(n.id)).find(e=>"credential"===e.providerId);if(!i)throw e.context.logger.error("Credential account not found",{phoneNumber:r}),new nh("UNAUTHORIZED",{message:u1.INVALID_PHONE_NUMBER_OR_PASSWORD});let o=i?.password;if(!o)throw e.context.logger.error("Password not found",{phoneNumber:r}),new nh("UNAUTHORIZED",{message:u1.UNEXPECTED_ERROR});if(!await e.context.password.verify({hash:o,password:t}))throw e.context.logger.error("Invalid password"),new nh("UNAUTHORIZED",{message:u1.INVALID_PHONE_NUMBER_OR_PASSWORD});let a=await e.context.internalAdapter.createSession(n.id,e,!1===e.body.rememberMe);if(!a)throw e.context.logger.error("Failed to create session"),new nh("UNAUTHORIZED",{message:ni.FAILED_TO_CREATE_SESSION});return await o0(e,{session:a,user:n},!1===e.body.rememberMe),e.json({token:a.token,user:{id:n.id,email:n.email,emailVerified:n.emailVerified,name:n.name,image:n.image,phoneNumber:n.phoneNumber,phoneNumberVerified:n.phoneNumberVerified,createdAt:n.createdAt,updatedAt:n.updatedAt}})}),sendPhoneNumberOTP:o6("/phone-number/send-otp",{method:"POST",body:oM.object({phoneNumber:oM.string().meta({description:'Phone number to send OTP. Eg: "+1234567890"'})}),metadata:{openapi:{summary:"Send OTP to phone number",description:"Use this endpoint to send OTP to phone number",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async e=>{if(!ed?.sendOTP)throw e.context.logger.warn("sendOTP not implemented"),new nh("NOT_IMPLEMENTED",{message:"sendOTP not implemented"});if(y.phoneNumberValidator&&!await y.phoneNumberValidator(e.body.phoneNumber))throw new nh("BAD_REQUEST",{message:u1.INVALID_PHONE_NUMBER});let t=u2(y.otpLength);return await e.context.internalAdapter.createVerificationValue({value:`${t}:0`,identifier:e.body.phoneNumber,expiresAt:oq(y.expiresIn,"sec")},e),await ed.sendOTP({phoneNumber:e.body.phoneNumber,code:t},e.request),e.json({message:"code sent"})}),verifyPhoneNumber:o6("/phone-number/verify",{method:"POST",body:oM.object({phoneNumber:oM.string().meta({description:'Phone number to verify. Eg: "+1234567890"'}),code:oM.string().meta({description:'OTP code. Eg: "123456"'}),disableSession:oM.boolean().meta({description:"Disable session creation after verification. Eg: false"}).optional(),updatePhoneNumber:oM.boolean().meta({description:"Check if there is a session and update the phone number. Eg: true"}).optional()}),metadata:{openapi:{summary:"Verify phone number",description:"Use this endpoint to verify phone number",responses:{200:{description:"Phone number verified successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the verification was successful",enum:[!0]},token:{type:"string",nullable:!0,description:"Session token if session is created, null if disableSession is true or no session is created"},user:{type:"object",nullable:!0,properties:{id:{type:"string",description:"Unique identifier of the user"},email:{type:"string",format:"email",nullable:!0,description:"User's email address"},emailVerified:{type:"boolean",nullable:!0,description:"Whether the email is verified"},name:{type:"string",nullable:!0,description:"User's name"},image:{type:"string",format:"uri",nullable:!0,description:"User's profile image URL"},phoneNumber:{type:"string",description:"User's phone number"},phoneNumberVerified:{type:"boolean",description:"Whether the phone number is verified"},createdAt:{type:"string",format:"date-time",description:"Timestamp when the user was created"},updatedAt:{type:"string",format:"date-time",description:"Timestamp when the user was last updated"}},required:["id","phoneNumber","phoneNumberVerified","createdAt","updatedAt"],description:"User object with phone number details, null if no user is created or found"}},required:["status"]}}}},400:{description:"Invalid OTP"}}}}},async e=>{let t=await e.context.internalAdapter.findVerificationValue(e.body.phoneNumber);if(!t||t.expiresAt<new Date){if(t&&t.expiresAt<new Date)throw new nh("BAD_REQUEST",{message:"OTP expired"});throw new nh("BAD_REQUEST",{message:u1.OTP_NOT_FOUND})}let[r,n]=t.value.split(":"),i=ed?.allowedAttempts||3;if(n&&parseInt(n)>=i)throw await e.context.internalAdapter.deleteVerificationValue(t.id),new nh("FORBIDDEN",{message:"Too many attempts"});if(r!==e.body.code)throw await e.context.internalAdapter.updateVerificationValue(t.id,{value:`${r}:${parseInt(n||"0")+1}`}),new nh("BAD_REQUEST",{message:"Invalid OTP"});if(await e.context.internalAdapter.deleteVerificationValue(t.id),e.body.updatePhoneNumber){let t=await ag(e);if(!t)throw new nh("UNAUTHORIZED",{message:ni.USER_NOT_FOUND});if((await e.context.adapter.findMany({model:"user",where:[{field:"phoneNumber",value:e.body.phoneNumber}]})).length)throw e.error("BAD_REQUEST",{message:u1.PHONE_NUMBER_EXIST});let r=await e.context.internalAdapter.updateUser(t.user.id,{[y.phoneNumber]:e.body.phoneNumber,[y.phoneNumberVerified]:!0},e);return e.json({status:!0,token:t.session.token,user:{id:r.id,email:r.email,emailVerified:r.emailVerified,name:r.name,image:r.image,phoneNumber:r.phoneNumber,phoneNumberVerified:r.phoneNumberVerified,createdAt:r.createdAt,updatedAt:r.updatedAt}})}let o=await e.context.adapter.findOne({model:"user",where:[{value:e.body.phoneNumber,field:y.phoneNumber}]});if(o)o=await e.context.internalAdapter.updateUser(o.id,{[y.phoneNumberVerified]:!0},e);else if(ed?.signUpOnVerification&&!(o=await e.context.internalAdapter.createUser({email:ed.signUpOnVerification.getTempEmail(e.body.phoneNumber),name:ed.signUpOnVerification.getTempName?ed.signUpOnVerification.getTempName(e.body.phoneNumber):e.body.phoneNumber,[y.phoneNumber]:e.body.phoneNumber,[y.phoneNumberVerified]:!0},e)))throw new nh("INTERNAL_SERVER_ERROR",{message:ni.FAILED_TO_CREATE_USER});if(!o)throw new nh("INTERNAL_SERVER_ERROR",{message:ni.FAILED_TO_UPDATE_USER});if(await ed?.callbackOnVerification?.({phoneNumber:e.body.phoneNumber,user:o},e.request),!e.body.disableSession){let t=await e.context.internalAdapter.createSession(o.id,e);if(!t)throw new nh("INTERNAL_SERVER_ERROR",{message:ni.FAILED_TO_CREATE_SESSION});return await o0(e,{session:t,user:o}),e.json({status:!0,token:t.token,user:{id:o.id,email:o.email,emailVerified:o.emailVerified,name:o.name,image:o.image,phoneNumber:o.phoneNumber,phoneNumberVerified:o.phoneNumberVerified,createdAt:o.createdAt,updatedAt:o.updatedAt}})}return e.json({status:!0,token:null,user:{id:o.id,email:o.email,emailVerified:o.emailVerified,name:o.name,image:o.image,phoneNumber:o.phoneNumber,phoneNumberVerified:o.phoneNumberVerified,createdAt:o.createdAt,updatedAt:o.updatedAt}})}),forgetPasswordPhoneNumber:o6("/phone-number/forget-password",{method:"POST",body:oM.object({phoneNumber:oM.string().meta({description:'The phone number which is associated with the user. Eg: "+1234567890"'})}),metadata:{openapi:{description:"Request OTP for password reset via phone number",responses:{200:{description:"OTP sent successfully for password reset",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the OTP was sent successfully",enum:[!0]}},required:["status"]}}}}}}}},async e=>{if(!await e.context.adapter.findOne({model:"user",where:[{value:e.body.phoneNumber,field:y.phoneNumber}]}))throw new nh("BAD_REQUEST",{message:"phone number isn't registered"});let t=u2(y.otpLength);return await e.context.internalAdapter.createVerificationValue({value:`${t}:0`,identifier:`${e.body.phoneNumber}-request-password-reset`,expiresAt:oq(y.expiresIn,"sec")},e),await ed?.sendForgetPasswordOTP?.({phoneNumber:e.body.phoneNumber,code:t},e.request),e.json({status:!0})}),requestPasswordResetPhoneNumber:o6("/phone-number/request-password-reset",{method:"POST",body:oM.object({phoneNumber:oM.string()}),metadata:{openapi:{description:"Request OTP for password reset via phone number",responses:{200:{description:"OTP sent successfully for password reset",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the OTP was sent successfully",enum:[!0]}},required:["status"]}}}}}}}},async e=>{if(!await e.context.adapter.findOne({model:"user",where:[{value:e.body.phoneNumber,field:y.phoneNumber}]}))throw new nh("BAD_REQUEST",{message:"phone number isn't registered"});let t=u2(y.otpLength);return await e.context.internalAdapter.createVerificationValue({value:`${t}:0`,identifier:`${e.body.phoneNumber}-request-password-reset`,expiresAt:oq(y.expiresIn,"sec")},e),await ed?.sendPasswordResetOTP?.({phoneNumber:e.body.phoneNumber,code:t},e.request),e.json({status:!0})}),resetPasswordPhoneNumber:o6("/phone-number/reset-password",{method:"POST",body:oM.object({otp:oM.string().meta({description:'The one time password to reset the password. Eg: "123456"'}),phoneNumber:oM.string().meta({description:'The phone number to the account which intends to reset the password for. Eg: "+1234567890"'}),newPassword:oM.string().meta({description:'The new password. Eg: "new-and-secure-password"'})}),metadata:{openapi:{description:"Reset password using phone number OTP",responses:{200:{description:"Password reset successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the password was reset successfully",enum:[!0]}},required:["status"]}}}}}}}},async e=>{let t=await e.context.internalAdapter.findVerificationValue(`${e.body.phoneNumber}-request-password-reset`);if(!t)throw new nh("BAD_REQUEST",{message:u1.OTP_NOT_FOUND});if(t.expiresAt<new Date)throw new nh("BAD_REQUEST",{message:u1.OTP_EXPIRED});let[r,n]=t.value.split(":"),i=ed?.allowedAttempts||3;if(n&&parseInt(n)>=i)throw await e.context.internalAdapter.deleteVerificationValue(t.id),new nh("FORBIDDEN",{message:"Too many attempts"});if(e.body.otp!==r)throw await e.context.internalAdapter.updateVerificationValue(t.id,{value:`${r}:${parseInt(n||"0")+1}`}),new nh("BAD_REQUEST",{message:u1.INVALID_OTP});let o=await e.context.adapter.findOne({model:"user",where:[{field:"phoneNumber",value:e.body.phoneNumber}]});if(!o)throw new nh("BAD_REQUEST",{message:u1.UNEXPECTED_ERROR});let a=await e.context.password.hash(e.body.newPassword);return await e.context.internalAdapter.updatePassword(o.id,a),await e.context.internalAdapter.deleteVerificationValue(t.id),e.json({status:!0})})},schema:aP({user:{fields:{phoneNumber:{type:"string",required:!1,unique:!0,sortable:!0,returned:!0},phoneNumberVerified:{type:"boolean",required:!1,returned:!0,input:!1}}}},ed?.schema),rateLimit:[{pathMatcher:e=>e.startsWith("/phone-number"),window:6e4,max:10}],$ERROR_CODES:u1})],advanced:{database:{generateId:()=>crypto.randomUUID()}}});var pj=e.i(955207);let p$=pD.env.PORTONE_WEBHOOK_ALLOWED_IPS.split(",").map(e=>e.trim()).filter(Boolean);async function pM(e){let{nextUrl:t}=e,r=await pL.api.getSession({headers:e.headers}),n=!!r,i=r?.user?.role,o=t.pathname.startsWith("/auth"),a="/"===t.pathname||"/about"===t.pathname||"/services"===t.pathname||"/contact"===t.pathname||"/terms"===t.pathname||"/error-report"===t.pathname,s=t.pathname.startsWith("/api"),c=t.pathname.startsWith("/admin"),d=t.pathname.startsWith("/groomer"),l=t.pathname.startsWith("/customer"),u=t.pathname.startsWith("/dashboard"),p=t.pathname.startsWith("/auth/verify-phone");if(t.pathname.startsWith("/api/v1/webhooks/portone")){let t,r,n,i=(t=e.headers.get("x-forwarded-for"),r=e.headers.get("x-real-ip"),n=e.headers.get("x-client-ip"),t?t.split(",")[0].trim():r?r.trim():n?n.trim():null);return(console.log(`[Webhook] Incoming request from IP: ${i}`),console.log("[Webhook] Headers:",{"x-forwarded-for":e.headers.get("x-forwarded-for"),"x-real-ip":e.headers.get("x-real-ip"),"x-client-ip":e.headers.get("x-client-ip")}),"development"===pD.env.NODE_ENV)?(console.log("[Webhook] Development mode - allowing all IPs"),pj.NextResponse.next()):i?p$.includes(i)?(console.log(`[Webhook] Allowed request from IP: ${i}`),pj.NextResponse.next()):(console.error(`[Webhook] Blocked request from unauthorized IP: ${i}`),new pj.NextResponse(JSON.stringify({error:"Forbidden"}),{status:403,headers:{"content-type":"application/json"}})):(console.warn("[Webhook] Could not determine client IP, allowing request"),pj.NextResponse.next())}if(s||a||p)return pj.NextResponse.next();if(!n&&!o){let e=t.pathname+t.search;return pj.NextResponse.redirect(new URL(`/auth/signin?callbackUrl=${encodeURIComponent(e)}`,t))}if(n&&o||n&&u&&"/dashboard"===t.pathname)switch(i){case"ADMIN":return pj.NextResponse.redirect(new URL("/admin/dashboard/overview",t));case"GROOMER":return pj.NextResponse.redirect(new URL("/groomer/dashboard/overview",t));case"CUSTOMER":return pj.NextResponse.redirect(new URL("/customer/dashboard/overview",t));default:return pj.NextResponse.redirect(new URL("/",t))}return n&&(c&&"ADMIN"!==i||d&&"GROOMER"!==i&&"ADMIN"!==i||l&&"CUSTOMER"!==i&&"ADMIN"!==i)?pj.NextResponse.redirect(new URL("/unauthorized",t)):pj.NextResponse.next()}e.s(["config",0,{matcher:["/((?!_next/static|_next/image|favicon.ico|icon.svg|logo.*|manifest.json|robots.txt|sitemap.xml|sw.js|workbox-.*|api/health).*)"]},"proxy",()=>pM],322685);var pq=e.i(322685);Object.values({NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401});let pV={...pq},pB="/proxy",pz=pV.proxy||pV.default;if("function"!=typeof pz)throw new class extends Error{constructor(e){super(e),this.stack=""}}(`The Proxy file "${pB}" must export a function named \`proxy\` or a default function.`);function pW(e){return tE({...e,page:pB,handler:async(...e)=>{try{return await pz(...e)}catch(i){let t=e[0],r=new URL(t.url),n=r.pathname+r.search;throw await v(i,{path:n,method:t.method,headers:Object.fromEntries(t.headers.entries())},{routerKind:"Pages Router",routePath:"/proxy",routeType:"proxy",revalidateReason:void 0}),i}}})}e.s(["default",()=>pW],489997)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__96fabb5d._.js.map