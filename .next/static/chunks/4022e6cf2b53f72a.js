(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,522524,e=>{"use strict";var s=e.i(843476),r=e.i(271645),a=e.i(613846),t=e.i(266027),l=e.i(108240),i=e.i(653145),n=e.i(994814),c=e.i(515288),d=e.i(519455),o=e.i(257428),m=e.i(93814),x=e.i(793479),u=e.i(110204),h=e.i(981140),p=e.i(820783),j=e.i(30030),g=e.i(248425),v=e.i(842727),N=e.i(369340),b=e.i(586318),f=e.i(635804),y=e.i(999682),C=e.i(296626),k="Radio",[w,A]=(0,j.createContextScope)(k),[S,z]=w(k),I=r.forwardRef((e,a)=>{let{__scopeRadio:t,name:l,checked:i=!1,required:n,disabled:c,value:d="on",onCheck:o,form:m,...x}=e,[u,j]=r.useState(null),v=(0,p.useComposedRefs)(a,e=>j(e)),N=r.useRef(!1),b=!u||m||!!u.closest("form");return(0,s.jsxs)(S,{scope:t,checked:i,disabled:c,children:[(0,s.jsx)(g.Primitive.button,{type:"button",role:"radio","aria-checked":i,"data-state":L(i),"data-disabled":c?"":void 0,disabled:c,value:d,...x,ref:v,onClick:(0,h.composeEventHandlers)(e.onClick,e=>{i||o?.(),b&&(N.current=e.isPropagationStopped(),N.current||e.stopPropagation())})}),b&&(0,s.jsx)(P,{control:u,bubbles:!N.current,name:l,value:d,checked:i,required:n,disabled:c,form:m,style:{transform:"translateX(-100%)"}})]})});I.displayName=k;var R="RadioIndicator",E=r.forwardRef((e,r)=>{let{__scopeRadio:a,forceMount:t,...l}=e,i=z(R,a);return(0,s.jsx)(C.Presence,{present:t||i.checked,children:(0,s.jsx)(g.Primitive.span,{"data-state":L(i.checked),"data-disabled":i.disabled?"":void 0,...l,ref:r})})});E.displayName=R;var P=r.forwardRef(({__scopeRadio:e,control:a,checked:t,bubbles:l=!0,...i},n)=>{let c=r.useRef(null),d=(0,p.useComposedRefs)(c,n),o=(0,y.usePrevious)(t),m=(0,f.useSize)(a);return r.useEffect(()=>{let e=c.current;if(!e)return;let s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(o!==t&&s){let r=new Event("click",{bubbles:l});s.call(e,t),e.dispatchEvent(r)}},[o,t,l]),(0,s.jsx)(g.Primitive.input,{type:"radio","aria-hidden":!0,defaultChecked:t,...i,tabIndex:-1,ref:d,style:{...i.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});function L(e){return e?"checked":"unchecked"}P.displayName="RadioBubbleInput";var T=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],F="RadioGroup",[D,H]=(0,j.createContextScope)(F,[v.createRovingFocusGroupScope,A]),O=(0,v.createRovingFocusGroupScope)(),K=A(),[$,_]=D(F),B=r.forwardRef((e,r)=>{let{__scopeRadioGroup:a,name:t,defaultValue:l,value:i,required:n=!1,disabled:c=!1,orientation:d,dir:o,loop:m=!0,onValueChange:x,...u}=e,h=O(a),p=(0,b.useDirection)(o),[j,f]=(0,N.useControllableState)({prop:i,defaultProp:l??null,onChange:x,caller:F});return(0,s.jsx)($,{scope:a,name:t,required:n,disabled:c,value:j,onValueChange:f,children:(0,s.jsx)(v.Root,{asChild:!0,...h,orientation:d,dir:p,loop:m,children:(0,s.jsx)(g.Primitive.div,{role:"radiogroup","aria-required":n,"aria-orientation":d,"data-disabled":c?"":void 0,dir:p,...u,ref:r})})})});B.displayName=F;var M="RadioGroupItem",V=r.forwardRef((e,a)=>{let{__scopeRadioGroup:t,disabled:l,...i}=e,n=_(M,t),c=n.disabled||l,d=O(t),o=K(t),m=r.useRef(null),x=(0,p.useComposedRefs)(a,m),u=n.value===i.value,j=r.useRef(!1);return r.useEffect(()=>{let e=e=>{T.includes(e.key)&&(j.current=!0)},s=()=>j.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",s),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",s)}},[]),(0,s.jsx)(v.Item,{asChild:!0,...d,focusable:!c,active:u,children:(0,s.jsx)(I,{disabled:c,required:n.required,checked:u,...o,...i,name:n.name,ref:x,onCheck:()=>n.onValueChange(i.value),onKeyDown:(0,h.composeEventHandlers)(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:(0,h.composeEventHandlers)(i.onFocus,()=>{j.current&&m.current?.click()})})})});V.displayName=M;var G=r.forwardRef((e,r)=>{let{__scopeRadioGroup:a,...t}=e,l=K(a);return(0,s.jsx)(E,{...l,...t,ref:r})});G.displayName="RadioGroupIndicator";var q=e.i(733498),Y=e.i(975157);function U({className:e,...r}){return(0,s.jsx)(B,{"data-slot":"radio-group",className:(0,Y.cn)("grid gap-3",e),...r})}function J({className:e,...r}){return(0,s.jsx)(V,{"data-slot":"radio-group-item",className:(0,Y.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",e),...r,children:(0,s.jsx)(G,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,s.jsx)(q.CircleIcon,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var W=e.i(967489),Q=e.i(754473),X=e.i(475254);let Z=(0,X.default)("banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]);var ee=e.i(365452),ee=ee,es=e.i(899237),er=e.i(328196),ea=e.i(681307);let et=ea.z.object({type:ea.z.enum(["CARD","BANK_TRANSFER","DIGITAL_WALLET"]),cardNumber:ea.z.string().optional(),expiryDate:ea.z.string().optional(),cvv:ea.z.string().optional(),cardHolderName:ea.z.string().optional(),bankCode:ea.z.string().optional(),accountNumber:ea.z.string().optional(),walletProvider:ea.z.enum(["KAKAO_PAY","TOSS_PAY","NAVER_PAY"]).optional()}),el=ea.z.object({name:ea.z.string().min(1,"이름을 입력해주세요"),phone:ea.z.string().min(1,"연락처를 입력해주세요"),address:ea.z.string().min(1,"주소를 입력해주세요"),detailAddress:ea.z.string().optional(),zipCode:ea.z.string().min(5,"우편번호를 입력해주세요")}),ei=ea.z.object({bookingId:ea.z.string(),services:ea.z.array(ea.z.object({id:ea.z.string(),name:ea.z.string(),price:ea.z.number(),duration:ea.z.number()})),totalAmount:ea.z.number().positive("결제 금액이 올바르지 않습니다"),discountAmount:ea.z.number().optional().default(0),finalAmount:ea.z.number().positive(),paymentMethod:et,billingAddress:el,couponCode:ea.z.string().optional(),agreeToTerms:ea.z.boolean().refine(e=>!0===e,{message:"이용약관에 동의해주세요"}),agreeToPrivacy:ea.z.boolean().refine(e=>!0===e,{message:"개인정보 처리방침에 동의해주세요"})});ea.z.object({bookingId:ea.z.string(),reason:ea.z.enum(["CUSTOMER_REQUEST","GROOMER_CANCELLATION","SALON_CLOSURE","FORCE_MAJEURE","OTHER"]),customReason:ea.z.string().optional(),refundAmount:ea.z.number().positive(),bankAccount:ea.z.object({bankCode:ea.z.string(),accountNumber:ea.z.string(),accountHolder:ea.z.string()}).optional()});let en=ea.z.object({code:ea.z.string().min(1,"쿠폰 코드를 입력해주세요"),bookingAmount:ea.z.number().positive()}),ec=[{id:"CARD",label:"신용/체크카드",description:"안전한 카드 결제",icon:Q.CreditCardIcon,color:"blue"},{id:"DIGITAL_WALLET",label:"간편결제",description:"카카오페이, 토스페이, 네이버페이",icon:ee.default,color:"green"},{id:"BANK_TRANSFER",label:"계좌이체",description:"실시간 계좌이체",icon:Z,color:"purple"}],ed=[{value:"KAKAO_PAY",label:"카카오페이"},{value:"TOSS_PAY",label:"토스페이"},{value:"NAVER_PAY",label:"네이버페이"}],eo=[{value:"004",label:"KB국민은행"},{value:"011",label:"NH농협은행"},{value:"020",label:"우리은행"},{value:"088",label:"신한은행"},{value:"081",label:"하나은행"},{value:"027",label:"씨티은행"},{value:"003",label:"IBK기업은행"},{value:"007",label:"수협은행"},{value:"023",label:"SC제일은행"},{value:"039",label:"경남은행"}];function em({selectedMethod:e,onMethodChange:a,className:t}){let[l,d]=(0,r.useState)(e?.type||""),{register:o,setValue:m,formState:{errors:h}}=(0,i.useForm)({resolver:(0,n.zodResolver)(et),defaultValues:e||{type:"CARD"}});return(0,s.jsx)("div",{className:(0,Y.cn)("space-y-6",t),children:(0,s.jsxs)(c.Card,{children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsxs)(c.CardTitle,{className:"flex items-center space-x-2",children:[(0,s.jsx)(es.ShieldCheckIcon,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"결제 방법 선택"})]})}),(0,s.jsx)(c.CardContent,{className:"space-y-6",children:(0,s.jsx)(U,{value:l,onValueChange:e=>{d(e),m("type",e),a({type:e}),m("cardNumber",void 0),m("expiryDate",void 0),m("cvv",void 0),m("cardHolderName",void 0),m("bankCode",void 0),m("accountNumber",void 0),m("walletProvider",void 0)},className:"space-y-4",children:ec.map(e=>{let r=e.icon;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(J,{value:e.id,id:e.id}),(0,s.jsxs)("label",{htmlFor:e.id,className:"flex flex-1 cursor-pointer items-center space-x-3",children:[(0,s.jsx)("div",{className:(0,Y.cn)("rounded-lg p-2","blue"===e.color&&"bg-blue-100 text-blue-600","green"===e.color&&"bg-green-100 text-green-600","purple"===e.color&&"bg-purple-100 text-purple-600"),children:(0,s.jsx)(r,{className:"h-5 w-5"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.label}),(0,s.jsx)("div",{className:"text-muted-foreground text-sm",children:e.description})]})]})]}),l===e.id&&(0,s.jsxs)("div",{className:"bg-muted ml-8 space-y-4 rounded-lg p-4",children:["CARD"===e.id&&(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)(u.Label,{htmlFor:"cardNumber",children:"카드번호"}),(0,s.jsx)(x.Input,{id:"cardNumber",placeholder:"1234 5678 9012 3456",maxLength:19,...o("cardNumber"),onChange:e=>{m("cardNumber",(e=>{let s=e.replace(/\s+/g,"").replace(/[^0-9]/gi,""),r=s.match(/\d{4,16}/g),a=r&&r[0]||"",t=[];for(let e=0,s=a.length;e<s;e+=4)t.push(a.substring(e,e+4));return t.length?t.join(" "):s})(e.target.value))}}),h.cardNumber&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.cardNumber.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"expiryDate",children:"유효기간"}),(0,s.jsx)(x.Input,{id:"expiryDate",placeholder:"MM/YY",maxLength:5,...o("expiryDate"),onChange:e=>{let s;m("expiryDate",(s=e.target.value.replace(/\D/g,"")).length>=2?s.substring(0,2)+"/"+s.substring(2,4):s)}}),h.expiryDate&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.expiryDate.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"cvv",children:"CVV"}),(0,s.jsx)(x.Input,{id:"cvv",placeholder:"123",maxLength:4,...o("cvv")}),h.cvv&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.cvv.message})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)(u.Label,{htmlFor:"cardHolderName",children:"카드 소유자명"}),(0,s.jsx)(x.Input,{id:"cardHolderName",placeholder:"홍길동",...o("cardHolderName")}),h.cardHolderName&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.cardHolderName.message})]})]}),"DIGITAL_WALLET"===e.id&&(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"walletProvider",children:"간편결제 선택"}),(0,s.jsxs)(W.Select,{onValueChange:e=>m("walletProvider",e),children:[(0,s.jsx)(W.SelectTrigger,{children:(0,s.jsx)(W.SelectValue,{placeholder:"간편결제를 선택해주세요"})}),(0,s.jsx)(W.SelectContent,{children:ed.map(e=>(0,s.jsx)(W.SelectItem,{value:e.value,children:e.label},e.value))})]}),h.walletProvider&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.walletProvider.message})]}),"BANK_TRANSFER"===e.id&&(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"bankCode",children:"은행 선택"}),(0,s.jsxs)(W.Select,{onValueChange:e=>m("bankCode",e),children:[(0,s.jsx)(W.SelectTrigger,{children:(0,s.jsx)(W.SelectValue,{placeholder:"은행을 선택해주세요"})}),(0,s.jsx)(W.SelectContent,{children:eo.map(e=>(0,s.jsx)(W.SelectItem,{value:e.value,children:e.label},e.value))})]}),h.bankCode&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.bankCode.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"accountNumber",children:"계좌번호"}),(0,s.jsx)(x.Input,{id:"accountNumber",placeholder:"계좌번호를 입력해주세요",...o("accountNumber")}),h.accountNumber&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.accountNumber.message})]})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-2 rounded-lg border border-blue-200 bg-blue-50 p-3",children:[(0,s.jsx)(er.AlertCircleIcon,{className:"mt-0.5 h-5 w-5 flex-shrink-0 text-blue-600"}),(0,s.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,s.jsx)("p",{className:"font-medium",children:"보안 안내"}),(0,s.jsx)("p",{className:"mt-1",children:"결제 정보는 SSL 암호화로 안전하게 보호되며, 당사는 결제 정보를 저장하지 않습니다."})]})]})]})]},e.id)})})})]})})}var ex=e.i(772436),eu=e.i(487486),eh=e.i(571509),ep=e.i(531447);let ej=(0,X.default)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),eg=(0,X.default)("percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);var ev=e.i(107649);function eN({services:e,couponDiscount:a,onCouponApply:t,onCouponRemove:l,className:o}){let[m,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),{register:j,handleSubmit:g,formState:{errors:v},reset:N}=(0,i.useForm)({resolver:(0,n.zodResolver)(en)}),b=e.reduce((e,s)=>e+s.price,0),f=a?.discountAmount||0,y=b-f,C=e.reduce((e,s)=>e+s.duration,0),k=async e=>{u(!0),p(null);try{await t({...e,bookingAmount:b})?N():p("유효하지 않은 쿠폰 코드입니다")}catch{p("쿠폰 적용 중 오류가 발생했습니다")}finally{u(!1)}};return(0,s.jsx)("div",{className:(0,Y.cn)("space-y-6",o),children:(0,s.jsxs)(c.Card,{children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsxs)(c.CardTitle,{className:"flex items-center space-x-2",children:[(0,s.jsx)(Q.CreditCardIcon,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"결제 요약"})]})}),(0,s.jsxs)(c.CardContent,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h4",{className:"text-muted-foreground text-sm font-medium",children:"선택된 서비스"}),e.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between py-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"bg-primary/10 rounded-lg p-2",children:(0,s.jsx)(eh.ScissorsIcon,{className:"text-primary h-4 w-4"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:e.name}),(0,s.jsxs)("div",{className:"text-muted-foreground mt-1 flex items-center space-x-4 text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)(ep.ClockIcon,{className:"h-3 w-3"}),(0,s.jsxs)("span",{children:[e.duration,"분"]})]}),(0,s.jsx)(eu.Badge,{variant:"outline",className:"text-xs",children:e.category})]})]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsxs)("div",{className:"font-medium",children:[e.price.toLocaleString(),"원"]})})]},e.id))]}),(0,s.jsx)(ex.Separator,{}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("h4",{className:"text-muted-foreground flex items-center space-x-2 text-sm font-medium",children:[(0,s.jsx)(ej,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:"할인 쿠폰"})]}),a?(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-green-200 bg-green-50 p-3",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(ev.CheckCircleIcon,{className:"h-5 w-5 text-green-600"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"font-medium text-green-900",children:["쿠폰 적용 완료: ",a.code]}),(0,s.jsx)("div",{className:"text-sm text-green-700",children:"PERCENTAGE"===a.discountType?`${a.discountAmount}% 할인`:`${a.discountAmount.toLocaleString("ko-KR")}원 할인`})]})]}),(0,s.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>{l(),p(null)},className:"border-green-300 text-green-700 hover:bg-green-100",children:"제거"})]}):(0,s.jsxs)("form",{onSubmit:g(k),className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(x.Input,{placeholder:"쿠폰 코드를 입력해주세요",...j("code")}),v.code&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:v.code.message})]}),(0,s.jsx)(d.Button,{type:"submit",disabled:m,className:"px-6",children:m?"확인 중...":"적용"})]}),h&&(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-red-600",children:[(0,s.jsx)(er.AlertCircleIcon,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:h})]})]})]}),(0,s.jsx)(ex.Separator,{}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:"서비스 소계"}),(0,s.jsxs)("span",{children:[b.toLocaleString("ko-KR"),"원"]})]}),f>0&&(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm text-green-600",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,s.jsx)(eg,{className:"h-3 w-3"}),(0,s.jsx)("span",{children:"할인 금액"})]}),(0,s.jsxs)("span",{children:["-",f.toLocaleString("ko-KR"),"원"]})]}),(0,s.jsx)(ex.Separator,{}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-lg font-semibold",children:[(0,s.jsx)("span",{children:"총 결제금액"}),(0,s.jsxs)("span",{className:"text-primary",children:[y.toLocaleString("ko-KR"),"원"]})]}),(0,s.jsxs)("div",{className:"text-muted-foreground flex items-center justify-center text-sm",children:[(0,s.jsx)(ep.ClockIcon,{className:"mr-1 h-4 w-4"}),(0,s.jsxs)("span",{children:["예상 소요시간: ",C,"분"]})]})]}),(0,s.jsx)("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,s.jsx)(er.AlertCircleIcon,{className:"mt-0.5 h-5 w-5 flex-shrink-0 text-blue-600"}),(0,s.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,s.jsx)("p",{className:"font-medium",children:"결제 안내"}),(0,s.jsxs)("ul",{className:"mt-2 list-inside list-disc space-y-1",children:[(0,s.jsx)("li",{children:"예약 확정 후 24시간 전까지 무료 취소 가능합니다"}),(0,s.jsx)("li",{children:"당일 취소 시 취소 수수료가 발생할 수 있습니다"}),(0,s.jsx)("li",{children:"결제 후 영수증은 이메일로 발송됩니다"})]})]})]})})]})]})})}e.i(247167);var eb=e.i(972985),ef=e.i(988846);function ey({defaultValues:e,onAddressChange:r,className:a}){let{register:t,handleSubmit:l,setValue:o,watch:m,formState:{errors:h,isValid:p}}=(0,i.useForm)({resolver:(0,n.zodResolver)(el),defaultValues:e||{},mode:"onChange"});m();let j=e=>{r(e)},g=()=>{p&&l(j)()};return(0,s.jsx)("div",{className:(0,Y.cn)("space-y-6",a),children:(0,s.jsxs)(c.Card,{children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsxs)(c.CardTitle,{className:"flex items-center space-x-2",children:[(0,s.jsx)(eb.MapPinIcon,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"청구서 배송 주소"})]})}),(0,s.jsx)(c.CardContent,{children:(0,s.jsxs)("form",{onSubmit:l(j),className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"name",children:"이름 *"}),(0,s.jsx)(x.Input,{id:"name",placeholder:"홍길동",...t("name"),onChange:e=>{t("name").onChange(e),setTimeout(g,100)}}),h.name&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.name.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"phone",children:"연락처 *"}),(0,s.jsx)(x.Input,{id:"phone",placeholder:"010-1234-5678",...t("phone"),onChange:e=>{let s;o("phone",(s=e.target.value.replace(/[^\d]/g,"")).length<=3?s:s.length<=7?`${s.slice(0,3)}-${s.slice(3)}`:`${s.slice(0,3)}-${s.slice(3,7)}-${s.slice(7,11)}`),setTimeout(g,100)}}),h.phone&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.phone.message})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"zipCode",children:"우편번호 *"}),(0,s.jsx)(x.Input,{id:"zipCode",placeholder:"12345",maxLength:5,...t("zipCode"),onChange:e=>{t("zipCode").onChange(e),setTimeout(g,100)}}),h.zipCode&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.zipCode.message})]}),(0,s.jsxs)("div",{className:"flex space-x-2 md:col-span-2",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(u.Label,{htmlFor:"address",children:"주소 *"}),(0,s.jsx)(x.Input,{id:"address",placeholder:"기본 주소",readOnly:!0,...t("address"),className:"bg-muted"}),h.address&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.address.message})]}),(0,s.jsx)("div",{className:"flex items-end",children:(0,s.jsxs)(d.Button,{type:"button",variant:"outline",onClick:()=>{console.log("주소 검색 API 호출")},className:"px-3",children:[(0,s.jsx)(ef.SearchIcon,{className:"mr-1 h-4 w-4"}),"검색"]})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(u.Label,{htmlFor:"detailAddress",children:"상세 주소"}),(0,s.jsx)(x.Input,{id:"detailAddress",placeholder:"동, 호수 등 상세 주소를 입력해주세요",...t("detailAddress"),onChange:e=>{t("detailAddress").onChange(e),setTimeout(g,100)}}),h.detailAddress&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:h.detailAddress.message})]}),(0,s.jsx)("div",{className:"rounded-lg border border-blue-200 bg-blue-50 p-4",children:(0,s.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,s.jsx)("p",{className:"font-medium",children:"주소 입력 안내"}),(0,s.jsxs)("ul",{className:"mt-2 list-inside list-disc space-y-1",children:[(0,s.jsx)("li",{children:"우편번호를 입력하거나 주소 검색 버튼을 클릭해주세요"}),(0,s.jsx)("li",{children:"정확한 주소 입력으로 빠른 서비스 이용이 가능합니다"}),(0,s.jsx)("li",{children:"청구서는 입력하신 주소로 발송됩니다"})]})]})}),!1]})})]})})}var eC=e.i(797239),ek=e.i(516430);function ew({params:e}){let x=(0,r.use)(e),u=(0,a.useRouter)(),[h,p]=(0,r.useState)(!1),[j,g]=(0,r.useState)(null),[v,N]=(0,r.useState)(null),[b,f]=(0,r.useState)(null),[y,C]=(0,r.useState)(!1),[k,w]=(0,r.useState)(!1),{requestPayment:A,isLoading:S,error:z,clearError:I}=(0,l.usePayment)(),{handleSubmit:R,formState:{}}=(0,i.useForm)({resolver:(0,n.zodResolver)(ei),mode:"onChange"}),{data:E,isLoading:P,isError:L}=(0,t.useQuery)({queryKey:["customer","bookings",x.id],queryFn:async()=>{let e=await fetch(`/api/customer/bookings/${x.id}`);if(!e.ok)throw Error("예약 정보를 불러올 수 없습니다");return e.json()},enabled:!!x.id});(0,r.useEffect)(()=>{L&&u.push("/customer/bookings")},[L,u]);let T=async e=>{try{let s=await fetch("/api/coupons/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)return!1;let r=await s.json();return f(r),!0}catch(e){return console.error("Error applying coupon:",e),!1}},F=async()=>{if(E&&j&&v){p(!0);try{let e=E.services.reduce((e,s)=>e+s.price,0),s=b?.discountAmount||0,r=e-s,a=await fetch("/api/payments/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bookingId:E.id,amount:r,orderName:`${E.pet.name} 미용 서비스`})});if(!a.ok)throw Error("결제 초기화에 실패했습니다");let t=await a.json(),l={amount:r,orderName:t.orderName,orderId:t.paymentId,customerName:t.customerName||v.name,customerEmail:t.customerEmail||"",customerPhone:t.customerPhone||v.phone||"",payMethod:j.type,storeId:t.storeId,channelKey:t.channelKey,customData:{bookingId:E.id,services:E.services.map(e=>({id:e.id,name:e.name,price:e.price})),originalAmount:e,discountAmount:s,finalAmount:r}};console.log("[Payment] Requesting payment via usePayment hook:",l);let i=await A(l);if(i.success){let e=0,s=!1,r=null;for(console.log("[Payment] Starting payment verification polling...");e<30&&!s;)try{let a=await fetch(`/api/payments/verify/${t.paymentId}`,{method:"GET"});if(a.ok){let l=await a.json();if(console.log(`[Payment] Attempt ${e+1}/30: Status = ${l.status}`),l.success){s=!0,console.log("[Payment] Payment verified successfully!"),u.push(`/customer/booking/${E.id}/payment/success?payment=${t.paymentId}`);break}if("FAILED"===l.status||"CANCELLED"===l.status){r=l.error||`결제가 ${"FAILED"===l.status?"실패":"취소"}되었습니다`;break}"PENDING"===l.status&&console.log("[Payment] Payment still pending, continuing to poll...")}else if(404===a.status)console.log(`[Payment] Attempt ${e+1}/30: Payment not found, waiting for webhook...`);else throw Error("서버 결제 검증 실패");e<29&&!s&&await new Promise(e=>setTimeout(e,1e3)),e++}catch(s){if(console.error(`[Payment] Verification attempt ${e+1} failed:`,s),e<29)await new Promise(e=>setTimeout(e,1e3)),e++;else{r=s instanceof Error?s.message:"결제 확인 중 오류가 발생했습니다";break}}if(!s){if(e>=30)throw Error("결제 확인 시간이 초과되었습니다. 고객센터에 문의해주세요.");else if(r)throw Error(r)}}else if(i.cancelled)console.log("[Payment] Payment was cancelled by user");else throw Error(i.error||"결제에 실패했습니다")}catch(s){console.error("Payment error:",s);let e=s instanceof Error?s.message:"알 수 없는 오류가 발생했습니다";alert(`결제 처리 중 오류가 발생했습니다: ${e}`)}finally{p(!1)}}},D=()=>j&&v&&y&&k;return P?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"space-y-4 text-center",children:[(0,s.jsx)(m.LoadingSpinner,{size:"lg"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"결제 정보를 불러오는 중..."})]})})})}):E?(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"mx-auto max-w-6xl",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)(d.Button,{variant:"ghost",onClick:()=>u.back(),className:"mb-4",children:[(0,s.jsx)(ek.ArrowLeftIcon,{className:"mr-2 h-4 w-4"}),"이전으로"]}),(0,s.jsxs)("div",{className:"mb-2 flex items-center space-x-3",children:[(0,s.jsx)(Q.CreditCardIcon,{className:"text-primary h-6 w-6"}),(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"결제하기"})]}),(0,s.jsxs)("div",{className:"text-muted-foreground",children:[E.pet.name,"의 기본 미용 서비스 결제 (추가 서비스는 현장에서 결제)"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-8 lg:grid-cols-3",children:[(0,s.jsxs)("div",{className:"space-y-6 lg:col-span-2",children:[(0,s.jsxs)(c.Card,{children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsx)(c.CardTitle,{children:"예약 정보"})}),(0,s.jsx)(c.CardContent,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-4 text-sm md:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"반려동물"}),(0,s.jsxs)("div",{className:"text-muted-foreground",children:[E.pet.name," (",E.pet.species,")"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"미용사"}),(0,s.jsxs)("div",{className:"text-muted-foreground",children:[E.groomer.name," - ",E.groomer.salon]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"예약 날짜"}),(0,s.jsx)("div",{className:"text-muted-foreground",children:E.scheduledDate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium",children:"예약 시간"}),(0,s.jsx)("div",{className:"text-muted-foreground",children:E.scheduledTime})]})]})})]}),(0,s.jsx)(em,{selectedMethod:j,onMethodChange:g}),(0,s.jsx)(ey,{onAddressChange:N}),(0,s.jsxs)(c.Card,{children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsxs)(c.CardTitle,{className:"flex items-center space-x-2",children:[(0,s.jsx)(es.ShieldCheckIcon,{className:"h-5 w-5 text-blue-600"}),(0,s.jsx)("span",{children:"결제 안내"})]})}),(0,s.jsx)(c.CardContent,{children:(0,s.jsx)("div",{className:"mb-4 rounded-lg bg-blue-50 p-4",children:(0,s.jsxs)("ul",{className:"space-y-1 text-sm text-blue-800",children:[(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"1차 결제 (지금)"}),": 기본 미용 서비스 금액"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("strong",{children:"2차 결제 (추가금 결제)"}),": 미용사가 제안하는 추가 서비스 금액"]})]})})})]}),(0,s.jsxs)(c.Card,{children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsxs)(c.CardTitle,{className:"flex items-center space-x-2",children:[(0,s.jsx)(es.ShieldCheckIcon,{className:"h-5 w-5"}),(0,s.jsx)("span",{children:"약관 동의"})]})}),(0,s.jsx)(c.CardContent,{className:"space-y-4",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(o.Checkbox,{id:"terms",checked:y,onCheckedChange:e=>C(!0===e)}),(0,s.jsxs)("label",{htmlFor:"terms",className:"cursor-pointer text-sm leading-relaxed",children:[(0,s.jsx)("span",{className:"font-medium",children:"이용약관"}),"에 동의합니다. (필수)",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"서비스 이용 조건 및 결제 정책을 확인했습니다."})]})]}),(0,s.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,s.jsx)(o.Checkbox,{id:"privacy",checked:k,onCheckedChange:e=>w(!0===e)}),(0,s.jsxs)("label",{htmlFor:"privacy",className:"cursor-pointer text-sm leading-relaxed",children:[(0,s.jsx)("span",{className:"font-medium",children:"개인정보 처리방침"}),"에 동의합니다. (필수)",(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"text-muted-foreground",children:"개인정보 수집 및 이용에 대한 안내를 확인했습니다."})]})]})]})})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(eN,{services:E.services,couponDiscount:b||void 0,onCouponApply:T,onCouponRemove:()=>{f(null)}}),(0,s.jsx)(c.Card,{children:(0,s.jsxs)(c.CardContent,{className:"pt-6",children:[(0,s.jsx)(d.Button,{onClick:R(F),disabled:!D()||h||S,className:"h-12 w-full text-lg font-semibold",size:"lg",children:h||S?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.LoadingSpinner,{size:"sm",className:"mr-2"}),"결제 처리 중..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(ev.CheckCircleIcon,{className:"mr-2 h-5 w-5"}),"결제하기"]})}),!D()&&(0,s.jsx)("p",{className:"text-muted-foreground mt-3 text-center text-sm",children:"결제 정보를 모두 입력하고 약관에 동의해주세요"}),z&&(0,s.jsxs)("div",{className:"mt-3 rounded bg-red-50 p-2 text-center text-sm text-red-500",children:[z,(0,s.jsx)("button",{onClick:I,className:"ml-2 text-red-700 underline",children:"닫기"})]})]})})]})]})]})}):(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"space-y-4 text-center",children:[(0,s.jsx)(eC.AlertTriangleIcon,{className:"text-muted-foreground mx-auto h-12 w-12"}),(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"예약 정보를 찾을 수 없습니다"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"유효하지 않은 예약이거나 이미 처리된 예약입니다."}),(0,s.jsx)(d.Button,{onClick:()=>u.push("/customer/bookings"),children:"예약 목록으로 돌아가기"})]})})})})}e.s(["default",()=>ew],522524)}]);